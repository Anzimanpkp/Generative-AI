var Or=Object.defineProperty;var Nr=(r,e,t)=>e in r?Or(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var dn=(r,e,t)=>(Nr(r,typeof e!="symbol"?e+"":e,t),t),bn=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var Ye=(r,e,t)=>(bn(r,e,"read from private field"),t?t.call(r):e.get(r)),gt=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},vt=(r,e,t,n)=>(bn(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);var fr=(r,e,t,n)=>({set _(s){vt(r,e,s,t)},get _(){return Ye(r,e,n)}}),Yt=(r,e,t)=>(bn(r,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const stringToByteArray$1=function(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let s=r.charCodeAt(n);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(s=65536+((s&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},byteArrayToString=function(r){const e=[];let t=0,n=0;for(;t<r.length;){const s=r[t++];if(s<128)e[n++]=String.fromCharCode(s);else if(s>191&&s<224){const o=r[t++];e[n++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=r[t++],a=r[t++],l=r[t++],f=((s&7)<<18|(o&63)<<12|(a&63)<<6|l&63)-65536;e[n++]=String.fromCharCode(55296+(f>>10)),e[n++]=String.fromCharCode(56320+(f&1023))}else{const o=r[t++],a=r[t++];e[n++]=String.fromCharCode((s&15)<<12|(o&63)<<6|a&63)}}return e.join("")},base64={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let s=0;s<r.length;s+=3){const o=r[s],a=s+1<r.length,l=a?r[s+1]:0,f=s+2<r.length,d=f?r[s+2]:0,A=o>>2,M=(o&3)<<4|l>>4;let q=(l&15)<<2|d>>6,V=d&63;f||(V=64,a||(q=64)),n.push(t[A],t[M],t[q],t[V])}return n.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(stringToByteArray$1(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):byteArrayToString(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let s=0;s<r.length;){const o=t[r.charAt(s++)],l=s<r.length?t[r.charAt(s)]:0;++s;const d=s<r.length?t[r.charAt(s)]:64;++s;const M=s<r.length?t[r.charAt(s)]:64;if(++s,o==null||l==null||d==null||M==null)throw new DecodeBase64StringError;const q=o<<2|l>>4;if(n.push(q),d!==64){const V=l<<4&240|d>>2;if(n.push(V),M!==64){const g=d<<6&192|M;n.push(g)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class DecodeBase64StringError extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const base64Encode=function(r){const e=stringToByteArray$1(r);return base64.encodeByteArray(e,!0)},base64urlEncodeWithoutPadding=function(r){return base64Encode(r).replace(/\./g,"")},base64Decode=function(r){try{return base64.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getGlobal(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const getDefaultsFromGlobal=()=>getGlobal().__FIREBASE_DEFAULTS__,getDefaultsFromEnvVariable=()=>{if(typeof process>"u"||typeof process.env>"u")return;const r={}.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},getDefaultsFromCookie=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=r&&base64Decode(r[1]);return e&&JSON.parse(e)},getDefaults=()=>{try{return getDefaultsFromGlobal()||getDefaultsFromEnvVariable()||getDefaultsFromCookie()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},getDefaultEmulatorHost=r=>{var e,t;return(t=(e=getDefaults())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[r]},getDefaultEmulatorHostnameAndPort=r=>{const e=getDefaultEmulatorHost(r);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},getDefaultAppConfig=()=>{var r;return(r=getDefaults())===null||r===void 0?void 0:r.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Deferred{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function createMockUserToken(r,e){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",s=r.iat||0,o=r.sub||r.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},r),l="";return[base64urlEncodeWithoutPadding(JSON.stringify(t)),base64urlEncodeWithoutPadding(JSON.stringify(a)),l].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getUA(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function isNode(){var r;const e=(r=getDefaults())===null||r===void 0?void 0:r.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function isSafari(){return!isNode()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function isIndexedDBAvailable(){try{return typeof indexedDB=="object"}catch{return!1}}function validateIndexedDBOpenable(){return new Promise((r,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(n),r(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var o;e(((o=s.error)===null||o===void 0?void 0:o.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ERROR_NAME="FirebaseError";class FirebaseError extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=ERROR_NAME,Object.setPrototypeOf(this,FirebaseError.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ErrorFactory.prototype.create)}}class ErrorFactory{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?replaceTemplate(o,n):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new FirebaseError(s,l,n)}}function replaceTemplate(r,e){return r.replace(PATTERN,(t,n)=>{const s=e[n];return s!=null?String(s):`<${n}?>`})}const PATTERN=/\{\$([^}]+)}/g;function deepEqual(r,e){if(r===e)return!0;const t=Object.keys(r),n=Object.keys(e);for(const s of t){if(!n.includes(s))return!1;const o=r[s],a=e[s];if(isObject(o)&&isObject(a)){if(!deepEqual(o,a))return!1}else if(o!==a)return!1}for(const s of n)if(!t.includes(s))return!1;return!0}function isObject(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getModularInstance(r){return r&&r._delegate?r._delegate:r}class Component{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ENTRY_NAME$1="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Provider{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new Deferred;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&n.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(o){if(s)return null;throw o}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(isComponentEager(e))try{this.getOrInitializeService({instanceIdentifier:DEFAULT_ENTRY_NAME$1})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:s});n.resolve(o)}catch{}}}}clearInstance(e=DEFAULT_ENTRY_NAME$1){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=DEFAULT_ENTRY_NAME$1){return this.instances.has(e)}getOptions(e=DEFAULT_ENTRY_NAME$1){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[o,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(o);n===l&&a.resolve(s)}return s}onInit(e,t){var n;const s=this.normalizeInstanceIdentifier(t),o=(n=this.onInitCallbacks.get(s))!==null&&n!==void 0?n:new Set;o.add(e),this.onInitCallbacks.set(s,o);const a=this.instances.get(s);return a&&e(a,s),()=>{o.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const s of n)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:normalizeIdentifierForFactory(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=DEFAULT_ENTRY_NAME$1){return this.component?this.component.multipleInstances?e:DEFAULT_ENTRY_NAME$1:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function normalizeIdentifierForFactory(r){return r===DEFAULT_ENTRY_NAME$1?void 0:r}function isComponentEager(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ComponentContainer{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Provider(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var LogLevel;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(LogLevel||(LogLevel={}));const levelStringToEnum={debug:LogLevel.DEBUG,verbose:LogLevel.VERBOSE,info:LogLevel.INFO,warn:LogLevel.WARN,error:LogLevel.ERROR,silent:LogLevel.SILENT},defaultLogLevel=LogLevel.INFO,ConsoleMethod={[LogLevel.DEBUG]:"log",[LogLevel.VERBOSE]:"log",[LogLevel.INFO]:"info",[LogLevel.WARN]:"warn",[LogLevel.ERROR]:"error"},defaultLogHandler=(r,e,...t)=>{if(e<r.logLevel)return;const n=new Date().toISOString(),s=ConsoleMethod[e];if(s)console[s](`[${n}]  ${r.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Logger{constructor(e){this.name=e,this._logLevel=defaultLogLevel,this._logHandler=defaultLogHandler,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in LogLevel))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?levelStringToEnum[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.DEBUG,...e),this._logHandler(this,LogLevel.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.VERBOSE,...e),this._logHandler(this,LogLevel.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.INFO,...e),this._logHandler(this,LogLevel.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.WARN,...e),this._logHandler(this,LogLevel.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.ERROR,...e),this._logHandler(this,LogLevel.ERROR,...e)}}const instanceOfAny=(r,e)=>e.some(t=>r instanceof t);let idbProxyableTypes,cursorAdvanceMethods;function getIdbProxyableTypes(){return idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const cursorRequestMap=new WeakMap,transactionDoneMap=new WeakMap,transactionStoreNamesMap=new WeakMap,transformCache=new WeakMap,reverseTransformCache=new WeakMap;function promisifyRequest(r){const e=new Promise((t,n)=>{const s=()=>{r.removeEventListener("success",o),r.removeEventListener("error",a)},o=()=>{t(wrap(r.result)),s()},a=()=>{n(r.error),s()};r.addEventListener("success",o),r.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&cursorRequestMap.set(t,r)}).catch(()=>{}),reverseTransformCache.set(e,r),e}function cacheDonePromiseForTransaction(r){if(transactionDoneMap.has(r))return;const e=new Promise((t,n)=>{const s=()=>{r.removeEventListener("complete",o),r.removeEventListener("error",a),r.removeEventListener("abort",a)},o=()=>{t(),s()},a=()=>{n(r.error||new DOMException("AbortError","AbortError")),s()};r.addEventListener("complete",o),r.addEventListener("error",a),r.addEventListener("abort",a)});transactionDoneMap.set(r,e)}let idbProxyTraps={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return transactionDoneMap.get(r);if(e==="objectStoreNames")return r.objectStoreNames||transactionStoreNamesMap.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return wrap(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function replaceTraps(r){idbProxyTraps=r(idbProxyTraps)}function wrapFunction(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=r.call(unwrap(this),e,...t);return transactionStoreNamesMap.set(n,e.sort?e.sort():[e]),wrap(n)}:getCursorAdvanceMethods().includes(r)?function(...e){return r.apply(unwrap(this),e),wrap(cursorRequestMap.get(this))}:function(...e){return wrap(r.apply(unwrap(this),e))}}function transformCachableValue(r){return typeof r=="function"?wrapFunction(r):(r instanceof IDBTransaction&&cacheDonePromiseForTransaction(r),instanceOfAny(r,getIdbProxyableTypes())?new Proxy(r,idbProxyTraps):r)}function wrap(r){if(r instanceof IDBRequest)return promisifyRequest(r);if(transformCache.has(r))return transformCache.get(r);const e=transformCachableValue(r);return e!==r&&(transformCache.set(r,e),reverseTransformCache.set(e,r)),e}const unwrap=r=>reverseTransformCache.get(r);function openDB(r,e,{blocked:t,upgrade:n,blocking:s,terminated:o}={}){const a=indexedDB.open(r,e),l=wrap(a);return n&&a.addEventListener("upgradeneeded",f=>{n(wrap(a.result),f.oldVersion,f.newVersion,wrap(a.transaction),f)}),t&&a.addEventListener("blocked",f=>t(f.oldVersion,f.newVersion,f)),l.then(f=>{o&&f.addEventListener("close",()=>o()),s&&f.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const readMethods=["get","getKey","getAll","getAllKeys","count"],writeMethods=["put","add","delete","clear"],cachedMethods=new Map;function getMethod(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(cachedMethods.get(e))return cachedMethods.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,s=writeMethods.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(s||readMethods.includes(t)))return;const o=async function(a,...l){const f=this.transaction(a,s?"readwrite":"readonly");let d=f.store;return n&&(d=d.index(l.shift())),(await Promise.all([d[t](...l),s&&f.done]))[0]};return cachedMethods.set(e,o),o}replaceTraps(r=>({...r,get:(e,t,n)=>getMethod(e,t)||r.get(e,t,n),has:(e,t)=>!!getMethod(e,t)||r.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PlatformLoggerServiceImpl{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(isVersionServiceProvider(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function isVersionServiceProvider(r){const e=r.getComponent();return(e==null?void 0:e.type)==="VERSION"}const name$q="@firebase/app",version$1$1="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const logger=new Logger("@firebase/app"),name$p="@firebase/app-compat",name$o="@firebase/analytics-compat",name$n="@firebase/analytics",name$m="@firebase/app-check-compat",name$l="@firebase/app-check",name$k="@firebase/auth",name$j="@firebase/auth-compat",name$i="@firebase/database",name$h="@firebase/data-connect",name$g="@firebase/database-compat",name$f="@firebase/functions",name$e="@firebase/functions-compat",name$d="@firebase/installations",name$c="@firebase/installations-compat",name$b="@firebase/messaging",name$a="@firebase/messaging-compat",name$9="@firebase/performance",name$8="@firebase/performance-compat",name$7="@firebase/remote-config",name$6="@firebase/remote-config-compat",name$5="@firebase/storage",name$4="@firebase/storage-compat",name$3="@firebase/firestore",name$2="@firebase/vertexai-preview",name$1$1="@firebase/firestore-compat",name$r="firebase",version$2="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ENTRY_NAME="[DEFAULT]",PLATFORM_LOG_STRING={[name$q]:"fire-core",[name$p]:"fire-core-compat",[name$n]:"fire-analytics",[name$o]:"fire-analytics-compat",[name$l]:"fire-app-check",[name$m]:"fire-app-check-compat",[name$k]:"fire-auth",[name$j]:"fire-auth-compat",[name$i]:"fire-rtdb",[name$h]:"fire-data-connect",[name$g]:"fire-rtdb-compat",[name$f]:"fire-fn",[name$e]:"fire-fn-compat",[name$d]:"fire-iid",[name$c]:"fire-iid-compat",[name$b]:"fire-fcm",[name$a]:"fire-fcm-compat",[name$9]:"fire-perf",[name$8]:"fire-perf-compat",[name$7]:"fire-rc",[name$6]:"fire-rc-compat",[name$5]:"fire-gcs",[name$4]:"fire-gcs-compat",[name$3]:"fire-fst",[name$1$1]:"fire-fst-compat",[name$2]:"fire-vertex","fire-js":"fire-js",[name$r]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _apps=new Map,_serverApps=new Map,_components=new Map;function _addComponent(r,e){try{r.container.addComponent(e)}catch(t){logger.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,t)}}function _registerComponent(r){const e=r.name;if(_components.has(e))return logger.debug(`There were multiple attempts to register component ${e}.`),!1;_components.set(e,r);for(const t of _apps.values())_addComponent(t,r);for(const t of _serverApps.values())_addComponent(t,r);return!0}function _getProvider(r,e){const t=r.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),r.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ERRORS={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ERROR_FACTORY=new ErrorFactory("app","Firebase",ERRORS);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FirebaseAppImpl{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Component("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ERROR_FACTORY.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SDK_VERSION=version$2;function initializeApp(r,e={}){let t=r;typeof e!="object"&&(e={name:e});const n=Object.assign({name:DEFAULT_ENTRY_NAME,automaticDataCollectionEnabled:!1},e),s=n.name;if(typeof s!="string"||!s)throw ERROR_FACTORY.create("bad-app-name",{appName:String(s)});if(t||(t=getDefaultAppConfig()),!t)throw ERROR_FACTORY.create("no-options");const o=_apps.get(s);if(o){if(deepEqual(t,o.options)&&deepEqual(n,o.config))return o;throw ERROR_FACTORY.create("duplicate-app",{appName:s})}const a=new ComponentContainer(s);for(const f of _components.values())a.addComponent(f);const l=new FirebaseAppImpl(t,n,a);return _apps.set(s,l),l}function getApp(r=DEFAULT_ENTRY_NAME){const e=_apps.get(r);if(!e&&r===DEFAULT_ENTRY_NAME&&getDefaultAppConfig())return initializeApp();if(!e)throw ERROR_FACTORY.create("no-app",{appName:r});return e}function registerVersion(r,e,t){var n;let s=(n=PLATFORM_LOG_STRING[r])!==null&&n!==void 0?n:r;t&&(s+=`-${t}`);const o=s.match(/\s|\//),a=e.match(/\s|\//);if(o||a){const l=[`Unable to register library "${s}" with version "${e}":`];o&&l.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&a&&l.push("and"),a&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),logger.warn(l.join(" "));return}_registerComponent(new Component(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DB_NAME="firebase-heartbeat-database",DB_VERSION=1,STORE_NAME="firebase-heartbeat-store";let dbPromise=null;function getDbPromise(){return dbPromise||(dbPromise=openDB(DB_NAME,DB_VERSION,{upgrade:(r,e)=>{switch(e){case 0:try{r.createObjectStore(STORE_NAME)}catch(t){console.warn(t)}}}}).catch(r=>{throw ERROR_FACTORY.create("idb-open",{originalErrorMessage:r.message})})),dbPromise}async function readHeartbeatsFromIndexedDB(r){try{const t=(await getDbPromise()).transaction(STORE_NAME),n=await t.objectStore(STORE_NAME).get(computeKey(r));return await t.done,n}catch(e){if(e instanceof FirebaseError)logger.warn(e.message);else{const t=ERROR_FACTORY.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});logger.warn(t.message)}}}async function writeHeartbeatsToIndexedDB(r,e){try{const n=(await getDbPromise()).transaction(STORE_NAME,"readwrite");await n.objectStore(STORE_NAME).put(e,computeKey(r)),await n.done}catch(t){if(t instanceof FirebaseError)logger.warn(t.message);else{const n=ERROR_FACTORY.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});logger.warn(n.message)}}}function computeKey(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MAX_HEADER_BYTES=1024,STORED_HEARTBEAT_RETENTION_MAX_MILLIS=30*24*60*60*1e3;class HeartbeatServiceImpl{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new HeartbeatStorageImpl(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=getUTCDateString();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(a=>a.date===o)?void 0:(this._heartbeatsCache.heartbeats.push({date:o,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{const l=new Date(a.date).valueOf();return Date.now()-l<=STORED_HEARTBEAT_RETENTION_MAX_MILLIS}),this._storage.overwrite(this._heartbeatsCache))}catch(n){logger.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=getUTCDateString(),{heartbeatsToSend:n,unsentEntries:s}=extractHeartbeatsForHeader(this._heartbeatsCache.heartbeats),o=base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(t){return logger.warn(t),""}}}function getUTCDateString(){return new Date().toISOString().substring(0,10)}function extractHeartbeatsForHeader(r,e=MAX_HEADER_BYTES){const t=[];let n=r.slice();for(const s of r){const o=t.find(a=>a.agent===s.agent);if(o){if(o.dates.push(s.date),countBytes(t)>e){o.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),countBytes(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class HeartbeatStorageImpl{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return isIndexedDBAvailable()?validateIndexedDBOpenable().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await readHeartbeatsFromIndexedDB(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function countBytes(r){return base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:r})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function registerCoreComponents(r){_registerComponent(new Component("platform-logger",e=>new PlatformLoggerServiceImpl(e),"PRIVATE")),_registerComponent(new Component("heartbeat",e=>new HeartbeatServiceImpl(e),"PRIVATE")),registerVersion(name$q,version$1$1,r),registerVersion(name$q,version$1$1,"esm2017"),registerVersion("fire-js","")}registerCoreComponents("");var name$1="firebase",version$1="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */registerVersion(name$1,version$1,"app");const firebaseConfig={apiKey:"AIzaSyAdR7PMFtItemrhImP2JHkl9zrIiOZJ2pI",authDomain:"fir-ai-7399c.firebaseapp.com",databaseURL:"https://fir-ai-7399c-default-rtdb.firebaseio.com",projectId:"fir-ai-7399c",storageBucket:"fir-ai-7399c.firebasestorage.app",messagingSenderId:"63800475370",appId:"1:63800475370:web:8e02295929255da43fe193"};var commonjsGlobal$2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Integer,Md5;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(U,h){function _(){}_.prototype=h.prototype,U.D=h.prototype,U.prototype=new _,U.prototype.constructor=U,U.C=function(E,x,P){for(var k=Array(arguments.length-2),Q=2;Q<arguments.length;Q++)k[Q-2]=arguments[Q];return h.prototype[x].apply(E,k)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(U,h,_){_||(_=0);var E=Array(16);if(typeof h=="string")for(var x=0;16>x;++x)E[x]=h.charCodeAt(_++)|h.charCodeAt(_++)<<8|h.charCodeAt(_++)<<16|h.charCodeAt(_++)<<24;else for(x=0;16>x;++x)E[x]=h[_++]|h[_++]<<8|h[_++]<<16|h[_++]<<24;h=U.g[0],_=U.g[1],x=U.g[2];var P=U.g[3],k=h+(P^_&(x^P))+E[0]+3614090360&4294967295;h=_+(k<<7&4294967295|k>>>25),k=P+(x^h&(_^x))+E[1]+3905402710&4294967295,P=h+(k<<12&4294967295|k>>>20),k=x+(_^P&(h^_))+E[2]+606105819&4294967295,x=P+(k<<17&4294967295|k>>>15),k=_+(h^x&(P^h))+E[3]+3250441966&4294967295,_=x+(k<<22&4294967295|k>>>10),k=h+(P^_&(x^P))+E[4]+4118548399&4294967295,h=_+(k<<7&4294967295|k>>>25),k=P+(x^h&(_^x))+E[5]+1200080426&4294967295,P=h+(k<<12&4294967295|k>>>20),k=x+(_^P&(h^_))+E[6]+2821735955&4294967295,x=P+(k<<17&4294967295|k>>>15),k=_+(h^x&(P^h))+E[7]+4249261313&4294967295,_=x+(k<<22&4294967295|k>>>10),k=h+(P^_&(x^P))+E[8]+1770035416&4294967295,h=_+(k<<7&4294967295|k>>>25),k=P+(x^h&(_^x))+E[9]+2336552879&4294967295,P=h+(k<<12&4294967295|k>>>20),k=x+(_^P&(h^_))+E[10]+4294925233&4294967295,x=P+(k<<17&4294967295|k>>>15),k=_+(h^x&(P^h))+E[11]+2304563134&4294967295,_=x+(k<<22&4294967295|k>>>10),k=h+(P^_&(x^P))+E[12]+1804603682&4294967295,h=_+(k<<7&4294967295|k>>>25),k=P+(x^h&(_^x))+E[13]+4254626195&4294967295,P=h+(k<<12&4294967295|k>>>20),k=x+(_^P&(h^_))+E[14]+2792965006&4294967295,x=P+(k<<17&4294967295|k>>>15),k=_+(h^x&(P^h))+E[15]+1236535329&4294967295,_=x+(k<<22&4294967295|k>>>10),k=h+(x^P&(_^x))+E[1]+4129170786&4294967295,h=_+(k<<5&4294967295|k>>>27),k=P+(_^x&(h^_))+E[6]+3225465664&4294967295,P=h+(k<<9&4294967295|k>>>23),k=x+(h^_&(P^h))+E[11]+643717713&4294967295,x=P+(k<<14&4294967295|k>>>18),k=_+(P^h&(x^P))+E[0]+3921069994&4294967295,_=x+(k<<20&4294967295|k>>>12),k=h+(x^P&(_^x))+E[5]+3593408605&4294967295,h=_+(k<<5&4294967295|k>>>27),k=P+(_^x&(h^_))+E[10]+38016083&4294967295,P=h+(k<<9&4294967295|k>>>23),k=x+(h^_&(P^h))+E[15]+3634488961&4294967295,x=P+(k<<14&4294967295|k>>>18),k=_+(P^h&(x^P))+E[4]+3889429448&4294967295,_=x+(k<<20&4294967295|k>>>12),k=h+(x^P&(_^x))+E[9]+568446438&4294967295,h=_+(k<<5&4294967295|k>>>27),k=P+(_^x&(h^_))+E[14]+3275163606&4294967295,P=h+(k<<9&4294967295|k>>>23),k=x+(h^_&(P^h))+E[3]+4107603335&4294967295,x=P+(k<<14&4294967295|k>>>18),k=_+(P^h&(x^P))+E[8]+1163531501&4294967295,_=x+(k<<20&4294967295|k>>>12),k=h+(x^P&(_^x))+E[13]+2850285829&4294967295,h=_+(k<<5&4294967295|k>>>27),k=P+(_^x&(h^_))+E[2]+4243563512&4294967295,P=h+(k<<9&4294967295|k>>>23),k=x+(h^_&(P^h))+E[7]+1735328473&4294967295,x=P+(k<<14&4294967295|k>>>18),k=_+(P^h&(x^P))+E[12]+2368359562&4294967295,_=x+(k<<20&4294967295|k>>>12),k=h+(_^x^P)+E[5]+4294588738&4294967295,h=_+(k<<4&4294967295|k>>>28),k=P+(h^_^x)+E[8]+2272392833&4294967295,P=h+(k<<11&4294967295|k>>>21),k=x+(P^h^_)+E[11]+1839030562&4294967295,x=P+(k<<16&4294967295|k>>>16),k=_+(x^P^h)+E[14]+4259657740&4294967295,_=x+(k<<23&4294967295|k>>>9),k=h+(_^x^P)+E[1]+2763975236&4294967295,h=_+(k<<4&4294967295|k>>>28),k=P+(h^_^x)+E[4]+1272893353&4294967295,P=h+(k<<11&4294967295|k>>>21),k=x+(P^h^_)+E[7]+4139469664&4294967295,x=P+(k<<16&4294967295|k>>>16),k=_+(x^P^h)+E[10]+3200236656&4294967295,_=x+(k<<23&4294967295|k>>>9),k=h+(_^x^P)+E[13]+681279174&4294967295,h=_+(k<<4&4294967295|k>>>28),k=P+(h^_^x)+E[0]+3936430074&4294967295,P=h+(k<<11&4294967295|k>>>21),k=x+(P^h^_)+E[3]+3572445317&4294967295,x=P+(k<<16&4294967295|k>>>16),k=_+(x^P^h)+E[6]+76029189&4294967295,_=x+(k<<23&4294967295|k>>>9),k=h+(_^x^P)+E[9]+3654602809&4294967295,h=_+(k<<4&4294967295|k>>>28),k=P+(h^_^x)+E[12]+3873151461&4294967295,P=h+(k<<11&4294967295|k>>>21),k=x+(P^h^_)+E[15]+530742520&4294967295,x=P+(k<<16&4294967295|k>>>16),k=_+(x^P^h)+E[2]+3299628645&4294967295,_=x+(k<<23&4294967295|k>>>9),k=h+(x^(_|~P))+E[0]+4096336452&4294967295,h=_+(k<<6&4294967295|k>>>26),k=P+(_^(h|~x))+E[7]+1126891415&4294967295,P=h+(k<<10&4294967295|k>>>22),k=x+(h^(P|~_))+E[14]+2878612391&4294967295,x=P+(k<<15&4294967295|k>>>17),k=_+(P^(x|~h))+E[5]+4237533241&4294967295,_=x+(k<<21&4294967295|k>>>11),k=h+(x^(_|~P))+E[12]+1700485571&4294967295,h=_+(k<<6&4294967295|k>>>26),k=P+(_^(h|~x))+E[3]+2399980690&4294967295,P=h+(k<<10&4294967295|k>>>22),k=x+(h^(P|~_))+E[10]+4293915773&4294967295,x=P+(k<<15&4294967295|k>>>17),k=_+(P^(x|~h))+E[1]+2240044497&4294967295,_=x+(k<<21&4294967295|k>>>11),k=h+(x^(_|~P))+E[8]+1873313359&4294967295,h=_+(k<<6&4294967295|k>>>26),k=P+(_^(h|~x))+E[15]+4264355552&4294967295,P=h+(k<<10&4294967295|k>>>22),k=x+(h^(P|~_))+E[6]+2734768916&4294967295,x=P+(k<<15&4294967295|k>>>17),k=_+(P^(x|~h))+E[13]+1309151649&4294967295,_=x+(k<<21&4294967295|k>>>11),k=h+(x^(_|~P))+E[4]+4149444226&4294967295,h=_+(k<<6&4294967295|k>>>26),k=P+(_^(h|~x))+E[11]+3174756917&4294967295,P=h+(k<<10&4294967295|k>>>22),k=x+(h^(P|~_))+E[2]+718787259&4294967295,x=P+(k<<15&4294967295|k>>>17),k=_+(P^(x|~h))+E[9]+3951481745&4294967295,U.g[0]=U.g[0]+h&4294967295,U.g[1]=U.g[1]+(x+(k<<21&4294967295|k>>>11))&4294967295,U.g[2]=U.g[2]+x&4294967295,U.g[3]=U.g[3]+P&4294967295}n.prototype.u=function(U,h){h===void 0&&(h=U.length);for(var _=h-this.blockSize,E=this.B,x=this.h,P=0;P<h;){if(x==0)for(;P<=_;)s(this,U,P),P+=this.blockSize;if(typeof U=="string"){for(;P<h;)if(E[x++]=U.charCodeAt(P++),x==this.blockSize){s(this,E),x=0;break}}else for(;P<h;)if(E[x++]=U[P++],x==this.blockSize){s(this,E),x=0;break}}this.h=x,this.o+=h},n.prototype.v=function(){var U=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);U[0]=128;for(var h=1;h<U.length-8;++h)U[h]=0;var _=8*this.o;for(h=U.length-8;h<U.length;++h)U[h]=_&255,_/=256;for(this.u(U),U=Array(16),h=_=0;4>h;++h)for(var E=0;32>E;E+=8)U[_++]=this.g[h]>>>E&255;return U};function o(U,h){var _=l;return Object.prototype.hasOwnProperty.call(_,U)?_[U]:_[U]=h(U)}function a(U,h){this.h=h;for(var _=[],E=!0,x=U.length-1;0<=x;x--){var P=U[x]|0;E&&P==h||(_[x]=P,E=!1)}this.g=_}var l={};function f(U){return-128<=U&&128>U?o(U,function(h){return new a([h|0],0>h?-1:0)}):new a([U|0],0>U?-1:0)}function d(U){if(isNaN(U)||!isFinite(U))return M;if(0>U)return I(d(-U));for(var h=[],_=1,E=0;U>=_;E++)h[E]=U/_|0,_*=4294967296;return new a(h,0)}function A(U,h){if(U.length==0)throw Error("number format error: empty string");if(h=h||10,2>h||36<h)throw Error("radix out of range: "+h);if(U.charAt(0)=="-")return I(A(U.substring(1),h));if(0<=U.indexOf("-"))throw Error('number format error: interior "-" character');for(var _=d(Math.pow(h,8)),E=M,x=0;x<U.length;x+=8){var P=Math.min(8,U.length-x),k=parseInt(U.substring(x,x+P),h);8>P?(P=d(Math.pow(h,P)),E=E.j(P).add(d(k))):(E=E.j(_),E=E.add(d(k)))}return E}var M=f(0),q=f(1),V=f(16777216);r=a.prototype,r.m=function(){if(F(this))return-I(this).m();for(var U=0,h=1,_=0;_<this.g.length;_++){var E=this.i(_);U+=(0<=E?E:4294967296+E)*h,h*=4294967296}return U},r.toString=function(U){if(U=U||10,2>U||36<U)throw Error("radix out of range: "+U);if(g(this))return"0";if(F(this))return"-"+I(this).toString(U);for(var h=d(Math.pow(U,6)),_=this,E="";;){var x=H(_,h).g;_=j(_,x.j(h));var P=((0<_.g.length?_.g[0]:_.h)>>>0).toString(U);if(_=x,g(_))return P+E;for(;6>P.length;)P="0"+P;E=P+E}},r.i=function(U){return 0>U?0:U<this.g.length?this.g[U]:this.h};function g(U){if(U.h!=0)return!1;for(var h=0;h<U.g.length;h++)if(U.g[h]!=0)return!1;return!0}function F(U){return U.h==-1}r.l=function(U){return U=j(this,U),F(U)?-1:g(U)?0:1};function I(U){for(var h=U.g.length,_=[],E=0;E<h;E++)_[E]=~U.g[E];return new a(_,~U.h).add(q)}r.abs=function(){return F(this)?I(this):this},r.add=function(U){for(var h=Math.max(this.g.length,U.g.length),_=[],E=0,x=0;x<=h;x++){var P=E+(this.i(x)&65535)+(U.i(x)&65535),k=(P>>>16)+(this.i(x)>>>16)+(U.i(x)>>>16);E=k>>>16,P&=65535,k&=65535,_[x]=k<<16|P}return new a(_,_[_.length-1]&-2147483648?-1:0)};function j(U,h){return U.add(I(h))}r.j=function(U){if(g(this)||g(U))return M;if(F(this))return F(U)?I(this).j(I(U)):I(I(this).j(U));if(F(U))return I(this.j(I(U)));if(0>this.l(V)&&0>U.l(V))return d(this.m()*U.m());for(var h=this.g.length+U.g.length,_=[],E=0;E<2*h;E++)_[E]=0;for(E=0;E<this.g.length;E++)for(var x=0;x<U.g.length;x++){var P=this.i(E)>>>16,k=this.i(E)&65535,Q=U.i(x)>>>16,Ce=U.i(x)&65535;_[2*E+2*x]+=k*Ce,G(_,2*E+2*x),_[2*E+2*x+1]+=P*Ce,G(_,2*E+2*x+1),_[2*E+2*x+1]+=k*Q,G(_,2*E+2*x+1),_[2*E+2*x+2]+=P*Q,G(_,2*E+2*x+2)}for(E=0;E<h;E++)_[E]=_[2*E+1]<<16|_[2*E];for(E=h;E<2*h;E++)_[E]=0;return new a(_,0)};function G(U,h){for(;(U[h]&65535)!=U[h];)U[h+1]+=U[h]>>>16,U[h]&=65535,h++}function O(U,h){this.g=U,this.h=h}function H(U,h){if(g(h))throw Error("division by zero");if(g(U))return new O(M,M);if(F(U))return h=H(I(U),h),new O(I(h.g),I(h.h));if(F(h))return h=H(U,I(h)),new O(I(h.g),h.h);if(30<U.g.length){if(F(U)||F(h))throw Error("slowDivide_ only works with positive integers.");for(var _=q,E=h;0>=E.l(U);)_=K(_),E=K(E);var x=Y(_,1),P=Y(E,1);for(E=Y(E,2),_=Y(_,2);!g(E);){var k=P.add(E);0>=k.l(U)&&(x=x.add(_),P=k),E=Y(E,1),_=Y(_,1)}return h=j(U,x.j(h)),new O(x,h)}for(x=M;0<=U.l(h);){for(_=Math.max(1,Math.floor(U.m()/h.m())),E=Math.ceil(Math.log(_)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),P=d(_),k=P.j(h);F(k)||0<k.l(U);)_-=E,P=d(_),k=P.j(h);g(P)&&(P=q),x=x.add(P),U=j(U,k)}return new O(x,U)}r.A=function(U){return H(this,U).h},r.and=function(U){for(var h=Math.max(this.g.length,U.g.length),_=[],E=0;E<h;E++)_[E]=this.i(E)&U.i(E);return new a(_,this.h&U.h)},r.or=function(U){for(var h=Math.max(this.g.length,U.g.length),_=[],E=0;E<h;E++)_[E]=this.i(E)|U.i(E);return new a(_,this.h|U.h)},r.xor=function(U){for(var h=Math.max(this.g.length,U.g.length),_=[],E=0;E<h;E++)_[E]=this.i(E)^U.i(E);return new a(_,this.h^U.h)};function K(U){for(var h=U.g.length+1,_=[],E=0;E<h;E++)_[E]=U.i(E)<<1|U.i(E-1)>>>31;return new a(_,U.h)}function Y(U,h){var _=h>>5;h%=32;for(var E=U.g.length-_,x=[],P=0;P<E;P++)x[P]=0<h?U.i(P+_)>>>h|U.i(P+_+1)<<32-h:U.i(P+_);return new a(x,U.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=A,Integer=a}).apply(typeof commonjsGlobal$2<"u"?commonjsGlobal$2:typeof self<"u"?self:typeof window<"u"?window:{});var commonjsGlobal$1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var XhrIo,WebChannel,EventType,ErrorCode,Stat,Event$1,getStatEventTarget,createWebChannelTransport;(function(){var r,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(i,u,y){return i==Array.prototype||i==Object.prototype||(i[u]=y.value),i};function t(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof commonjsGlobal$1=="object"&&commonjsGlobal$1];for(var u=0;u<i.length;++u){var y=i[u];if(y&&y.Math==Math)return y}throw Error("Cannot find global object")}var n=t(this);function s(i,u){if(u)e:{var y=n;i=i.split(".");for(var $=0;$<i.length-1;$++){var Ae=i[$];if(!(Ae in y))break e;y=y[Ae]}i=i[i.length-1],$=y[i],u=u($),u!=$&&u!=null&&e(y,i,{configurable:!0,writable:!0,value:u})}}function o(i,u){i instanceof String&&(i+="");var y=0,$=!1,Ae={next:function(){if(!$&&y<i.length){var Re=y++;return{value:u(Re,i[Re]),done:!1}}return $=!0,{done:!0,value:void 0}}};return Ae[Symbol.iterator]=function(){return Ae},Ae}s("Array.prototype.values",function(i){return i||function(){return o(this,function(u,y){return y})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},l=this||self;function f(i){var u=typeof i;return u=u!="object"?u:i?Array.isArray(i)?"array":u:"null",u=="array"||u=="object"&&typeof i.length=="number"}function d(i){var u=typeof i;return u=="object"&&i!=null||u=="function"}function A(i,u,y){return i.call.apply(i.bind,arguments)}function M(i,u,y){if(!i)throw Error();if(2<arguments.length){var $=Array.prototype.slice.call(arguments,2);return function(){var Ae=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Ae,$),i.apply(u,Ae)}}return function(){return i.apply(u,arguments)}}function q(i,u,y){return q=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?A:M,q.apply(null,arguments)}function V(i,u){var y=Array.prototype.slice.call(arguments,1);return function(){var $=y.slice();return $.push.apply($,arguments),i.apply(this,$)}}function g(i,u){function y(){}y.prototype=u.prototype,i.aa=u.prototype,i.prototype=new y,i.prototype.constructor=i,i.Qb=function($,Ae,Re){for(var Be=Array(arguments.length-2),Je=2;Je<arguments.length;Je++)Be[Je-2]=arguments[Je];return u.prototype[Ae].apply($,Be)}}function F(i){const u=i.length;if(0<u){const y=Array(u);for(let $=0;$<u;$++)y[$]=i[$];return y}return[]}function I(i,u){for(let y=1;y<arguments.length;y++){const $=arguments[y];if(f($)){const Ae=i.length||0,Re=$.length||0;i.length=Ae+Re;for(let Be=0;Be<Re;Be++)i[Ae+Be]=$[Be]}else i.push($)}}class j{constructor(u,y){this.i=u,this.j=y,this.h=0,this.g=null}get(){let u;return 0<this.h?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function G(i){return/^[\s\xa0]*$/.test(i)}function O(){var i=l.navigator;return i&&(i=i.userAgent)?i:""}function H(i){return H[" "](i),i}H[" "]=function(){};var K=O().indexOf("Gecko")!=-1&&!(O().toLowerCase().indexOf("webkit")!=-1&&O().indexOf("Edge")==-1)&&!(O().indexOf("Trident")!=-1||O().indexOf("MSIE")!=-1)&&O().indexOf("Edge")==-1;function Y(i,u,y){for(const $ in i)u.call(y,i[$],$,i)}function U(i,u){for(const y in i)u.call(void 0,i[y],y,i)}function h(i){const u={};for(const y in i)u[y]=i[y];return u}const _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(i,u){let y,$;for(let Ae=1;Ae<arguments.length;Ae++){$=arguments[Ae];for(y in $)i[y]=$[y];for(let Re=0;Re<_.length;Re++)y=_[Re],Object.prototype.hasOwnProperty.call($,y)&&(i[y]=$[y])}}function x(i){var u=1;i=i.split(":");const y=[];for(;0<u&&i.length;)y.push(i.shift()),u--;return i.length&&y.push(i.join(":")),y}function P(i){l.setTimeout(()=>{throw i},0)}function k(){var i=Ve;let u=null;return i.g&&(u=i.g,i.g=i.g.next,i.g||(i.h=null),u.next=null),u}class Q{constructor(){this.h=this.g=null}add(u,y){const $=Ce.get();$.set(u,y),this.h?this.h.next=$:this.g=$,this.h=$}}var Ce=new j(()=>new Oe,i=>i.reset());class Oe{constructor(){this.next=this.g=this.h=null}set(u,y){this.h=u,this.g=y,this.next=null}reset(){this.next=this.g=this.h=null}}let Se,Fe=!1,Ve=new Q,Le=()=>{const i=l.Promise.resolve(void 0);Se=()=>{i.then(W)}};var W=()=>{for(var i;i=k();){try{i.h.call(i.g)}catch(y){P(y)}var u=Ce;u.j(i),100>u.h&&(u.h++,i.next=u.g,u.g=i)}Fe=!1};function T(){this.s=this.s,this.C=this.C}T.prototype.s=!1,T.prototype.ma=function(){this.s||(this.s=!0,this.N())},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function m(i,u){this.type=i,this.g=this.target=u,this.defaultPrevented=!1}m.prototype.h=function(){this.defaultPrevented=!0};var B=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var i=!1,u=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const y=()=>{};l.addEventListener("test",y,u),l.removeEventListener("test",y,u)}catch{}return i}();function c(i,u){if(m.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i){var y=this.type=i.type,$=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;if(this.target=i.target||i.srcElement,this.g=u,u=i.relatedTarget){if(K){e:{try{H(u.nodeName);var Ae=!0;break e}catch{}Ae=!1}Ae||(u=null)}}else y=="mouseover"?u=i.fromElement:y=="mouseout"&&(u=i.toElement);this.relatedTarget=u,$?(this.clientX=$.clientX!==void 0?$.clientX:$.pageX,this.clientY=$.clientY!==void 0?$.clientY:$.pageY,this.screenX=$.screenX||0,this.screenY=$.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=typeof i.pointerType=="string"?i.pointerType:p[i.pointerType]||"",this.state=i.state,this.i=i,i.defaultPrevented&&c.aa.h.call(this)}}g(c,m);var p={2:"touch",3:"pen",4:"mouse"};c.prototype.h=function(){c.aa.h.call(this);var i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var R="closure_listenable_"+(1e6*Math.random()|0),L=0;function N(i,u,y,$,Ae){this.listener=i,this.proxy=null,this.src=u,this.type=y,this.capture=!!$,this.ha=Ae,this.key=++L,this.da=this.fa=!1}function z(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function X(i){this.src=i,this.g={},this.h=0}X.prototype.add=function(i,u,y,$,Ae){var Re=i.toString();i=this.g[Re],i||(i=this.g[Re]=[],this.h++);var Be=J(i,u,$,Ae);return-1<Be?(u=i[Be],y||(u.fa=!1)):(u=new N(u,this.src,Re,!!$,Ae),u.fa=y,i.push(u)),u};function ee(i,u){var y=u.type;if(y in i.g){var $=i.g[y],Ae=Array.prototype.indexOf.call($,u,void 0),Re;(Re=0<=Ae)&&Array.prototype.splice.call($,Ae,1),Re&&(z(u),i.g[y].length==0&&(delete i.g[y],i.h--))}}function J(i,u,y,$){for(var Ae=0;Ae<i.length;++Ae){var Re=i[Ae];if(!Re.da&&Re.listener==u&&Re.capture==!!y&&Re.ha==$)return Ae}return-1}var ie="closure_lm_"+(1e6*Math.random()|0),Z={};function ve(i,u,y,$,Ae){if($&&$.once)return Ne(i,u,y,$,Ae);if(Array.isArray(u)){for(var Re=0;Re<u.length;Re++)ve(i,u[Re],y,$,Ae);return null}return y=ze(y),i&&i[R]?i.K(u,y,d($)?!!$.capture:!!$,Ae):Me(i,u,y,!1,$,Ae)}function Me(i,u,y,$,Ae,Re){if(!u)throw Error("Invalid event type");var Be=d(Ae)?!!Ae.capture:!!Ae,Je=rt(i);if(Je||(i[ie]=Je=new X(i)),y=Je.add(u,y,$,Be,Re),y.proxy)return y;if($=Ue(),y.proxy=$,$.src=i,$.listener=y,i.addEventListener)B||(Ae=Be),Ae===void 0&&(Ae=!1),i.addEventListener(u.toString(),$,Ae);else if(i.attachEvent)i.attachEvent($e(u.toString()),$);else if(i.addListener&&i.removeListener)i.addListener($);else throw Error("addEventListener and attachEvent are unavailable.");return y}function Ue(){function i(y){return u.call(i.src,i.listener,y)}const u=ke;return i}function Ne(i,u,y,$,Ae){if(Array.isArray(u)){for(var Re=0;Re<u.length;Re++)Ne(i,u[Re],y,$,Ae);return null}return y=ze(y),i&&i[R]?i.L(u,y,d($)?!!$.capture:!!$,Ae):Me(i,u,y,!0,$,Ae)}function xe(i,u,y,$,Ae){if(Array.isArray(u))for(var Re=0;Re<u.length;Re++)xe(i,u[Re],y,$,Ae);else $=d($)?!!$.capture:!!$,y=ze(y),i&&i[R]?(i=i.i,u=String(u).toString(),u in i.g&&(Re=i.g[u],y=J(Re,y,$,Ae),-1<y&&(z(Re[y]),Array.prototype.splice.call(Re,y,1),Re.length==0&&(delete i.g[u],i.h--)))):i&&(i=rt(i))&&(u=i.g[u.toString()],i=-1,u&&(i=J(u,y,$,Ae)),(y=-1<i?u[i]:null)&&qe(y))}function qe(i){if(typeof i!="number"&&i&&!i.da){var u=i.src;if(u&&u[R])ee(u.i,i);else{var y=i.type,$=i.proxy;u.removeEventListener?u.removeEventListener(y,$,i.capture):u.detachEvent?u.detachEvent($e(y),$):u.addListener&&u.removeListener&&u.removeListener($),(y=rt(u))?(ee(y,i),y.h==0&&(y.src=null,u[ie]=null)):z(i)}}}function $e(i){return i in Z?Z[i]:Z[i]="on"+i}function ke(i,u){if(i.da)i=!0;else{u=new c(u,this);var y=i.listener,$=i.ha||i.src;i.fa&&qe(i),i=y.call($,u)}return i}function rt(i){return i=i[ie],i instanceof X?i:null}var tt="__closure_events_fn_"+(1e9*Math.random()>>>0);function ze(i){return typeof i=="function"?i:(i[tt]||(i[tt]=function(u){return i.handleEvent(u)}),i[tt])}function Ge(){T.call(this),this.i=new X(this),this.M=this,this.F=null}g(Ge,T),Ge.prototype[R]=!0,Ge.prototype.removeEventListener=function(i,u,y,$){xe(this,i,u,y,$)};function Ke(i,u){var y,$=i.F;if($)for(y=[];$;$=$.F)y.push($);if(i=i.M,$=u.type||u,typeof u=="string")u=new m(u,i);else if(u instanceof m)u.target=u.target||i;else{var Ae=u;u=new m($,i),E(u,Ae)}if(Ae=!0,y)for(var Re=y.length-1;0<=Re;Re--){var Be=u.g=y[Re];Ae=ct(Be,$,!0,u)&&Ae}if(Be=u.g=i,Ae=ct(Be,$,!0,u)&&Ae,Ae=ct(Be,$,!1,u)&&Ae,y)for(Re=0;Re<y.length;Re++)Be=u.g=y[Re],Ae=ct(Be,$,!1,u)&&Ae}Ge.prototype.N=function(){if(Ge.aa.N.call(this),this.i){var i=this.i,u;for(u in i.g){for(var y=i.g[u],$=0;$<y.length;$++)z(y[$]);delete i.g[u],i.h--}}this.F=null},Ge.prototype.K=function(i,u,y,$){return this.i.add(String(i),u,!1,y,$)},Ge.prototype.L=function(i,u,y,$){return this.i.add(String(i),u,!0,y,$)};function ct(i,u,y,$){if(u=i.i.g[String(u)],!u)return!0;u=u.concat();for(var Ae=!0,Re=0;Re<u.length;++Re){var Be=u[Re];if(Be&&!Be.da&&Be.capture==y){var Je=Be.listener,ut=Be.ha||Be.src;Be.fa&&ee(i.i,Be),Ae=Je.call(ut,$)!==!1&&Ae}}return Ae&&!$.defaultPrevented}function at(i,u,y){if(typeof i=="function")y&&(i=q(i,y));else if(i&&typeof i.handleEvent=="function")i=q(i.handleEvent,i);else throw Error("Invalid listener argument");return 2147483647<Number(u)?-1:l.setTimeout(i,u||0)}function Et(i){i.g=at(()=>{i.g=null,i.i&&(i.i=!1,Et(i))},i.l);const u=i.h;i.h=null,i.m.apply(null,u)}class st extends T{constructor(u,y){super(),this.m=u,this.l=y,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:Et(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Pe(i){T.call(this),this.h=i,this.g={}}g(Pe,T);var te=[];function se(i){Y(i.g,function(u,y){this.g.hasOwnProperty(y)&&qe(u)},i),i.g={}}Pe.prototype.N=function(){Pe.aa.N.call(this),se(this)},Pe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var je=l.JSON.stringify,We=l.JSON.parse,Qe=class{stringify(i){return l.JSON.stringify(i,void 0)}parse(i){return l.JSON.parse(i,void 0)}};function Xe(){}Xe.prototype.h=null;function mt(i){return i.h||(i.h=i.i())}function Rt(){}var _t={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function lt(){m.call(this,"d")}g(lt,m);function Tt(){m.call(this,"c")}g(Tt,m);var ht={},Dt=null;function et(){return Dt=Dt||new Ge}ht.La="serverreachability";function xt(i){m.call(this,ht.La,i)}g(xt,m);function Pt(i){const u=et();Ke(u,new xt(u))}ht.STAT_EVENT="statevent";function Ot(i,u){m.call(this,ht.STAT_EVENT,i),this.stat=u}g(Ot,m);function it(i){const u=et();Ke(u,new Ot(u,i))}ht.Ma="timingevent";function St(i,u){m.call(this,ht.Ma,i),this.size=u}g(St,m);function ot(i,u){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){i()},u)}function At(){this.g=!0}At.prototype.xa=function(){this.g=!1};function jt(i,u,y,$,Ae,Re){i.info(function(){if(i.g)if(Re)for(var Be="",Je=Re.split("&"),ut=0;ut<Je.length;ut++){var He=Je[ut].split("=");if(1<He.length){var dt=He[0];He=He[1];var ft=dt.split("_");Be=2<=ft.length&&ft[1]=="type"?Be+(dt+"="+He+"&"):Be+(dt+"=redacted&")}}else Be=null;else Be=Re;return"XMLHTTP REQ ("+$+") [attempt "+Ae+"]: "+u+`
`+y+`
`+Be})}function _r(i,u,y,$,Ae,Re,Be){i.info(function(){return"XMLHTTP RESP ("+$+") [ attempt "+Ae+"]: "+u+`
`+y+`
`+Re+" "+Be})}function Nt(i,u,y,$){i.info(function(){return"XMLHTTP TEXT ("+u+"): "+gr(i,y)+($?" "+$:"")})}function pr(i,u){i.info(function(){return"TIMEOUT: "+u})}At.prototype.info=function(){};function gr(i,u){if(!i.g)return u;if(!u)return null;try{var y=JSON.parse(u);if(y){for(i=0;i<y.length;i++)if(Array.isArray(y[i])){var $=y[i];if(!(2>$.length)){var Ae=$[1];if(Array.isArray(Ae)&&!(1>Ae.length)){var Re=Ae[0];if(Re!="noop"&&Re!="stop"&&Re!="close")for(var Be=1;Be<Ae.length;Be++)Ae[Be]=""}}}}return je(y)}catch{return u}}var Qt={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Cn={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},fn;function Jt(){}g(Jt,Xe),Jt.prototype.g=function(){return new XMLHttpRequest},Jt.prototype.i=function(){return{}},fn=new Jt;function Ct(i,u,y,$){this.j=i,this.i=u,this.l=y,this.R=$||1,this.U=new Pe(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new wn}function wn(){this.i=null,this.g="",this.h=!1}var Vn={},_n={};function pn(i,u,y){i.L=1,i.v=nn(It(u)),i.m=y,i.P=!0,Dn(i,null)}function Dn(i,u){i.F=Date.now(),Zt(i),i.A=It(i.v);var y=i.A,$=i.R;Array.isArray($)||($=[String($)]),Gn(y.i,"t",$),i.C=0,y=i.j.J,i.h=new wn,i.g=cr(i.j,y?u:null,!i.m),0<i.O&&(i.M=new st(q(i.Y,i,i.g),i.O)),u=i.U,y=i.g,$=i.ca;var Ae="readystatechange";Array.isArray(Ae)||(Ae&&(te[0]=Ae.toString()),Ae=te);for(var Re=0;Re<Ae.length;Re++){var Be=ve(y,Ae[Re],$||u.handleEvent,!1,u.h||u);if(!Be)break;u.g[Be.key]=Be}u=i.H?h(i.H):{},i.m?(i.u||(i.u="POST"),u["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.A,i.u,i.m,u)):(i.u="GET",i.g.ea(i.A,i.u,null,u)),Pt(),jt(i.i,i.u,i.A,i.l,i.R,i.m)}Ct.prototype.ca=function(i){i=i.target;const u=this.M;u&&bt(i)==3?u.j():this.Y(i)},Ct.prototype.Y=function(i){try{if(i==this.g)e:{const ft=bt(this.g);var u=this.g.Ba();const Ut=this.g.Z();if(!(3>ft)&&(ft!=3||this.g&&(this.h.h||this.g.oa()||Jn(this.g)))){this.J||ft!=4||u==7||(u==8||0>=Ut?Pt(3):Pt(2)),gn(this);var y=this.g.Z();this.X=y;t:if(xn(this)){var $=Jn(this.g);i="";var Ae=$.length,Re=bt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ft(this),qt(this);var Be="";break t}this.h.i=new l.TextDecoder}for(u=0;u<Ae;u++)this.h.h=!0,i+=this.h.i.decode($[u],{stream:!(Re&&u==Ae-1)});$.length=0,this.h.g+=i,this.C=0,Be=this.h.g}else Be=this.g.oa();if(this.o=y==200,_r(this.i,this.u,this.A,this.l,this.R,ft,y),this.o){if(this.T&&!this.K){t:{if(this.g){var Je,ut=this.g;if((Je=ut.g?ut.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!G(Je)){var He=Je;break t}}He=null}if(y=He)Nt(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,mn(this,y);else{this.o=!1,this.s=3,it(12),Ft(this),qt(this);break e}}if(this.P){y=!0;let yt;for(;!this.J&&this.C<Be.length;)if(yt=mr(this,Be),yt==_n){ft==4&&(this.s=4,it(14),y=!1),Nt(this.i,this.l,null,"[Incomplete Response]");break}else if(yt==Vn){this.s=4,it(15),Nt(this.i,this.l,Be,"[Invalid Chunk]"),y=!1;break}else Nt(this.i,this.l,yt,null),mn(this,yt);if(xn(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ft!=4||Be.length!=0||this.h.h||(this.s=1,it(16),y=!1),this.o=this.o&&y,!y)Nt(this.i,this.l,Be,"[Invalid Chunked Response]"),Ft(this),qt(this);else if(0<Be.length&&!this.W){this.W=!0;var dt=this.j;dt.g==this&&dt.ba&&!dt.M&&(dt.j.info("Great, no buffering proxy detected. Bytes received: "+Be.length),Rn(dt),dt.M=!0,it(11))}}else Nt(this.i,this.l,Be,null),mn(this,Be);ft==4&&Ft(this),this.o&&!this.J&&(ft==4?ir(this.j,this):(this.o=!1,Zt(this)))}else kr(this.g),y==400&&0<Be.indexOf("Unknown SID")?(this.s=3,it(12)):(this.s=0,it(13)),Ft(this),qt(this)}}}catch{}finally{}};function xn(i){return i.g?i.u=="GET"&&i.L!=2&&i.j.Ca:!1}function mr(i,u){var y=i.C,$=u.indexOf(`
`,y);return $==-1?_n:(y=Number(u.substring(y,$)),isNaN(y)?Vn:($+=1,$+y>u.length?_n:(u=u.slice($,$+y),i.C=$+y,u)))}Ct.prototype.cancel=function(){this.J=!0,Ft(this)};function Zt(i){i.S=Date.now()+i.I,Fn(i,i.I)}function Fn(i,u){if(i.B!=null)throw Error("WatchDog timer not null");i.B=ot(q(i.ba,i),u)}function gn(i){i.B&&(l.clearTimeout(i.B),i.B=null)}Ct.prototype.ba=function(){this.B=null;const i=Date.now();0<=i-this.S?(pr(this.i,this.A),this.L!=2&&(Pt(),it(17)),Ft(this),this.s=2,qt(this)):Fn(this,this.S-i)};function qt(i){i.j.G==0||i.J||ir(i.j,i)}function Ft(i){gn(i);var u=i.M;u&&typeof u.ma=="function"&&u.ma(),i.M=null,se(i.U),i.g&&(u=i.g,i.g=null,u.abort(),u.ma())}function mn(i,u){try{var y=i.j;if(y.G!=0&&(y.g==i||An(y.h,i))){if(!i.K&&An(y.h,i)&&y.G==3){try{var $=y.Da.g.parse(u)}catch{$=null}if(Array.isArray($)&&$.length==3){var Ae=$;if(Ae[0]==0){e:if(!y.u){if(y.g)if(y.g.F+3e3<i.F)cn(y),an(y);else break e;Pn(y),it(18)}}else y.za=Ae[1],0<y.za-y.T&&37500>Ae[2]&&y.F&&y.v==0&&!y.C&&(y.C=ot(q(y.Za,y),6e3));if(1>=On(y.h)&&y.ca){try{y.ca()}catch{}y.ca=void 0}}else Mt(y,11)}else if((i.K||y.g==i)&&cn(y),!G(u))for(Ae=y.Da.g.parse(u),u=0;u<Ae.length;u++){let He=Ae[u];if(y.T=He[0],He=He[1],y.G==2)if(He[0]=="c"){y.K=He[1],y.ia=He[2];const dt=He[3];dt!=null&&(y.la=dt,y.j.info("VER="+y.la));const ft=He[4];ft!=null&&(y.Aa=ft,y.j.info("SVER="+y.Aa));const Ut=He[5];Ut!=null&&typeof Ut=="number"&&0<Ut&&($=1.5*Ut,y.L=$,y.j.info("backChannelRequestTimeoutMs_="+$)),$=y;const yt=i.g;if(yt){const hn=yt.g?yt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(hn){var Re=$.h;Re.g||hn.indexOf("spdy")==-1&&hn.indexOf("quic")==-1&&hn.indexOf("h2")==-1||(Re.j=Re.l,Re.g=new Set,Re.h&&(yn(Re,Re.h),Re.h=null))}if($.D){const In=yt.g?yt.g.getResponseHeader("X-HTTP-Session-Id"):null;In&&($.ya=In,Ze($.I,$.D,In))}}y.G=3,y.l&&y.l.ua(),y.ba&&(y.R=Date.now()-i.F,y.j.info("Handshake RTT: "+y.R+"ms")),$=y;var Be=i;if($.qa=lr($,$.J?$.ia:null,$.W),Be.K){Nn($.h,Be);var Je=Be,ut=$.L;ut&&(Je.I=ut),Je.B&&(gn(Je),Zt(Je)),$.g=Be}else rr($);0<y.i.length&&ln(y)}else He[0]!="stop"&&He[0]!="close"||Mt(y,7);else y.G==3&&(He[0]=="stop"||He[0]=="close"?He[0]=="stop"?Mt(y,7):Tn(y):He[0]!="noop"&&y.l&&y.l.ta(He),y.v=0)}}Pt(4)}catch{}}var Ar=class{constructor(i,u){this.g=i,this.map=u}};function kn(i){this.l=i||10,l.PerformanceNavigationTiming?(i=l.performance.getEntriesByType("navigation"),i=0<i.length&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Mn(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function On(i){return i.h?1:i.g?i.g.size:0}function An(i,u){return i.h?i.h==u:i.g?i.g.has(u):!1}function yn(i,u){i.g?i.g.add(u):i.h=u}function Nn(i,u){i.h&&i.h==u?i.h=null:i.g&&i.g.has(u)&&i.g.delete(u)}kn.prototype.cancel=function(){if(this.i=Ln(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function Ln(i){if(i.h!=null)return i.i.concat(i.h.D);if(i.g!=null&&i.g.size!==0){let u=i.i;for(const y of i.g.values())u=u.concat(y.D);return u}return F(i.i)}function yr(i){if(i.V&&typeof i.V=="function")return i.V();if(typeof Map<"u"&&i instanceof Map||typeof Set<"u"&&i instanceof Set)return Array.from(i.values());if(typeof i=="string")return i.split("");if(f(i)){for(var u=[],y=i.length,$=0;$<y;$++)u.push(i[$]);return u}u=[],y=0;for($ in i)u[y++]=i[$];return u}function Er(i){if(i.na&&typeof i.na=="function")return i.na();if(!i.V||typeof i.V!="function"){if(typeof Map<"u"&&i instanceof Map)return Array.from(i.keys());if(!(typeof Set<"u"&&i instanceof Set)){if(f(i)||typeof i=="string"){var u=[];i=i.length;for(var y=0;y<i;y++)u.push(y);return u}u=[],y=0;for(const $ in i)u[y++]=$;return u}}}function Bn(i,u){if(i.forEach&&typeof i.forEach=="function")i.forEach(u,void 0);else if(f(i)||typeof i=="string")Array.prototype.forEach.call(i,u,void 0);else for(var y=Er(i),$=yr(i),Ae=$.length,Re=0;Re<Ae;Re++)u.call(void 0,$[Re],y&&y[Re],i)}var Un=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Tr(i,u){if(i){i=i.split("&");for(var y=0;y<i.length;y++){var $=i[y].indexOf("="),Ae=null;if(0<=$){var Re=i[y].substring(0,$);Ae=i[y].substring($+1)}else Re=i[y];u(Re,Ae?decodeURIComponent(Ae.replace(/\+/g," ")):"")}}}function kt(i){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,i instanceof kt){this.h=i.h,en(this,i.j),this.o=i.o,this.g=i.g,tn(this,i.s),this.l=i.l;var u=i.i,y=new Gt;y.i=u.i,u.g&&(y.g=new Map(u.g),y.h=u.h),jn(this,y),this.m=i.m}else i&&(u=String(i).match(Un))?(this.h=!1,en(this,u[1]||"",!0),this.o=$t(u[2]||""),this.g=$t(u[3]||"",!0),tn(this,u[4]),this.l=$t(u[5]||"",!0),jn(this,u[6]||"",!0),this.m=$t(u[7]||"")):(this.h=!1,this.i=new Gt(null,this.h))}kt.prototype.toString=function(){var i=[],u=this.j;u&&i.push(Wt(u,qn,!0),":");var y=this.g;return(y||u=="file")&&(i.push("//"),(u=this.o)&&i.push(Wt(u,qn,!0),"@"),i.push(encodeURIComponent(String(y)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y=this.s,y!=null&&i.push(":",String(y))),(y=this.l)&&(this.g&&y.charAt(0)!="/"&&i.push("/"),i.push(Wt(y,y.charAt(0)=="/"?Ir:Rr,!0))),(y=this.i.toString())&&i.push("?",y),(y=this.m)&&i.push("#",Wt(y,vr)),i.join("")};function It(i){return new kt(i)}function en(i,u,y){i.j=y?$t(u,!0):u,i.j&&(i.j=i.j.replace(/:$/,""))}function tn(i,u){if(u){if(u=Number(u),isNaN(u)||0>u)throw Error("Bad port number "+u);i.s=u}else i.s=null}function jn(i,u,y){u instanceof Gt?(i.i=u,Sr(i.i,i.h)):(y||(u=Wt(u,br)),i.i=new Gt(u,i.h))}function Ze(i,u,y){i.i.set(u,y)}function nn(i){return Ze(i,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),i}function $t(i,u){return i?u?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function Wt(i,u,y){return typeof i=="string"?(i=encodeURI(i).replace(u,Pr),y&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function Pr(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var qn=/[#\/\?@]/g,Rr=/[#\?:]/g,Ir=/[#\?]/g,br=/[#\?@]/g,vr=/#/g;function Gt(i,u){this.h=this.g=null,this.i=i||null,this.j=!!u}function wt(i){i.g||(i.g=new Map,i.h=0,i.i&&Tr(i.i,function(u,y){i.add(decodeURIComponent(u.replace(/\+/g," ")),y)}))}r=Gt.prototype,r.add=function(i,u){wt(this),this.i=null,i=Lt(this,i);var y=this.g.get(i);return y||this.g.set(i,y=[]),y.push(u),this.h+=1,this};function $n(i,u){wt(i),u=Lt(i,u),i.g.has(u)&&(i.i=null,i.h-=i.g.get(u).length,i.g.delete(u))}function Wn(i,u){return wt(i),u=Lt(i,u),i.g.has(u)}r.forEach=function(i,u){wt(this),this.g.forEach(function(y,$){y.forEach(function(Ae){i.call(u,Ae,$,this)},this)},this)},r.na=function(){wt(this);const i=Array.from(this.g.values()),u=Array.from(this.g.keys()),y=[];for(let $=0;$<u.length;$++){const Ae=i[$];for(let Re=0;Re<Ae.length;Re++)y.push(u[$])}return y},r.V=function(i){wt(this);let u=[];if(typeof i=="string")Wn(this,i)&&(u=u.concat(this.g.get(Lt(this,i))));else{i=Array.from(this.g.values());for(let y=0;y<i.length;y++)u=u.concat(i[y])}return u},r.set=function(i,u){return wt(this),this.i=null,i=Lt(this,i),Wn(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[u]),this.h+=1,this},r.get=function(i,u){return i?(i=this.V(i),0<i.length?String(i[0]):u):u};function Gn(i,u,y){$n(i,u),0<y.length&&(i.i=null,i.g.set(Lt(i,u),F(y)),i.h+=y.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],u=Array.from(this.g.keys());for(var y=0;y<u.length;y++){var $=u[y];const Re=encodeURIComponent(String($)),Be=this.V($);for($=0;$<Be.length;$++){var Ae=Re;Be[$]!==""&&(Ae+="="+encodeURIComponent(String(Be[$]))),i.push(Ae)}}return this.i=i.join("&")};function Lt(i,u){return u=String(u),i.j&&(u=u.toLowerCase()),u}function Sr(i,u){u&&!i.j&&(wt(i),i.i=null,i.g.forEach(function(y,$){var Ae=$.toLowerCase();$!=Ae&&($n(this,$),Gn(this,Ae,y))},i)),i.j=u}function Cr(i,u){const y=new At;if(l.Image){const $=new Image;$.onload=V(Vt,y,"TestLoadImage: loaded",!0,u,$),$.onerror=V(Vt,y,"TestLoadImage: error",!1,u,$),$.onabort=V(Vt,y,"TestLoadImage: abort",!1,u,$),$.ontimeout=V(Vt,y,"TestLoadImage: timeout",!1,u,$),l.setTimeout(function(){$.ontimeout&&$.ontimeout()},1e4),$.src=i}else u(!1)}function wr(i,u){const y=new At,$=new AbortController,Ae=setTimeout(()=>{$.abort(),Vt(y,"TestPingServer: timeout",!1,u)},1e4);fetch(i,{signal:$.signal}).then(Re=>{clearTimeout(Ae),Re.ok?Vt(y,"TestPingServer: ok",!0,u):Vt(y,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(Ae),Vt(y,"TestPingServer: error",!1,u)})}function Vt(i,u,y,$,Ae){try{Ae&&(Ae.onload=null,Ae.onerror=null,Ae.onabort=null,Ae.ontimeout=null),$(y)}catch{}}function Vr(){this.g=new Qe}function Dr(i,u,y){const $=y||"";try{Bn(i,function(Ae,Re){let Be=Ae;d(Ae)&&(Be=je(Ae)),u.push($+Re+"="+encodeURIComponent(Be))})}catch(Ae){throw u.push($+"type="+encodeURIComponent("_badmap")),Ae}}function rn(i){this.l=i.Ub||null,this.j=i.eb||!1}g(rn,Xe),rn.prototype.g=function(){return new sn(this.l,this.j)},rn.prototype.i=function(i){return function(){return i}}({});function sn(i,u){Ge.call(this),this.D=i,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}g(sn,Ge),r=sn.prototype,r.open=function(i,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=i,this.A=u,this.readyState=1,zt(this)},r.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const u={headers:this.u,method:this.B,credentials:this.m,cache:void 0};i&&(u.body=i),(this.D||l).fetch(new Request(this.A,u)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ht(this)),this.readyState=0},r.Sa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,zt(this)),this.g&&(this.readyState=3,zt(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Hn(this)}else i.text().then(this.Ra.bind(this),this.ga.bind(this))};function Hn(i){i.j.read().then(i.Pa.bind(i)).catch(i.ga.bind(i))}r.Pa=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var u=i.value?i.value:new Uint8Array(0);(u=this.v.decode(u,{stream:!i.done}))&&(this.response=this.responseText+=u)}i.done?Ht(this):zt(this),this.readyState==3&&Hn(this)}},r.Ra=function(i){this.g&&(this.response=this.responseText=i,Ht(this))},r.Qa=function(i){this.g&&(this.response=i,Ht(this))},r.ga=function(){this.g&&Ht(this)};function Ht(i){i.readyState=4,i.l=null,i.j=null,i.v=null,zt(i)}r.setRequestHeader=function(i,u){this.u.append(i,u)},r.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],u=this.h.entries();for(var y=u.next();!y.done;)y=y.value,i.push(y[0]+": "+y[1]),y=u.next();return i.join(`\r
`)};function zt(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(sn.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function zn(i){let u="";return Y(i,function(y,$){u+=$,u+=":",u+=y,u+=`\r
`}),u}function En(i,u,y){e:{for($ in y){var $=!1;break e}$=!0}$||(y=zn(y),typeof i=="string"?y!=null&&encodeURIComponent(String(y)):Ze(i,u,y))}function nt(i){Ge.call(this),this.headers=new Map,this.o=i||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}g(nt,Ge);var xr=/^https?$/i,Fr=["POST","PUT"];r=nt.prototype,r.Ha=function(i){this.J=i},r.ea=function(i,u,y,$){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);u=u?u.toUpperCase():"GET",this.D=i,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():fn.g(),this.v=this.o?mt(this.o):mt(fn),this.g.onreadystatechange=q(this.Ea,this);try{this.B=!0,this.g.open(u,String(i),!0),this.B=!1}catch(Re){Kn(this,Re);return}if(i=y||"",y=new Map(this.headers),$)if(Object.getPrototypeOf($)===Object.prototype)for(var Ae in $)y.set(Ae,$[Ae]);else if(typeof $.keys=="function"&&typeof $.get=="function")for(const Re of $.keys())y.set(Re,$.get(Re));else throw Error("Unknown input type for opt_headers: "+String($));$=Array.from(y.keys()).find(Re=>Re.toLowerCase()=="content-type"),Ae=l.FormData&&i instanceof l.FormData,!(0<=Array.prototype.indexOf.call(Fr,u,void 0))||$||Ae||y.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Re,Be]of y)this.g.setRequestHeader(Re,Be);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Qn(this),this.u=!0,this.g.send(i),this.u=!1}catch(Re){Kn(this,Re)}};function Kn(i,u){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=u,i.m=5,Xn(i),on(i)}function Xn(i){i.A||(i.A=!0,Ke(i,"complete"),Ke(i,"error"))}r.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=i||7,Ke(this,"complete"),Ke(this,"abort"),on(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),on(this,!0)),nt.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Yn(this):this.bb())},r.bb=function(){Yn(this)};function Yn(i){if(i.h&&typeof a<"u"&&(!i.v[1]||bt(i)!=4||i.Z()!=2)){if(i.u&&bt(i)==4)at(i.Ea,0,i);else if(Ke(i,"readystatechange"),bt(i)==4){i.h=!1;try{const Be=i.Z();e:switch(Be){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var y;if(!(y=u)){var $;if($=Be===0){var Ae=String(i.D).match(Un)[1]||null;!Ae&&l.self&&l.self.location&&(Ae=l.self.location.protocol.slice(0,-1)),$=!xr.test(Ae?Ae.toLowerCase():"")}y=$}if(y)Ke(i,"complete"),Ke(i,"success");else{i.m=6;try{var Re=2<bt(i)?i.g.statusText:""}catch{Re=""}i.l=Re+" ["+i.Z()+"]",Xn(i)}}finally{on(i)}}}}function on(i,u){if(i.g){Qn(i);const y=i.g,$=i.v[0]?()=>{}:null;i.g=null,i.v=null,u||Ke(i,"ready");try{y.onreadystatechange=$}catch{}}}function Qn(i){i.I&&(l.clearTimeout(i.I),i.I=null)}r.isActive=function(){return!!this.g};function bt(i){return i.g?i.g.readyState:0}r.Z=function(){try{return 2<bt(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(i){if(this.g){var u=this.g.responseText;return i&&u.indexOf(i)==0&&(u=u.substring(i.length)),We(u)}};function Jn(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.H){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function kr(i){const u={};i=(i.g&&2<=bt(i)&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let $=0;$<i.length;$++){if(G(i[$]))continue;var y=x(i[$]);const Ae=y[0];if(y=y[1],typeof y!="string")continue;y=y.trim();const Re=u[Ae]||[];u[Ae]=Re,Re.push(y)}U(u,function($){return $.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Kt(i,u,y){return y&&y.internalChannelParams&&y.internalChannelParams[i]||u}function Zn(i){this.Aa=0,this.i=[],this.j=new At,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Kt("failFast",!1,i),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Kt("baseRetryDelayMs",5e3,i),this.cb=Kt("retryDelaySeedMs",1e4,i),this.Wa=Kt("forwardChannelMaxRetries",2,i),this.wa=Kt("forwardChannelRequestTimeoutMs",2e4,i),this.pa=i&&i.xmlHttpFactory||void 0,this.Xa=i&&i.Tb||void 0,this.Ca=i&&i.useFetchStreams||!1,this.L=void 0,this.J=i&&i.supportsCrossDomainXhr||!1,this.K="",this.h=new kn(i&&i.concurrentRequestLimit),this.Da=new Vr,this.P=i&&i.fastHandshake||!1,this.O=i&&i.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=i&&i.Rb||!1,i&&i.xa&&this.j.xa(),i&&i.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&i&&i.detectBufferingProxy||!1,this.ja=void 0,i&&i.longPollingTimeout&&0<i.longPollingTimeout&&(this.ja=i.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Zn.prototype,r.la=8,r.G=1,r.connect=function(i,u,y,$){it(0),this.W=i,this.H=u||{},y&&$!==void 0&&(this.H.OSID=y,this.H.OAID=$),this.F=this.X,this.I=lr(this,null,this.W),ln(this)};function Tn(i){if(er(i),i.G==3){var u=i.U++,y=It(i.I);if(Ze(y,"SID",i.K),Ze(y,"RID",u),Ze(y,"TYPE","terminate"),Xt(i,y),u=new Ct(i,i.j,u),u.L=2,u.v=nn(It(y)),y=!1,l.navigator&&l.navigator.sendBeacon)try{y=l.navigator.sendBeacon(u.v.toString(),"")}catch{}!y&&l.Image&&(new Image().src=u.v,y=!0),y||(u.g=cr(u.j,null),u.g.ea(u.v)),u.F=Date.now(),Zt(u)}ar(i)}function an(i){i.g&&(Rn(i),i.g.cancel(),i.g=null)}function er(i){an(i),i.u&&(l.clearTimeout(i.u),i.u=null),cn(i),i.h.cancel(),i.s&&(typeof i.s=="number"&&l.clearTimeout(i.s),i.s=null)}function ln(i){if(!Mn(i.h)&&!i.s){i.s=!0;var u=i.Ga;Se||Le(),Fe||(Se(),Fe=!0),Ve.add(u,i),i.B=0}}function Mr(i,u){return On(i.h)>=i.h.j-(i.s?1:0)?!1:i.s?(i.i=u.D.concat(i.i),!0):i.G==1||i.G==2||i.B>=(i.Va?0:i.Wa)?!1:(i.s=ot(q(i.Ga,i,u),or(i,i.B)),i.B++,!0)}r.Ga=function(i){if(this.s)if(this.s=null,this.G==1){if(!i){this.U=Math.floor(1e5*Math.random()),i=this.U++;const Ae=new Ct(this,this.j,i);let Re=this.o;if(this.S&&(Re?(Re=h(Re),E(Re,this.S)):Re=this.S),this.m!==null||this.O||(Ae.H=Re,Re=null),this.P)e:{for(var u=0,y=0;y<this.i.length;y++){t:{var $=this.i[y];if("__data__"in $.map&&($=$.map.__data__,typeof $=="string")){$=$.length;break t}$=void 0}if($===void 0)break;if(u+=$,4096<u){u=y;break e}if(u===4096||y===this.i.length-1){u=y+1;break e}}u=1e3}else u=1e3;u=nr(this,Ae,u),y=It(this.I),Ze(y,"RID",i),Ze(y,"CVER",22),this.D&&Ze(y,"X-HTTP-Session-Id",this.D),Xt(this,y),Re&&(this.O?u="headers="+encodeURIComponent(String(zn(Re)))+"&"+u:this.m&&En(y,this.m,Re)),yn(this.h,Ae),this.Ua&&Ze(y,"TYPE","init"),this.P?(Ze(y,"$req",u),Ze(y,"SID","null"),Ae.T=!0,pn(Ae,y,null)):pn(Ae,y,u),this.G=2}}else this.G==3&&(i?tr(this,i):this.i.length==0||Mn(this.h)||tr(this))};function tr(i,u){var y;u?y=u.l:y=i.U++;const $=It(i.I);Ze($,"SID",i.K),Ze($,"RID",y),Ze($,"AID",i.T),Xt(i,$),i.m&&i.o&&En($,i.m,i.o),y=new Ct(i,i.j,y,i.B+1),i.m===null&&(y.H=i.o),u&&(i.i=u.D.concat(i.i)),u=nr(i,y,1e3),y.I=Math.round(.5*i.wa)+Math.round(.5*i.wa*Math.random()),yn(i.h,y),pn(y,$,u)}function Xt(i,u){i.H&&Y(i.H,function(y,$){Ze(u,$,y)}),i.l&&Bn({},function(y,$){Ze(u,$,y)})}function nr(i,u,y){y=Math.min(i.i.length,y);var $=i.l?q(i.l.Na,i.l,i):null;e:{var Ae=i.i;let Re=-1;for(;;){const Be=["count="+y];Re==-1?0<y?(Re=Ae[0].g,Be.push("ofs="+Re)):Re=0:Be.push("ofs="+Re);let Je=!0;for(let ut=0;ut<y;ut++){let He=Ae[ut].g;const dt=Ae[ut].map;if(He-=Re,0>He)Re=Math.max(0,Ae[ut].g-100),Je=!1;else try{Dr(dt,Be,"req"+He+"_")}catch{$&&$(dt)}}if(Je){$=Be.join("&");break e}}}return i=i.i.splice(0,y),u.D=i,$}function rr(i){if(!i.g&&!i.u){i.Y=1;var u=i.Fa;Se||Le(),Fe||(Se(),Fe=!0),Ve.add(u,i),i.v=0}}function Pn(i){return i.g||i.u||3<=i.v?!1:(i.Y++,i.u=ot(q(i.Fa,i),or(i,i.v)),i.v++,!0)}r.Fa=function(){if(this.u=null,sr(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var i=2*this.R;this.j.info("BP detection timer enabled: "+i),this.A=ot(q(this.ab,this),i)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,it(10),an(this),sr(this))};function Rn(i){i.A!=null&&(l.clearTimeout(i.A),i.A=null)}function sr(i){i.g=new Ct(i,i.j,"rpc",i.Y),i.m===null&&(i.g.H=i.o),i.g.O=0;var u=It(i.qa);Ze(u,"RID","rpc"),Ze(u,"SID",i.K),Ze(u,"AID",i.T),Ze(u,"CI",i.F?"0":"1"),!i.F&&i.ja&&Ze(u,"TO",i.ja),Ze(u,"TYPE","xmlhttp"),Xt(i,u),i.m&&i.o&&En(u,i.m,i.o),i.L&&(i.g.I=i.L);var y=i.g;i=i.ia,y.L=1,y.v=nn(It(u)),y.m=null,y.P=!0,Dn(y,i)}r.Za=function(){this.C!=null&&(this.C=null,an(this),Pn(this),it(19))};function cn(i){i.C!=null&&(l.clearTimeout(i.C),i.C=null)}function ir(i,u){var y=null;if(i.g==u){cn(i),Rn(i),i.g=null;var $=2}else if(An(i.h,u))y=u.D,Nn(i.h,u),$=1;else return;if(i.G!=0){if(u.o)if($==1){y=u.m?u.m.length:0,u=Date.now()-u.F;var Ae=i.B;$=et(),Ke($,new St($,y)),ln(i)}else rr(i);else if(Ae=u.s,Ae==3||Ae==0&&0<u.X||!($==1&&Mr(i,u)||$==2&&Pn(i)))switch(y&&0<y.length&&(u=i.h,u.i=u.i.concat(y)),Ae){case 1:Mt(i,5);break;case 4:Mt(i,10);break;case 3:Mt(i,6);break;default:Mt(i,2)}}}function or(i,u){let y=i.Ta+Math.floor(Math.random()*i.cb);return i.isActive()||(y*=2),y*u}function Mt(i,u){if(i.j.info("Error code "+u),u==2){var y=q(i.fb,i),$=i.Xa;const Ae=!$;$=new kt($||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||en($,"https"),nn($),Ae?Cr($.toString(),y):wr($.toString(),y)}else it(2);i.G=0,i.l&&i.l.sa(u),ar(i),er(i)}r.fb=function(i){i?(this.j.info("Successfully pinged google.com"),it(2)):(this.j.info("Failed to ping google.com"),it(1))};function ar(i){if(i.G=0,i.ka=[],i.l){const u=Ln(i.h);(u.length!=0||i.i.length!=0)&&(I(i.ka,u),I(i.ka,i.i),i.h.i.length=0,F(i.i),i.i.length=0),i.l.ra()}}function lr(i,u,y){var $=y instanceof kt?It(y):new kt(y);if($.g!="")u&&($.g=u+"."+$.g),tn($,$.s);else{var Ae=l.location;$=Ae.protocol,u=u?u+"."+Ae.hostname:Ae.hostname,Ae=+Ae.port;var Re=new kt(null);$&&en(Re,$),u&&(Re.g=u),Ae&&tn(Re,Ae),y&&(Re.l=y),$=Re}return y=i.D,u=i.ya,y&&u&&Ze($,y,u),Ze($,"VER",i.la),Xt(i,$),$}function cr(i,u,y){if(u&&!i.J)throw Error("Can't create secondary domain capable XhrIo object.");return u=i.Ca&&!i.pa?new nt(new rn({eb:y})):new nt(i.pa),u.Ha(i.J),u}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function ur(){}r=ur.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function un(){}un.prototype.g=function(i,u){return new pt(i,u)};function pt(i,u){Ge.call(this),this.g=new Zn(u),this.l=i,this.h=u&&u.messageUrlParams||null,i=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(i?i["X-WebChannel-Content-Type"]=u.messageContentType:i={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.va&&(i?i["X-WebChannel-Client-Profile"]=u.va:i={"X-WebChannel-Client-Profile":u.va}),this.g.S=i,(i=u&&u.Sb)&&!G(i)&&(this.g.m=i),this.v=u&&u.supportsCrossDomainXhr||!1,this.u=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!G(u)&&(this.g.D=u,i=this.h,i!==null&&u in i&&(i=this.h,u in i&&delete i[u])),this.j=new Bt(this)}g(pt,Ge),pt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},pt.prototype.close=function(){Tn(this.g)},pt.prototype.o=function(i){var u=this.g;if(typeof i=="string"){var y={};y.__data__=i,i=y}else this.u&&(y={},y.__data__=je(i),i=y);u.i.push(new Ar(u.Ya++,i)),u.G==3&&ln(u)},pt.prototype.N=function(){this.g.l=null,delete this.j,Tn(this.g),delete this.g,pt.aa.N.call(this)};function hr(i){lt.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var u=i.__sm__;if(u){e:{for(const y in u){i=y;break e}i=void 0}(this.i=i)&&(i=this.i,u=u!==null&&i in u?u[i]:void 0),this.data=u}else this.data=i}g(hr,lt);function dr(){Tt.call(this),this.status=1}g(dr,Tt);function Bt(i){this.g=i}g(Bt,ur),Bt.prototype.ua=function(){Ke(this.g,"a")},Bt.prototype.ta=function(i){Ke(this.g,new hr(i))},Bt.prototype.sa=function(i){Ke(this.g,new dr)},Bt.prototype.ra=function(){Ke(this.g,"b")},un.prototype.createWebChannel=un.prototype.g,pt.prototype.send=pt.prototype.o,pt.prototype.open=pt.prototype.m,pt.prototype.close=pt.prototype.close,createWebChannelTransport=function(){return new un},getStatEventTarget=function(){return et()},Event$1=ht,Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Qt.NO_ERROR=0,Qt.TIMEOUT=8,Qt.HTTP_ERROR=6,ErrorCode=Qt,Cn.COMPLETE="complete",EventType=Cn,Rt.EventType=_t,_t.OPEN="a",_t.CLOSE="b",_t.ERROR="c",_t.MESSAGE="d",Ge.prototype.listen=Ge.prototype.K,WebChannel=Rt,nt.prototype.listenOnce=nt.prototype.L,nt.prototype.getLastError=nt.prototype.Ka,nt.prototype.getLastErrorCode=nt.prototype.Ba,nt.prototype.getStatus=nt.prototype.Z,nt.prototype.getResponseJson=nt.prototype.Oa,nt.prototype.getResponseText=nt.prototype.oa,nt.prototype.send=nt.prototype.ea,nt.prototype.setWithCredentials=nt.prototype.Ha,XhrIo=nt}).apply(typeof commonjsGlobal$1<"u"?commonjsGlobal$1:typeof self<"u"?self:typeof window<"u"?window:{});const w="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class User{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}User.UNAUTHENTICATED=new User(null),User.GOOGLE_CREDENTIALS=new User("google-credentials-uid"),User.FIRST_PARTY=new User("first-party-uid"),User.MOCK_USER=new User("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let S="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b=new Logger("@firebase/firestore");function __PRIVATE_getLogLevel(){return b.logLevel}function __PRIVATE_logDebug(r,...e){if(b.logLevel<=LogLevel.DEBUG){const t=e.map(__PRIVATE_argToString);b.debug(`Firestore (${S}): ${r}`,...t)}}function __PRIVATE_logError(r,...e){if(b.logLevel<=LogLevel.ERROR){const t=e.map(__PRIVATE_argToString);b.error(`Firestore (${S}): ${r}`,...t)}}function __PRIVATE_logWarn(r,...e){if(b.logLevel<=LogLevel.WARN){const t=e.map(__PRIVATE_argToString);b.warn(`Firestore (${S}): ${r}`,...t)}}function __PRIVATE_argToString(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fail(r="Unexpected state"){const e=`FIRESTORE (${S}) INTERNAL ASSERTION FAILED: `+r;throw __PRIVATE_logError(e),new Error(e)}function __PRIVATE_hardAssert(r,e){r||fail()}function __PRIVATE_debugCast(r,e){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class FirestoreError extends FirebaseError{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_Deferred{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_OAuthToken{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class __PRIVATE_EmptyAuthCredentialsProvider{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(User.UNAUTHENTICATED))}shutdown(){}}class __PRIVATE_EmulatorAuthCredentialsProvider{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class __PRIVATE_FirebaseAuthCredentialsProvider{constructor(e){this.t=e,this.currentUser=User.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){__PRIVATE_hardAssert(this.o===void 0);let n=this.i;const s=f=>this.i!==n?(n=this.i,t(f)):Promise.resolve();let o=new __PRIVATE_Deferred;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new __PRIVATE_Deferred,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const f=o;e.enqueueRetryable(async()=>{await f.promise,await s(this.currentUser)})},l=f=>{__PRIVATE_logDebug("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=f,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(f=>l(f)),setTimeout(()=>{if(!this.auth){const f=this.t.getImmediate({optional:!0});f?l(f):(__PRIVATE_logDebug("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new __PRIVATE_Deferred)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(__PRIVATE_logDebug("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(__PRIVATE_hardAssert(typeof n.accessToken=="string"),new __PRIVATE_OAuthToken(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return __PRIVATE_hardAssert(e===null||typeof e=="string"),new User(e)}}class __PRIVATE_FirstPartyToken{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=User.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class __PRIVATE_FirstPartyAuthCredentialsProvider{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new __PRIVATE_FirstPartyToken(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(User.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class AppCheckToken{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class __PRIVATE_FirebaseAppCheckTokenProvider{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){__PRIVATE_hardAssert(this.o===void 0);const n=o=>{o.error!=null&&__PRIVATE_logDebug("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.R;return this.R=o.token,__PRIVATE_logDebug("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>n(o))};const s=o=>{__PRIVATE_logDebug("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(o=>s(o)),setTimeout(()=>{if(!this.appCheck){const o=this.A.getImmediate({optional:!0});o?s(o):__PRIVATE_logDebug("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(__PRIVATE_hardAssert(typeof t.token=="string"),this.R=t.token,new AppCheckToken(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_randomBytes(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_AutoId{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const s=__PRIVATE_randomBytes(40);for(let o=0;o<s.length;++o)n.length<20&&s[o]<t&&(n+=e.charAt(s[o]%e.length))}return n}}function __PRIVATE_primitiveComparator(r,e){return r<e?-1:r>e?1:0}function __PRIVATE_arrayEquals(r,e,t){return r.length===e.length&&r.every((n,s)=>t(n,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Timestamp{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new FirestoreError(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new FirestoreError(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new FirestoreError(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new FirestoreError(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Timestamp.fromMillis(Date.now())}static fromDate(e){return Timestamp.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Timestamp(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?__PRIVATE_primitiveComparator(this.nanoseconds,e.nanoseconds):__PRIVATE_primitiveComparator(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SnapshotVersion{constructor(e){this.timestamp=e}static fromTimestamp(e){return new SnapshotVersion(e)}static min(){return new SnapshotVersion(new Timestamp(0,0))}static max(){return new SnapshotVersion(new Timestamp(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BasePath{constructor(e,t,n){t===void 0?t=0:t>e.length&&fail(),n===void 0?n=e.length-t:n>e.length-t&&fail(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return BasePath.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof BasePath?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++){const o=e.get(s),a=t.get(s);if(o<a)return-1;if(o>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ResourcePath extends BasePath{construct(e,t,n){return new ResourcePath(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new FirestoreError(D.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(s=>s.length>0))}return new ResourcePath(t)}static emptyPath(){return new ResourcePath([])}}const v=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class FieldPath$1 extends BasePath{construct(e,t,n){return new FieldPath$1(e,t,n)}static isValidIdentifier(e){return v.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),FieldPath$1.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new FieldPath$1(["__name__"])}static fromServerFormat(e){const t=[];let n="",s=0;const o=()=>{if(n.length===0)throw new FirestoreError(D.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let a=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new FirestoreError(D.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const f=e[s+1];if(f!=="\\"&&f!=="."&&f!=="`")throw new FirestoreError(D.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=f,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(n+=l,s++):(o(),s++)}if(o(),a)throw new FirestoreError(D.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new FieldPath$1(t)}static emptyPath(){return new FieldPath$1([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DocumentKey{constructor(e){this.path=e}static fromPath(e){return new DocumentKey(ResourcePath.fromString(e))}static fromName(e){return new DocumentKey(ResourcePath.fromString(e).popFirst(5))}static empty(){return new DocumentKey(ResourcePath.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ResourcePath.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ResourcePath.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new DocumentKey(new ResourcePath(e.slice()))}}function __PRIVATE_newIndexOffsetSuccessorFromReadTime(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,s=SnapshotVersion.fromTimestamp(n===1e9?new Timestamp(t+1,0):new Timestamp(t,n));return new IndexOffset(s,DocumentKey.empty(),e)}function __PRIVATE_newIndexOffsetFromDocument(r){return new IndexOffset(r.readTime,r.key,-1)}class IndexOffset{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new IndexOffset(SnapshotVersion.min(),DocumentKey.empty(),-1)}static max(){return new IndexOffset(SnapshotVersion.max(),DocumentKey.empty(),-1)}}function __PRIVATE_indexOffsetComparator(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=DocumentKey.comparator(r.documentKey,e.documentKey),t!==0?t:__PRIVATE_primitiveComparator(r.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class PersistenceTransaction{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function __PRIVATE_ignoreIfPrimaryLeaseLoss(r){if(r.code!==D.FAILED_PRECONDITION||r.message!==C)throw r;__PRIVATE_logDebug("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PersistencePromise{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&fail(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new PersistencePromise((n,s)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(n,s)},this.catchCallback=o=>{this.wrapFailure(t,o).next(n,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof PersistencePromise?t:PersistencePromise.resolve(t)}catch(t){return PersistencePromise.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):PersistencePromise.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):PersistencePromise.reject(t)}static resolve(e){return new PersistencePromise((t,n)=>{t(e)})}static reject(e){return new PersistencePromise((t,n)=>{n(e)})}static waitFor(e){return new PersistencePromise((t,n)=>{let s=0,o=0,a=!1;e.forEach(l=>{++s,l.next(()=>{++o,a&&o===s&&t()},f=>n(f))}),a=!0,o===s&&t()})}static or(e){let t=PersistencePromise.resolve(!1);for(const n of e)t=t.next(s=>s?PersistencePromise.resolve(s):n());return t}static forEach(e,t){const n=[];return e.forEach((s,o)=>{n.push(t.call(this,s,o))}),this.waitFor(n)}static mapArray(e,t){return new PersistencePromise((n,s)=>{const o=e.length,a=new Array(o);let l=0;for(let f=0;f<o;f++){const d=f;t(e[d]).next(A=>{a[d]=A,++l,l===o&&n(a)},A=>s(A))}})}static doWhile(e,t){return new PersistencePromise((n,s)=>{const o=()=>{e()===!0?t().next(()=>{o()},s):n()};o()})}}function __PRIVATE_getAndroidVersion(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function __PRIVATE_isIndexedDbTransactionError(r){return r.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_ListenSequence{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.ie(n),this.se=n=>t.writeSequenceNumber(n))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}__PRIVATE_ListenSequence.oe=-1;function __PRIVATE_isNullOrUndefined(r){return r==null}function __PRIVATE_isNegativeZero(r){return r===0&&1/r==-1/0}function isSafeInteger(r){return typeof r=="number"&&Number.isInteger(r)&&!__PRIVATE_isNegativeZero(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_objectSize(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function forEach(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function isEmpty(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SortedMap{constructor(e,t){this.comparator=e,this.root=t||LLRBNode.EMPTY}insert(e,t){return new SortedMap(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,LLRBNode.BLACK,null,null))}remove(e){return new SortedMap(this.comparator,this.root.remove(e,this.comparator).copy(null,null,LLRBNode.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(s===0)return t+n.left.size;s<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new SortedMapIterator(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new SortedMapIterator(this.root,e,this.comparator,!1)}getReverseIterator(){return new SortedMapIterator(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new SortedMapIterator(this.root,e,this.comparator,!0)}}class SortedMapIterator{constructor(e,t,n,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?n(e.key,t):1,t&&s&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class LLRBNode{constructor(e,t,n,s,o){this.key=e,this.value=t,this.color=n??LLRBNode.RED,this.left=s??LLRBNode.EMPTY,this.right=o??LLRBNode.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,s,o){return new LLRBNode(e??this.key,t??this.value,n??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this;const o=n(e,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(e,t,n),null):o===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return LLRBNode.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return LLRBNode.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,LLRBNode.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,LLRBNode.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw fail();const e=this.left.check();if(e!==this.right.check())throw fail();return e+(this.isRed()?0:1)}}LLRBNode.EMPTY=null,LLRBNode.RED=!0,LLRBNode.BLACK=!1;LLRBNode.EMPTY=new class{constructor(){this.size=0}get key(){throw fail()}get value(){throw fail()}get color(){throw fail()}get left(){throw fail()}get right(){throw fail()}copy(e,t,n,s,o){return this}insert(e,t,n){return new LLRBNode(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SortedSet{constructor(e){this.comparator=e,this.data=new SortedMap(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new SortedSetIterator(this.data.getIterator())}getIteratorFrom(e){return new SortedSetIterator(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof SortedSet)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=n.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new SortedSet(this.comparator);return t.data=e,t}}class SortedSetIterator{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FieldMask{constructor(e){this.fields=e,e.sort(FieldPath$1.comparator)}static empty(){return new FieldMask([])}unionWith(e){let t=new SortedSet(FieldPath$1.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new FieldMask(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return __PRIVATE_arrayEquals(this.fields,e.fields,(t,n)=>t.isEqual(n))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_Base64DecodeError extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ByteString{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new __PRIVATE_Base64DecodeError("Invalid base64 string: "+o):o}}(e);return new ByteString(t)}static fromUint8Array(e){const t=function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o}(e);return new ByteString(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return __PRIVATE_primitiveComparator(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ByteString.EMPTY_BYTE_STRING=new ByteString("");const ne=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function __PRIVATE_normalizeTimestamp(r){if(__PRIVATE_hardAssert(!!r),typeof r=="string"){let e=0;const t=ne.exec(r);if(__PRIVATE_hardAssert(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:__PRIVATE_normalizeNumber(r.seconds),nanos:__PRIVATE_normalizeNumber(r.nanos)}}function __PRIVATE_normalizeNumber(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function __PRIVATE_normalizeByteString(r){return typeof r=="string"?ByteString.fromBase64String(r):ByteString.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_isServerTimestamp(r){var e,t;return((t=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function __PRIVATE_getPreviousValue(r){const e=r.mapValue.fields.__previous_value__;return __PRIVATE_isServerTimestamp(e)?__PRIVATE_getPreviousValue(e):e}function __PRIVATE_getLocalWriteTime(r){const e=__PRIVATE_normalizeTimestamp(r.mapValue.fields.__local_write_time__.timestampValue);return new Timestamp(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DatabaseInfo{constructor(e,t,n,s,o,a,l,f,d){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=s,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=f,this.useFetchStreams=d}}class DatabaseId{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new DatabaseId("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof DatabaseId&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const re={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function __PRIVATE_typeOrder(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?__PRIVATE_isServerTimestamp(r)?4:__PRIVATE_isMaxValue(r)?9007199254740991:__PRIVATE_isVectorValue(r)?10:11:fail()}function __PRIVATE_valueEquals(r,e){if(r===e)return!0;const t=__PRIVATE_typeOrder(r);if(t!==__PRIVATE_typeOrder(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return __PRIVATE_getLocalWriteTime(r).isEqual(__PRIVATE_getLocalWriteTime(e));case 3:return function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const a=__PRIVATE_normalizeTimestamp(s.timestampValue),l=__PRIVATE_normalizeTimestamp(o.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return function(s,o){return __PRIVATE_normalizeByteString(s.bytesValue).isEqual(__PRIVATE_normalizeByteString(o.bytesValue))}(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return function(s,o){return __PRIVATE_normalizeNumber(s.geoPointValue.latitude)===__PRIVATE_normalizeNumber(o.geoPointValue.latitude)&&__PRIVATE_normalizeNumber(s.geoPointValue.longitude)===__PRIVATE_normalizeNumber(o.geoPointValue.longitude)}(r,e);case 2:return function(s,o){if("integerValue"in s&&"integerValue"in o)return __PRIVATE_normalizeNumber(s.integerValue)===__PRIVATE_normalizeNumber(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const a=__PRIVATE_normalizeNumber(s.doubleValue),l=__PRIVATE_normalizeNumber(o.doubleValue);return a===l?__PRIVATE_isNegativeZero(a)===__PRIVATE_isNegativeZero(l):isNaN(a)&&isNaN(l)}return!1}(r,e);case 9:return __PRIVATE_arrayEquals(r.arrayValue.values||[],e.arrayValue.values||[],__PRIVATE_valueEquals);case 10:case 11:return function(s,o){const a=s.mapValue.fields||{},l=o.mapValue.fields||{};if(__PRIVATE_objectSize(a)!==__PRIVATE_objectSize(l))return!1;for(const f in a)if(a.hasOwnProperty(f)&&(l[f]===void 0||!__PRIVATE_valueEquals(a[f],l[f])))return!1;return!0}(r,e);default:return fail()}}function __PRIVATE_arrayValueContains(r,e){return(r.values||[]).find(t=>__PRIVATE_valueEquals(t,e))!==void 0}function __PRIVATE_valueCompare(r,e){if(r===e)return 0;const t=__PRIVATE_typeOrder(r),n=__PRIVATE_typeOrder(e);if(t!==n)return __PRIVATE_primitiveComparator(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return __PRIVATE_primitiveComparator(r.booleanValue,e.booleanValue);case 2:return function(o,a){const l=__PRIVATE_normalizeNumber(o.integerValue||o.doubleValue),f=__PRIVATE_normalizeNumber(a.integerValue||a.doubleValue);return l<f?-1:l>f?1:l===f?0:isNaN(l)?isNaN(f)?0:-1:1}(r,e);case 3:return __PRIVATE_compareTimestamps(r.timestampValue,e.timestampValue);case 4:return __PRIVATE_compareTimestamps(__PRIVATE_getLocalWriteTime(r),__PRIVATE_getLocalWriteTime(e));case 5:return __PRIVATE_primitiveComparator(r.stringValue,e.stringValue);case 6:return function(o,a){const l=__PRIVATE_normalizeByteString(o),f=__PRIVATE_normalizeByteString(a);return l.compareTo(f)}(r.bytesValue,e.bytesValue);case 7:return function(o,a){const l=o.split("/"),f=a.split("/");for(let d=0;d<l.length&&d<f.length;d++){const A=__PRIVATE_primitiveComparator(l[d],f[d]);if(A!==0)return A}return __PRIVATE_primitiveComparator(l.length,f.length)}(r.referenceValue,e.referenceValue);case 8:return function(o,a){const l=__PRIVATE_primitiveComparator(__PRIVATE_normalizeNumber(o.latitude),__PRIVATE_normalizeNumber(a.latitude));return l!==0?l:__PRIVATE_primitiveComparator(__PRIVATE_normalizeNumber(o.longitude),__PRIVATE_normalizeNumber(a.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return __PRIVATE_compareArrays(r.arrayValue,e.arrayValue);case 10:return function(o,a){var l,f,d,A;const M=o.fields||{},q=a.fields||{},V=(l=M.value)===null||l===void 0?void 0:l.arrayValue,g=(f=q.value)===null||f===void 0?void 0:f.arrayValue,F=__PRIVATE_primitiveComparator(((d=V==null?void 0:V.values)===null||d===void 0?void 0:d.length)||0,((A=g==null?void 0:g.values)===null||A===void 0?void 0:A.length)||0);return F!==0?F:__PRIVATE_compareArrays(V,g)}(r.mapValue,e.mapValue);case 11:return function(o,a){if(o===re.mapValue&&a===re.mapValue)return 0;if(o===re.mapValue)return 1;if(a===re.mapValue)return-1;const l=o.fields||{},f=Object.keys(l),d=a.fields||{},A=Object.keys(d);f.sort(),A.sort();for(let M=0;M<f.length&&M<A.length;++M){const q=__PRIVATE_primitiveComparator(f[M],A[M]);if(q!==0)return q;const V=__PRIVATE_valueCompare(l[f[M]],d[A[M]]);if(V!==0)return V}return __PRIVATE_primitiveComparator(f.length,A.length)}(r.mapValue,e.mapValue);default:throw fail()}}function __PRIVATE_compareTimestamps(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return __PRIVATE_primitiveComparator(r,e);const t=__PRIVATE_normalizeTimestamp(r),n=__PRIVATE_normalizeTimestamp(e),s=__PRIVATE_primitiveComparator(t.seconds,n.seconds);return s!==0?s:__PRIVATE_primitiveComparator(t.nanos,n.nanos)}function __PRIVATE_compareArrays(r,e){const t=r.values||[],n=e.values||[];for(let s=0;s<t.length&&s<n.length;++s){const o=__PRIVATE_valueCompare(t[s],n[s]);if(o)return o}return __PRIVATE_primitiveComparator(t.length,n.length)}function canonicalId(r){return __PRIVATE_canonifyValue(r)}function __PRIVATE_canonifyValue(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=__PRIVATE_normalizeTimestamp(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(t){return __PRIVATE_normalizeByteString(t).toBase64()}(r.bytesValue):"referenceValue"in r?function(t){return DocumentKey.fromName(t).toString()}(r.referenceValue):"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",s=!0;for(const o of t.values||[])s?s=!1:n+=",",n+=__PRIVATE_canonifyValue(o);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let s="{",o=!0;for(const a of n)o?o=!1:s+=",",s+=`${a}:${__PRIVATE_canonifyValue(t.fields[a])}`;return s+"}"}(r.mapValue):fail()}function isInteger(r){return!!r&&"integerValue"in r}function isArray(r){return!!r&&"arrayValue"in r}function __PRIVATE_isNullValue(r){return!!r&&"nullValue"in r}function __PRIVATE_isNanValue(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function __PRIVATE_isMapValue(r){return!!r&&"mapValue"in r}function __PRIVATE_isVectorValue(r){var e,t;return((t=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function __PRIVATE_deepClone(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return forEach(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=__PRIVATE_deepClone(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=__PRIVATE_deepClone(r.arrayValue.values[t]);return e}return Object.assign({},r)}function __PRIVATE_isMaxValue(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ObjectValue{constructor(e){this.value=e}static empty(){return new ObjectValue({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!__PRIVATE_isMapValue(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=__PRIVATE_deepClone(t)}setAll(e){let t=FieldPath$1.emptyPath(),n={},s=[];e.forEach((a,l)=>{if(!t.isImmediateParentOf(l)){const f=this.getFieldsMap(t);this.applyChanges(f,n,s),n={},s=[],t=l.popLast()}a?n[l.lastSegment()]=__PRIVATE_deepClone(a):s.push(l.lastSegment())});const o=this.getFieldsMap(t);this.applyChanges(o,n,s)}delete(e){const t=this.field(e.popLast());__PRIVATE_isMapValue(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return __PRIVATE_valueEquals(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=t.mapValue.fields[e.get(n)];__PRIVATE_isMapValue(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,n){forEach(t,(s,o)=>e[s]=o);for(const s of n)delete e[s]}clone(){return new ObjectValue(__PRIVATE_deepClone(this.value))}}function __PRIVATE_extractFieldMask(r){const e=[];return forEach(r.fields,(t,n)=>{const s=new FieldPath$1([t]);if(__PRIVATE_isMapValue(n)){const o=__PRIVATE_extractFieldMask(n.mapValue).fields;if(o.length===0)e.push(s);else for(const a of o)e.push(s.child(a))}else e.push(s)}),new FieldMask(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MutableDocument{constructor(e,t,n,s,o,a,l){this.key=e,this.documentType=t,this.version=n,this.readTime=s,this.createTime=o,this.data=a,this.documentState=l}static newInvalidDocument(e){return new MutableDocument(e,0,SnapshotVersion.min(),SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),0)}static newFoundDocument(e,t,n,s){return new MutableDocument(e,1,t,SnapshotVersion.min(),n,s,0)}static newNoDocument(e,t){return new MutableDocument(e,2,t,SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),0)}static newUnknownDocument(e,t){return new MutableDocument(e,3,t,SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(SnapshotVersion.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ObjectValue.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ObjectValue.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=SnapshotVersion.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof MutableDocument&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new MutableDocument(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bound{constructor(e,t){this.position=e,this.inclusive=t}}function __PRIVATE_boundCompareToDocument(r,e,t){let n=0;for(let s=0;s<r.position.length;s++){const o=e[s],a=r.position[s];if(o.field.isKeyField()?n=DocumentKey.comparator(DocumentKey.fromName(a.referenceValue),t.key):n=__PRIVATE_valueCompare(a,t.data.field(o.field)),o.dir==="desc"&&(n*=-1),n!==0)break}return n}function __PRIVATE_boundEquals(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!__PRIVATE_valueEquals(r.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OrderBy{constructor(e,t="asc"){this.field=e,this.dir=t}}function __PRIVATE_orderByEquals(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Filter{}class FieldFilter extends Filter{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new __PRIVATE_KeyFieldFilter(e,t,n):t==="array-contains"?new __PRIVATE_ArrayContainsFilter(e,n):t==="in"?new __PRIVATE_InFilter(e,n):t==="not-in"?new __PRIVATE_NotInFilter(e,n):t==="array-contains-any"?new __PRIVATE_ArrayContainsAnyFilter(e,n):new FieldFilter(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new __PRIVATE_KeyFieldInFilter(e,n):new __PRIVATE_KeyFieldNotInFilter(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(__PRIVATE_valueCompare(t,this.value)):t!==null&&__PRIVATE_typeOrder(this.value)===__PRIVATE_typeOrder(t)&&this.matchesComparison(__PRIVATE_valueCompare(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return fail()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class CompositeFilter extends Filter{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new CompositeFilter(e,t)}matches(e){return __PRIVATE_compositeFilterIsConjunction(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function __PRIVATE_compositeFilterIsConjunction(r){return r.op==="and"}function __PRIVATE_compositeFilterIsFlatConjunction(r){return __PRIVATE_compositeFilterIsFlat(r)&&__PRIVATE_compositeFilterIsConjunction(r)}function __PRIVATE_compositeFilterIsFlat(r){for(const e of r.filters)if(e instanceof CompositeFilter)return!1;return!0}function __PRIVATE_canonifyFilter(r){if(r instanceof FieldFilter)return r.field.canonicalString()+r.op.toString()+canonicalId(r.value);if(__PRIVATE_compositeFilterIsFlatConjunction(r))return r.filters.map(e=>__PRIVATE_canonifyFilter(e)).join(",");{const e=r.filters.map(t=>__PRIVATE_canonifyFilter(t)).join(",");return`${r.op}(${e})`}}function __PRIVATE_filterEquals(r,e){return r instanceof FieldFilter?function(n,s){return s instanceof FieldFilter&&n.op===s.op&&n.field.isEqual(s.field)&&__PRIVATE_valueEquals(n.value,s.value)}(r,e):r instanceof CompositeFilter?function(n,s){return s instanceof CompositeFilter&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce((o,a,l)=>o&&__PRIVATE_filterEquals(a,s.filters[l]),!0):!1}(r,e):void fail()}function __PRIVATE_stringifyFilter(r){return r instanceof FieldFilter?function(t){return`${t.field.canonicalString()} ${t.op} ${canonicalId(t.value)}`}(r):r instanceof CompositeFilter?function(t){return t.op.toString()+" {"+t.getFilters().map(__PRIVATE_stringifyFilter).join(" ,")+"}"}(r):"Filter"}class __PRIVATE_KeyFieldFilter extends FieldFilter{constructor(e,t,n){super(e,t,n),this.key=DocumentKey.fromName(n.referenceValue)}matches(e){const t=DocumentKey.comparator(e.key,this.key);return this.matchesComparison(t)}}class __PRIVATE_KeyFieldInFilter extends FieldFilter{constructor(e,t){super(e,"in",t),this.keys=__PRIVATE_extractDocumentKeysFromArrayValue("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class __PRIVATE_KeyFieldNotInFilter extends FieldFilter{constructor(e,t){super(e,"not-in",t),this.keys=__PRIVATE_extractDocumentKeysFromArrayValue("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function __PRIVATE_extractDocumentKeysFromArrayValue(r,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>DocumentKey.fromName(n.referenceValue))}class __PRIVATE_ArrayContainsFilter extends FieldFilter{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return isArray(t)&&__PRIVATE_arrayValueContains(t.arrayValue,this.value)}}class __PRIVATE_InFilter extends FieldFilter{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&__PRIVATE_arrayValueContains(this.value.arrayValue,t)}}class __PRIVATE_NotInFilter extends FieldFilter{constructor(e,t){super(e,"not-in",t)}matches(e){if(__PRIVATE_arrayValueContains(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!__PRIVATE_arrayValueContains(this.value.arrayValue,t)}}class __PRIVATE_ArrayContainsAnyFilter extends FieldFilter{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!isArray(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>__PRIVATE_arrayValueContains(this.value.arrayValue,n))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_TargetImpl{constructor(e,t=null,n=[],s=[],o=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=s,this.limit=o,this.startAt=a,this.endAt=l,this.ue=null}}function __PRIVATE_newTarget(r,e=null,t=[],n=[],s=null,o=null,a=null){return new __PRIVATE_TargetImpl(r,e,t,n,s,o,a)}function __PRIVATE_canonifyTarget(r){const e=__PRIVATE_debugCast(r);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>__PRIVATE_canonifyFilter(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(o){return o.field.canonicalString()+o.dir}(n)).join(","),__PRIVATE_isNullOrUndefined(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>canonicalId(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>canonicalId(n)).join(",")),e.ue=t}return e.ue}function __PRIVATE_targetEquals(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!__PRIVATE_orderByEquals(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!__PRIVATE_filterEquals(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!__PRIVATE_boundEquals(r.startAt,e.startAt)&&__PRIVATE_boundEquals(r.endAt,e.endAt)}function __PRIVATE_targetIsDocumentTarget(r){return DocumentKey.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_QueryImpl{constructor(e,t=null,n=[],s=[],o=null,a="F",l=null,f=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=s,this.limit=o,this.limitType=a,this.startAt=l,this.endAt=f,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function __PRIVATE_newQuery(r,e,t,n,s,o,a,l){return new __PRIVATE_QueryImpl(r,e,t,n,s,o,a,l)}function __PRIVATE_newQueryForPath(r){return new __PRIVATE_QueryImpl(r)}function __PRIVATE_queryMatchesAllDocuments(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function __PRIVATE_isCollectionGroupQuery(r){return r.collectionGroup!==null}function __PRIVATE_queryNormalizedOrderBy(r){const e=__PRIVATE_debugCast(r);if(e.ce===null){e.ce=[];const t=new Set;for(const o of e.explicitOrderBy)e.ce.push(o),t.add(o.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new SortedSet(FieldPath$1.comparator);return a.filters.forEach(f=>{f.getFlattenedFilters().forEach(d=>{d.isInequality()&&(l=l.add(d.field))})}),l})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.ce.push(new OrderBy(o,n))}),t.has(FieldPath$1.keyField().canonicalString())||e.ce.push(new OrderBy(FieldPath$1.keyField(),n))}return e.ce}function __PRIVATE_queryToTarget(r){const e=__PRIVATE_debugCast(r);return e.le||(e.le=__PRIVATE__queryToTarget(e,__PRIVATE_queryNormalizedOrderBy(r))),e.le}function __PRIVATE__queryToTarget(r,e){if(r.limitType==="F")return __PRIVATE_newTarget(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(s=>{const o=s.dir==="desc"?"asc":"desc";return new OrderBy(s.field,o)});const t=r.endAt?new Bound(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Bound(r.startAt.position,r.startAt.inclusive):null;return __PRIVATE_newTarget(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function __PRIVATE_queryWithLimit(r,e,t){return new __PRIVATE_QueryImpl(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function __PRIVATE_queryEquals(r,e){return __PRIVATE_targetEquals(__PRIVATE_queryToTarget(r),__PRIVATE_queryToTarget(e))&&r.limitType===e.limitType}function __PRIVATE_canonifyQuery(r){return`${__PRIVATE_canonifyTarget(__PRIVATE_queryToTarget(r))}|lt:${r.limitType}`}function __PRIVATE_stringifyQuery(r){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(s=>__PRIVATE_stringifyFilter(s)).join(", ")}]`),__PRIVATE_isNullOrUndefined(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(s=>canonicalId(s)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(s=>canonicalId(s)).join(",")),`Target(${n})`}(__PRIVATE_queryToTarget(r))}; limitType=${r.limitType})`}function __PRIVATE_queryMatches(r,e){return e.isFoundDocument()&&function(n,s){const o=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(o):DocumentKey.isDocumentKey(n.path)?n.path.isEqual(o):n.path.isImmediateParentOf(o)}(r,e)&&function(n,s){for(const o of __PRIVATE_queryNormalizedOrderBy(n))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0}(r,e)&&function(n,s){for(const o of n.filters)if(!o.matches(s))return!1;return!0}(r,e)&&function(n,s){return!(n.startAt&&!function(a,l,f){const d=__PRIVATE_boundCompareToDocument(a,l,f);return a.inclusive?d<=0:d<0}(n.startAt,__PRIVATE_queryNormalizedOrderBy(n),s)||n.endAt&&!function(a,l,f){const d=__PRIVATE_boundCompareToDocument(a,l,f);return a.inclusive?d>=0:d>0}(n.endAt,__PRIVATE_queryNormalizedOrderBy(n),s))}(r,e)}function __PRIVATE_queryCollectionGroup(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function __PRIVATE_newQueryComparator(r){return(e,t)=>{let n=!1;for(const s of __PRIVATE_queryNormalizedOrderBy(r)){const o=__PRIVATE_compareDocs(s,e,t);if(o!==0)return o;n=n||s.field.isKeyField()}return 0}}function __PRIVATE_compareDocs(r,e,t){const n=r.field.isKeyField()?DocumentKey.comparator(e.key,t.key):function(o,a,l){const f=a.data.field(o),d=l.data.field(o);return f!==null&&d!==null?__PRIVATE_valueCompare(f,d):fail()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return fail()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ObjectMap{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[s,o]of n)if(this.equalsFn(s,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),s=this.inner[n];if(s===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],e))return void(s[o]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return n.length===1?delete this.inner[t]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){forEach(this.inner,(t,n)=>{for(const[s,o]of n)e(s,o)})}isEmpty(){return isEmpty(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oe=new SortedMap(DocumentKey.comparator);function __PRIVATE_mutableDocumentMap(){return oe}const _e=new SortedMap(DocumentKey.comparator);function documentMap(...r){let e=_e;for(const t of r)e=e.insert(t.key,t);return e}function __PRIVATE_convertOverlayedDocumentMapToDocumentMap(r){let e=_e;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function __PRIVATE_newOverlayMap(){return __PRIVATE_newDocumentKeyMap()}function __PRIVATE_newMutationMap(){return __PRIVATE_newDocumentKeyMap()}function __PRIVATE_newDocumentKeyMap(){return new ObjectMap(r=>r.toString(),(r,e)=>r.isEqual(e))}const ae=new SortedMap(DocumentKey.comparator),ue=new SortedSet(DocumentKey.comparator);function __PRIVATE_documentKeySet(...r){let e=ue;for(const t of r)e=e.add(t);return e}const ce=new SortedSet(__PRIVATE_primitiveComparator);function __PRIVATE_targetIdSet(){return ce}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_toDouble(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:__PRIVATE_isNegativeZero(e)?"-0":e}}function __PRIVATE_toInteger(r){return{integerValue:""+r}}function toNumber(r,e){return isSafeInteger(e)?__PRIVATE_toInteger(e):__PRIVATE_toDouble(r,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TransformOperation{constructor(){this._=void 0}}function __PRIVATE_applyTransformOperationToLocalView(r,e,t){return r instanceof __PRIVATE_ServerTimestampTransform?function(s,o){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&__PRIVATE_isServerTimestamp(o)&&(o=__PRIVATE_getPreviousValue(o)),o&&(a.fields.__previous_value__=o),{mapValue:a}}(t,e):r instanceof __PRIVATE_ArrayUnionTransformOperation?__PRIVATE_applyArrayUnionTransformOperation(r,e):r instanceof __PRIVATE_ArrayRemoveTransformOperation?__PRIVATE_applyArrayRemoveTransformOperation(r,e):function(s,o){const a=__PRIVATE_computeTransformOperationBaseValue(s,o),l=asNumber(a)+asNumber(s.Pe);return isInteger(a)&&isInteger(s.Pe)?__PRIVATE_toInteger(l):__PRIVATE_toDouble(s.serializer,l)}(r,e)}function __PRIVATE_applyTransformOperationToRemoteDocument(r,e,t){return r instanceof __PRIVATE_ArrayUnionTransformOperation?__PRIVATE_applyArrayUnionTransformOperation(r,e):r instanceof __PRIVATE_ArrayRemoveTransformOperation?__PRIVATE_applyArrayRemoveTransformOperation(r,e):t}function __PRIVATE_computeTransformOperationBaseValue(r,e){return r instanceof __PRIVATE_NumericIncrementTransformOperation?function(n){return isInteger(n)||function(o){return!!o&&"doubleValue"in o}(n)}(e)?e:{integerValue:0}:null}class __PRIVATE_ServerTimestampTransform extends TransformOperation{}class __PRIVATE_ArrayUnionTransformOperation extends TransformOperation{constructor(e){super(),this.elements=e}}function __PRIVATE_applyArrayUnionTransformOperation(r,e){const t=__PRIVATE_coercedFieldValuesArray(e);for(const n of r.elements)t.some(s=>__PRIVATE_valueEquals(s,n))||t.push(n);return{arrayValue:{values:t}}}class __PRIVATE_ArrayRemoveTransformOperation extends TransformOperation{constructor(e){super(),this.elements=e}}function __PRIVATE_applyArrayRemoveTransformOperation(r,e){let t=__PRIVATE_coercedFieldValuesArray(e);for(const n of r.elements)t=t.filter(s=>!__PRIVATE_valueEquals(s,n));return{arrayValue:{values:t}}}class __PRIVATE_NumericIncrementTransformOperation extends TransformOperation{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function asNumber(r){return __PRIVATE_normalizeNumber(r.integerValue||r.doubleValue)}function __PRIVATE_coercedFieldValuesArray(r){return isArray(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}function __PRIVATE_fieldTransformEquals(r,e){return r.field.isEqual(e.field)&&function(n,s){return n instanceof __PRIVATE_ArrayUnionTransformOperation&&s instanceof __PRIVATE_ArrayUnionTransformOperation||n instanceof __PRIVATE_ArrayRemoveTransformOperation&&s instanceof __PRIVATE_ArrayRemoveTransformOperation?__PRIVATE_arrayEquals(n.elements,s.elements,__PRIVATE_valueEquals):n instanceof __PRIVATE_NumericIncrementTransformOperation&&s instanceof __PRIVATE_NumericIncrementTransformOperation?__PRIVATE_valueEquals(n.Pe,s.Pe):n instanceof __PRIVATE_ServerTimestampTransform&&s instanceof __PRIVATE_ServerTimestampTransform}(r.transform,e.transform)}class MutationResult{constructor(e,t){this.version=e,this.transformResults=t}}class Precondition{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Precondition}static exists(e){return new Precondition(void 0,e)}static updateTime(e){return new Precondition(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function __PRIVATE_preconditionIsValidForDocument(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}class Mutation{}function __PRIVATE_calculateOverlayMutation(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new __PRIVATE_DeleteMutation(r.key,Precondition.none()):new __PRIVATE_SetMutation(r.key,r.data,Precondition.none());{const t=r.data,n=ObjectValue.empty();let s=new SortedSet(FieldPath$1.comparator);for(let o of e.fields)if(!s.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?n.delete(o):n.set(o,a),s=s.add(o)}return new __PRIVATE_PatchMutation(r.key,n,new FieldMask(s.toArray()),Precondition.none())}}function __PRIVATE_mutationApplyToRemoteDocument(r,e,t){r instanceof __PRIVATE_SetMutation?function(s,o,a){const l=s.value.clone(),f=__PRIVATE_serverTransformResults(s.fieldTransforms,o,a.transformResults);l.setAll(f),o.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(r,e,t):r instanceof __PRIVATE_PatchMutation?function(s,o,a){if(!__PRIVATE_preconditionIsValidForDocument(s.precondition,o))return void o.convertToUnknownDocument(a.version);const l=__PRIVATE_serverTransformResults(s.fieldTransforms,o,a.transformResults),f=o.data;f.setAll(__PRIVATE_getPatch(s)),f.setAll(l),o.convertToFoundDocument(a.version,f).setHasCommittedMutations()}(r,e,t):function(s,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function __PRIVATE_mutationApplyToLocalView(r,e,t,n){return r instanceof __PRIVATE_SetMutation?function(o,a,l,f){if(!__PRIVATE_preconditionIsValidForDocument(o.precondition,a))return l;const d=o.value.clone(),A=__PRIVATE_localTransformResults(o.fieldTransforms,f,a);return d.setAll(A),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(r,e,t,n):r instanceof __PRIVATE_PatchMutation?function(o,a,l,f){if(!__PRIVATE_preconditionIsValidForDocument(o.precondition,a))return l;const d=__PRIVATE_localTransformResults(o.fieldTransforms,f,a),A=a.data;return A.setAll(__PRIVATE_getPatch(o)),A.setAll(d),a.convertToFoundDocument(a.version,A).setHasLocalMutations(),l===null?null:l.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(M=>M.field))}(r,e,t,n):function(o,a,l){return __PRIVATE_preconditionIsValidForDocument(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l}(r,e,t)}function __PRIVATE_mutationExtractBaseValue(r,e){let t=null;for(const n of r.fieldTransforms){const s=e.data.field(n.field),o=__PRIVATE_computeTransformOperationBaseValue(n.transform,s||null);o!=null&&(t===null&&(t=ObjectValue.empty()),t.set(n.field,o))}return t||null}function __PRIVATE_mutationEquals(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&__PRIVATE_arrayEquals(n,s,(o,a)=>__PRIVATE_fieldTransformEquals(o,a))}(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}class __PRIVATE_SetMutation extends Mutation{constructor(e,t,n,s=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class __PRIVATE_PatchMutation extends Mutation{constructor(e,t,n,s,o=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function __PRIVATE_getPatch(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function __PRIVATE_serverTransformResults(r,e,t){const n=new Map;__PRIVATE_hardAssert(r.length===t.length);for(let s=0;s<t.length;s++){const o=r[s],a=o.transform,l=e.data.field(o.field);n.set(o.field,__PRIVATE_applyTransformOperationToRemoteDocument(a,l,t[s]))}return n}function __PRIVATE_localTransformResults(r,e,t){const n=new Map;for(const s of r){const o=s.transform,a=t.data.field(s.field);n.set(s.field,__PRIVATE_applyTransformOperationToLocalView(o,a,e))}return n}class __PRIVATE_DeleteMutation extends Mutation{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class __PRIVATE_VerifyMutation extends Mutation{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MutationBatch{constructor(e,t,n,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(e.key)&&__PRIVATE_mutationApplyToRemoteDocument(o,e,n[s])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=__PRIVATE_mutationApplyToLocalView(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=__PRIVATE_mutationApplyToLocalView(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=__PRIVATE_newMutationMap();return this.mutations.forEach(s=>{const o=e.get(s.key),a=o.overlayedDocument;let l=this.applyToLocalView(a,o.mutatedFields);l=t.has(s.key)?null:l;const f=__PRIVATE_calculateOverlayMutation(a,l);f!==null&&n.set(s.key,f),a.isValidDocument()||a.convertToNoDocument(SnapshotVersion.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),__PRIVATE_documentKeySet())}isEqual(e){return this.batchId===e.batchId&&__PRIVATE_arrayEquals(this.mutations,e.mutations,(t,n)=>__PRIVATE_mutationEquals(t,n))&&__PRIVATE_arrayEquals(this.baseMutations,e.baseMutations,(t,n)=>__PRIVATE_mutationEquals(t,n))}}class MutationBatchResult{constructor(e,t,n,s){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=s}static from(e,t,n){__PRIVATE_hardAssert(e.mutations.length===n.length);let s=function(){return ae}();const o=e.mutations;for(let a=0;a<o.length;a++)s=s.insert(o[a].key,n[a].version);return new MutationBatchResult(e,t,n,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Overlay{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ExistenceFilter{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var le,he;function __PRIVATE_isPermanentError(r){switch(r){default:return fail();case D.CANCELLED:case D.UNKNOWN:case D.DEADLINE_EXCEEDED:case D.RESOURCE_EXHAUSTED:case D.INTERNAL:case D.UNAVAILABLE:case D.UNAUTHENTICATED:return!1;case D.INVALID_ARGUMENT:case D.NOT_FOUND:case D.ALREADY_EXISTS:case D.PERMISSION_DENIED:case D.FAILED_PRECONDITION:case D.ABORTED:case D.OUT_OF_RANGE:case D.UNIMPLEMENTED:case D.DATA_LOSS:return!0}}function __PRIVATE_mapCodeFromRpcCode(r){if(r===void 0)return __PRIVATE_logError("GRPC error has no .code"),D.UNKNOWN;switch(r){case le.OK:return D.OK;case le.CANCELLED:return D.CANCELLED;case le.UNKNOWN:return D.UNKNOWN;case le.DEADLINE_EXCEEDED:return D.DEADLINE_EXCEEDED;case le.RESOURCE_EXHAUSTED:return D.RESOURCE_EXHAUSTED;case le.INTERNAL:return D.INTERNAL;case le.UNAVAILABLE:return D.UNAVAILABLE;case le.UNAUTHENTICATED:return D.UNAUTHENTICATED;case le.INVALID_ARGUMENT:return D.INVALID_ARGUMENT;case le.NOT_FOUND:return D.NOT_FOUND;case le.ALREADY_EXISTS:return D.ALREADY_EXISTS;case le.PERMISSION_DENIED:return D.PERMISSION_DENIED;case le.FAILED_PRECONDITION:return D.FAILED_PRECONDITION;case le.ABORTED:return D.ABORTED;case le.OUT_OF_RANGE:return D.OUT_OF_RANGE;case le.UNIMPLEMENTED:return D.UNIMPLEMENTED;case le.DATA_LOSS:return D.DATA_LOSS;default:return fail()}}(he=le||(le={}))[he.OK=0]="OK",he[he.CANCELLED=1]="CANCELLED",he[he.UNKNOWN=2]="UNKNOWN",he[he.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",he[he.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",he[he.NOT_FOUND=5]="NOT_FOUND",he[he.ALREADY_EXISTS=6]="ALREADY_EXISTS",he[he.PERMISSION_DENIED=7]="PERMISSION_DENIED",he[he.UNAUTHENTICATED=16]="UNAUTHENTICATED",he[he.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",he[he.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",he[he.ABORTED=10]="ABORTED",he[he.OUT_OF_RANGE=11]="OUT_OF_RANGE",he[he.UNIMPLEMENTED=12]="UNIMPLEMENTED",he[he.INTERNAL=13]="INTERNAL",he[he.UNAVAILABLE=14]="UNAVAILABLE",he[he.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_newTextEncoder(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ie=new Integer([4294967295,4294967295],0);function __PRIVATE_getMd5HashValue(r){const e=__PRIVATE_newTextEncoder().encode(r),t=new Md5;return t.update(e),new Uint8Array(t.digest())}function __PRIVATE_get64BitUints(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),s=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new Integer([t,n],0),new Integer([s,o],0)]}class BloomFilter{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new __PRIVATE_BloomFilterError(`Invalid padding: ${t}`);if(n<0)throw new __PRIVATE_BloomFilterError(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new __PRIVATE_BloomFilterError(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new __PRIVATE_BloomFilterError(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Integer.fromNumber(this.Ie)}Ee(e,t,n){let s=e.add(t.multiply(Integer.fromNumber(n)));return s.compare(Ie)===1&&(s=new Integer([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=__PRIVATE_getMd5HashValue(e),[n,s]=__PRIVATE_get64BitUints(t);for(let o=0;o<this.hashCount;o++){const a=this.Ee(n,s,o);if(!this.de(a))return!1}return!0}static create(e,t,n){const s=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new BloomFilter(o,s,t);return n.forEach(l=>a.insert(l)),a}insert(e){if(this.Ie===0)return;const t=__PRIVATE_getMd5HashValue(e),[n,s]=__PRIVATE_get64BitUints(t);for(let o=0;o<this.hashCount;o++){const a=this.Ee(n,s,o);this.Ae(a)}}Ae(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class __PRIVATE_BloomFilterError extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RemoteEvent{constructor(e,t,n,s,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const s=new Map;return s.set(e,TargetChange.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new RemoteEvent(SnapshotVersion.min(),s,new SortedMap(__PRIVATE_primitiveComparator),__PRIVATE_mutableDocumentMap(),__PRIVATE_documentKeySet())}}class TargetChange{constructor(e,t,n,s,o){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new TargetChange(n,t,__PRIVATE_documentKeySet(),__PRIVATE_documentKeySet(),__PRIVATE_documentKeySet())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_DocumentWatchChange{constructor(e,t,n,s){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=s}}class __PRIVATE_ExistenceFilterChange{constructor(e,t){this.targetId=e,this.me=t}}class __PRIVATE_WatchTargetChange{constructor(e,t,n=ByteString.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=s}}class __PRIVATE_TargetState{constructor(){this.fe=0,this.ge=__PRIVATE_snapshotChangesMap(),this.pe=ByteString.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=__PRIVATE_documentKeySet(),t=__PRIVATE_documentKeySet(),n=__PRIVATE_documentKeySet();return this.ge.forEach((s,o)=>{switch(o){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:n=n.add(s);break;default:fail()}}),new TargetChange(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=__PRIVATE_snapshotChangesMap()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,__PRIVATE_hardAssert(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class __PRIVATE_WatchChangeAggregator{constructor(e){this.Le=e,this.Be=new Map,this.ke=__PRIVATE_mutableDocumentMap(),this.qe=__PRIVATE_documentTargetMap(),this.Qe=new SortedMap(__PRIVATE_primitiveComparator)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:fail()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,n=e.me.count,s=this.Je(t);if(s){const o=s.target;if(__PRIVATE_targetIsDocumentTarget(o))if(n===0){const a=new DocumentKey(o.path);this.Ue(t,a,MutableDocument.newNoDocument(a,SnapshotVersion.min()))}else __PRIVATE_hardAssert(n===1);else{const a=this.Ye(t);if(a!==n){const l=this.Ze(e),f=l?this.Xe(l,e,a):1;if(f!==0){this.je(t);const d=f===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,d)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:o=0}=t;let a,l;try{a=__PRIVATE_normalizeByteString(n).toUint8Array()}catch(f){if(f instanceof __PRIVATE_Base64DecodeError)return __PRIVATE_logWarn("Decoding the base64 bloom filter in existence filter failed ("+f.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw f}try{l=new BloomFilter(a,s,o)}catch(f){return __PRIVATE_logWarn(f instanceof __PRIVATE_BloomFilterError?"BloomFilter error: ":"Applying bloom filter failed: ",f),null}return l.Ie===0?null:l}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let s=0;return n.forEach(o=>{const a=this.Le.tt(),l=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(l)||(this.Ue(t,o,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((o,a)=>{const l=this.Je(a);if(l){if(o.current&&__PRIVATE_targetIsDocumentTarget(l.target)){const f=new DocumentKey(l.target.path);this.ke.get(f)!==null||this.it(a,f)||this.Ue(a,f,MutableDocument.newNoDocument(f,e))}o.be&&(t.set(a,o.ve()),o.Ce())}});let n=__PRIVATE_documentKeySet();this.qe.forEach((o,a)=>{let l=!0;a.forEachWhile(f=>{const d=this.Je(f);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(n=n.add(o))}),this.ke.forEach((o,a)=>a.setReadTime(e));const s=new RemoteEvent(e,t,this.Qe,this.ke,n);return this.ke=__PRIVATE_mutableDocumentMap(),this.qe=__PRIVATE_documentTargetMap(),this.Qe=new SortedMap(__PRIVATE_primitiveComparator),s}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new __PRIVATE_TargetState,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new SortedSet(__PRIVATE_primitiveComparator),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||__PRIVATE_logDebug("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new __PRIVATE_TargetState),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function __PRIVATE_documentTargetMap(){return new SortedMap(DocumentKey.comparator)}function __PRIVATE_snapshotChangesMap(){return new SortedMap(DocumentKey.comparator)}const Te=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),Ee=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),de=(()=>({and:"AND",or:"OR"}))();class JsonProtoSerializer{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function __PRIVATE_toInt32Proto(r,e){return r.useProto3Json||__PRIVATE_isNullOrUndefined(e)?e:{value:e}}function toTimestamp(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function __PRIVATE_toBytes(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function __PRIVATE_toVersion(r,e){return toTimestamp(r,e.toTimestamp())}function __PRIVATE_fromVersion(r){return __PRIVATE_hardAssert(!!r),SnapshotVersion.fromTimestamp(function(t){const n=__PRIVATE_normalizeTimestamp(t);return new Timestamp(n.seconds,n.nanos)}(r))}function __PRIVATE_toResourceName(r,e){return __PRIVATE_toResourcePath(r,e).canonicalString()}function __PRIVATE_toResourcePath(r,e){const t=function(s){return new ResourcePath(["projects",s.projectId,"databases",s.database])}(r).child("documents");return e===void 0?t:t.child(e)}function __PRIVATE_fromResourceName(r){const e=ResourcePath.fromString(r);return __PRIVATE_hardAssert(__PRIVATE_isValidResourceName(e)),e}function __PRIVATE_toName(r,e){return __PRIVATE_toResourceName(r.databaseId,e.path)}function fromName(r,e){const t=__PRIVATE_fromResourceName(e);if(t.get(1)!==r.databaseId.projectId)throw new FirestoreError(D.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new FirestoreError(D.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new DocumentKey(__PRIVATE_extractLocalPathFromResourceName(t))}function __PRIVATE_toQueryPath(r,e){return __PRIVATE_toResourceName(r.databaseId,e)}function __PRIVATE_fromQueryPath(r){const e=__PRIVATE_fromResourceName(r);return e.length===4?ResourcePath.emptyPath():__PRIVATE_extractLocalPathFromResourceName(e)}function __PRIVATE_getEncodedDatabaseId(r){return new ResourcePath(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function __PRIVATE_extractLocalPathFromResourceName(r){return __PRIVATE_hardAssert(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function __PRIVATE_toMutationDocument(r,e,t){return{name:__PRIVATE_toName(r,e),fields:t.value.mapValue.fields}}function __PRIVATE_fromWatchChange(r,e){let t;if("targetChange"in e){e.targetChange;const n=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:fail()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],o=function(d,A){return d.useProto3Json?(__PRIVATE_hardAssert(A===void 0||typeof A=="string"),ByteString.fromBase64String(A||"")):(__PRIVATE_hardAssert(A===void 0||A instanceof Buffer||A instanceof Uint8Array),ByteString.fromUint8Array(A||new Uint8Array))}(r,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&function(d){const A=d.code===void 0?D.UNKNOWN:__PRIVATE_mapCodeFromRpcCode(d.code);return new FirestoreError(A,d.message||"")}(a);t=new __PRIVATE_WatchTargetChange(n,s,o,l||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const s=fromName(r,n.document.name),o=__PRIVATE_fromVersion(n.document.updateTime),a=n.document.createTime?__PRIVATE_fromVersion(n.document.createTime):SnapshotVersion.min(),l=new ObjectValue({mapValue:{fields:n.document.fields}}),f=MutableDocument.newFoundDocument(s,o,a,l),d=n.targetIds||[],A=n.removedTargetIds||[];t=new __PRIVATE_DocumentWatchChange(d,A,f.key,f)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const s=fromName(r,n.document),o=n.readTime?__PRIVATE_fromVersion(n.readTime):SnapshotVersion.min(),a=MutableDocument.newNoDocument(s,o),l=n.removedTargetIds||[];t=new __PRIVATE_DocumentWatchChange([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const s=fromName(r,n.document),o=n.removedTargetIds||[];t=new __PRIVATE_DocumentWatchChange([],o,s,null)}else{if(!("filter"in e))return fail();{e.filter;const n=e.filter;n.targetId;const{count:s=0,unchangedNames:o}=n,a=new ExistenceFilter(s,o),l=n.targetId;t=new __PRIVATE_ExistenceFilterChange(l,a)}}return t}function toMutation(r,e){let t;if(e instanceof __PRIVATE_SetMutation)t={update:__PRIVATE_toMutationDocument(r,e.key,e.value)};else if(e instanceof __PRIVATE_DeleteMutation)t={delete:__PRIVATE_toName(r,e.key)};else if(e instanceof __PRIVATE_PatchMutation)t={update:__PRIVATE_toMutationDocument(r,e.key,e.data),updateMask:__PRIVATE_toDocumentMask(e.fieldMask)};else{if(!(e instanceof __PRIVATE_VerifyMutation))return fail();t={verify:__PRIVATE_toName(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(o,a){const l=a.transform;if(l instanceof __PRIVATE_ServerTimestampTransform)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof __PRIVATE_ArrayUnionTransformOperation)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof __PRIVATE_ArrayRemoveTransformOperation)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof __PRIVATE_NumericIncrementTransformOperation)return{fieldPath:a.field.canonicalString(),increment:l.Pe};throw fail()}(0,n))),e.precondition.isNone||(t.currentDocument=function(s,o){return o.updateTime!==void 0?{updateTime:__PRIVATE_toVersion(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:fail()}(r,e.precondition)),t}function __PRIVATE_fromWriteResults(r,e){return r&&r.length>0?(__PRIVATE_hardAssert(e!==void 0),r.map(t=>function(s,o){let a=s.updateTime?__PRIVATE_fromVersion(s.updateTime):__PRIVATE_fromVersion(o);return a.isEqual(SnapshotVersion.min())&&(a=__PRIVATE_fromVersion(o)),new MutationResult(a,s.transformResults||[])}(t,e))):[]}function __PRIVATE_toDocumentsTarget(r,e){return{documents:[__PRIVATE_toQueryPath(r,e.path)]}}function __PRIVATE_toQueryTarget(r,e){const t={structuredQuery:{}},n=e.path;let s;e.collectionGroup!==null?(s=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=__PRIVATE_toQueryPath(r,s);const o=function(d){if(d.length!==0)return __PRIVATE_toFilter(CompositeFilter.create(d,"and"))}(e.filters);o&&(t.structuredQuery.where=o);const a=function(d){if(d.length!==0)return d.map(A=>function(q){return{field:__PRIVATE_toFieldPathReference(q.field),direction:__PRIVATE_toDirection(q.dir)}}(A))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const l=__PRIVATE_toInt32Proto(r,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{_t:t,parent:s}}function __PRIVATE_convertQueryTargetToQuery(r){let e=__PRIVATE_fromQueryPath(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let s=null;if(n>0){__PRIVATE_hardAssert(n===1);const A=t.from[0];A.allDescendants?s=A.collectionId:e=e.child(A.collectionId)}let o=[];t.where&&(o=function(M){const q=__PRIVATE_fromFilter(M);return q instanceof CompositeFilter&&__PRIVATE_compositeFilterIsFlatConjunction(q)?q.getFilters():[q]}(t.where));let a=[];t.orderBy&&(a=function(M){return M.map(q=>function(g){return new OrderBy(__PRIVATE_fromFieldPathReference(g.field),function(I){switch(I){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(g.direction))}(q))}(t.orderBy));let l=null;t.limit&&(l=function(M){let q;return q=typeof M=="object"?M.value:M,__PRIVATE_isNullOrUndefined(q)?null:q}(t.limit));let f=null;t.startAt&&(f=function(M){const q=!!M.before,V=M.values||[];return new Bound(V,q)}(t.startAt));let d=null;return t.endAt&&(d=function(M){const q=!M.before,V=M.values||[];return new Bound(V,q)}(t.endAt)),__PRIVATE_newQuery(e,s,a,o,l,"F",f,d)}function __PRIVATE_toListenRequestLabels(r,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return fail()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function __PRIVATE_fromFilter(r){return r.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=__PRIVATE_fromFieldPathReference(t.unaryFilter.field);return FieldFilter.create(n,"==",{doubleValue:NaN});case"IS_NULL":const s=__PRIVATE_fromFieldPathReference(t.unaryFilter.field);return FieldFilter.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=__PRIVATE_fromFieldPathReference(t.unaryFilter.field);return FieldFilter.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=__PRIVATE_fromFieldPathReference(t.unaryFilter.field);return FieldFilter.create(a,"!=",{nullValue:"NULL_VALUE"});default:return fail()}}(r):r.fieldFilter!==void 0?function(t){return FieldFilter.create(__PRIVATE_fromFieldPathReference(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return fail()}}(t.fieldFilter.op),t.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(t){return CompositeFilter.create(t.compositeFilter.filters.map(n=>__PRIVATE_fromFilter(n)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return fail()}}(t.compositeFilter.op))}(r):fail()}function __PRIVATE_toDirection(r){return Te[r]}function __PRIVATE_toOperatorName(r){return Ee[r]}function __PRIVATE_toCompositeOperatorName(r){return de[r]}function __PRIVATE_toFieldPathReference(r){return{fieldPath:r.canonicalString()}}function __PRIVATE_fromFieldPathReference(r){return FieldPath$1.fromServerFormat(r.fieldPath)}function __PRIVATE_toFilter(r){return r instanceof FieldFilter?function(t){if(t.op==="=="){if(__PRIVATE_isNanValue(t.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(t.field),op:"IS_NAN"}};if(__PRIVATE_isNullValue(t.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(__PRIVATE_isNanValue(t.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(t.field),op:"IS_NOT_NAN"}};if(__PRIVATE_isNullValue(t.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:__PRIVATE_toFieldPathReference(t.field),op:__PRIVATE_toOperatorName(t.op),value:t.value}}}(r):r instanceof CompositeFilter?function(t){const n=t.getFilters().map(s=>__PRIVATE_toFilter(s));return n.length===1?n[0]:{compositeFilter:{op:__PRIVATE_toCompositeOperatorName(t.op),filters:n}}}(r):fail()}function __PRIVATE_toDocumentMask(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function __PRIVATE_isValidResourceName(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TargetData{constructor(e,t,n,s,o=SnapshotVersion.min(),a=SnapshotVersion.min(),l=ByteString.EMPTY_BYTE_STRING,f=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=f}withSequenceNumber(e){return new TargetData(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_LocalSerializer{constructor(e){this.ct=e}}function __PRIVATE_fromBundledQuery(r){const e=__PRIVATE_convertQueryTargetToQuery({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?__PRIVATE_queryWithLimit(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryIndexManager{constructor(){this.un=new __PRIVATE_MemoryCollectionParentIndex}addToCollectionParentIndex(e,t){return this.un.add(t),PersistencePromise.resolve()}getCollectionParents(e,t){return PersistencePromise.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return PersistencePromise.resolve()}deleteFieldIndex(e,t){return PersistencePromise.resolve()}deleteAllFieldIndexes(e){return PersistencePromise.resolve()}createTargetIndexes(e,t){return PersistencePromise.resolve()}getDocumentsMatchingTarget(e,t){return PersistencePromise.resolve(null)}getIndexType(e,t){return PersistencePromise.resolve(0)}getFieldIndexes(e,t){return PersistencePromise.resolve([])}getNextCollectionGroupToUpdate(e){return PersistencePromise.resolve(null)}getMinOffset(e,t){return PersistencePromise.resolve(IndexOffset.min())}getMinOffsetFromCollectionGroup(e,t){return PersistencePromise.resolve(IndexOffset.min())}updateCollectionGroup(e,t,n){return PersistencePromise.resolve()}updateIndexEntries(e,t){return PersistencePromise.resolve()}}class __PRIVATE_MemoryCollectionParentIndex{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t]||new SortedSet(ResourcePath.comparator),o=!s.has(n);return this.index[t]=s.add(n),o}has(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t];return s&&s.has(n)}getEntries(e){return(this.index[e]||new SortedSet(ResourcePath.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_TargetIdGenerator{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new __PRIVATE_TargetIdGenerator(0)}static kn(){return new __PRIVATE_TargetIdGenerator(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RemoteDocumentChangeBuffer{constructor(){this.changes=new ObjectMap(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,MutableDocument.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?PersistencePromise.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OverlayedDocument{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LocalDocumentsView{constructor(e,t,n,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(n=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(n!==null&&__PRIVATE_mutationApplyToLocalView(n.mutation,s,FieldMask.empty(),Timestamp.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,__PRIVATE_documentKeySet()).next(()=>n))}getLocalViewOfDocuments(e,t,n=__PRIVATE_documentKeySet()){const s=__PRIVATE_newOverlayMap();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,n).next(o=>{let a=documentMap();return o.forEach((l,f)=>{a=a.insert(l,f.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const n=__PRIVATE_newOverlayMap();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,__PRIVATE_documentKeySet()))}populateOverlays(e,t,n){const s=[];return n.forEach(o=>{t.has(o)||s.push(o)}),this.documentOverlayCache.getOverlays(e,s).next(o=>{o.forEach((a,l)=>{t.set(a,l)})})}computeViews(e,t,n,s){let o=__PRIVATE_mutableDocumentMap();const a=__PRIVATE_newDocumentKeyMap(),l=function(){return __PRIVATE_newDocumentKeyMap()}();return t.forEach((f,d)=>{const A=n.get(d.key);s.has(d.key)&&(A===void 0||A.mutation instanceof __PRIVATE_PatchMutation)?o=o.insert(d.key,d):A!==void 0?(a.set(d.key,A.mutation.getFieldMask()),__PRIVATE_mutationApplyToLocalView(A.mutation,d,A.mutation.getFieldMask(),Timestamp.now())):a.set(d.key,FieldMask.empty())}),this.recalculateAndSaveOverlays(e,o).next(f=>(f.forEach((d,A)=>a.set(d,A)),t.forEach((d,A)=>{var M;return l.set(d,new OverlayedDocument(A,(M=a.get(d))!==null&&M!==void 0?M:null))}),l))}recalculateAndSaveOverlays(e,t){const n=__PRIVATE_newDocumentKeyMap();let s=new SortedMap((a,l)=>a-l),o=__PRIVATE_documentKeySet();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const l of a)l.keys().forEach(f=>{const d=t.get(f);if(d===null)return;let A=n.get(f)||FieldMask.empty();A=l.applyToLocalView(d,A),n.set(f,A);const M=(s.get(l.batchId)||__PRIVATE_documentKeySet()).add(f);s=s.insert(l.batchId,M)})}).next(()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const f=l.getNext(),d=f.key,A=f.value,M=__PRIVATE_newMutationMap();A.forEach(q=>{if(!o.has(q)){const V=__PRIVATE_calculateOverlayMutation(t.get(q),n.get(q));V!==null&&M.set(q,V),o=o.add(q)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,M))}return PersistencePromise.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,s){return function(a){return DocumentKey.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):__PRIVATE_isCollectionGroupQuery(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,s):this.getDocumentsMatchingCollectionQuery(e,t,n,s)}getNextDocuments(e,t,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,s).next(o=>{const a=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,s-o.size):PersistencePromise.resolve(__PRIVATE_newOverlayMap());let l=-1,f=o;return a.next(d=>PersistencePromise.forEach(d,(A,M)=>(l<M.largestBatchId&&(l=M.largestBatchId),o.get(A)?PersistencePromise.resolve():this.remoteDocumentCache.getEntry(e,A).next(q=>{f=f.insert(A,q)}))).next(()=>this.populateOverlays(e,d,o)).next(()=>this.computeViews(e,f,d,__PRIVATE_documentKeySet())).next(A=>({batchId:l,changes:__PRIVATE_convertOverlayedDocumentMapToDocumentMap(A)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new DocumentKey(t)).next(n=>{let s=documentMap();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,n,s){const o=t.collectionGroup;let a=documentMap();return this.indexManager.getCollectionParents(e,o).next(l=>PersistencePromise.forEach(l,f=>{const d=function(M,q){return new __PRIVATE_QueryImpl(q,null,M.explicitOrderBy.slice(),M.filters.slice(),M.limit,M.limitType,M.startAt,M.endAt)}(t,f.child(o));return this.getDocumentsMatchingCollectionQuery(e,d,n,s).next(A=>{A.forEach((M,q)=>{a=a.insert(M,q)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,n,s){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,o,s))).next(a=>{o.forEach((f,d)=>{const A=d.getKey();a.get(A)===null&&(a=a.insert(A,MutableDocument.newInvalidDocument(A)))});let l=documentMap();return a.forEach((f,d)=>{const A=o.get(f);A!==void 0&&__PRIVATE_mutationApplyToLocalView(A.mutation,d,FieldMask.empty(),Timestamp.now()),__PRIVATE_queryMatches(t,d)&&(l=l.insert(f,d))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryBundleCache{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return PersistencePromise.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:__PRIVATE_fromVersion(s.createTime)}}(t)),PersistencePromise.resolve()}getNamedQuery(e,t){return PersistencePromise.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:__PRIVATE_fromBundledQuery(s.bundledQuery),readTime:__PRIVATE_fromVersion(s.readTime)}}(t)),PersistencePromise.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryDocumentOverlayCache{constructor(){this.overlays=new SortedMap(DocumentKey.comparator),this.Ir=new Map}getOverlay(e,t){return PersistencePromise.resolve(this.overlays.get(t))}getOverlays(e,t){const n=__PRIVATE_newOverlayMap();return PersistencePromise.forEach(t,s=>this.getOverlay(e,s).next(o=>{o!==null&&n.set(s,o)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((s,o)=>{this.ht(e,t,o)}),PersistencePromise.resolve()}removeOverlaysForBatchId(e,t,n){const s=this.Ir.get(n);return s!==void 0&&(s.forEach(o=>this.overlays=this.overlays.remove(o)),this.Ir.delete(n)),PersistencePromise.resolve()}getOverlaysForCollection(e,t,n){const s=__PRIVATE_newOverlayMap(),o=t.length+1,a=new DocumentKey(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const f=l.getNext().value,d=f.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===o&&f.largestBatchId>n&&s.set(f.getKey(),f)}return PersistencePromise.resolve(s)}getOverlaysForCollectionGroup(e,t,n,s){let o=new SortedMap((d,A)=>d-A);const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>n){let A=o.get(d.largestBatchId);A===null&&(A=__PRIVATE_newOverlayMap(),o=o.insert(d.largestBatchId,A)),A.set(d.getKey(),d)}}const l=__PRIVATE_newOverlayMap(),f=o.getIterator();for(;f.hasNext()&&(f.getNext().value.forEach((d,A)=>l.set(d,A)),!(l.size()>=s)););return PersistencePromise.resolve(l)}ht(e,t,n){const s=this.overlays.get(n.key);if(s!==null){const a=this.Ir.get(s.largestBatchId).delete(n.key);this.Ir.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new Overlay(t,n));let o=this.Ir.get(t);o===void 0&&(o=__PRIVATE_documentKeySet(),this.Ir.set(t,o)),this.Ir.set(t,o.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryGlobalsCache{constructor(){this.sessionToken=ByteString.EMPTY_BYTE_STRING}getSessionToken(e){return PersistencePromise.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,PersistencePromise.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_ReferenceSet{constructor(){this.Tr=new SortedSet(__PRIVATE_DocReference.Er),this.dr=new SortedSet(__PRIVATE_DocReference.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new __PRIVATE_DocReference(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new __PRIVATE_DocReference(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){const t=new DocumentKey(new ResourcePath([])),n=new __PRIVATE_DocReference(t,e),s=new __PRIVATE_DocReference(t,e+1),o=[];return this.dr.forEachInRange([n,s],a=>{this.Vr(a),o.push(a.key)}),o}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new DocumentKey(new ResourcePath([])),n=new __PRIVATE_DocReference(t,e),s=new __PRIVATE_DocReference(t,e+1);let o=__PRIVATE_documentKeySet();return this.dr.forEachInRange([n,s],a=>{o=o.add(a.key)}),o}containsKey(e){const t=new __PRIVATE_DocReference(e,0),n=this.Tr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class __PRIVATE_DocReference{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return DocumentKey.comparator(e.key,t.key)||__PRIVATE_primitiveComparator(e.wr,t.wr)}static Ar(e,t){return __PRIVATE_primitiveComparator(e.wr,t.wr)||DocumentKey.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryMutationQueue{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new SortedSet(__PRIVATE_DocReference.Er)}checkEmpty(e){return PersistencePromise.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,s){const o=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new MutationBatch(o,t,n,s);this.mutationQueue.push(a);for(const l of s)this.br=this.br.add(new __PRIVATE_DocReference(l.key,o)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return PersistencePromise.resolve(a)}lookupMutationBatch(e,t){return PersistencePromise.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,s=this.vr(n),o=s<0?0:s;return PersistencePromise.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return PersistencePromise.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return PersistencePromise.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new __PRIVATE_DocReference(t,0),s=new __PRIVATE_DocReference(t,Number.POSITIVE_INFINITY),o=[];return this.br.forEachInRange([n,s],a=>{const l=this.Dr(a.wr);o.push(l)}),PersistencePromise.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new SortedSet(__PRIVATE_primitiveComparator);return t.forEach(s=>{const o=new __PRIVATE_DocReference(s,0),a=new __PRIVATE_DocReference(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([o,a],l=>{n=n.add(l.wr)})}),PersistencePromise.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,s=n.length+1;let o=n;DocumentKey.isDocumentKey(o)||(o=o.child(""));const a=new __PRIVATE_DocReference(new DocumentKey(o),0);let l=new SortedSet(__PRIVATE_primitiveComparator);return this.br.forEachWhile(f=>{const d=f.key.path;return!!n.isPrefixOf(d)&&(d.length===s&&(l=l.add(f.wr)),!0)},a),PersistencePromise.resolve(this.Cr(l))}Cr(e){const t=[];return e.forEach(n=>{const s=this.Dr(n);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){__PRIVATE_hardAssert(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.br;return PersistencePromise.forEach(t.mutations,s=>{const o=new __PRIVATE_DocReference(s.key,t.batchId);return n=n.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new __PRIVATE_DocReference(t,0),s=this.br.firstAfterOrEqual(n);return PersistencePromise.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,PersistencePromise.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryRemoteDocumentCacheImpl{constructor(e){this.Mr=e,this.docs=function(){return new SortedMap(DocumentKey.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,s=this.docs.get(n),o=s?s.size:0,a=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return PersistencePromise.resolve(n?n.document.mutableCopy():MutableDocument.newInvalidDocument(t))}getEntries(e,t){let n=__PRIVATE_mutableDocumentMap();return t.forEach(s=>{const o=this.docs.get(s);n=n.insert(s,o?o.document.mutableCopy():MutableDocument.newInvalidDocument(s))}),PersistencePromise.resolve(n)}getDocumentsMatchingQuery(e,t,n,s){let o=__PRIVATE_mutableDocumentMap();const a=t.path,l=new DocumentKey(a.child("")),f=this.docs.getIteratorFrom(l);for(;f.hasNext();){const{key:d,value:{document:A}}=f.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||__PRIVATE_indexOffsetComparator(__PRIVATE_newIndexOffsetFromDocument(A),n)<=0||(s.has(A.key)||__PRIVATE_queryMatches(t,A))&&(o=o.insert(A.key,A.mutableCopy()))}return PersistencePromise.resolve(o)}getAllFromCollectionGroup(e,t,n,s){fail()}Or(e,t){return PersistencePromise.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new __PRIVATE_MemoryRemoteDocumentChangeBuffer(this)}getSize(e){return PersistencePromise.resolve(this.size)}}class __PRIVATE_MemoryRemoteDocumentChangeBuffer extends RemoteDocumentChangeBuffer{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(n)}),PersistencePromise.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryTargetCache{constructor(e){this.persistence=e,this.Nr=new ObjectMap(t=>__PRIVATE_canonifyTarget(t),__PRIVATE_targetEquals),this.lastRemoteSnapshotVersion=SnapshotVersion.min(),this.highestTargetId=0,this.Lr=0,this.Br=new __PRIVATE_ReferenceSet,this.targetCount=0,this.kr=__PRIVATE_TargetIdGenerator.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,s)=>t(s)),PersistencePromise.resolve()}getLastRemoteSnapshotVersion(e){return PersistencePromise.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return PersistencePromise.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),PersistencePromise.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),PersistencePromise.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new __PRIVATE_TargetIdGenerator(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,PersistencePromise.resolve()}updateTargetData(e,t){return this.Kn(t),PersistencePromise.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,PersistencePromise.resolve()}removeTargets(e,t,n){let s=0;const o=[];return this.Nr.forEach((a,l)=>{l.sequenceNumber<=t&&n.get(l.targetId)===null&&(this.Nr.delete(a),o.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)}),PersistencePromise.waitFor(o).next(()=>s)}getTargetCount(e){return PersistencePromise.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return PersistencePromise.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),PersistencePromise.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const s=this.persistence.referenceDelegate,o=[];return s&&t.forEach(a=>{o.push(s.markPotentiallyOrphaned(e,a))}),PersistencePromise.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),PersistencePromise.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return PersistencePromise.resolve(n)}containsKey(e,t){return PersistencePromise.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryPersistence{constructor(e,t){this.qr={},this.overlays={},this.Qr=new __PRIVATE_ListenSequence(0),this.Kr=!1,this.Kr=!0,this.$r=new __PRIVATE_MemoryGlobalsCache,this.referenceDelegate=e(this),this.Ur=new __PRIVATE_MemoryTargetCache(this),this.indexManager=new __PRIVATE_MemoryIndexManager,this.remoteDocumentCache=function(s){return new __PRIVATE_MemoryRemoteDocumentCacheImpl(s)}(n=>this.referenceDelegate.Wr(n)),this.serializer=new __PRIVATE_LocalSerializer(t),this.Gr=new __PRIVATE_MemoryBundleCache(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new __PRIVATE_MemoryDocumentOverlayCache,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new __PRIVATE_MemoryMutationQueue(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){__PRIVATE_logDebug("MemoryPersistence","Starting transaction:",e);const s=new __PRIVATE_MemoryTransaction(this.Qr.next());return this.referenceDelegate.zr(),n(s).next(o=>this.referenceDelegate.jr(s).next(()=>o)).toPromise().then(o=>(s.raiseOnCommittedEvent(),o))}Hr(e,t){return PersistencePromise.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class __PRIVATE_MemoryTransaction extends PersistenceTransaction{constructor(e){super(),this.currentSequenceNumber=e}}class __PRIVATE_MemoryEagerDelegate{constructor(e){this.persistence=e,this.Jr=new __PRIVATE_ReferenceSet,this.Yr=null}static Zr(e){return new __PRIVATE_MemoryEagerDelegate(e)}get Xr(){if(this.Yr)return this.Yr;throw fail()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),PersistencePromise.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),PersistencePromise.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),PersistencePromise.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.Xr.add(o.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return PersistencePromise.forEach(this.Xr,n=>{const s=DocumentKey.fromPath(n);return this.ei(e,s).next(o=>{o||t.removeEntry(s,SnapshotVersion.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return PersistencePromise.or([()=>PersistencePromise.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_LocalViewChanges{constructor(e,t,n,s){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=s}static Wi(e,t){let n=__PRIVATE_documentKeySet(),s=__PRIVATE_documentKeySet();for(const o of t.docChanges)switch(o.type){case 0:n=n.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new __PRIVATE_LocalViewChanges(e,t.fromCache,n,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QueryContext{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_QueryEngine{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return isSafari()?8:__PRIVATE_getAndroidVersion(getUA())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,s){const o={result:null};return this.Yi(e,t).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.Zi(e,t,s,n).next(a=>{o.result=a})}).next(()=>{if(o.result)return;const a=new QueryContext;return this.Xi(e,t,a).next(l=>{if(o.result=l,this.zi)return this.es(e,t,a,l.size)})}).next(()=>o.result)}es(e,t,n,s){return n.documentReadCount<this.ji?(__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","SDK will not create cache indexes for query:",__PRIVATE_stringifyQuery(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),PersistencePromise.resolve()):(__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","Query:",__PRIVATE_stringifyQuery(t),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.Hi*s?(__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","The SDK decides to create cache indexes for query:",__PRIVATE_stringifyQuery(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,__PRIVATE_queryToTarget(t))):PersistencePromise.resolve())}Yi(e,t){if(__PRIVATE_queryMatchesAllDocuments(t))return PersistencePromise.resolve(null);let n=__PRIVATE_queryToTarget(t);return this.indexManager.getIndexType(e,n).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=__PRIVATE_queryWithLimit(t,null,"F"),n=__PRIVATE_queryToTarget(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(o=>{const a=__PRIVATE_documentKeySet(...o);return this.Ji.getDocuments(e,a).next(l=>this.indexManager.getMinOffset(e,n).next(f=>{const d=this.ts(t,l);return this.ns(t,d,a,f.readTime)?this.Yi(e,__PRIVATE_queryWithLimit(t,null,"F")):this.rs(e,d,t,f)}))})))}Zi(e,t,n,s){return __PRIVATE_queryMatchesAllDocuments(t)||s.isEqual(SnapshotVersion.min())?PersistencePromise.resolve(null):this.Ji.getDocuments(e,n).next(o=>{const a=this.ts(t,o);return this.ns(t,a,n,s)?PersistencePromise.resolve(null):(__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),__PRIVATE_stringifyQuery(t)),this.rs(e,a,t,__PRIVATE_newIndexOffsetSuccessorFromReadTime(s,-1)).next(l=>l))})}ts(e,t){let n=new SortedSet(__PRIVATE_newQueryComparator(e));return t.forEach((s,o)=>{__PRIVATE_queryMatches(e,o)&&(n=n.add(o))}),n}ns(e,t,n,s){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Xi(e,t,n){return __PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","Using full collection scan to execute query:",__PRIVATE_stringifyQuery(t)),this.Ji.getDocumentsMatchingQuery(e,t,IndexOffset.min(),n)}rs(e,t,n,s){return this.Ji.getDocumentsMatchingQuery(e,n,s).next(o=>(t.forEach(a=>{o=o.insert(a.key,a)}),o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_LocalStoreImpl{constructor(e,t,n,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new SortedMap(__PRIVATE_primitiveComparator),this._s=new ObjectMap(o=>__PRIVATE_canonifyTarget(o),__PRIVATE_targetEquals),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new LocalDocumentsView(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function __PRIVATE_newLocalStore(r,e,t,n){return new __PRIVATE_LocalStoreImpl(r,e,t,n)}async function __PRIVATE_localStoreHandleUserChange(r,e){const t=__PRIVATE_debugCast(r);return await t.persistence.runTransaction("Handle user change","readonly",n=>{let s;return t.mutationQueue.getAllMutationBatches(n).next(o=>(s=o,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(o=>{const a=[],l=[];let f=__PRIVATE_documentKeySet();for(const d of s){a.push(d.batchId);for(const A of d.mutations)f=f.add(A.key)}for(const d of o){l.push(d.batchId);for(const A of d.mutations)f=f.add(A.key)}return t.localDocuments.getDocuments(n,f).next(d=>({hs:d,removedBatchIds:a,addedBatchIds:l}))})})}function __PRIVATE_localStoreAcknowledgeBatch(r,e){const t=__PRIVATE_debugCast(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const s=e.batch.keys(),o=t.cs.newChangeBuffer({trackRemovals:!0});return function(l,f,d,A){const M=d.batch,q=M.keys();let V=PersistencePromise.resolve();return q.forEach(g=>{V=V.next(()=>A.getEntry(f,g)).next(F=>{const I=d.docVersions.get(g);__PRIVATE_hardAssert(I!==null),F.version.compareTo(I)<0&&(M.applyToRemoteDocument(F,d),F.isValidDocument()&&(F.setReadTime(d.commitVersion),A.addEntry(F)))})}),V.next(()=>l.mutationQueue.removeMutationBatch(f,M))}(t,n,e,o).next(()=>o.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(l){let f=__PRIVATE_documentKeySet();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(f=f.add(l.batch.mutations[d].key));return f}(e))).next(()=>t.localDocuments.getDocuments(n,s))})}function __PRIVATE_localStoreGetLastRemoteSnapshotVersion(r){const e=__PRIVATE_debugCast(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function __PRIVATE_localStoreApplyRemoteEventToLocalCache(r,e){const t=__PRIVATE_debugCast(r),n=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const a=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const l=[];e.targetChanges.forEach((A,M)=>{const q=s.get(M);if(!q)return;l.push(t.Ur.removeMatchingKeys(o,A.removedDocuments,M).next(()=>t.Ur.addMatchingKeys(o,A.addedDocuments,M)));let V=q.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(M)!==null?V=V.withResumeToken(ByteString.EMPTY_BYTE_STRING,SnapshotVersion.min()).withLastLimboFreeSnapshotVersion(SnapshotVersion.min()):A.resumeToken.approximateByteSize()>0&&(V=V.withResumeToken(A.resumeToken,n)),s=s.insert(M,V),function(F,I,j){return F.resumeToken.approximateByteSize()===0||I.snapshotVersion.toMicroseconds()-F.snapshotVersion.toMicroseconds()>=3e8?!0:j.addedDocuments.size+j.modifiedDocuments.size+j.removedDocuments.size>0}(q,V,A)&&l.push(t.Ur.updateTargetData(o,V))});let f=__PRIVATE_mutableDocumentMap(),d=__PRIVATE_documentKeySet();if(e.documentUpdates.forEach(A=>{e.resolvedLimboDocuments.has(A)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(o,A))}),l.push(__PRIVATE_populateDocumentChangeBuffer(o,a,e.documentUpdates).next(A=>{f=A.Ps,d=A.Is})),!n.isEqual(SnapshotVersion.min())){const A=t.Ur.getLastRemoteSnapshotVersion(o).next(M=>t.Ur.setTargetsMetadata(o,o.currentSequenceNumber,n));l.push(A)}return PersistencePromise.waitFor(l).next(()=>a.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,f,d)).next(()=>f)}).then(o=>(t.os=s,o))}function __PRIVATE_populateDocumentChangeBuffer(r,e,t){let n=__PRIVATE_documentKeySet(),s=__PRIVATE_documentKeySet();return t.forEach(o=>n=n.add(o)),e.getEntries(r,n).next(o=>{let a=__PRIVATE_mutableDocumentMap();return t.forEach((l,f)=>{const d=o.get(l);f.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),f.isNoDocument()&&f.version.isEqual(SnapshotVersion.min())?(e.removeEntry(l,f.readTime),a=a.insert(l,f)):!d.isValidDocument()||f.version.compareTo(d.version)>0||f.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(f),a=a.insert(l,f)):__PRIVATE_logDebug("LocalStore","Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",f.version)}),{Ps:a,Is:s}})}function __PRIVATE_localStoreGetNextMutationBatch(r,e){const t=__PRIVATE_debugCast(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function __PRIVATE_localStoreAllocateTarget(r,e){const t=__PRIVATE_debugCast(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let s;return t.Ur.getTargetData(n,e).next(o=>o?(s=o,PersistencePromise.resolve(s)):t.Ur.allocateTargetId(n).next(a=>(s=new TargetData(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,s).next(()=>s))))}).then(n=>{const s=t.os.get(n.targetId);return(s===null||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}async function __PRIVATE_localStoreReleaseTarget(r,e,t){const n=__PRIVATE_debugCast(r),s=n.os.get(e),o=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",o,a=>n.persistence.referenceDelegate.removeTarget(a,s))}catch(a){if(!__PRIVATE_isIndexedDbTransactionError(a))throw a;__PRIVATE_logDebug("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}n.os=n.os.remove(e),n._s.delete(s.target)}function __PRIVATE_localStoreExecuteQuery(r,e,t){const n=__PRIVATE_debugCast(r);let s=SnapshotVersion.min(),o=__PRIVATE_documentKeySet();return n.persistence.runTransaction("Execute query","readwrite",a=>function(f,d,A){const M=__PRIVATE_debugCast(f),q=M._s.get(A);return q!==void 0?PersistencePromise.resolve(M.os.get(q)):M.Ur.getTargetData(d,A)}(n,a,__PRIVATE_queryToTarget(e)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(a,l.targetId).next(f=>{o=f})}).next(()=>n.ss.getDocumentsMatchingQuery(a,e,t?s:SnapshotVersion.min(),t?o:__PRIVATE_documentKeySet())).next(l=>(__PRIVATE_setMaxReadTime(n,__PRIVATE_queryCollectionGroup(e),l),{documents:l,Ts:o})))}function __PRIVATE_setMaxReadTime(r,e,t){let n=r.us.get(e)||SnapshotVersion.min();t.forEach((s,o)=>{o.readTime.compareTo(n)>0&&(n=o.readTime)}),r.us.set(e,n)}class __PRIVATE_LocalClientState{constructor(){this.activeTargetIds=__PRIVATE_targetIdSet()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class __PRIVATE_MemorySharedClientState{constructor(){this.so=new __PRIVATE_LocalClientState,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new __PRIVATE_LocalClientState,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_NoopConnectivityMonitor{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_BrowserConnectivityMonitor{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){__PRIVATE_logDebug("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){__PRIVATE_logDebug("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let me=null;function __PRIVATE_generateUniqueDebugId(){return me===null?me=function(){return 268435456+Math.round(2147483648*Math.random())}():me++,"0x"+me.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fe={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_StreamBridge{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ge="WebChannelConnection";class __PRIVATE_WebChannelConnection extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),o=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${s}/databases/${o}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${o}`}get Fo(){return!1}Mo(t,n,s,o,a){const l=__PRIVATE_generateUniqueDebugId(),f=this.xo(t,n.toUriEncodedString());__PRIVATE_logDebug("RestConnection",`Sending RPC '${t}' ${l}:`,f,s);const d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,o,a),this.No(t,f,d,s).then(A=>(__PRIVATE_logDebug("RestConnection",`Received RPC '${t}' ${l}: `,A),A),A=>{throw __PRIVATE_logWarn("RestConnection",`RPC '${t}' ${l} failed with error: `,A,"url: ",f,"request:",s),A})}Lo(t,n,s,o,a,l){return this.Mo(t,n,s,o,a)}Oo(t,n,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+S}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((o,a)=>t[a]=o),s&&s.headers.forEach((o,a)=>t[a]=o)}xo(t,n){const s=fe[t];return`${this.Do}/v1/${n}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,s){const o=__PRIVATE_generateUniqueDebugId();return new Promise((a,l)=>{const f=new XhrIo;f.setWithCredentials(!0),f.listenOnce(EventType.COMPLETE,()=>{try{switch(f.getLastErrorCode()){case ErrorCode.NO_ERROR:const A=f.getResponseJson();__PRIVATE_logDebug(ge,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(A)),a(A);break;case ErrorCode.TIMEOUT:__PRIVATE_logDebug(ge,`RPC '${e}' ${o} timed out`),l(new FirestoreError(D.DEADLINE_EXCEEDED,"Request time out"));break;case ErrorCode.HTTP_ERROR:const M=f.getStatus();if(__PRIVATE_logDebug(ge,`RPC '${e}' ${o} failed with status:`,M,"response text:",f.getResponseText()),M>0){let q=f.getResponseJson();Array.isArray(q)&&(q=q[0]);const V=q==null?void 0:q.error;if(V&&V.status&&V.message){const g=function(I){const j=I.toLowerCase().replace(/_/g,"-");return Object.values(D).indexOf(j)>=0?j:D.UNKNOWN}(V.status);l(new FirestoreError(g,V.message))}else l(new FirestoreError(D.UNKNOWN,"Server responded with status "+f.getStatus()))}else l(new FirestoreError(D.UNAVAILABLE,"Connection failed."));break;default:fail()}}finally{__PRIVATE_logDebug(ge,`RPC '${e}' ${o} completed.`)}});const d=JSON.stringify(s);__PRIVATE_logDebug(ge,`RPC '${e}' ${o} sending request:`,s),f.send(t,"POST",d,n,15)})}Bo(e,t,n){const s=__PRIVATE_generateUniqueDebugId(),o=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=createWebChannelTransport(),l=getStatEventTarget(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(f.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(f.useFetchStreams=!0),this.Oo(f.initMessageHeaders,t,n),f.encodeInitMessageHeaders=!0;const A=o.join("");__PRIVATE_logDebug(ge,`Creating RPC '${e}' stream ${s}: ${A}`,f);const M=a.createWebChannel(A,f);let q=!1,V=!1;const g=new __PRIVATE_StreamBridge({Io:I=>{V?__PRIVATE_logDebug(ge,`Not sending because RPC '${e}' stream ${s} is closed:`,I):(q||(__PRIVATE_logDebug(ge,`Opening RPC '${e}' stream ${s} transport.`),M.open(),q=!0),__PRIVATE_logDebug(ge,`RPC '${e}' stream ${s} sending:`,I),M.send(I))},To:()=>M.close()}),F=(I,j,G)=>{I.listen(j,O=>{try{G(O)}catch(H){setTimeout(()=>{throw H},0)}})};return F(M,WebChannel.EventType.OPEN,()=>{V||(__PRIVATE_logDebug(ge,`RPC '${e}' stream ${s} transport opened.`),g.yo())}),F(M,WebChannel.EventType.CLOSE,()=>{V||(V=!0,__PRIVATE_logDebug(ge,`RPC '${e}' stream ${s} transport closed`),g.So())}),F(M,WebChannel.EventType.ERROR,I=>{V||(V=!0,__PRIVATE_logWarn(ge,`RPC '${e}' stream ${s} transport errored:`,I),g.So(new FirestoreError(D.UNAVAILABLE,"The operation could not be completed")))}),F(M,WebChannel.EventType.MESSAGE,I=>{var j;if(!V){const G=I.data[0];__PRIVATE_hardAssert(!!G);const O=G,H=O.error||((j=O[0])===null||j===void 0?void 0:j.error);if(H){__PRIVATE_logDebug(ge,`RPC '${e}' stream ${s} received error:`,H);const K=H.status;let Y=function(_){const E=le[_];if(E!==void 0)return __PRIVATE_mapCodeFromRpcCode(E)}(K),U=H.message;Y===void 0&&(Y=D.INTERNAL,U="Unknown error status: "+K+" with message "+H.message),V=!0,g.So(new FirestoreError(Y,U)),M.close()}else __PRIVATE_logDebug(ge,`RPC '${e}' stream ${s} received:`,G),g.bo(G)}}),F(l,Event$1.STAT_EVENT,I=>{I.stat===Stat.PROXY?__PRIVATE_logDebug(ge,`RPC '${e}' stream ${s} detected buffering proxy`):I.stat===Stat.NOPROXY&&__PRIVATE_logDebug(ge,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{g.wo()},0),g}}function getDocument(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_newSerializer(r){return new JsonProtoSerializer(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_ExponentialBackoff{constructor(e,t,n=1e3,s=1.5,o=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=s,this.Qo=o,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-n);s>0&&__PRIVATE_logDebug("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_PersistentStream{constructor(e,t,n,s,o,a,l,f){this.ui=e,this.Ho=n,this.Jo=s,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=f,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new __PRIVATE_ExponentialBackoff(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===D.RESOURCE_EXHAUSTED?(__PRIVATE_logError(t.toString()),__PRIVATE_logError("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===D.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,s])=>{this.Yo===t&&this.P_(n,s)},n=>{e(()=>{const s=new FirestoreError(D.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(s)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{n(()=>this.I_(s))}),this.stream.onMessage(s=>{n(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return __PRIVATE_logDebug("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(__PRIVATE_logDebug("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class __PRIVATE_PersistentListenStream extends __PRIVATE_PersistentStream{constructor(e,t,n,s,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,s,a),this.serializer=o}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=__PRIVATE_fromWatchChange(this.serializer,e),n=function(o){if(!("targetChange"in o))return SnapshotVersion.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?SnapshotVersion.min():a.readTime?__PRIVATE_fromVersion(a.readTime):SnapshotVersion.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=__PRIVATE_getEncodedDatabaseId(this.serializer),t.addTarget=function(o,a){let l;const f=a.target;if(l=__PRIVATE_targetIsDocumentTarget(f)?{documents:__PRIVATE_toDocumentsTarget(o,f)}:{query:__PRIVATE_toQueryTarget(o,f)._t},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=__PRIVATE_toBytes(o,a.resumeToken);const d=__PRIVATE_toInt32Proto(o,a.expectedCount);d!==null&&(l.expectedCount=d)}else if(a.snapshotVersion.compareTo(SnapshotVersion.min())>0){l.readTime=toTimestamp(o,a.snapshotVersion.toTimestamp());const d=__PRIVATE_toInt32Proto(o,a.expectedCount);d!==null&&(l.expectedCount=d)}return l}(this.serializer,e);const n=__PRIVATE_toListenRequestLabels(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=__PRIVATE_getEncodedDatabaseId(this.serializer),t.removeTarget=e,this.a_(t)}}class __PRIVATE_PersistentWriteStream extends __PRIVATE_PersistentStream{constructor(e,t,n,s,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,s,a),this.serializer=o}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return __PRIVATE_hardAssert(!!e.streamToken),this.lastStreamToken=e.streamToken,__PRIVATE_hardAssert(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){__PRIVATE_hardAssert(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=__PRIVATE_fromWriteResults(e.writeResults,e.commitTime),n=__PRIVATE_fromVersion(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=__PRIVATE_getEncodedDatabaseId(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>toMutation(this.serializer,n))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_DatastoreImpl extends class{}{constructor(e,t,n,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new FirestoreError(D.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Mo(e,__PRIVATE_toResourcePath(t,n),s,o,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new FirestoreError(D.UNKNOWN,o.toString())})}Lo(e,t,n,s,o){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.connection.Lo(e,__PRIVATE_toResourcePath(t,n),s,a,l,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new FirestoreError(D.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class __PRIVATE_OnlineStateTracker{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(__PRIVATE_logError(t),this.D_=!1):__PRIVATE_logDebug("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_RemoteStoreImpl{constructor(e,t,n,s,o){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=o,this.k_._o(a=>{n.enqueueAndForget(async()=>{__PRIVATE_canUseNetwork(this)&&(__PRIVATE_logDebug("RemoteStore","Restarting streams for network reachability change."),await async function(f){const d=__PRIVATE_debugCast(f);d.L_.add(4),await __PRIVATE_disableNetworkInternal(d),d.q_.set("Unknown"),d.L_.delete(4),await __PRIVATE_enableNetworkInternal(d)}(this))})}),this.q_=new __PRIVATE_OnlineStateTracker(n,s)}}async function __PRIVATE_enableNetworkInternal(r){if(__PRIVATE_canUseNetwork(r))for(const e of r.B_)await e(!0)}async function __PRIVATE_disableNetworkInternal(r){for(const e of r.B_)await e(!1)}function __PRIVATE_remoteStoreListen(r,e){const t=__PRIVATE_debugCast(r);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),__PRIVATE_shouldStartWatchStream(t)?__PRIVATE_startWatchStream(t):__PRIVATE_ensureWatchStream(t).r_()&&__PRIVATE_sendWatchRequest(t,e))}function __PRIVATE_remoteStoreUnlisten(r,e){const t=__PRIVATE_debugCast(r),n=__PRIVATE_ensureWatchStream(t);t.N_.delete(e),n.r_()&&__PRIVATE_sendUnwatchRequest(t,e),t.N_.size===0&&(n.r_()?n.o_():__PRIVATE_canUseNetwork(t)&&t.q_.set("Unknown"))}function __PRIVATE_sendWatchRequest(r,e){if(r.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(SnapshotVersion.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}__PRIVATE_ensureWatchStream(r).A_(e)}function __PRIVATE_sendUnwatchRequest(r,e){r.Q_.xe(e),__PRIVATE_ensureWatchStream(r).R_(e)}function __PRIVATE_startWatchStream(r){r.Q_=new __PRIVATE_WatchChangeAggregator({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.N_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),__PRIVATE_ensureWatchStream(r).start(),r.q_.v_()}function __PRIVATE_shouldStartWatchStream(r){return __PRIVATE_canUseNetwork(r)&&!__PRIVATE_ensureWatchStream(r).n_()&&r.N_.size>0}function __PRIVATE_canUseNetwork(r){return __PRIVATE_debugCast(r).L_.size===0}function __PRIVATE_cleanUpWatchStreamState(r){r.Q_=void 0}async function __PRIVATE_onWatchStreamConnected(r){r.q_.set("Online")}async function __PRIVATE_onWatchStreamOpen(r){r.N_.forEach((e,t)=>{__PRIVATE_sendWatchRequest(r,e)})}async function __PRIVATE_onWatchStreamClose(r,e){__PRIVATE_cleanUpWatchStreamState(r),__PRIVATE_shouldStartWatchStream(r)?(r.q_.M_(e),__PRIVATE_startWatchStream(r)):r.q_.set("Unknown")}async function __PRIVATE_onWatchStreamChange(r,e,t){if(r.q_.set("Online"),e instanceof __PRIVATE_WatchTargetChange&&e.state===2&&e.cause)try{await async function(s,o){const a=o.cause;for(const l of o.targetIds)s.N_.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.N_.delete(l),s.Q_.removeTarget(l))}(r,e)}catch(n){__PRIVATE_logDebug("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await __PRIVATE_disableNetworkUntilRecovery(r,n)}else if(e instanceof __PRIVATE_DocumentWatchChange?r.Q_.Ke(e):e instanceof __PRIVATE_ExistenceFilterChange?r.Q_.He(e):r.Q_.We(e),!t.isEqual(SnapshotVersion.min()))try{const n=await __PRIVATE_localStoreGetLastRemoteSnapshotVersion(r.localStore);t.compareTo(n)>=0&&await function(o,a){const l=o.Q_.rt(a);return l.targetChanges.forEach((f,d)=>{if(f.resumeToken.approximateByteSize()>0){const A=o.N_.get(d);A&&o.N_.set(d,A.withResumeToken(f.resumeToken,a))}}),l.targetMismatches.forEach((f,d)=>{const A=o.N_.get(f);if(!A)return;o.N_.set(f,A.withResumeToken(ByteString.EMPTY_BYTE_STRING,A.snapshotVersion)),__PRIVATE_sendUnwatchRequest(o,f);const M=new TargetData(A.target,f,d,A.sequenceNumber);__PRIVATE_sendWatchRequest(o,M)}),o.remoteSyncer.applyRemoteEvent(l)}(r,t)}catch(n){__PRIVATE_logDebug("RemoteStore","Failed to raise snapshot:",n),await __PRIVATE_disableNetworkUntilRecovery(r,n)}}async function __PRIVATE_disableNetworkUntilRecovery(r,e,t){if(!__PRIVATE_isIndexedDbTransactionError(e))throw e;r.L_.add(1),await __PRIVATE_disableNetworkInternal(r),r.q_.set("Offline"),t||(t=()=>__PRIVATE_localStoreGetLastRemoteSnapshotVersion(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{__PRIVATE_logDebug("RemoteStore","Retrying IndexedDB access"),await t(),r.L_.delete(1),await __PRIVATE_enableNetworkInternal(r)})}function __PRIVATE_executeWithRecovery(r,e){return e().catch(t=>__PRIVATE_disableNetworkUntilRecovery(r,t,e))}async function __PRIVATE_fillWritePipeline(r){const e=__PRIVATE_debugCast(r),t=__PRIVATE_ensureWriteStream(e);let n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;__PRIVATE_canAddToWritePipeline(e);)try{const s=await __PRIVATE_localStoreGetNextMutationBatch(e.localStore,n);if(s===null){e.O_.length===0&&t.o_();break}n=s.batchId,__PRIVATE_addToWritePipeline(e,s)}catch(s){await __PRIVATE_disableNetworkUntilRecovery(e,s)}__PRIVATE_shouldStartWriteStream(e)&&__PRIVATE_startWriteStream(e)}function __PRIVATE_canAddToWritePipeline(r){return __PRIVATE_canUseNetwork(r)&&r.O_.length<10}function __PRIVATE_addToWritePipeline(r,e){r.O_.push(e);const t=__PRIVATE_ensureWriteStream(r);t.r_()&&t.V_&&t.m_(e.mutations)}function __PRIVATE_shouldStartWriteStream(r){return __PRIVATE_canUseNetwork(r)&&!__PRIVATE_ensureWriteStream(r).n_()&&r.O_.length>0}function __PRIVATE_startWriteStream(r){__PRIVATE_ensureWriteStream(r).start()}async function __PRIVATE_onWriteStreamOpen(r){__PRIVATE_ensureWriteStream(r).p_()}async function __PRIVATE_onWriteHandshakeComplete(r){const e=__PRIVATE_ensureWriteStream(r);for(const t of r.O_)e.m_(t.mutations)}async function __PRIVATE_onMutationResult(r,e,t){const n=r.O_.shift(),s=MutationBatchResult.from(n,e,t);await __PRIVATE_executeWithRecovery(r,()=>r.remoteSyncer.applySuccessfulWrite(s)),await __PRIVATE_fillWritePipeline(r)}async function __PRIVATE_onWriteStreamClose(r,e){e&&__PRIVATE_ensureWriteStream(r).V_&&await async function(n,s){if(function(a){return __PRIVATE_isPermanentError(a)&&a!==D.ABORTED}(s.code)){const o=n.O_.shift();__PRIVATE_ensureWriteStream(n).s_(),await __PRIVATE_executeWithRecovery(n,()=>n.remoteSyncer.rejectFailedWrite(o.batchId,s)),await __PRIVATE_fillWritePipeline(n)}}(r,e),__PRIVATE_shouldStartWriteStream(r)&&__PRIVATE_startWriteStream(r)}async function __PRIVATE_remoteStoreHandleCredentialChange(r,e){const t=__PRIVATE_debugCast(r);t.asyncQueue.verifyOperationInProgress(),__PRIVATE_logDebug("RemoteStore","RemoteStore received new credentials");const n=__PRIVATE_canUseNetwork(t);t.L_.add(3),await __PRIVATE_disableNetworkInternal(t),n&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await __PRIVATE_enableNetworkInternal(t)}async function __PRIVATE_remoteStoreApplyPrimaryState(r,e){const t=__PRIVATE_debugCast(r);e?(t.L_.delete(2),await __PRIVATE_enableNetworkInternal(t)):e||(t.L_.add(2),await __PRIVATE_disableNetworkInternal(t),t.q_.set("Unknown"))}function __PRIVATE_ensureWatchStream(r){return r.K_||(r.K_=function(t,n,s){const o=__PRIVATE_debugCast(t);return o.w_(),new __PRIVATE_PersistentListenStream(n,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(r.datastore,r.asyncQueue,{Eo:__PRIVATE_onWatchStreamConnected.bind(null,r),Ro:__PRIVATE_onWatchStreamOpen.bind(null,r),mo:__PRIVATE_onWatchStreamClose.bind(null,r),d_:__PRIVATE_onWatchStreamChange.bind(null,r)}),r.B_.push(async e=>{e?(r.K_.s_(),__PRIVATE_shouldStartWatchStream(r)?__PRIVATE_startWatchStream(r):r.q_.set("Unknown")):(await r.K_.stop(),__PRIVATE_cleanUpWatchStreamState(r))})),r.K_}function __PRIVATE_ensureWriteStream(r){return r.U_||(r.U_=function(t,n,s){const o=__PRIVATE_debugCast(t);return o.w_(),new __PRIVATE_PersistentWriteStream(n,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:__PRIVATE_onWriteStreamOpen.bind(null,r),mo:__PRIVATE_onWriteStreamClose.bind(null,r),f_:__PRIVATE_onWriteHandshakeComplete.bind(null,r),g_:__PRIVATE_onMutationResult.bind(null,r)}),r.B_.push(async e=>{e?(r.U_.s_(),await __PRIVATE_fillWritePipeline(r)):(await r.U_.stop(),r.O_.length>0&&(__PRIVATE_logDebug("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))})),r.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DelayedOperation{constructor(e,t,n,s,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=s,this.removalCallback=o,this.deferred=new __PRIVATE_Deferred,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,s,o){const a=Date.now()+n,l=new DelayedOperation(e,t,a,s,o);return l.start(n),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new FirestoreError(D.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function __PRIVATE_wrapInUserErrorIfRecoverable(r,e){if(__PRIVATE_logError("AsyncQueue",`${e}: ${r}`),__PRIVATE_isIndexedDbTransactionError(r))return new FirestoreError(D.UNAVAILABLE,`${e}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DocumentSet{constructor(e){this.comparator=e?(t,n)=>e(t,n)||DocumentKey.comparator(t.key,n.key):(t,n)=>DocumentKey.comparator(t.key,n.key),this.keyedMap=documentMap(),this.sortedSet=new SortedMap(this.comparator)}static emptySet(e){return new DocumentSet(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof DocumentSet)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=n.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new DocumentSet;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_DocumentChangeSet{constructor(){this.W_=new SortedMap(DocumentKey.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?e.type!==0&&n.type===3?this.W_=this.W_.insert(t,e):e.type===3&&n.type!==1?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.W_=this.W_.remove(t):e.type===1&&n.type===2?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):fail():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class ViewSnapshot{constructor(e,t,n,s,o,a,l,f,d){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=f,this.hasCachedResults=d}static fromInitialDocuments(e,t,n,s,o){const a=[];return t.forEach(l=>{a.push({type:0,doc:l})}),new ViewSnapshot(e,t,DocumentSet.emptySet(t),a,n,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&__PRIVATE_queryEquals(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==n[s].type||!t[s].doc.isEqual(n[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_QueryListenersInfo{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class __PRIVATE_EventManagerImpl{constructor(){this.queries=__PRIVATE_newQueriesObjectMap(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,n){const s=__PRIVATE_debugCast(t),o=s.queries;s.queries=__PRIVATE_newQueriesObjectMap(),o.forEach((a,l)=>{for(const f of l.j_)f.onError(n)})})(this,new FirestoreError(D.ABORTED,"Firestore shutting down"))}}function __PRIVATE_newQueriesObjectMap(){return new ObjectMap(r=>__PRIVATE_canonifyQuery(r),__PRIVATE_queryEquals)}async function __PRIVATE_eventManagerListen(r,e){const t=__PRIVATE_debugCast(r);let n=3;const s=e.query;let o=t.queries.get(s);o?!o.H_()&&e.J_()&&(n=2):(o=new __PRIVATE_QueryListenersInfo,n=e.J_()?0:1);try{switch(n){case 0:o.z_=await t.onListen(s,!0);break;case 1:o.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const l=__PRIVATE_wrapInUserErrorIfRecoverable(a,`Initialization of query '${__PRIVATE_stringifyQuery(e.query)}' failed`);return void e.onError(l)}t.queries.set(s,o),o.j_.push(e),e.Z_(t.onlineState),o.z_&&e.X_(o.z_)&&__PRIVATE_raiseSnapshotsInSyncEvent(t)}async function __PRIVATE_eventManagerUnlisten(r,e){const t=__PRIVATE_debugCast(r),n=e.query;let s=3;const o=t.queries.get(n);if(o){const a=o.j_.indexOf(e);a>=0&&(o.j_.splice(a,1),o.j_.length===0?s=e.J_()?0:1:!o.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function __PRIVATE_eventManagerOnWatchChange(r,e){const t=__PRIVATE_debugCast(r);let n=!1;for(const s of e){const o=s.query,a=t.queries.get(o);if(a){for(const l of a.j_)l.X_(s)&&(n=!0);a.z_=s}}n&&__PRIVATE_raiseSnapshotsInSyncEvent(t)}function __PRIVATE_eventManagerOnWatchError(r,e,t){const n=__PRIVATE_debugCast(r),s=n.queries.get(e);if(s)for(const o of s.j_)o.onError(t);n.queries.delete(e)}function __PRIVATE_raiseSnapshotsInSyncEvent(r){r.Y_.forEach(e=>{e.next()})}var pe,ye;(ye=pe||(pe={})).ea="default",ye.Cache="cache";class __PRIVATE_QueryListener{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const n=[];for(const s of e.docChanges)s.type!==3&&n.push(s);e=new ViewSnapshot(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const n=t!=="Offline";return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=ViewSnapshot.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==pe.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_AddedLimboDocument{constructor(e){this.key=e}}class __PRIVATE_RemovedLimboDocument{constructor(e){this.key=e}}class __PRIVATE_View{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=__PRIVATE_documentKeySet(),this.mutatedKeys=__PRIVATE_documentKeySet(),this.Aa=__PRIVATE_newQueryComparator(e),this.Ra=new DocumentSet(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new __PRIVATE_DocumentChangeSet,s=t?t.Ra:this.Ra;let o=t?t.mutatedKeys:this.mutatedKeys,a=s,l=!1;const f=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((A,M)=>{const q=s.get(A),V=__PRIVATE_queryMatches(this.query,M)?M:null,g=!!q&&this.mutatedKeys.has(q.key),F=!!V&&(V.hasLocalMutations||this.mutatedKeys.has(V.key)&&V.hasCommittedMutations);let I=!1;q&&V?q.data.isEqual(V.data)?g!==F&&(n.track({type:3,doc:V}),I=!0):this.ga(q,V)||(n.track({type:2,doc:V}),I=!0,(f&&this.Aa(V,f)>0||d&&this.Aa(V,d)<0)&&(l=!0)):!q&&V?(n.track({type:0,doc:V}),I=!0):q&&!V&&(n.track({type:1,doc:q}),I=!0,(f||d)&&(l=!0)),I&&(V?(a=a.add(V),o=F?o.add(A):o.delete(A)):(a=a.delete(A),o=o.delete(A)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const A=this.query.limitType==="F"?a.last():a.first();a=a.delete(A.key),o=o.delete(A.key),n.track({type:1,doc:A})}return{Ra:a,fa:n,ns:l,mutatedKeys:o}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,s){const o=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const a=e.fa.G_();a.sort((A,M)=>function(V,g){const F=I=>{switch(I){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return fail()}};return F(V)-F(g)}(A.type,M.type)||this.Aa(A.doc,M.doc)),this.pa(n),s=s!=null&&s;const l=t&&!s?this.ya():[],f=this.da.size===0&&this.current&&!s?1:0,d=f!==this.Ea;return this.Ea=f,a.length!==0||d?{snapshot:new ViewSnapshot(this.query,e.Ra,o,a,e.mutatedKeys,f===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:l}:{wa:l}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new __PRIVATE_DocumentChangeSet,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=__PRIVATE_documentKeySet(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});const t=[];return e.forEach(n=>{this.da.has(n)||t.push(new __PRIVATE_RemovedLimboDocument(n))}),this.da.forEach(n=>{e.has(n)||t.push(new __PRIVATE_AddedLimboDocument(n))}),t}ba(e){this.Ta=e.Ts,this.da=__PRIVATE_documentKeySet();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return ViewSnapshot.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class __PRIVATE_QueryView{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class LimboResolution{constructor(e){this.key=e,this.va=!1}}class __PRIVATE_SyncEngineImpl{constructor(e,t,n,s,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new ObjectMap(l=>__PRIVATE_canonifyQuery(l),__PRIVATE_queryEquals),this.Ma=new Map,this.xa=new Set,this.Oa=new SortedMap(DocumentKey.comparator),this.Na=new Map,this.La=new __PRIVATE_ReferenceSet,this.Ba={},this.ka=new Map,this.qa=__PRIVATE_TargetIdGenerator.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function __PRIVATE_syncEngineListen(r,e,t=!0){const n=__PRIVATE_ensureWatchCallbacks(r);let s;const o=n.Fa.get(e);return o?(n.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.Da()):s=await __PRIVATE_allocateTargetAndMaybeListen(n,e,t,!0),s}async function __PRIVATE_triggerRemoteStoreListen(r,e){const t=__PRIVATE_ensureWatchCallbacks(r);await __PRIVATE_allocateTargetAndMaybeListen(t,e,!0,!1)}async function __PRIVATE_allocateTargetAndMaybeListen(r,e,t,n){const s=await __PRIVATE_localStoreAllocateTarget(r.localStore,__PRIVATE_queryToTarget(e)),o=s.targetId,a=r.sharedClientState.addLocalQueryTarget(o,t);let l;return n&&(l=await __PRIVATE_initializeViewAndComputeSnapshot(r,e,o,a==="current",s.resumeToken)),r.isPrimaryClient&&t&&__PRIVATE_remoteStoreListen(r.remoteStore,s),l}async function __PRIVATE_initializeViewAndComputeSnapshot(r,e,t,n,s){r.Ka=(M,q,V)=>async function(F,I,j,G){let O=I.view.ma(j);O.ns&&(O=await __PRIVATE_localStoreExecuteQuery(F.localStore,I.query,!1).then(({documents:U})=>I.view.ma(U,O)));const H=G&&G.targetChanges.get(I.targetId),K=G&&G.targetMismatches.get(I.targetId)!=null,Y=I.view.applyChanges(O,F.isPrimaryClient,H,K);return __PRIVATE_updateTrackedLimbos(F,I.targetId,Y.wa),Y.snapshot}(r,M,q,V);const o=await __PRIVATE_localStoreExecuteQuery(r.localStore,e,!0),a=new __PRIVATE_View(e,o.Ts),l=a.ma(o.documents),f=TargetChange.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",s),d=a.applyChanges(l,r.isPrimaryClient,f);__PRIVATE_updateTrackedLimbos(r,t,d.wa);const A=new __PRIVATE_QueryView(e,t,a);return r.Fa.set(e,A),r.Ma.has(t)?r.Ma.get(t).push(e):r.Ma.set(t,[e]),d.snapshot}async function __PRIVATE_syncEngineUnlisten(r,e,t){const n=__PRIVATE_debugCast(r),s=n.Fa.get(e),o=n.Ma.get(s.targetId);if(o.length>1)return n.Ma.set(s.targetId,o.filter(a=>!__PRIVATE_queryEquals(a,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await __PRIVATE_localStoreReleaseTarget(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),t&&__PRIVATE_remoteStoreUnlisten(n.remoteStore,s.targetId),__PRIVATE_removeAndCleanupTarget(n,s.targetId)}).catch(__PRIVATE_ignoreIfPrimaryLeaseLoss)):(__PRIVATE_removeAndCleanupTarget(n,s.targetId),await __PRIVATE_localStoreReleaseTarget(n.localStore,s.targetId,!0))}async function __PRIVATE_triggerRemoteStoreUnlisten(r,e){const t=__PRIVATE_debugCast(r),n=t.Fa.get(e),s=t.Ma.get(n.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),__PRIVATE_remoteStoreUnlisten(t.remoteStore,n.targetId))}async function __PRIVATE_syncEngineWrite(r,e,t){const n=__PRIVATE_syncEngineEnsureWriteCallbacks(r);try{const s=await function(a,l){const f=__PRIVATE_debugCast(a),d=Timestamp.now(),A=l.reduce((V,g)=>V.add(g.key),__PRIVATE_documentKeySet());let M,q;return f.persistence.runTransaction("Locally write mutations","readwrite",V=>{let g=__PRIVATE_mutableDocumentMap(),F=__PRIVATE_documentKeySet();return f.cs.getEntries(V,A).next(I=>{g=I,g.forEach((j,G)=>{G.isValidDocument()||(F=F.add(j))})}).next(()=>f.localDocuments.getOverlayedDocuments(V,g)).next(I=>{M=I;const j=[];for(const G of l){const O=__PRIVATE_mutationExtractBaseValue(G,M.get(G.key).overlayedDocument);O!=null&&j.push(new __PRIVATE_PatchMutation(G.key,O,__PRIVATE_extractFieldMask(O.value.mapValue),Precondition.exists(!0)))}return f.mutationQueue.addMutationBatch(V,d,j,l)}).next(I=>{q=I;const j=I.applyToLocalDocumentSet(M,F);return f.documentOverlayCache.saveOverlays(V,I.batchId,j)})}).then(()=>({batchId:q.batchId,changes:__PRIVATE_convertOverlayedDocumentMapToDocumentMap(M)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(s.batchId),function(a,l,f){let d=a.Ba[a.currentUser.toKey()];d||(d=new SortedMap(__PRIVATE_primitiveComparator)),d=d.insert(l,f),a.Ba[a.currentUser.toKey()]=d}(n,s.batchId,t),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(n,s.changes),await __PRIVATE_fillWritePipeline(n.remoteStore)}catch(s){const o=__PRIVATE_wrapInUserErrorIfRecoverable(s,"Failed to persist write");t.reject(o)}}async function __PRIVATE_syncEngineApplyRemoteEvent(r,e){const t=__PRIVATE_debugCast(r);try{const n=await __PRIVATE_localStoreApplyRemoteEventToLocalCache(t.localStore,e);e.targetChanges.forEach((s,o)=>{const a=t.Na.get(o);a&&(__PRIVATE_hardAssert(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?a.va=!0:s.modifiedDocuments.size>0?__PRIVATE_hardAssert(a.va):s.removedDocuments.size>0&&(__PRIVATE_hardAssert(a.va),a.va=!1))}),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(t,n,e)}catch(n){await __PRIVATE_ignoreIfPrimaryLeaseLoss(n)}}function __PRIVATE_syncEngineApplyOnlineStateChange(r,e,t){const n=__PRIVATE_debugCast(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const s=[];n.Fa.forEach((o,a)=>{const l=a.view.Z_(e);l.snapshot&&s.push(l.snapshot)}),function(a,l){const f=__PRIVATE_debugCast(a);f.onlineState=l;let d=!1;f.queries.forEach((A,M)=>{for(const q of M.j_)q.Z_(l)&&(d=!0)}),d&&__PRIVATE_raiseSnapshotsInSyncEvent(f)}(n.eventManager,e),s.length&&n.Ca.d_(s),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function __PRIVATE_syncEngineRejectListen(r,e,t){const n=__PRIVATE_debugCast(r);n.sharedClientState.updateQueryState(e,"rejected",t);const s=n.Na.get(e),o=s&&s.key;if(o){let a=new SortedMap(DocumentKey.comparator);a=a.insert(o,MutableDocument.newNoDocument(o,SnapshotVersion.min()));const l=__PRIVATE_documentKeySet().add(o),f=new RemoteEvent(SnapshotVersion.min(),new Map,new SortedMap(__PRIVATE_primitiveComparator),a,l);await __PRIVATE_syncEngineApplyRemoteEvent(n,f),n.Oa=n.Oa.remove(o),n.Na.delete(e),__PRIVATE_pumpEnqueuedLimboResolutions(n)}else await __PRIVATE_localStoreReleaseTarget(n.localStore,e,!1).then(()=>__PRIVATE_removeAndCleanupTarget(n,e,t)).catch(__PRIVATE_ignoreIfPrimaryLeaseLoss)}async function __PRIVATE_syncEngineApplySuccessfulWrite(r,e){const t=__PRIVATE_debugCast(r),n=e.batch.batchId;try{const s=await __PRIVATE_localStoreAcknowledgeBatch(t.localStore,e);__PRIVATE_processUserCallback(t,n,null),__PRIVATE_triggerPendingWritesCallbacks(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(t,s)}catch(s){await __PRIVATE_ignoreIfPrimaryLeaseLoss(s)}}async function __PRIVATE_syncEngineRejectFailedWrite(r,e,t){const n=__PRIVATE_debugCast(r);try{const s=await function(a,l){const f=__PRIVATE_debugCast(a);return f.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let A;return f.mutationQueue.lookupMutationBatch(d,l).next(M=>(__PRIVATE_hardAssert(M!==null),A=M.keys(),f.mutationQueue.removeMutationBatch(d,M))).next(()=>f.mutationQueue.performConsistencyCheck(d)).next(()=>f.documentOverlayCache.removeOverlaysForBatchId(d,A,l)).next(()=>f.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,A)).next(()=>f.localDocuments.getDocuments(d,A))})}(n.localStore,e);__PRIVATE_processUserCallback(n,e,t),__PRIVATE_triggerPendingWritesCallbacks(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(n,s)}catch(s){await __PRIVATE_ignoreIfPrimaryLeaseLoss(s)}}function __PRIVATE_triggerPendingWritesCallbacks(r,e){(r.ka.get(e)||[]).forEach(t=>{t.resolve()}),r.ka.delete(e)}function __PRIVATE_processUserCallback(r,e,t){const n=__PRIVATE_debugCast(r);let s=n.Ba[n.currentUser.toKey()];if(s){const o=s.get(e);o&&(t?o.reject(t):o.resolve(),s=s.remove(e)),n.Ba[n.currentUser.toKey()]=s}}function __PRIVATE_removeAndCleanupTarget(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Ma.get(e))r.Fa.delete(n),t&&r.Ca.$a(n,t);r.Ma.delete(e),r.isPrimaryClient&&r.La.gr(e).forEach(n=>{r.La.containsKey(n)||__PRIVATE_removeLimboTarget(r,n)})}function __PRIVATE_removeLimboTarget(r,e){r.xa.delete(e.path.canonicalString());const t=r.Oa.get(e);t!==null&&(__PRIVATE_remoteStoreUnlisten(r.remoteStore,t),r.Oa=r.Oa.remove(e),r.Na.delete(t),__PRIVATE_pumpEnqueuedLimboResolutions(r))}function __PRIVATE_updateTrackedLimbos(r,e,t){for(const n of t)n instanceof __PRIVATE_AddedLimboDocument?(r.La.addReference(n.key,e),__PRIVATE_trackLimboChange(r,n)):n instanceof __PRIVATE_RemovedLimboDocument?(__PRIVATE_logDebug("SyncEngine","Document no longer in limbo: "+n.key),r.La.removeReference(n.key,e),r.La.containsKey(n.key)||__PRIVATE_removeLimboTarget(r,n.key)):fail()}function __PRIVATE_trackLimboChange(r,e){const t=e.key,n=t.path.canonicalString();r.Oa.get(t)||r.xa.has(n)||(__PRIVATE_logDebug("SyncEngine","New document in limbo: "+t),r.xa.add(n),__PRIVATE_pumpEnqueuedLimboResolutions(r))}function __PRIVATE_pumpEnqueuedLimboResolutions(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){const e=r.xa.values().next().value;r.xa.delete(e);const t=new DocumentKey(ResourcePath.fromString(e)),n=r.qa.next();r.Na.set(n,new LimboResolution(t)),r.Oa=r.Oa.insert(t,n),__PRIVATE_remoteStoreListen(r.remoteStore,new TargetData(__PRIVATE_queryToTarget(__PRIVATE_newQueryForPath(t.path)),n,"TargetPurposeLimboResolution",__PRIVATE_ListenSequence.oe))}}async function __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(r,e,t){const n=__PRIVATE_debugCast(r),s=[],o=[],a=[];n.Fa.isEmpty()||(n.Fa.forEach((l,f)=>{a.push(n.Ka(f,e,t).then(d=>{var A;if((d||t)&&n.isPrimaryClient){const M=d?!d.fromCache:(A=t==null?void 0:t.targetChanges.get(f.targetId))===null||A===void 0?void 0:A.current;n.sharedClientState.updateQueryState(f.targetId,M?"current":"not-current")}if(d){s.push(d);const M=__PRIVATE_LocalViewChanges.Wi(f.targetId,d);o.push(M)}}))}),await Promise.all(a),n.Ca.d_(s),await async function(f,d){const A=__PRIVATE_debugCast(f);try{await A.persistence.runTransaction("notifyLocalViewChanges","readwrite",M=>PersistencePromise.forEach(d,q=>PersistencePromise.forEach(q.$i,V=>A.persistence.referenceDelegate.addReference(M,q.targetId,V)).next(()=>PersistencePromise.forEach(q.Ui,V=>A.persistence.referenceDelegate.removeReference(M,q.targetId,V)))))}catch(M){if(!__PRIVATE_isIndexedDbTransactionError(M))throw M;__PRIVATE_logDebug("LocalStore","Failed to update sequence numbers: "+M)}for(const M of d){const q=M.targetId;if(!M.fromCache){const V=A.os.get(q),g=V.snapshotVersion,F=V.withLastLimboFreeSnapshotVersion(g);A.os=A.os.insert(q,F)}}}(n.localStore,o))}async function __PRIVATE_syncEngineHandleCredentialChange(r,e){const t=__PRIVATE_debugCast(r);if(!t.currentUser.isEqual(e)){__PRIVATE_logDebug("SyncEngine","User change. New user:",e.toKey());const n=await __PRIVATE_localStoreHandleUserChange(t.localStore,e);t.currentUser=e,function(o,a){o.ka.forEach(l=>{l.forEach(f=>{f.reject(new FirestoreError(D.CANCELLED,a))})}),o.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(t,n.hs)}}function __PRIVATE_syncEngineGetRemoteKeysForTarget(r,e){const t=__PRIVATE_debugCast(r),n=t.Na.get(e);if(n&&n.va)return __PRIVATE_documentKeySet().add(n.key);{let s=__PRIVATE_documentKeySet();const o=t.Ma.get(e);if(!o)return s;for(const a of o){const l=t.Fa.get(a);s=s.unionWith(l.view.Va)}return s}}function __PRIVATE_ensureWatchCallbacks(r){const e=__PRIVATE_debugCast(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=__PRIVATE_syncEngineApplyRemoteEvent.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=__PRIVATE_syncEngineGetRemoteKeysForTarget.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=__PRIVATE_syncEngineRejectListen.bind(null,e),e.Ca.d_=__PRIVATE_eventManagerOnWatchChange.bind(null,e.eventManager),e.Ca.$a=__PRIVATE_eventManagerOnWatchError.bind(null,e.eventManager),e}function __PRIVATE_syncEngineEnsureWriteCallbacks(r){const e=__PRIVATE_debugCast(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=__PRIVATE_syncEngineApplySuccessfulWrite.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=__PRIVATE_syncEngineRejectFailedWrite.bind(null,e),e}class __PRIVATE_MemoryOfflineComponentProvider{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=__PRIVATE_newSerializer(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return __PRIVATE_newLocalStore(this.persistence,new __PRIVATE_QueryEngine,e.initialUser,this.serializer)}Ga(e){return new __PRIVATE_MemoryPersistence(__PRIVATE_MemoryEagerDelegate.Zr,this.serializer)}Wa(e){return new __PRIVATE_MemorySharedClientState}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}__PRIVATE_MemoryOfflineComponentProvider.provider={build:()=>new __PRIVATE_MemoryOfflineComponentProvider};class OnlineComponentProvider{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>__PRIVATE_syncEngineApplyOnlineStateChange(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=__PRIVATE_syncEngineHandleCredentialChange.bind(null,this.syncEngine),await __PRIVATE_remoteStoreApplyPrimaryState(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new __PRIVATE_EventManagerImpl}()}createDatastore(e){const t=__PRIVATE_newSerializer(e.databaseInfo.databaseId),n=function(o){return new __PRIVATE_WebChannelConnection(o)}(e.databaseInfo);return function(o,a,l,f){return new __PRIVATE_DatastoreImpl(o,a,l,f)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(n,s,o,a,l){return new __PRIVATE_RemoteStoreImpl(n,s,o,a,l)}(this.localStore,this.datastore,e.asyncQueue,t=>__PRIVATE_syncEngineApplyOnlineStateChange(this.syncEngine,t,0),function(){return __PRIVATE_BrowserConnectivityMonitor.D()?new __PRIVATE_BrowserConnectivityMonitor:new __PRIVATE_NoopConnectivityMonitor}())}createSyncEngine(e,t){return function(s,o,a,l,f,d,A){const M=new __PRIVATE_SyncEngineImpl(s,o,a,l,f,d);return A&&(M.Qa=!0),M}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const o=__PRIVATE_debugCast(s);__PRIVATE_logDebug("RemoteStore","RemoteStore shutting down."),o.L_.add(5),await __PRIVATE_disableNetworkInternal(o),o.k_.shutdown(),o.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}OnlineComponentProvider.provider={build:()=>new OnlineComponentProvider};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_AsyncObserver{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):__PRIVATE_logError("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FirestoreClient{constructor(e,t,n,s,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=s,this.user=User.UNAUTHENTICATED,this.clientId=__PRIVATE_AutoId.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(n,async a=>{__PRIVATE_logDebug("FirestoreClient","Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(n,a=>(__PRIVATE_logDebug("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new __PRIVATE_Deferred;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=__PRIVATE_wrapInUserErrorIfRecoverable(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function __PRIVATE_setOfflineComponentProvider(r,e){r.asyncQueue.verifyOperationInProgress(),__PRIVATE_logDebug("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;await e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(async s=>{n.isEqual(s)||(await __PRIVATE_localStoreHandleUserChange(e.localStore,s),n=s)}),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}async function __PRIVATE_setOnlineComponentProvider(r,e){r.asyncQueue.verifyOperationInProgress();const t=await __PRIVATE_ensureOfflineComponents(r);__PRIVATE_logDebug("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>__PRIVATE_remoteStoreHandleCredentialChange(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,s)=>__PRIVATE_remoteStoreHandleCredentialChange(e.remoteStore,s)),r._onlineComponents=e}async function __PRIVATE_ensureOfflineComponents(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){__PRIVATE_logDebug("FirestoreClient","Using user provided OfflineComponentProvider");try{await __PRIVATE_setOfflineComponentProvider(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===D.FAILED_PRECONDITION||s.code===D.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;__PRIVATE_logWarn("Error using user provided cache. Falling back to memory cache: "+t),await __PRIVATE_setOfflineComponentProvider(r,new __PRIVATE_MemoryOfflineComponentProvider)}}else __PRIVATE_logDebug("FirestoreClient","Using default OfflineComponentProvider"),await __PRIVATE_setOfflineComponentProvider(r,new __PRIVATE_MemoryOfflineComponentProvider);return r._offlineComponents}async function __PRIVATE_ensureOnlineComponents(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(__PRIVATE_logDebug("FirestoreClient","Using user provided OnlineComponentProvider"),await __PRIVATE_setOnlineComponentProvider(r,r._uninitializedComponentsProvider._online)):(__PRIVATE_logDebug("FirestoreClient","Using default OnlineComponentProvider"),await __PRIVATE_setOnlineComponentProvider(r,new OnlineComponentProvider))),r._onlineComponents}function __PRIVATE_getSyncEngine(r){return __PRIVATE_ensureOnlineComponents(r).then(e=>e.syncEngine)}async function __PRIVATE_getEventManager(r){const e=await __PRIVATE_ensureOnlineComponents(r),t=e.eventManager;return t.onListen=__PRIVATE_syncEngineListen.bind(null,e.syncEngine),t.onUnlisten=__PRIVATE_syncEngineUnlisten.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=__PRIVATE_triggerRemoteStoreListen.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=__PRIVATE_triggerRemoteStoreUnlisten.bind(null,e.syncEngine),t}function __PRIVATE_firestoreClientGetDocumentsViaSnapshotListener(r,e,t={}){const n=new __PRIVATE_Deferred;return r.asyncQueue.enqueueAndForget(async()=>function(o,a,l,f,d){const A=new __PRIVATE_AsyncObserver({next:q=>{A.Za(),a.enqueueAndForget(()=>__PRIVATE_eventManagerUnlisten(o,M)),q.fromCache&&f.source==="server"?d.reject(new FirestoreError(D.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(q)},error:q=>d.reject(q)}),M=new __PRIVATE_QueryListener(l,A,{includeMetadataChanges:!0,_a:!0});return __PRIVATE_eventManagerListen(o,M)}(await __PRIVATE_getEventManager(r),r.asyncQueue,e,t,n)),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_cloneLongPollingOptions(r){const e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const we=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_validateNonEmptyArgument(r,e,t){if(!t)throw new FirestoreError(D.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function __PRIVATE_validateIsNotUsedTogether(r,e,t,n){if(e===!0&&n===!0)throw new FirestoreError(D.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function __PRIVATE_validateDocumentPath(r){if(!DocumentKey.isDocumentKey(r))throw new FirestoreError(D.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function __PRIVATE_validateCollectionPath(r){if(DocumentKey.isDocumentKey(r))throw new FirestoreError(D.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function __PRIVATE_valueDescription(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":fail()}function __PRIVATE_cast(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new FirestoreError(D.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=__PRIVATE_valueDescription(r);throw new FirestoreError(D.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FirestoreSettingsImpl{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new FirestoreError(D.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new FirestoreError(D.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}__PRIVATE_validateIsNotUsedTogether("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=__PRIVATE_cloneLongPollingOptions((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new FirestoreError(D.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new FirestoreError(D.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new FirestoreError(D.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,s){return n.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Firestore$1{constructor(e,t,n,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new FirestoreSettingsImpl({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new FirestoreError(D.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new FirestoreError(D.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new FirestoreSettingsImpl(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new __PRIVATE_EmptyAuthCredentialsProvider;switch(n.type){case"firstParty":return new __PRIVATE_FirstPartyAuthCredentialsProvider(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new FirestoreError(D.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=we.get(t);n&&(__PRIVATE_logDebug("ComponentProvider","Removing Datastore"),we.delete(t),n.terminate())}(this),Promise.resolve()}}function connectFirestoreEmulator(r,e,t,n={}){var s;const o=(r=__PRIVATE_cast(r,Firestore$1))._getSettings(),a=`${e}:${t}`;if(o.host!=="firestore.googleapis.com"&&o.host!==a&&__PRIVATE_logWarn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),n.mockUserToken){let l,f;if(typeof n.mockUserToken=="string")l=n.mockUserToken,f=User.MOCK_USER;else{l=createMockUserToken(n.mockUserToken,(s=r._app)===null||s===void 0?void 0:s.options.projectId);const d=n.mockUserToken.sub||n.mockUserToken.user_id;if(!d)throw new FirestoreError(D.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new User(d)}r._authCredentials=new __PRIVATE_EmulatorAuthCredentialsProvider(new __PRIVATE_OAuthToken(l,f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Query{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Query(this.firestore,e,this._query)}}class DocumentReference{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new CollectionReference(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new DocumentReference(this.firestore,e,this._key)}}class CollectionReference extends Query{constructor(e,t,n){super(e,t,__PRIVATE_newQueryForPath(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new DocumentReference(this.firestore,null,new DocumentKey(e))}withConverter(e){return new CollectionReference(this.firestore,e,this._path)}}function collection(r,e,...t){if(r=getModularInstance(r),__PRIVATE_validateNonEmptyArgument("collection","path",e),r instanceof Firestore$1){const n=ResourcePath.fromString(e,...t);return __PRIVATE_validateCollectionPath(n),new CollectionReference(r,null,n)}{if(!(r instanceof DocumentReference||r instanceof CollectionReference))throw new FirestoreError(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(ResourcePath.fromString(e,...t));return __PRIVATE_validateCollectionPath(n),new CollectionReference(r.firestore,null,n)}}function doc(r,e,...t){if(r=getModularInstance(r),arguments.length===1&&(e=__PRIVATE_AutoId.newId()),__PRIVATE_validateNonEmptyArgument("doc","path",e),r instanceof Firestore$1){const n=ResourcePath.fromString(e,...t);return __PRIVATE_validateDocumentPath(n),new DocumentReference(r,null,new DocumentKey(n))}{if(!(r instanceof DocumentReference||r instanceof CollectionReference))throw new FirestoreError(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(ResourcePath.fromString(e,...t));return __PRIVATE_validateDocumentPath(n),new DocumentReference(r.firestore,r instanceof CollectionReference?r.converter:null,new DocumentKey(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_AsyncQueueImpl{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new __PRIVATE_ExponentialBackoff(this,"async_queue_retry"),this.Vu=()=>{const n=getDocument();n&&__PRIVATE_logDebug("AsyncQueue","Visibility state changed to "+n.visibilityState),this.t_.jo()},this.mu=e;const t=getDocument();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=getDocument();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new __PRIVATE_Deferred;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!__PRIVATE_isIndexedDbTransactionError(e))throw e;__PRIVATE_logDebug("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(n=>{this.Eu=n,this.du=!1;const s=function(a){let l=a.message||"";return a.stack&&(l=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),l}(n);throw __PRIVATE_logError("INTERNAL UNHANDLED ERROR: ",s),n}).then(n=>(this.du=!1,n))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=DelayedOperation.createAndSchedule(this,e,t,n,o=>this.yu(o));return this.Tu.push(s),s}fu(){this.Eu&&fail()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}class Firestore extends Firestore$1{constructor(e,t,n,s){super(e,t,n,s),this.type="firestore",this._queue=new __PRIVATE_AsyncQueueImpl,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new __PRIVATE_AsyncQueueImpl(e),this._firestoreClient=void 0,await e}}}function getFirestore(r,e){const t=typeof r=="object"?r:getApp(),n=typeof r=="string"?r:e||"(default)",s=_getProvider(t,"firestore").getImmediate({identifier:n});if(!s._initialized){const o=getDefaultEmulatorHostnameAndPort("firestore");o&&connectFirestoreEmulator(s,...o)}return s}function ensureFirestoreConfigured(r){if(r._terminated)throw new FirestoreError(D.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||__PRIVATE_configureFirestore(r),r._firestoreClient}function __PRIVATE_configureFirestore(r){var e,t,n;const s=r._freezeSettings(),o=function(l,f,d,A){return new DatabaseInfo(l,f,d,A.host,A.ssl,A.experimentalForceLongPolling,A.experimentalAutoDetectLongPolling,__PRIVATE_cloneLongPollingOptions(A.experimentalLongPollingOptions),A.useFetchStreams)}(r._databaseId,((e=r._app)===null||e===void 0?void 0:e.options.appId)||"",r._persistenceKey,s);r._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=s.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),r._firestoreClient=new FirestoreClient(r._authCredentials,r._appCheckCredentials,r._queue,o,r._componentsProvider&&function(l){const f=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(f),_online:f}}(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bytes{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Bytes(ByteString.fromBase64String(e))}catch(t){throw new FirestoreError(D.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Bytes(ByteString.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FieldPath{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new FirestoreError(D.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new FieldPath$1(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FieldValue{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GeoPoint{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new FirestoreError(D.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new FirestoreError(D.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return __PRIVATE_primitiveComparator(this._lat,e._lat)||__PRIVATE_primitiveComparator(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VectorValue{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,s){if(n.length!==s.length)return!1;for(let o=0;o<n.length;++o)if(n[o]!==s[o])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const be=/^__.*__$/;class ParsedSetData{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new __PRIVATE_PatchMutation(e,this.data,this.fieldMask,t,this.fieldTransforms):new __PRIVATE_SetMutation(e,this.data,t,this.fieldTransforms)}}function __PRIVATE_isWrite(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw fail()}}class __PRIVATE_ParseContextImpl{constructor(e,t,n,s,o,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=s,o===void 0&&this.vu(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new __PRIVATE_ParseContextImpl(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:n,xu:!1});return s.Ou(e),s}Nu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:n,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return __PRIVATE_createError(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(__PRIVATE_isWrite(this.Cu)&&be.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class __PRIVATE_UserDataReader{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||__PRIVATE_newSerializer(e)}Qu(e,t,n,s=!1){return new __PRIVATE_ParseContextImpl({Cu:e,methodName:t,qu:n,path:FieldPath$1.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function __PRIVATE_newUserDataReader(r){const e=r._freezeSettings(),t=__PRIVATE_newSerializer(r._databaseId);return new __PRIVATE_UserDataReader(r._databaseId,!!e.ignoreUndefinedProperties,t)}function __PRIVATE_parseSetData(r,e,t,n,s,o={}){const a=r.Qu(o.merge||o.mergeFields?2:0,e,t,s);__PRIVATE_validatePlainObject("Data must be an object, but it was:",a,n);const l=__PRIVATE_parseObject(n,a);let f,d;if(o.merge)f=new FieldMask(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){const A=[];for(const M of o.mergeFields){const q=__PRIVATE_fieldPathFromArgument$1(e,M,t);if(!a.contains(q))throw new FirestoreError(D.INVALID_ARGUMENT,`Field '${q}' is specified in your field mask but missing from your input data.`);__PRIVATE_fieldMaskContains(A,q)||A.push(q)}f=new FieldMask(A),d=a.fieldTransforms.filter(M=>f.covers(M.field))}else f=null,d=a.fieldTransforms;return new ParsedSetData(new ObjectValue(l),f,d)}function __PRIVATE_parseData(r,e){if(__PRIVATE_looksLikeJsonObject(r=getModularInstance(r)))return __PRIVATE_validatePlainObject("Unsupported field value:",e,r),__PRIVATE_parseObject(r,e);if(r instanceof FieldValue)return function(n,s){if(!__PRIVATE_isWrite(s.Cu))throw s.Bu(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${n._methodName}() is not currently supported inside arrays`);const o=n._toFieldTransform(s);o&&s.fieldTransforms.push(o)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(n,s){const o=[];let a=0;for(const l of n){let f=__PRIVATE_parseData(l,s.Lu(a));f==null&&(f={nullValue:"NULL_VALUE"}),o.push(f),a++}return{arrayValue:{values:o}}}(r,e)}return function(n,s){if((n=getModularInstance(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return toNumber(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const o=Timestamp.fromDate(n);return{timestampValue:toTimestamp(s.serializer,o)}}if(n instanceof Timestamp){const o=new Timestamp(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:toTimestamp(s.serializer,o)}}if(n instanceof GeoPoint)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Bytes)return{bytesValue:__PRIVATE_toBytes(s.serializer,n._byteString)};if(n instanceof DocumentReference){const o=s.databaseId,a=n.firestore._databaseId;if(!a.isEqual(o))throw s.Bu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:__PRIVATE_toResourceName(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof VectorValue)return function(a,l){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(f=>{if(typeof f!="number")throw l.Bu("VectorValues must only contain numeric values.");return __PRIVATE_toDouble(l.serializer,f)})}}}}}}(n,s);throw s.Bu(`Unsupported field value: ${__PRIVATE_valueDescription(n)}`)}(r,e)}function __PRIVATE_parseObject(r,e){const t={};return isEmpty(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):forEach(r,(n,s)=>{const o=__PRIVATE_parseData(s,e.Mu(n));o!=null&&(t[n]=o)}),{mapValue:{fields:t}}}function __PRIVATE_looksLikeJsonObject(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof Timestamp||r instanceof GeoPoint||r instanceof Bytes||r instanceof DocumentReference||r instanceof FieldValue||r instanceof VectorValue)}function __PRIVATE_validatePlainObject(r,e,t){if(!__PRIVATE_looksLikeJsonObject(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const n=__PRIVATE_valueDescription(t);throw n==="an object"?e.Bu(r+" a custom object"):e.Bu(r+" "+n)}}function __PRIVATE_fieldPathFromArgument$1(r,e,t){if((e=getModularInstance(e))instanceof FieldPath)return e._internalPath;if(typeof e=="string")return __PRIVATE_fieldPathFromDotSeparatedString(r,e);throw __PRIVATE_createError("Field path arguments must be of type string or ",r,!1,void 0,t)}const De=new RegExp("[~\\*/\\[\\]]");function __PRIVATE_fieldPathFromDotSeparatedString(r,e,t){if(e.search(De)>=0)throw __PRIVATE_createError(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new FieldPath(...e.split("."))._internalPath}catch{throw __PRIVATE_createError(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function __PRIVATE_createError(r,e,t,n,s){const o=n&&!n.isEmpty(),a=s!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let f="";return(o||a)&&(f+=" (found",o&&(f+=` in field ${n}`),a&&(f+=` in document ${s}`),f+=")"),new FirestoreError(D.INVALID_ARGUMENT,l+r+f)}function __PRIVATE_fieldMaskContains(r,e){return r.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DocumentSnapshot$1{constructor(e,t,n,s,o){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new DocumentReference(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new QueryDocumentSnapshot$1(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(__PRIVATE_fieldPathFromArgument("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class QueryDocumentSnapshot$1 extends DocumentSnapshot$1{data(){return super.data()}}function __PRIVATE_fieldPathFromArgument(r,e){return typeof e=="string"?__PRIVATE_fieldPathFromDotSeparatedString(r,e):e instanceof FieldPath?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_validateHasExplicitOrderByForLimitToLast(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new FirestoreError(D.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class AbstractUserDataWriter{convertValue(e,t="none"){switch(__PRIVATE_typeOrder(e)){case 0:return null;case 1:return e.booleanValue;case 2:return __PRIVATE_normalizeNumber(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(__PRIVATE_normalizeByteString(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw fail()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return forEach(e,(s,o)=>{n[s]=this.convertValue(o,t)}),n}convertVectorValue(e){var t,n,s;const o=(s=(n=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||n===void 0?void 0:n.values)===null||s===void 0?void 0:s.map(a=>__PRIVATE_normalizeNumber(a.doubleValue));return new VectorValue(o)}convertGeoPoint(e){return new GeoPoint(__PRIVATE_normalizeNumber(e.latitude),__PRIVATE_normalizeNumber(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=__PRIVATE_getPreviousValue(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(__PRIVATE_getLocalWriteTime(e));default:return null}}convertTimestamp(e){const t=__PRIVATE_normalizeTimestamp(e);return new Timestamp(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ResourcePath.fromString(e);__PRIVATE_hardAssert(__PRIVATE_isValidResourceName(n));const s=new DatabaseId(n.get(1),n.get(3)),o=new DocumentKey(n.popFirst(5));return s.isEqual(t)||__PRIVATE_logError(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_applyFirestoreDataConverter(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SnapshotMetadata{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class DocumentSnapshot extends DocumentSnapshot$1{constructor(e,t,n,s,o,a){super(e,t,n,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new QueryDocumentSnapshot(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(__PRIVATE_fieldPathFromArgument("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class QueryDocumentSnapshot extends DocumentSnapshot{data(e={}){return super.data(e)}}class QuerySnapshot{constructor(e,t,n,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new SnapshotMetadata(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new QueryDocumentSnapshot(this._firestore,this._userDataWriter,n.key,n,new SnapshotMetadata(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new FirestoreError(D.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(l=>{const f=new QueryDocumentSnapshot(s._firestore,s._userDataWriter,l.doc.key,l.doc,new SnapshotMetadata(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:f,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>o||l.type!==3).map(l=>{const f=new QueryDocumentSnapshot(s._firestore,s._userDataWriter,l.doc.key,l.doc,new SnapshotMetadata(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,A=-1;return l.type!==0&&(d=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),A=a.indexOf(l.doc.key)),{type:__PRIVATE_resultChangeType(l.type),doc:f,oldIndex:d,newIndex:A}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function __PRIVATE_resultChangeType(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return fail()}}class __PRIVATE_ExpUserDataWriter extends AbstractUserDataWriter{constructor(e){super(),this.firestore=e}convertBytes(e){return new Bytes(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new DocumentReference(this.firestore,null,t)}}function getDocs(r){r=__PRIVATE_cast(r,Query);const e=__PRIVATE_cast(r.firestore,Firestore),t=ensureFirestoreConfigured(e),n=new __PRIVATE_ExpUserDataWriter(e);return __PRIVATE_validateHasExplicitOrderByForLimitToLast(r._query),__PRIVATE_firestoreClientGetDocumentsViaSnapshotListener(t,r._query).then(s=>new QuerySnapshot(e,n,r,s))}function addDoc(r,e){const t=__PRIVATE_cast(r.firestore,Firestore),n=doc(r),s=__PRIVATE_applyFirestoreDataConverter(r.converter,e);return executeWrite(t,[__PRIVATE_parseSetData(__PRIVATE_newUserDataReader(r.firestore),"addDoc",n._key,s,r.converter!==null,{}).toMutation(n._key,Precondition.exists(!1))]).then(()=>n)}function executeWrite(r,e){return function(n,s){const o=new __PRIVATE_Deferred;return n.asyncQueue.enqueueAndForget(async()=>__PRIVATE_syncEngineWrite(await __PRIVATE_getSyncEngine(n),s,o)),o.promise}(ensureFirestoreConfigured(r),e)}(function(e,t=!0){(function(s){S=s})(SDK_VERSION),_registerComponent(new Component("firestore",(n,{instanceIdentifier:s,options:o})=>{const a=n.getProvider("app").getImmediate(),l=new Firestore(new __PRIVATE_FirebaseAuthCredentialsProvider(n.getProvider("auth-internal")),new __PRIVATE_FirebaseAppCheckTokenProvider(n.getProvider("app-check-internal")),function(d,A){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new FirestoreError(D.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new DatabaseId(d.options.projectId,A)}(a,s),a);return o=Object.assign({useFetchStreams:t},o),l._setSettings(o),l},"PUBLIC").setMultipleInstances(!0)),registerVersion(w,"4.7.3",e),registerVersion(w,"4.7.3","esm2017")})();function __await(r){return this instanceof __await?(this.v=r,this):new __await(r)}function __asyncGenerator(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),s,o=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",a),s[Symbol.asyncIterator]=function(){return this},s;function a(V){return function(g){return Promise.resolve(g).then(V,M)}}function l(V,g){n[V]&&(s[V]=function(F){return new Promise(function(I,j){o.push([V,F,I,j])>1||f(V,F)})},g&&(s[V]=g(s[V])))}function f(V,g){try{d(n[V](g))}catch(F){q(o[0][3],F)}}function d(V){V.value instanceof __await?Promise.resolve(V.value.v).then(A,M):q(o[0][2],V)}function A(V){f("next",V)}function M(V){f("throw",V)}function q(V,g){V(g),o.shift(),o.length&&f(o[0][0],o[0][1])}}typeof SuppressedError=="function"&&SuppressedError;var name="@firebase/vertexai-preview",version="0.0.4";/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VERTEX_TYPE="vertexAI",DEFAULT_LOCATION="us-central1",DEFAULT_BASE_URL="https://firebaseml.googleapis.com",DEFAULT_API_VERSION="v2beta",PACKAGE_VERSION=version,LANGUAGE_TAG="gl-js";/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VertexAIService{constructor(e,t,n,s){var o;this.app=e,this.options=s;const a=n==null?void 0:n.getImmediate({optional:!0}),l=t==null?void 0:t.getImmediate({optional:!0});this.auth=l||null,this.appCheck=a||null,this.location=((o=this.options)===null||o===void 0?void 0:o.location)||DEFAULT_LOCATION}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VertexAIError extends FirebaseError{constructor(e,t,n){const s=VERTEX_TYPE,o="VertexAI",a=`${s}/${e}`,l=`${o}: ${t} (${a}).`;super(a,l),this.code=e,this.message=t,this.customErrorData=n,Error.captureStackTrace&&Error.captureStackTrace(this,VertexAIError),Object.setPrototypeOf(this,VertexAIError.prototype),this.toString=()=>l}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Task;(function(r){r.GENERATE_CONTENT="generateContent",r.STREAM_GENERATE_CONTENT="streamGenerateContent",r.COUNT_TOKENS="countTokens"})(Task||(Task={}));class RequestUrl{constructor(e,t,n,s,o){this.model=e,this.task=t,this.apiSettings=n,this.stream=s,this.requestOptions=o}toString(){var e;const t=DEFAULT_API_VERSION;let s=`${((e=this.requestOptions)===null||e===void 0?void 0:e.baseUrl)||DEFAULT_BASE_URL}/${t}`;return s+=`/projects/${this.apiSettings.project}`,s+=`/locations/${this.apiSettings.location}`,s+=`/${this.model}`,s+=`:${this.task}`,this.stream&&(s+="?alt=sse"),s}get fullModelString(){let e=`projects/${this.apiSettings.project}`;return e+=`/locations/${this.apiSettings.location}`,e+=`/${this.model}`,e}}function getClientHeaders(){const r=[];return r.push(`${LANGUAGE_TAG}/${PACKAGE_VERSION}`),r.push(`fire/${PACKAGE_VERSION}`),r.join(" ")}async function getHeaders(r){const e=new Headers;if(e.append("Content-Type","application/json"),e.append("x-goog-api-client",getClientHeaders()),e.append("x-goog-api-key",r.apiSettings.apiKey),r.apiSettings.getAppCheckToken){const t=await r.apiSettings.getAppCheckToken();t&&!t.error&&e.append("X-Firebase-AppCheck",t.token)}if(r.apiSettings.getAuthToken){const t=await r.apiSettings.getAuthToken();t&&e.append("Authorization",`Firebase ${t.accessToken}`)}return e}async function constructRequest(r,e,t,n,s,o){const a=new RequestUrl(r,e,t,n,o);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},buildFetchOptions(o)),{method:"POST",headers:await getHeaders(a),body:s})}}async function makeRequest(r,e,t,n,s,o){const a=new RequestUrl(r,e,t,n,o);let l;try{const f=await constructRequest(r,e,t,n,s,o);if(l=await fetch(f.url,f.fetchOptions),!l.ok){let d="",A;try{const M=await l.json();d=M.error.message,M.error.details&&(d+=` ${JSON.stringify(M.error.details)}`,A=M.error.details)}catch{}throw new VertexAIError("fetch-error",`Error fetching from ${a}: [${l.status} ${l.statusText}] ${d}`,{status:l.status,statusText:l.statusText,errorDetails:A})}}catch(f){let d=f;throw f.code!=="fetch-error"&&f instanceof Error&&(d=new VertexAIError("error",`Error fetching from ${a.toString()}: ${f.message}`),d.stack=f.stack),d}return l}function buildFetchOptions(r){const e={};if(r!=null&&r.timeout&&(r==null?void 0:r.timeout)>=0){const t=new AbortController,n=t.signal;setTimeout(()=>t.abort(),r.timeout),e.signal=n}return e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const POSSIBLE_ROLES=["user","model","function","system"];var HarmCategory;(function(r){r.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",r.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",r.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",r.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",r.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(HarmCategory||(HarmCategory={}));var HarmBlockThreshold;(function(r){r.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",r.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",r.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",r.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",r.BLOCK_NONE="BLOCK_NONE"})(HarmBlockThreshold||(HarmBlockThreshold={}));var HarmBlockMethod;(function(r){r.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",r.SEVERITY="SEVERITY",r.PROBABILITY="PROBABILITY"})(HarmBlockMethod||(HarmBlockMethod={}));var HarmProbability;(function(r){r.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",r.NEGLIGIBLE="NEGLIGIBLE",r.LOW="LOW",r.MEDIUM="MEDIUM",r.HIGH="HIGH"})(HarmProbability||(HarmProbability={}));var HarmSeverity;(function(r){r.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",r.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",r.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",r.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",r.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(HarmSeverity||(HarmSeverity={}));var BlockReason;(function(r){r.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",r.SAFETY="SAFETY",r.OTHER="OTHER"})(BlockReason||(BlockReason={}));var FinishReason;(function(r){r.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",r.STOP="STOP",r.MAX_TOKENS="MAX_TOKENS",r.SAFETY="SAFETY",r.RECITATION="RECITATION",r.OTHER="OTHER"})(FinishReason||(FinishReason={}));var FunctionCallingMode;(function(r){r.MODE_UNSPECIFIED="MODE_UNSPECIFIED",r.AUTO="AUTO",r.ANY="ANY",r.NONE="NONE"})(FunctionCallingMode||(FunctionCallingMode={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var FunctionDeclarationSchemaType;(function(r){r.STRING="STRING",r.NUMBER="NUMBER",r.INTEGER="INTEGER",r.BOOLEAN="BOOLEAN",r.ARRAY="ARRAY",r.OBJECT="OBJECT"})(FunctionDeclarationSchemaType||(FunctionDeclarationSchemaType={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function addHelpers(r){return r.text=()=>{if(r.candidates&&r.candidates.length>0){if(r.candidates.length>1&&console.warn(`This response had ${r.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),hadBadFinishReason(r.candidates[0]))throw new VertexAIError("response-error",`Response error: ${formatBlockErrorMessage(r)}. Response body stored in error.response`,{response:r});return getText(r)}else if(r.promptFeedback)throw new VertexAIError("response-error",`Text not available. ${formatBlockErrorMessage(r)}`,{response:r});return""},r.functionCalls=()=>{if(r.candidates&&r.candidates.length>0){if(r.candidates.length>1&&console.warn(`This response had ${r.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),hadBadFinishReason(r.candidates[0]))throw new VertexAIError("response-error",`Response error: ${formatBlockErrorMessage(r)}. Response body stored in error.response`,{response:r});return getFunctionCalls(r)}else if(r.promptFeedback)throw new VertexAIError("response-error",`Function call not available. ${formatBlockErrorMessage(r)}`,{response:r})},r}function getText(r){var e,t,n,s;const o=[];if(!((t=(e=r.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const a of(s=(n=r.candidates)===null||n===void 0?void 0:n[0].content)===null||s===void 0?void 0:s.parts)a.text&&o.push(a.text);return o.length>0?o.join(""):""}function getFunctionCalls(r){var e,t,n,s;const o=[];if(!((t=(e=r.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const a of(s=(n=r.candidates)===null||n===void 0?void 0:n[0].content)===null||s===void 0?void 0:s.parts)a.functionCall&&o.push(a.functionCall);if(o.length>0)return o}const badFinishReasons=[FinishReason.RECITATION,FinishReason.SAFETY];function hadBadFinishReason(r){return!!r.finishReason&&badFinishReasons.includes(r.finishReason)}function formatBlockErrorMessage(r){var e,t,n;let s="";if((!r.candidates||r.candidates.length===0)&&r.promptFeedback)s+="Response was blocked",!((e=r.promptFeedback)===null||e===void 0)&&e.blockReason&&(s+=` due to ${r.promptFeedback.blockReason}`),!((t=r.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(s+=`: ${r.promptFeedback.blockReasonMessage}`);else if(!((n=r.candidates)===null||n===void 0)&&n[0]){const o=r.candidates[0];hadBadFinishReason(o)&&(s+=`Candidate was blocked due to ${o.finishReason}`,o.finishMessage&&(s+=`: ${o.finishMessage}`))}return s}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const responseLineRE=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function processStream(r){const e=r.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=getResponseStream(e),[n,s]=t.tee();return{stream:generateResponseSequence(n),response:getResponsePromise(s)}}async function getResponsePromise(r){const e=[],t=r.getReader();for(;;){const{done:n,value:s}=await t.read();if(n)return addHelpers(aggregateResponses(e));e.push(s)}}function generateResponseSequence(r){return __asyncGenerator(this,arguments,function*(){const t=r.getReader();for(;;){const{value:n,done:s}=yield __await(t.read());if(s)break;yield yield __await(addHelpers(n))}})}function getResponseStream(r){const e=r.getReader();return new ReadableStream({start(n){let s="";return o();function o(){return e.read().then(({value:a,done:l})=>{if(l){if(s.trim()){n.error(new VertexAIError("parse-failed","Failed to parse stream"));return}n.close();return}s+=a;let f=s.match(responseLineRE),d;for(;f;){try{d=JSON.parse(f[1])}catch{n.error(new VertexAIError("parse-failed",`Error parsing JSON response: "${f[1]}`));return}n.enqueue(d),s=s.substring(f[0].length),f=s.match(responseLineRE)}return o()})}}})}function aggregateResponses(r){const e=r[r.length-1],t={promptFeedback:e==null?void 0:e.promptFeedback};for(const n of r)if(n.candidates)for(const s of n.candidates){const o=s.index;if(t.candidates||(t.candidates=[]),t.candidates[o]||(t.candidates[o]={index:s.index}),t.candidates[o].citationMetadata=s.citationMetadata,t.candidates[o].finishReason=s.finishReason,t.candidates[o].finishMessage=s.finishMessage,t.candidates[o].safetyRatings=s.safetyRatings,s.content&&s.content.parts){t.candidates[o].content||(t.candidates[o].content={role:s.content.role||"user",parts:[]});const a={};for(const l of s.content.parts)l.text&&(a.text=l.text),l.functionCall&&(a.functionCall=l.functionCall),Object.keys(a).length===0&&(a.text=""),t.candidates[o].content.parts.push(a)}}return t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function generateContentStream(r,e,t,n){const s=await makeRequest(e,Task.STREAM_GENERATE_CONTENT,r,!0,JSON.stringify(t),n);return processStream(s)}async function generateContent(r,e,t,n){const o=await(await makeRequest(e,Task.GENERATE_CONTENT,r,!1,JSON.stringify(t),n)).json();return{response:addHelpers(o)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function formatSystemInstruction(r){if(r!=null){if(typeof r=="string")return{role:"system",parts:[{text:r}]};if(r.text)return{role:"system",parts:[r]};if(r.parts)return r.role?r:{role:"system",parts:r.parts}}}function formatNewContent(r){let e=[];if(typeof r=="string")e=[{text:r}];else for(const t of r)typeof t=="string"?e.push({text:t}):e.push(t);return assignRoleToPartsAndValidateSendMessageRequest(e)}function assignRoleToPartsAndValidateSendMessageRequest(r){const e={role:"user",parts:[]},t={role:"function",parts:[]};let n=!1,s=!1;for(const o of r)"functionResponse"in o?(t.parts.push(o),s=!0):(e.parts.push(o),n=!0);if(n&&s)throw new VertexAIError("invalid-content","Within a single message, FunctionResponse cannot be mixed with other type of Part in the request for sending chat message.");if(!n&&!s)throw new VertexAIError("invalid-content","No Content is provided for sending chat message.");return n?e:t}function formatGenerateContentInput(r){let e;return r.contents?e=r:e={contents:[formatNewContent(r)]},r.systemInstruction&&(e.systemInstruction=formatSystemInstruction(r.systemInstruction)),e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VALID_PART_FIELDS=["text","inlineData","functionCall","functionResponse"],VALID_PARTS_PER_ROLE={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall"],system:["text"]},VALID_PREVIOUS_CONTENT_ROLES={user:["model"],function:["model"],model:["user","function"],system:[]};function validateChatHistory(r){let e=null;for(const t of r){const{role:n,parts:s}=t;if(!e&&n!=="user")throw new VertexAIError("invalid-content",`First Content should be with role 'user', got ${n}`);if(!POSSIBLE_ROLES.includes(n))throw new VertexAIError("invalid-content",`Each item should include role field. Got ${n} but valid roles are: ${JSON.stringify(POSSIBLE_ROLES)}`);if(!Array.isArray(s))throw new VertexAIError("invalid-content","Content should have 'parts' but property with an array of Parts");if(s.length===0)throw new VertexAIError("invalid-content","Each Content should have at least one part");const o={text:0,inlineData:0,functionCall:0,functionResponse:0};for(const l of s)for(const f of VALID_PART_FIELDS)f in l&&(o[f]+=1);const a=VALID_PARTS_PER_ROLE[n];for(const l of VALID_PART_FIELDS)if(!a.includes(l)&&o[l]>0)throw new VertexAIError("invalid-content",`Content with role '${n}' can't contain '${l}' part`);if(e&&!VALID_PREVIOUS_CONTENT_ROLES[n].includes(e.role))throw new VertexAIError("invalid-content",`Content with role '${n} can't follow '${e.role}'. Valid previous roles: ${JSON.stringify(VALID_PREVIOUS_CONTENT_ROLES)}`);e=t}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SILENT_ERROR="SILENT_ERROR";class ChatSession{constructor(e,t,n,s){this.model=t,this.params=n,this.requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiSettings=e,n!=null&&n.history&&(validateChatHistory(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e){var t,n,s,o,a;await this._sendPromise;const l=formatNewContent(e),f={safetySettings:(t=this.params)===null||t===void 0?void 0:t.safetySettings,generationConfig:(n=this.params)===null||n===void 0?void 0:n.generationConfig,tools:(s=this.params)===null||s===void 0?void 0:s.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,contents:[...this._history,l]};let d={};return this._sendPromise=this._sendPromise.then(()=>generateContent(this._apiSettings,this.model,f,this.requestOptions)).then(A=>{var M,q;if(A.response.candidates&&A.response.candidates.length>0){this._history.push(l);const V={parts:((M=A.response.candidates)===null||M===void 0?void 0:M[0].content.parts)||[],role:((q=A.response.candidates)===null||q===void 0?void 0:q[0].content.role)||"model"};this._history.push(V)}else{const V=formatBlockErrorMessage(A.response);V&&console.warn(`sendMessage() was unsuccessful. ${V}. Inspect response object for details.`)}d=A}),await this._sendPromise,d}async sendMessageStream(e){var t,n,s,o,a;await this._sendPromise;const l=formatNewContent(e),f={safetySettings:(t=this.params)===null||t===void 0?void 0:t.safetySettings,generationConfig:(n=this.params)===null||n===void 0?void 0:n.generationConfig,tools:(s=this.params)===null||s===void 0?void 0:s.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,contents:[...this._history,l]},d=generateContentStream(this._apiSettings,this.model,f,this.requestOptions);return this._sendPromise=this._sendPromise.then(()=>d).catch(A=>{throw new Error(SILENT_ERROR)}).then(A=>A.response).then(A=>{if(A.candidates&&A.candidates.length>0){this._history.push(l);const M=Object.assign({},A.candidates[0].content);M.role||(M.role="model"),this._history.push(M)}else{const M=formatBlockErrorMessage(A);M&&console.warn(`sendMessageStream() was unsuccessful. ${M}. Inspect response object for details.`)}}).catch(A=>{A.message!==SILENT_ERROR&&console.error(A)}),d}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function countTokens(r,e,t,n){return(await makeRequest(e,Task.COUNT_TOKENS,r,!1,JSON.stringify(t),n)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GenerativeModel{constructor(e,t,n){var s,o,a,l;if(!((o=(s=e.app)===null||s===void 0?void 0:s.options)===null||o===void 0)&&o.apiKey)if(!((l=(a=e.app)===null||a===void 0?void 0:a.options)===null||l===void 0)&&l.projectId)this._apiSettings={apiKey:e.app.options.apiKey,project:e.app.options.projectId,location:e.location},e.appCheck&&(this._apiSettings.getAppCheckToken=()=>e.appCheck.getToken()),e.auth&&(this._apiSettings.getAuthToken=()=>e.auth.getToken());else throw new VertexAIError("no-project-id",'The "projectId" field is empty in the local Firebase config. Firebase VertexAI requires this field to contain a valid project ID.');else throw new VertexAIError("no-api-key",'The "apiKey" field is empty in the local Firebase config. Firebase VertexAI requires this field to contain a valid API key.');t.model.includes("/")?t.model.startsWith("models/")?this.model=`publishers/google/${t.model}`:this.model=t.model:this.model=`publishers/google/models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=formatSystemInstruction(t.systemInstruction),this.requestOptions=n||{}}async generateContent(e){const t=formatGenerateContentInput(e);return generateContent(this._apiSettings,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction},t),this.requestOptions)}async generateContentStream(e){const t=formatGenerateContentInput(e);return generateContentStream(this._apiSettings,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction},t),this.requestOptions)}startChat(e){return new ChatSession(this._apiSettings,this.model,Object.assign({tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction},e),this.requestOptions)}async countTokens(e){const t=formatGenerateContentInput(e);return countTokens(this._apiSettings,this.model,t)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getVertexAI(r=getApp(),e){return r=getModularInstance(r),_getProvider(r,VERTEX_TYPE).getImmediate({identifier:(e==null?void 0:e.location)||DEFAULT_LOCATION})}function getGenerativeModel(r,e,t){if(!e.model)throw new VertexAIError("no-model","Must provide a model name. Example: getGenerativeModel({ model: 'my-model-name' })");return new GenerativeModel(r,e,t)}function registerVertex(){_registerComponent(new Component(VERTEX_TYPE,(r,{instanceIdentifier:e})=>{const t=r.getProvider("app").getImmediate(),n=r.getProvider("auth-internal"),s=r.getProvider("app-check-internal");return new VertexAIService(t,n,s,{location:e})},"PUBLIC").setMultipleInstances(!0)),registerVersion(name,version),registerVersion(name,version,"esm2017")}registerVertex();async function generateResponse(r,e,t,n,s){try{console.log("Sending prompt:",e);const o=await r.generateContent(e);if(console.log("Full Response received:",o),n.style.display="none",s.style.display="block",o!=null&&o.response){const a=o.response,l=typeof a.text=="function"?a.text():a.text||"No text found in response.",f=formatResponse(l);return t.innerHTML=f,f}else return t.textContent="No response generated.","No response generated."}catch(o){return console.error("Error during content generation:",o),t.textContent="Error generating response. Please try again.",n.style.display="none",s.style.display="block","Error generating response. Please try again."}}function formatResponse(r){return r=r.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),r=r.replace(/\*(.*?)\*/g,"<em>$1</em>"),r=r.replace(/^\s*\*\s*(.*?)$/gm,"<ul><li>$1</li></ul>"),r=r.replace(/<ul><ul>/g,"<ul>"),r=r.replace(/<\/ul><ul>/g,"</ul>"),r}function updateResponse(r,e,t,n){r.textContent=e,t.style.display="none",n.style.display="block"}function removeHistory(){const r=document.getElementById("historyContainer");r&&(r.innerHTML="",r.remove())}async function setupPromptGenerator(){removeHistory();const r=initializeApp(firebaseConfig),e=getVertexAI(r),t=getGenerativeModel(e,{model:"gemini-1.5-flash-preview-0514"}),n=getFirestore(r),s=document.getElementById("submitBtn"),o=document.getElementById("inputField"),a=document.getElementById("responseText"),l=document.getElementById("response"),f=document.getElementById("loading");s.addEventListener("click",async()=>{const d=o.value.trim();if(!d){updateResponse(a,"Please enter a valid prompt.",f,l);return}try{f.style.display="block";const A=await generateResponse(t,d,a,f,l),M=await addDoc(collection(n,"model_interactions"),{request:d,response:A});console.log("Document written with ID:",M.id)}catch(A){console.error("Error saving to Firestore:",A)}finally{f.style.display="none"}})}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getAugmentedNamespace(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var s=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return r[n]}})}),t}function commonjsRequire(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$5=getAugmentedNamespace(__viteBrowserExternal$1);(function(module,exports){(function(e,t){module.exports=t()})(commonjsGlobal,()=>(()=>{var __webpack_modules__=[,(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.VerbosityLevel=e.Util=e.UnknownErrorException=e.UnexpectedResponseException=e.UNSUPPORTED_FEATURES=e.TextRenderingMode=e.StreamType=e.RenderingIntentFlag=e.PermissionFlag=e.PasswordResponses=e.PasswordException=e.PageActionEventType=e.OPS=e.MissingPDFException=e.InvalidPDFException=e.ImageKind=e.IDENTITY_MATRIX=e.FormatError=e.FontType=e.FeatureTest=e.FONT_IDENTITY_MATRIX=e.DocumentActionEventType=e.CMapCompressionType=e.BaseException=e.AnnotationType=e.AnnotationStateModelType=e.AnnotationReviewState=e.AnnotationReplyType=e.AnnotationMode=e.AnnotationMarkedState=e.AnnotationFlag=e.AnnotationFieldFlag=e.AnnotationBorderStyleType=e.AnnotationActionEventType=e.AbortException=void 0,e.arrayByteLength=ee,e.arraysToBytes=J,e.assert=Fe,e.bytesToString=z,e.createPromiseCapability=st,e.createValidAbsoluteUrl=Le,e.escapeString=rt,e.getModificationDate=Et,e.getVerbosityLevel=Q,e.info=Ce,e.isArrayBuffer=ct,e.isArrayEqual=at,e.isAscii=tt,e.objectFromMap=ve,e.objectSize=Z,e.setVerbosityLevel=k,e.shadow=W,e.string32=ie,e.stringToBytes=X,e.stringToPDFString=ke,e.stringToUTF16BEString=ze,e.stringToUTF8String=Ge,e.unreachable=Se,e.utf8StringToString=Ke,e.warn=Oe,t(2);const n=[1,0,0,1,0,0];e.IDENTITY_MATRIX=n;const s=[.001,0,0,.001,0,0];e.FONT_IDENTITY_MATRIX=s;const o={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};e.RenderingIntentFlag=o;const a={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};e.AnnotationMode=a;const l={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};e.PermissionFlag=l;const f={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};e.TextRenderingMode=f;const d={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};e.ImageKind=d;const A={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};e.AnnotationType=A;const M={MARKED:"Marked",REVIEW:"Review"};e.AnnotationStateModelType=M;const q={MARKED:"Marked",UNMARKED:"Unmarked"};e.AnnotationMarkedState=q;const V={ACCEPTED:"Accepted",REJECTED:"Rejected",CANCELLED:"Cancelled",COMPLETED:"Completed",NONE:"None"};e.AnnotationReviewState=V;const g={GROUP:"Group",REPLY:"R"};e.AnnotationReplyType=g;const F={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};e.AnnotationFlag=F;const I={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};e.AnnotationFieldFlag=I;const j={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};e.AnnotationBorderStyleType=j;const G={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};e.AnnotationActionEventType=G;const O={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};e.DocumentActionEventType=O;const H={O:"PageOpen",C:"PageClose"};e.PageActionEventType=H;const K={UNKNOWN:"UNKNOWN",FLATE:"FLATE",LZW:"LZW",DCT:"DCT",JPX:"JPX",JBIG:"JBIG",A85:"A85",AHX:"AHX",CCF:"CCF",RLX:"RLX"};e.StreamType=K;const Y={UNKNOWN:"UNKNOWN",TYPE1:"TYPE1",TYPE1STANDARD:"TYPE1STANDARD",TYPE1C:"TYPE1C",CIDFONTTYPE0:"CIDFONTTYPE0",CIDFONTTYPE0C:"CIDFONTTYPE0C",TRUETYPE:"TRUETYPE",CIDFONTTYPE2:"CIDFONTTYPE2",TYPE3:"TYPE3",OPENTYPE:"OPENTYPE",TYPE0:"TYPE0",MMTYPE1:"MMTYPE1"};e.FontType=Y;const U={ERRORS:0,WARNINGS:1,INFOS:5};e.VerbosityLevel=U;const h={NONE:0,BINARY:1,STREAM:2};e.CMapCompressionType=h;const _={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};e.OPS=_;const E={unknown:"unknown",forms:"forms",javaScript:"javaScript",signatures:"signatures",smask:"smask",shadingPattern:"shadingPattern",font:"font",errorTilingPattern:"errorTilingPattern",errorExtGState:"errorExtGState",errorXObject:"errorXObject",errorFontLoadType3:"errorFontLoadType3",errorFontState:"errorFontState",errorFontMissing:"errorFontMissing",errorFontTranslate:"errorFontTranslate",errorColorSpace:"errorColorSpace",errorOperatorList:"errorOperatorList",errorFontToUnicode:"errorFontToUnicode",errorFontLoadNative:"errorFontLoadNative",errorFontBuildPath:"errorFontBuildPath",errorFontGetPath:"errorFontGetPath",errorMarkedContent:"errorMarkedContent",errorContentSubStream:"errorContentSubStream"};e.UNSUPPORTED_FEATURES=E;const x={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};e.PasswordResponses=x;let P=U.WARNINGS;function k(Pe){Number.isInteger(Pe)&&(P=Pe)}function Q(){return P}function Ce(Pe){P>=U.INFOS&&console.log(`Info: ${Pe}`)}function Oe(Pe){P>=U.WARNINGS&&console.log(`Warning: ${Pe}`)}function Se(Pe){throw new Error(Pe)}function Fe(Pe,te){Pe||Se(te)}function Ve(Pe){if(!Pe)return!1;switch(Pe.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Le(Pe,te=null,se=null){if(!Pe)return null;try{if(se&&typeof Pe=="string"){if(se.addDefaultProtocol&&Pe.startsWith("www.")){const We=Pe.match(/\./g);We&&We.length>=2&&(Pe=`http://${Pe}`)}if(se.tryConvertEncoding)try{Pe=Ge(Pe)}catch{}}const je=te?new URL(Pe,te):new URL(Pe);if(Ve(je))return je}catch{}return null}function W(Pe,te,se){return Object.defineProperty(Pe,te,{value:se,enumerable:!0,configurable:!0,writable:!1}),se}const T=function(){function te(se,je){this.constructor===te&&Se("Cannot initialize BaseException."),this.message=se,this.name=je}return te.prototype=new Error,te.constructor=te,te}();e.BaseException=T;class m extends T{constructor(te,se){super(te,"PasswordException"),this.code=se}}e.PasswordException=m;class B extends T{constructor(te,se){super(te,"UnknownErrorException"),this.details=se}}e.UnknownErrorException=B;class c extends T{constructor(te){super(te,"InvalidPDFException")}}e.InvalidPDFException=c;class p extends T{constructor(te){super(te,"MissingPDFException")}}e.MissingPDFException=p;class R extends T{constructor(te,se){super(te,"UnexpectedResponseException"),this.status=se}}e.UnexpectedResponseException=R;class L extends T{constructor(te){super(te,"FormatError")}}e.FormatError=L;class N extends T{constructor(te){super(te,"AbortException")}}e.AbortException=N;function z(Pe){(typeof Pe!="object"||Pe===null||Pe.length===void 0)&&Se("Invalid argument for bytesToString");const te=Pe.length,se=8192;if(te<se)return String.fromCharCode.apply(null,Pe);const je=[];for(let We=0;We<te;We+=se){const Qe=Math.min(We+se,te),Xe=Pe.subarray(We,Qe);je.push(String.fromCharCode.apply(null,Xe))}return je.join("")}function X(Pe){typeof Pe!="string"&&Se("Invalid argument for stringToBytes");const te=Pe.length,se=new Uint8Array(te);for(let je=0;je<te;++je)se[je]=Pe.charCodeAt(je)&255;return se}function ee(Pe){if(Pe.length!==void 0)return Pe.length;if(Pe.byteLength!==void 0)return Pe.byteLength;Se("Invalid argument for arrayByteLength")}function J(Pe){const te=Pe.length;if(te===1&&Pe[0]instanceof Uint8Array)return Pe[0];let se=0;for(let Qe=0;Qe<te;Qe++)se+=ee(Pe[Qe]);let je=0;const We=new Uint8Array(se);for(let Qe=0;Qe<te;Qe++){let Xe=Pe[Qe];Xe instanceof Uint8Array||(typeof Xe=="string"?Xe=X(Xe):Xe=new Uint8Array(Xe));const mt=Xe.byteLength;We.set(Xe,je),je+=mt}return We}function ie(Pe){return String.fromCharCode(Pe>>24&255,Pe>>16&255,Pe>>8&255,Pe&255)}function Z(Pe){return Object.keys(Pe).length}function ve(Pe){const te=Object.create(null);for(const[se,je]of Pe)te[se]=je;return te}function Me(){const Pe=new Uint8Array(4);return Pe[0]=1,new Uint32Array(Pe.buffer,0,1)[0]===1}function Ue(){try{return new Function(""),!0}catch{return!1}}class Ne{static get isLittleEndian(){return W(this,"isLittleEndian",Me())}static get isEvalSupported(){return W(this,"isEvalSupported",Ue())}static get isOffscreenCanvasSupported(){return W(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}}e.FeatureTest=Ne;const xe=[...Array(256).keys()].map(Pe=>Pe.toString(16).padStart(2,"0"));class qe{static makeHexColor(te,se,je){return`#${xe[te]}${xe[se]}${xe[je]}`}static scaleMinMax(te,se){let je;te[0]?(te[0]<0&&(je=se[0],se[0]=se[1],se[1]=je),se[0]*=te[0],se[1]*=te[0],te[3]<0&&(je=se[2],se[2]=se[3],se[3]=je),se[2]*=te[3],se[3]*=te[3]):(je=se[0],se[0]=se[2],se[2]=je,je=se[1],se[1]=se[3],se[3]=je,te[1]<0&&(je=se[2],se[2]=se[3],se[3]=je),se[2]*=te[1],se[3]*=te[1],te[2]<0&&(je=se[0],se[0]=se[1],se[1]=je),se[0]*=te[2],se[1]*=te[2]),se[0]+=te[4],se[1]+=te[4],se[2]+=te[5],se[3]+=te[5]}static transform(te,se){return[te[0]*se[0]+te[2]*se[1],te[1]*se[0]+te[3]*se[1],te[0]*se[2]+te[2]*se[3],te[1]*se[2]+te[3]*se[3],te[0]*se[4]+te[2]*se[5]+te[4],te[1]*se[4]+te[3]*se[5]+te[5]]}static applyTransform(te,se){const je=te[0]*se[0]+te[1]*se[2]+se[4],We=te[0]*se[1]+te[1]*se[3]+se[5];return[je,We]}static applyInverseTransform(te,se){const je=se[0]*se[3]-se[1]*se[2],We=(te[0]*se[3]-te[1]*se[2]+se[2]*se[5]-se[4]*se[3])/je,Qe=(-te[0]*se[1]+te[1]*se[0]+se[4]*se[1]-se[5]*se[0])/je;return[We,Qe]}static getAxialAlignedBoundingBox(te,se){const je=qe.applyTransform(te,se),We=qe.applyTransform(te.slice(2,4),se),Qe=qe.applyTransform([te[0],te[3]],se),Xe=qe.applyTransform([te[2],te[1]],se);return[Math.min(je[0],We[0],Qe[0],Xe[0]),Math.min(je[1],We[1],Qe[1],Xe[1]),Math.max(je[0],We[0],Qe[0],Xe[0]),Math.max(je[1],We[1],Qe[1],Xe[1])]}static inverseTransform(te){const se=te[0]*te[3]-te[1]*te[2];return[te[3]/se,-te[1]/se,-te[2]/se,te[0]/se,(te[2]*te[5]-te[4]*te[3])/se,(te[4]*te[1]-te[5]*te[0])/se]}static apply3dTransform(te,se){return[te[0]*se[0]+te[1]*se[1]+te[2]*se[2],te[3]*se[0]+te[4]*se[1]+te[5]*se[2],te[6]*se[0]+te[7]*se[1]+te[8]*se[2]]}static singularValueDecompose2dScale(te){const se=[te[0],te[2],te[1],te[3]],je=te[0]*se[0]+te[1]*se[2],We=te[0]*se[1]+te[1]*se[3],Qe=te[2]*se[0]+te[3]*se[2],Xe=te[2]*se[1]+te[3]*se[3],mt=(je+Xe)/2,Rt=Math.sqrt((je+Xe)**2-4*(je*Xe-Qe*We))/2,_t=mt+Rt||1,lt=mt-Rt||1;return[Math.sqrt(_t),Math.sqrt(lt)]}static normalizeRect(te){const se=te.slice(0);return te[0]>te[2]&&(se[0]=te[2],se[2]=te[0]),te[1]>te[3]&&(se[1]=te[3],se[3]=te[1]),se}static intersect(te,se){const je=Math.max(Math.min(te[0],te[2]),Math.min(se[0],se[2])),We=Math.min(Math.max(te[0],te[2]),Math.max(se[0],se[2]));if(je>We)return null;const Qe=Math.max(Math.min(te[1],te[3]),Math.min(se[1],se[3])),Xe=Math.min(Math.max(te[1],te[3]),Math.max(se[1],se[3]));return Qe>Xe?null:[je,Qe,We,Xe]}static bezierBoundingBox(te,se,je,We,Qe,Xe,mt,Rt){const _t=[],lt=[[],[]];let Tt,ht,Dt,et,xt,Pt,Ot,it;for(let jt=0;jt<2;++jt){if(jt===0?(ht=6*te-12*je+6*Qe,Tt=-3*te+9*je-9*Qe+3*mt,Dt=3*je-3*te):(ht=6*se-12*We+6*Xe,Tt=-3*se+9*We-9*Xe+3*Rt,Dt=3*We-3*se),Math.abs(Tt)<1e-12){if(Math.abs(ht)<1e-12)continue;et=-Dt/ht,0<et&&et<1&&_t.push(et);continue}Ot=ht*ht-4*Dt*Tt,it=Math.sqrt(Ot),!(Ot<0)&&(xt=(-ht+it)/(2*Tt),0<xt&&xt<1&&_t.push(xt),Pt=(-ht-it)/(2*Tt),0<Pt&&Pt<1&&_t.push(Pt))}let St=_t.length,ot;const At=St;for(;St--;)et=_t[St],ot=1-et,lt[0][St]=ot*ot*ot*te+3*ot*ot*et*je+3*ot*et*et*Qe+et*et*et*mt,lt[1][St]=ot*ot*ot*se+3*ot*ot*et*We+3*ot*et*et*Xe+et*et*et*Rt;return lt[0][At]=te,lt[1][At]=se,lt[0][At+1]=mt,lt[1][At+1]=Rt,lt[0].length=lt[1].length=At+2,[Math.min(...lt[0]),Math.min(...lt[1]),Math.max(...lt[0]),Math.max(...lt[1])]}}e.Util=qe;const $e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function ke(Pe){if(Pe[0]>="ï"){let se;if(Pe[0]==="þ"&&Pe[1]==="ÿ"?se="utf-16be":Pe[0]==="ÿ"&&Pe[1]==="þ"?se="utf-16le":Pe[0]==="ï"&&Pe[1]==="»"&&Pe[2]==="¿"&&(se="utf-8"),se)try{const je=new TextDecoder(se,{fatal:!0}),We=X(Pe);return je.decode(We)}catch(je){Oe(`stringToPDFString: "${je}".`)}}const te=[];for(let se=0,je=Pe.length;se<je;se++){const We=$e[Pe.charCodeAt(se)];te.push(We?String.fromCharCode(We):Pe.charAt(se))}return te.join("")}function rt(Pe){return Pe.replace(/([()\\\n\r])/g,te=>te===`
`?"\\n":te==="\r"?"\\r":`\\${te}`)}function tt(Pe){return/^[\x00-\x7F]*$/.test(Pe)}function ze(Pe){const te=["þÿ"];for(let se=0,je=Pe.length;se<je;se++){const We=Pe.charCodeAt(se);te.push(String.fromCharCode(We>>8&255),String.fromCharCode(We&255))}return te.join("")}function Ge(Pe){return decodeURIComponent(escape(Pe))}function Ke(Pe){return unescape(encodeURIComponent(Pe))}function ct(Pe){return typeof Pe=="object"&&Pe!==null&&Pe.byteLength!==void 0}function at(Pe,te){if(Pe.length!==te.length)return!1;for(let se=0,je=Pe.length;se<je;se++)if(Pe[se]!==te[se])return!1;return!0}function Et(Pe=new Date){return[Pe.getUTCFullYear().toString(),(Pe.getUTCMonth()+1).toString().padStart(2,"0"),Pe.getUTCDate().toString().padStart(2,"0"),Pe.getUTCHours().toString().padStart(2,"0"),Pe.getUTCMinutes().toString().padStart(2,"0"),Pe.getUTCSeconds().toString().padStart(2,"0")].join("")}function st(){const Pe=Object.create(null);let te=!1;return Object.defineProperty(Pe,"settled",{get(){return te}}),Pe.promise=new Promise(function(se,je){Pe.resolve=function(We){te=!0,se(We)},Pe.reject=function(We){te=!0,je(We)}}),Pe}},(r,e,t)=>{t(3)},(r,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isNodeJS=void 0;const t=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");e.isNodeJS=t},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var r,t,n,s,o,a,l,f,d,vn,M;Object.defineProperty(exports,"__esModule",{value:!0}),exports.build=exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,exports.getDocument=getDocument,exports.setPDFNetworkStreamFactory=setPDFNetworkStreamFactory,exports.version=void 0;var _util=__w_pdfjs_require__(1),_display_utils=__w_pdfjs_require__(5),_font_loader=__w_pdfjs_require__(7),_annotation_storage=__w_pdfjs_require__(8),_canvas=__w_pdfjs_require__(10),_worker_options=__w_pdfjs_require__(13),_is_node=__w_pdfjs_require__(3),_message_handler=__w_pdfjs_require__(14),_metadata=__w_pdfjs_require__(15),_optional_content_config=__w_pdfjs_require__(16),_transport_stream=__w_pdfjs_require__(17),_xfa_text=__w_pdfjs_require__(18);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100;let DefaultCanvasFactory=_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;let DefaultCMapReaderFactory=_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;let DefaultStandardFontDataFactory=_display_utils.DOMStandardFontDataFactory;if(exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory,_is_node.isNodeJS){const{NodeCanvasFactory:V,NodeCMapReaderFactory:g,NodeStandardFontDataFactory:F}=__w_pdfjs_require__(19);exports.DefaultCanvasFactory=DefaultCanvasFactory=V,exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory=g,exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory=F}let createPDFNetworkStream;function setPDFNetworkStreamFactory(V){createPDFNetworkStream=V}function getDocument(V){const g=new PDFDocumentLoadingTask;let F;if(typeof V=="string"||V instanceof URL)F={url:V};else if((0,_util.isArrayBuffer)(V))F={data:V};else if(V instanceof PDFDataRangeTransport)F={range:V};else{if(typeof V!="object")throw new Error("Invalid parameter in getDocument, need either string, URL, Uint8Array, or parameter object.");if(!V.url&&!V.data&&!V.range)throw new Error("Invalid parameter object: need either .data, .range or .url");F=V}const I=Object.create(null);let j=null,G=null;for(const H in F){const K=F[H];switch(H){case"url":if(typeof window<"u")try{I[H]=new URL(K,window.location).href;continue}catch(Y){(0,_util.warn)(`Cannot create valid URL: "${Y}".`)}else if(typeof K=="string"||K instanceof URL){I[H]=K.toString();continue}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.");case"range":j=K;continue;case"worker":G=K;continue;case"data":if(_is_node.isNodeJS&&typeof Buffer<"u"&&K instanceof Buffer)I[H]=new Uint8Array(K);else{if(K instanceof Uint8Array)break;if(typeof K=="string")I[H]=(0,_util.stringToBytes)(K);else if(typeof K=="object"&&K!==null&&!isNaN(K.length))I[H]=new Uint8Array(K);else if((0,_util.isArrayBuffer)(K))I[H]=new Uint8Array(K);else throw new Error("Invalid PDF binary data: either typed array, string, or array-like object is expected in the data property.")}continue}I[H]=K}if(I.CMapReaderFactory=I.CMapReaderFactory||DefaultCMapReaderFactory,I.StandardFontDataFactory=I.StandardFontDataFactory||DefaultStandardFontDataFactory,I.ignoreErrors=I.stopAtErrors!==!0,I.fontExtraProperties=I.fontExtraProperties===!0,I.pdfBug=I.pdfBug===!0,I.enableXfa=I.enableXfa===!0,(!Number.isInteger(I.rangeChunkSize)||I.rangeChunkSize<1)&&(I.rangeChunkSize=DEFAULT_RANGE_CHUNK_SIZE),(typeof I.docBaseUrl!="string"||(0,_display_utils.isDataScheme)(I.docBaseUrl))&&(I.docBaseUrl=null),(!Number.isInteger(I.maxImageSize)||I.maxImageSize<-1)&&(I.maxImageSize=-1),typeof I.cMapUrl!="string"&&(I.cMapUrl=null),typeof I.standardFontDataUrl!="string"&&(I.standardFontDataUrl=null),typeof I.useWorkerFetch!="boolean"&&(I.useWorkerFetch=I.CMapReaderFactory===_display_utils.DOMCMapReaderFactory&&I.StandardFontDataFactory===_display_utils.DOMStandardFontDataFactory),typeof I.isEvalSupported!="boolean"&&(I.isEvalSupported=!0),typeof I.disableFontFace!="boolean"&&(I.disableFontFace=_is_node.isNodeJS),typeof I.useSystemFonts!="boolean"&&(I.useSystemFonts=!_is_node.isNodeJS&&!I.disableFontFace),(typeof I.ownerDocument!="object"||I.ownerDocument===null)&&(I.ownerDocument=globalThis.document),typeof I.disableRange!="boolean"&&(I.disableRange=!1),typeof I.disableStream!="boolean"&&(I.disableStream=!1),typeof I.disableAutoFetch!="boolean"&&(I.disableAutoFetch=!1),(0,_util.setVerbosityLevel)(I.verbosity),!G){const H={verbosity:I.verbosity,port:_worker_options.GlobalWorkerOptions.workerPort};G=H.port?PDFWorker.fromPort(H):new PDFWorker(H),g._worker=G}const O=g.docId;return G.promise.then(function(){if(g.destroyed)throw new Error("Loading aborted");const H=_fetchDocument(G,I,j,O),K=new Promise(function(Y){let U;j?U=new _transport_stream.PDFDataTransportStream({length:I.length,initialData:I.initialData,progressiveDone:I.progressiveDone,contentDispositionFilename:I.contentDispositionFilename,disableRange:I.disableRange,disableStream:I.disableStream},j):I.data||(U=createPDFNetworkStream({url:I.url,length:I.length,httpHeaders:I.httpHeaders,withCredentials:I.withCredentials,rangeChunkSize:I.rangeChunkSize,disableRange:I.disableRange,disableStream:I.disableStream})),Y(U)});return Promise.all([H,K]).then(function([Y,U]){if(g.destroyed)throw new Error("Loading aborted");const h=new _message_handler.MessageHandler(O,Y,G.port),_=new WorkerTransport(h,g,U,I);g._transport=_,h.send("Ready",null)})}).catch(g._capability.reject),g}async function _fetchDocument(V,g,F,I){if(V.destroyed)throw new Error("Worker was destroyed");F&&(g.length=F.length,g.initialData=F.initialData,g.progressiveDone=F.progressiveDone,g.contentDispositionFilename=F.contentDispositionFilename);const j=await V.messageHandler.sendWithPromise("GetDocRequest",{docId:I,apiVersion:"2.14.305",source:{data:g.data,url:g.url,password:g.password,disableAutoFetch:g.disableAutoFetch,rangeChunkSize:g.rangeChunkSize,length:g.length},maxImageSize:g.maxImageSize,disableFontFace:g.disableFontFace,docBaseUrl:g.docBaseUrl,ignoreErrors:g.ignoreErrors,isEvalSupported:g.isEvalSupported,fontExtraProperties:g.fontExtraProperties,enableXfa:g.enableXfa,useSystemFonts:g.useSystemFonts,cMapUrl:g.useWorkerFetch?g.cMapUrl:null,standardFontDataUrl:g.useWorkerFetch?g.standardFontDataUrl:null});if(V.destroyed)throw new Error("Worker was destroyed");return j}const e=class e{constructor(){this._capability=(0,_util.createPromiseCapability)(),this._transport=null,this._worker=null,this.docId=`d${fr(e,r)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null,this.onUnsupportedFeature=null}get promise(){return this._capability.promise}async destroy(){var g;this.destroyed=!0,await((g=this._transport)==null?void 0:g.destroy()),this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};r=new WeakMap,gt(e,r,0);let PDFDocumentLoadingTask=e;exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(g,F,I=!1,j=null){this.length=g,this.initialData=F,this.progressiveDone=I,this.contentDispositionFilename=j,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=(0,_util.createPromiseCapability)()}addRangeListener(g){this._rangeListeners.push(g)}addProgressListener(g){this._progressListeners.push(g)}addProgressiveReadListener(g){this._progressiveReadListeners.push(g)}addProgressiveDoneListener(g){this._progressiveDoneListeners.push(g)}onDataRange(g,F){for(const I of this._rangeListeners)I(g,F)}onDataProgress(g,F){this._readyCapability.promise.then(()=>{for(const I of this._progressListeners)I(g,F)})}onDataProgressiveRead(g){this._readyCapability.promise.then(()=>{for(const F of this._progressiveReadListeners)F(g)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const g of this._progressiveDoneListeners)g()})}transportReady(){this._readyCapability.resolve()}requestDataRange(g,F){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(g,F){this._pdfInfo=g,this._transport=F,Object.defineProperty(this,"fingerprint",{get(){return(0,_display_utils.deprecated)("`PDFDocumentProxy.fingerprint`, please use `PDFDocumentProxy.fingerprints` instead."),this.fingerprints[0]}}),Object.defineProperty(this,"getStats",{value:async()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getStats`, please use the `PDFDocumentProxy.stats`-getter instead."),this.stats||{streamTypes:{},fontTypes:{}})})}get annotationStorage(){return this._transport.annotationStorage}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get stats(){return this._transport.stats}get isPureXfa(){return!!this._transport._htmlForXfa}get allXfaHtml(){return this._transport._htmlForXfa}getPage(g){return this._transport.getPage(g)}getPageIndex(g){return this._transport.getPageIndex(g)}getDestinations(){return this._transport.getDestinations()}getDestination(g){return this._transport.getDestination(g)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(g=!1){return this._transport.startCleanup(g||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}saveDocument(){return this._transport.annotationStorage.size<=0&&(0,_display_utils.deprecated)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead."),this._transport.saveDocument()}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(g,F,I,j,G=!1){this._pageIndex=g,this._pageInfo=F,this._ownerDocument=j,this._transport=I,this._stats=G?new _display_utils.StatTimer:null,this._pdfBug=G,this.commonObjs=I.commonObjs,this.objs=new PDFObjects,this._bitmaps=new Set,this.cleanupAfterRender=!1,this.pendingCleanup=!1,this._intentStates=new Map,this._annotationPromises=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:g,rotation:F=this.rotate,offsetX:I=0,offsetY:j=0,dontFlip:G=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:g,rotation:F,offsetX:I,offsetY:j,dontFlip:G})}getAnnotations({intent:g="display"}={}){const F=this._transport.getRenderingIntent(g);let I=this._annotationPromises.get(F.cacheKey);return I||(I=this._transport.getAnnotations(this._pageIndex,F.renderingIntent),this._annotationPromises.set(F.cacheKey,I),I=I.then(j=>{for(const G of j)G.titleObj!==void 0&&Object.defineProperty(G,"title",{get(){return(0,_display_utils.deprecated)("`title`-property on annotation, please use `titleObj` instead."),G.titleObj.str}}),G.contentsObj!==void 0&&Object.defineProperty(G,"contents",{get(){return(0,_display_utils.deprecated)("`contents`-property on annotation, please use `contentsObj` instead."),G.contentsObj.str}});return j})),I}getJSActions(){return this._jsActionsPromise||(this._jsActionsPromise=this._transport.getPageJSActions(this._pageIndex))}async getXfa(){var g;return((g=this._transport._htmlForXfa)==null?void 0:g.children[this._pageIndex])||null}render({canvasContext:g,viewport:F,intent:I="display",annotationMode:j=_util.AnnotationMode.ENABLE,transform:G=null,imageLayer:O=null,canvasFactory:H=null,background:K=null,optionalContentConfigPromise:Y=null,annotationCanvasMap:U=null,pageColors:h=null}){var Oe,Se;((Oe=arguments[0])==null?void 0:Oe.renderInteractiveForms)!==void 0&&((0,_display_utils.deprecated)("render no longer accepts the `renderInteractiveForms`-option, please use the `annotationMode`-option instead."),arguments[0].renderInteractiveForms===!0&&j===_util.AnnotationMode.ENABLE&&(j=_util.AnnotationMode.ENABLE_FORMS)),((Se=arguments[0])==null?void 0:Se.includeAnnotationStorage)!==void 0&&((0,_display_utils.deprecated)("render no longer accepts the `includeAnnotationStorage`-option, please use the `annotationMode`-option instead."),arguments[0].includeAnnotationStorage===!0&&j===_util.AnnotationMode.ENABLE&&(j=_util.AnnotationMode.ENABLE_STORAGE)),this._stats&&this._stats.time("Overall");const _=this._transport.getRenderingIntent(I,j);this.pendingCleanup=!1,Y||(Y=this._transport.getOptionalContentConfig());let E=this._intentStates.get(_.cacheKey);E||(E=Object.create(null),this._intentStates.set(_.cacheKey,E)),E.streamReaderCancelTimeout&&(clearTimeout(E.streamReaderCancelTimeout),E.streamReaderCancelTimeout=null);const x=H||new DefaultCanvasFactory({ownerDocument:this._ownerDocument}),P=!!(_.renderingIntent&_util.RenderingIntentFlag.PRINT);E.displayReadyCapability||(E.displayReadyCapability=(0,_util.createPromiseCapability)(),E.operatorList={fnArray:[],argsArray:[],lastChunk:!1},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList(_));const k=Fe=>{E.renderTasks.delete(Q),(this.cleanupAfterRender||P)&&(this.pendingCleanup=!0),this._tryCleanup(),Fe?(Q.capability.reject(Fe),this._abortOperatorList({intentState:E,reason:Fe instanceof Error?Fe:new Error(Fe)})):Q.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"))},Q=new InternalRenderTask({callback:k,params:{canvasContext:g,viewport:F,transform:G,imageLayer:O,background:K},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:U,operatorList:E.operatorList,pageIndex:this._pageIndex,canvasFactory:x,useRequestAnimationFrame:!P,pdfBug:this._pdfBug,pageColors:h});(E.renderTasks||(E.renderTasks=new Set)).add(Q);const Ce=Q.task;return Promise.all([E.displayReadyCapability.promise,Y]).then(([Fe,Ve])=>{if(this.pendingCleanup){k();return}this._stats&&this._stats.time("Rendering"),Q.initializeGraphics({transparency:Fe,optionalContentConfig:Ve}),Q.operatorListChanged()}).catch(k),Ce}getOperatorList({intent:g="display",annotationMode:F=_util.AnnotationMode.ENABLE}={}){function I(){G.operatorList.lastChunk&&(G.opListReadCapability.resolve(G.operatorList),G.renderTasks.delete(O))}const j=this._transport.getRenderingIntent(g,F,!0);let G=this._intentStates.get(j.cacheKey);G||(G=Object.create(null),this._intentStates.set(j.cacheKey,G));let O;return G.opListReadCapability||(O=Object.create(null),O.operatorListChanged=I,G.opListReadCapability=(0,_util.createPromiseCapability)(),(G.renderTasks||(G.renderTasks=new Set)).add(O),G.operatorList={fnArray:[],argsArray:[],lastChunk:!1},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList(j)),G.opListReadCapability.promise}streamTextContent({disableCombineTextItems:g=!1,includeMarkedContent:F=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,combineTextItems:g!==!0,includeMarkedContent:F===!0},{highWaterMark:100,size(j){return j.items.length}})}getTextContent(g={}){if(this._transport._htmlForXfa)return this.getXfa().then(I=>_xfa_text.XfaText.textContent(I));const F=this.streamTextContent(g);return new Promise(function(I,j){function G(){O.read().then(function({value:K,done:Y}){if(Y){I(H);return}Object.assign(H.styles,K.styles),H.items.push(...K.items),G()},j)}const O=F.getReader(),H={items:[],styles:Object.create(null)};G()})}getStructTree(){return this._structTreePromise||(this._structTreePromise=this._transport.getStructTree(this._pageIndex))}_destroy(){this.destroyed=!0;const g=[];for(const F of this._intentStates.values())if(this._abortOperatorList({intentState:F,reason:new Error("Page was destroyed."),force:!0}),!F.opListReadCapability)for(const I of F.renderTasks)g.push(I.completed),I.cancel();this.objs.clear();for(const F of this._bitmaps)F.close();return this._bitmaps.clear(),this._annotationPromises.clear(),this._jsActionsPromise=null,this._structTreePromise=null,this.pendingCleanup=!1,Promise.all(g)}cleanup(g=!1){return this.pendingCleanup=!0,this._tryCleanup(g)}_tryCleanup(g=!1){if(!this.pendingCleanup)return!1;for(const{renderTasks:F,operatorList:I}of this._intentStates.values())if(F.size>0||!I.lastChunk)return!1;this._intentStates.clear(),this.objs.clear(),this._annotationPromises.clear(),this._jsActionsPromise=null,this._structTreePromise=null,g&&this._stats&&(this._stats=new _display_utils.StatTimer);for(const F of this._bitmaps)F.close();return this._bitmaps.clear(),this.pendingCleanup=!1,!0}_startRenderPage(g,F){const I=this._intentStates.get(F);I&&(this._stats&&this._stats.timeEnd("Page Request"),I.displayReadyCapability&&I.displayReadyCapability.resolve(g))}_renderPageChunk(g,F){for(let I=0,j=g.length;I<j;I++)F.operatorList.fnArray.push(g.fnArray[I]),F.operatorList.argsArray.push(g.argsArray[I]);F.operatorList.lastChunk=g.lastChunk;for(const I of F.renderTasks)I.operatorListChanged();g.lastChunk&&this._tryCleanup()}_pumpOperatorList({renderingIntent:g,cacheKey:F}){const j=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:g,cacheKey:F,annotationStorage:g&_util.RenderingIntentFlag.ANNOTATIONS_STORAGE?this._transport.annotationStorage.serializable:null}).getReader(),G=this._intentStates.get(F);G.streamReader=j;const O=()=>{j.read().then(({value:H,done:K})=>{if(K){G.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(H,G),O())},H=>{if(G.streamReader=null,!this._transport.destroyed){if(G.operatorList){G.operatorList.lastChunk=!0;for(const K of G.renderTasks)K.operatorListChanged();this._tryCleanup()}if(G.displayReadyCapability)G.displayReadyCapability.reject(H);else if(G.opListReadCapability)G.opListReadCapability.reject(H);else throw H}})};O()}_abortOperatorList({intentState:g,reason:F,force:I=!1}){if(g.streamReader){if(!I){if(g.renderTasks.size>0)return;if(F instanceof _display_utils.RenderingCancelledException){g.streamReaderCancelTimeout=setTimeout(()=>{this._abortOperatorList({intentState:g,reason:F,force:!0}),g.streamReaderCancelTimeout=null},RENDERING_CANCELLED_TIMEOUT);return}}if(g.streamReader.cancel(new _util.AbortException(F.message)).catch(()=>{}),g.streamReader=null,!this._transport.destroyed){for(const[j,G]of this._intentStates)if(G===g){this._intentStates.delete(j);break}this.cleanup()}}}get stats(){return this._stats}}exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){this._listeners=[],this._deferred=Promise.resolve()}postMessage(g,F){const I={data:structuredClone(g,F)};this._deferred.then(()=>{for(const j of this._listeners)j.call(this,I)})}addEventListener(g,F){this._listeners.push(F)}removeEventListener(g,F){const I=this._listeners.indexOf(F);this._listeners.splice(I,1)}terminate(){this._listeners.length=0}}exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_is_node.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const V=(t=document==null?void 0:document.currentScript)==null?void 0:t.src;V&&(PDFWorkerUtil.fallbackWorkerSrc=V.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(V,g){let F;try{if(F=new URL(V),!F.origin||F.origin==="null")return!1}catch{return!1}const I=new URL(g,F);return F.origin===I.origin},PDFWorkerUtil.createCDNWrapper=function(V){const g=`importScripts("${V}");`;return URL.createObjectURL(new Blob([g]))}}const _PDFWorker=class _PDFWorker{constructor({name:V=null,port:g=null,verbosity:F=(0,_util.getVerbosityLevel)()}={}){if(g&&Ye(_PDFWorker,n).has(g))throw new Error("Cannot use more than one PDFWorker per port.");if(this.name=V,this.destroyed=!1,this.verbosity=F,this._readyCapability=(0,_util.createPromiseCapability)(),this._port=null,this._webWorker=null,this._messageHandler=null,g){Ye(_PDFWorker,n).set(g,this),this._initializeFromPort(g);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(V){this._port=V,this._messageHandler=new _message_handler.MessageHandler("main","worker",V),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve()}_initialize(){if(typeof Worker<"u"&&!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let V=_PDFWorker.workerSrc;try{PDFWorkerUtil.isSameOrigin(window.location.href,V)||(V=PDFWorkerUtil.createCDNWrapper(new URL(V,window.location).href));const g=new Worker(V),F=new _message_handler.MessageHandler("main","worker",g),I=()=>{g.removeEventListener("error",j),F.destroy(),g.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},j=()=>{this._webWorker||I()};g.addEventListener("error",j),F.on("test",O=>{if(g.removeEventListener("error",j),this.destroyed){I();return}O?(this._messageHandler=F,this._port=g,this._webWorker=g,this._readyCapability.resolve(),F.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),F.destroy(),g.terminate())}),F.on("ready",O=>{if(g.removeEventListener("error",j),this.destroyed){I();return}try{G()}catch{this._setupFakeWorker()}});const G=()=>{const O=new Uint8Array;F.send("test",O,[O.buffer])};G();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(V=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const g=new LoopbackPort;this._port=g;const F=`fake${PDFWorkerUtil.fakeWorkerId++}`,I=new _message_handler.MessageHandler(F+"_worker",F,g);V.setup(I,g);const j=new _message_handler.MessageHandler(F,F+"_worker",g);this._messageHandler=j,this._readyCapability.resolve(),j.send("configure",{verbosity:this.verbosity})}).catch(V=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${V.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),Ye(_PDFWorker,n).delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(V){if(!(V!=null&&V.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return Ye(this,n).has(V.port)?Ye(this,n).get(V.port):new _PDFWorker(V)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var V;try{return((V=globalThis.pdfjsWorker)==null?void 0:V.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_is_node.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};n=new WeakMap,gt(_PDFWorker,n,new WeakMap);let PDFWorker=_PDFWorker;exports.PDFWorker=PDFWorker,PDFWorker.getWorkerSrc=function(){return(0,_display_utils.deprecated)("`PDFWorker.getWorkerSrc()`, please use `PDFWorker.workerSrc` instead."),this.workerSrc};class WorkerTransport{constructor(g,F,I,j){gt(this,s,null);gt(this,o,new Map);gt(this,a,new Map);gt(this,l,null);this.messageHandler=g,this.loadingTask=F,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({docId:F.docId,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),ownerDocument:j.ownerDocument,styleElement:j.styleElement}),this._params=j,j.useWorkerFetch||(this.CMapReaderFactory=new j.CMapReaderFactory({baseUrl:j.cMapUrl,isCompressed:j.cMapPacked}),this.StandardFontDataFactory=new j.StandardFontDataFactory({baseUrl:j.standardFontDataUrl})),this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=I,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=(0,_util.createPromiseCapability)(),this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}get stats(){return Ye(this,s)}getRenderingIntent(g,F=_util.AnnotationMode.ENABLE,I=!1){let j=_util.RenderingIntentFlag.DISPLAY,G="";switch(g){case"any":j=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":j=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${g}`)}switch(F){case _util.AnnotationMode.DISABLE:j+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:j+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:j+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,G=this.annotationStorage.hash;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${F}`)}return I&&(j+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:j,cacheKey:`${j}_${G}`}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=(0,_util.createPromiseCapability)(),this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));const g=[];for(const I of Ye(this,o).values())g.push(I._destroy());Ye(this,o).clear(),Ye(this,a).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const F=this.messageHandler.sendWithPromise("Terminate",null);return g.push(F),Promise.all(g).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),vt(this,l,null),this._getFieldObjectsPromise=null,this._hasJSActionsPromise=null,this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:g,loadingTask:F}=this;g.on("GetReader",(I,j)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=G=>{this._lastProgress={loaded:G.loaded,total:G.total}},j.onPull=()=>{this._fullReader.read().then(function({value:G,done:O}){if(O){j.close();return}(0,_util.assert)((0,_util.isArrayBuffer)(G),"GetReader - expected an ArrayBuffer."),j.enqueue(new Uint8Array(G),1,[G])}).catch(G=>{j.error(G)})},j.onCancel=G=>{this._fullReader.cancel(G),j.ready.catch(O=>{if(!this.destroyed)throw O})}}),g.on("ReaderHeadersReady",I=>{const j=(0,_util.createPromiseCapability)(),G=this._fullReader;return G.headersReady.then(()=>{var O;(!G.isStreamingSupported||!G.isRangeSupported)&&(this._lastProgress&&((O=F.onProgress)==null||O.call(F,this._lastProgress)),G.onProgress=H=>{var K;(K=F.onProgress)==null||K.call(F,{loaded:H.loaded,total:H.total})}),j.resolve({isStreamingSupported:G.isStreamingSupported,isRangeSupported:G.isRangeSupported,contentLength:G.contentLength})},j.reject),j.promise}),g.on("GetRangeReader",(I,j)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const G=this._networkStream.getRangeReader(I.begin,I.end);if(!G){j.close();return}j.onPull=()=>{G.read().then(function({value:O,done:H}){if(H){j.close();return}(0,_util.assert)((0,_util.isArrayBuffer)(O),"GetRangeReader - expected an ArrayBuffer."),j.enqueue(new Uint8Array(O),1,[O])}).catch(O=>{j.error(O)})},j.onCancel=O=>{G.cancel(O),j.ready.catch(H=>{if(!this.destroyed)throw H})}}),g.on("GetDoc",({pdfInfo:I})=>{this._numPages=I.numPages,this._htmlForXfa=I.htmlForXfa,delete I.htmlForXfa,F._capability.resolve(new PDFDocumentProxy(I,this))}),g.on("DocException",function(I){let j;switch(I.name){case"PasswordException":j=new _util.PasswordException(I.message,I.code);break;case"InvalidPDFException":j=new _util.InvalidPDFException(I.message);break;case"MissingPDFException":j=new _util.MissingPDFException(I.message);break;case"UnexpectedResponseException":j=new _util.UnexpectedResponseException(I.message,I.status);break;case"UnknownErrorException":j=new _util.UnknownErrorException(I.message,I.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}F._capability.reject(j)}),g.on("PasswordRequest",I=>{if(this._passwordCapability=(0,_util.createPromiseCapability)(),F.onPassword){const j=G=>{G instanceof Error?this._passwordCapability.reject(G):this._passwordCapability.resolve({password:G})};try{F.onPassword(j,I.code)}catch(G){this._passwordCapability.reject(G)}}else this._passwordCapability.reject(new _util.PasswordException(I.message,I.code));return this._passwordCapability.promise}),g.on("DataLoaded",I=>{var j;(j=F.onProgress)==null||j.call(F,{loaded:I.length,total:I.length}),this.downloadInfoCapability.resolve(I)}),g.on("StartRenderPage",I=>{if(this.destroyed)return;Ye(this,o).get(I.pageIndex)._startRenderPage(I.transparency,I.cacheKey)}),g.on("commonobj",([I,j,G])=>{var O;if(!this.destroyed&&!this.commonObjs.has(I))switch(j){case"Font":const H=this._params;if("error"in G){const U=G.error;(0,_util.warn)(`Error during font loading: ${U}`),this.commonObjs.resolve(I,U);break}let K=null;H.pdfBug&&((O=globalThis.FontInspector)!=null&&O.enabled)&&(K={registerFont(U,h){globalThis.FontInspector.fontAdded(U,h)}});const Y=new _font_loader.FontFaceObject(G,{isEvalSupported:H.isEvalSupported,disableFontFace:H.disableFontFace,ignoreErrors:H.ignoreErrors,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),fontRegistry:K});this.fontLoader.bind(Y).catch(U=>g.sendWithPromise("FontFallback",{id:I})).finally(()=>{!H.fontExtraProperties&&Y.data&&(Y.data=null),this.commonObjs.resolve(I,Y)});break;case"FontPath":case"Image":this.commonObjs.resolve(I,G);break;default:throw new Error(`Got unknown common object type ${j}`)}}),g.on("obj",([I,j,G,O])=>{var K;if(this.destroyed)return;const H=Ye(this,o).get(j);if(!H.objs.has(I))switch(G){case"Image":H.objs.resolve(I,O);const Y=8e6;if(O){let U;if(O.bitmap){const{bitmap:h,width:_,height:E}=O;U=_*E*4,H._bitmaps.add(h)}else U=((K=O.data)==null?void 0:K.length)||0;U>Y&&(H.cleanupAfterRender=!0)}break;case"Pattern":H.objs.resolve(I,O);break;default:throw new Error(`Got unknown object type ${G}`)}}),g.on("DocProgress",I=>{var j;this.destroyed||(j=F.onProgress)==null||j.call(F,{loaded:I.loaded,total:I.total})}),g.on("DocStats",I=>{this.destroyed||vt(this,s,Object.freeze({streamTypes:Object.freeze(I.streamTypes),fontTypes:Object.freeze(I.fontTypes)}))}),g.on("UnsupportedFeature",this._onUnsupportedFeature.bind(this)),g.on("FetchBuiltInCMap",I=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.CMapReaderFactory?this.CMapReaderFactory.fetch(I):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),g.on("FetchStandardFontData",I=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.StandardFontDataFactory?this.StandardFontDataFactory.fetch(I):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}_onUnsupportedFeature({featureId:g}){var F,I;this.destroyed||(I=(F=this.loadingTask).onUnsupportedFeature)==null||I.call(F,g)}getData(){return this.messageHandler.sendWithPromise("GetData",null)}getPage(g){if(!Number.isInteger(g)||g<=0||g>this._numPages)return Promise.reject(new Error("Invalid page request."));const F=g-1,I=Ye(this,a).get(F);if(I)return I;const j=this.messageHandler.sendWithPromise("GetPage",{pageIndex:F}).then(G=>{if(this.destroyed)throw new Error("Transport destroyed");const O=new PDFPageProxy(F,G,this,this._params.ownerDocument,this._params.pdfBug);return Ye(this,o).set(F,O),O});return Ye(this,a).set(F,j),j}getPageIndex(g){return typeof g!="object"||g===null||!Number.isInteger(g.num)||g.num<0||!Number.isInteger(g.gen)||g.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:g.num,gen:g.gen})}getAnnotations(g,F){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:g,intent:F})}saveDocument(){var g;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:this.annotationStorage.serializable,filename:((g=this._fullReader)==null?void 0:g.filename)??null}).finally(()=>{this.annotationStorage.resetModified()})}getFieldObjects(){return this._getFieldObjectsPromise||(this._getFieldObjectsPromise=this.messageHandler.sendWithPromise("GetFieldObjects",null))}hasJSActions(){return this._hasJSActionsPromise||(this._hasJSActionsPromise=this.messageHandler.sendWithPromise("HasJSActions",null))}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(g){return typeof g!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:g})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(g){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:g})}getStructTree(g){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:g})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(g=>new _optional_content_config.OptionalContentConfig(g))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){return Ye(this,l)||vt(this,l,this.messageHandler.sendWithPromise("GetMetadata",null).then(g=>{var F,I;return{info:g[0],metadata:g[1]?new _metadata.Metadata(g[1]):null,contentDispositionFilename:((F=this._fullReader)==null?void 0:F.filename)??null,contentLength:((I=this._fullReader)==null?void 0:I.contentLength)??null}}))}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(g=!1){if(await this.messageHandler.sendWithPromise("Cleanup",null),!this.destroyed){for(const F of Ye(this,o).values())if(!F.cleanup())throw new Error(`startCleanup: Page ${F.pageNumber} is currently rendering.`);this.commonObjs.clear(),g||this.fontLoader.clear(),vt(this,l,null),this._getFieldObjectsPromise=null,this._hasJSActionsPromise=null}}get loadingParams(){const g=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:g.disableAutoFetch,enableXfa:g.enableXfa})}}s=new WeakMap,o=new WeakMap,a=new WeakMap,l=new WeakMap;class PDFObjects{constructor(){gt(this,d);gt(this,f,Object.create(null))}get(g,F=null){if(F){const j=Yt(this,d,vn).call(this,g);return j.capability.promise.then(()=>F(j.data)),null}const I=Ye(this,f)[g];if(!(I!=null&&I.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${g}.`);return I.data}has(g){const F=Ye(this,f)[g];return(F==null?void 0:F.capability.settled)||!1}resolve(g,F=null){const I=Yt(this,d,vn).call(this,g);I.data=F,I.capability.resolve()}clear(){vt(this,f,Object.create(null))}}f=new WeakMap,d=new WeakSet,vn=function(g){const F=Ye(this,f)[g];return F||(Ye(this,f)[g]={capability:(0,_util.createPromiseCapability)(),data:null})};class RenderTask{constructor(g){this._internalRenderTask=g,this.onContinue=null}get promise(){return this._internalRenderTask.capability.promise}cancel(){this._internalRenderTask.cancel()}}exports.RenderTask=RenderTask;const q=class q{constructor({callback:g,params:F,objs:I,commonObjs:j,annotationCanvasMap:G,operatorList:O,pageIndex:H,canvasFactory:K,useRequestAnimationFrame:Y=!1,pdfBug:U=!1,pageColors:h=null}){this.callback=g,this.params=F,this.objs=I,this.commonObjs=j,this.annotationCanvasMap=G,this.operatorListIdx=null,this.operatorList=O,this._pageIndex=H,this.canvasFactory=K,this._pdfBug=U,this.pageColors=h,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=Y===!0&&typeof window<"u",this.cancelled=!1,this.capability=(0,_util.createPromiseCapability)(),this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=F.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:g=!1,optionalContentConfig:F}){var K;if(this.cancelled)return;if(this._canvas){if(Ye(q,M).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Ye(q,M).add(this._canvas)}this._pdfBug&&((K=globalThis.StepperManager)!=null&&K.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:I,viewport:j,transform:G,imageLayer:O,background:H}=this.params;this.gfx=new _canvas.CanvasGraphics(I,this.commonObjs,this.objs,this.canvasFactory,O,F,this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:G,viewport:j,transparency:g,background:H}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback&&this.graphicsReadyCallback()}cancel(g=null){this.running=!1,this.cancelled=!0,this.gfx&&this.gfx.endDrawing(),this._canvas&&Ye(q,M).delete(this._canvas),this.callback(g||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,"canvas"))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}this.stepper&&this.stepper.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),this._canvas&&Ye(q,M).delete(this._canvas),this.callback())))}};M=new WeakMap,gt(q,M,new WeakSet);let InternalRenderTask=q;const version="2.14.305";exports.version=version;const build="eaaa8b4ad";exports.build=build},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StatTimer=e.RenderingCancelledException=e.PixelsPerInch=e.PageViewport=e.PDFDateString=e.DOMStandardFontDataFactory=e.DOMSVGFactory=e.DOMCanvasFactory=e.DOMCMapReaderFactory=void 0,e.deprecated=K,e.getFilenameFromUrl=I,e.getPdfFilenameFromUrl=j,e.getXfaPageViewport=h,e.isDataScheme=g,e.isPdfFile=F,e.isValidFetchUrl=O,e.loadScript=H;var n=t(6),s=t(1);const o="http://www.w3.org/2000/svg",_=class _{};dn(_,"CSS",96),dn(_,"PDF",72),dn(_,"PDF_TO_CSS_UNITS",_.CSS/_.PDF);let a=_;e.PixelsPerInch=a;class l extends n.BaseCanvasFactory{constructor({ownerDocument:x=globalThis.document}={}){super(),this._document=x}_createCanvas(x,P){const k=this._document.createElement("canvas");return k.width=x,k.height=P,k}}e.DOMCanvasFactory=l;async function f(E,x=!1){if(O(E,document.baseURI)){const P=await fetch(E);if(!P.ok)throw new Error(P.statusText);return x?new Uint8Array(await P.arrayBuffer()):(0,s.stringToBytes)(await P.text())}return new Promise((P,k)=>{const Q=new XMLHttpRequest;Q.open("GET",E,!0),x&&(Q.responseType="arraybuffer"),Q.onreadystatechange=()=>{if(Q.readyState===XMLHttpRequest.DONE){if(Q.status===200||Q.status===0){let Ce;if(x&&Q.response?Ce=new Uint8Array(Q.response):!x&&Q.responseText&&(Ce=(0,s.stringToBytes)(Q.responseText)),Ce){P(Ce);return}}k(new Error(Q.statusText))}},Q.send(null)})}class d extends n.BaseCMapReaderFactory{_fetchData(x,P){return f(x,this.isCompressed).then(k=>({cMapData:k,compressionType:P}))}}e.DOMCMapReaderFactory=d;class A extends n.BaseStandardFontDataFactory{_fetchData(x){return f(x,!0)}}e.DOMStandardFontDataFactory=A;class M extends n.BaseSVGFactory{_createSVG(x){return document.createElementNS(o,x)}}e.DOMSVGFactory=M;class q{constructor({viewBox:x,scale:P,rotation:k,offsetX:Q=0,offsetY:Ce=0,dontFlip:Oe=!1}){this.viewBox=x,this.scale=P,this.rotation=k,this.offsetX=Q,this.offsetY=Ce;const Se=(x[2]+x[0])/2,Fe=(x[3]+x[1])/2;let Ve,Le,W,T;switch(k%=360,k<0&&(k+=360),k){case 180:Ve=-1,Le=0,W=0,T=1;break;case 90:Ve=0,Le=1,W=1,T=0;break;case 270:Ve=0,Le=-1,W=-1,T=0;break;case 0:Ve=1,Le=0,W=0,T=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}Oe&&(W=-W,T=-T);let m,B,c,p;Ve===0?(m=Math.abs(Fe-x[1])*P+Q,B=Math.abs(Se-x[0])*P+Ce,c=Math.abs(x[3]-x[1])*P,p=Math.abs(x[2]-x[0])*P):(m=Math.abs(Se-x[0])*P+Q,B=Math.abs(Fe-x[1])*P+Ce,c=Math.abs(x[2]-x[0])*P,p=Math.abs(x[3]-x[1])*P),this.transform=[Ve*P,Le*P,W*P,T*P,m-Ve*P*Se-W*P*Fe,B-Le*P*Se-T*P*Fe],this.width=c,this.height=p}clone({scale:x=this.scale,rotation:P=this.rotation,offsetX:k=this.offsetX,offsetY:Q=this.offsetY,dontFlip:Ce=!1}={}){return new q({viewBox:this.viewBox.slice(),scale:x,rotation:P,offsetX:k,offsetY:Q,dontFlip:Ce})}convertToViewportPoint(x,P){return s.Util.applyTransform([x,P],this.transform)}convertToViewportRectangle(x){const P=s.Util.applyTransform([x[0],x[1]],this.transform),k=s.Util.applyTransform([x[2],x[3]],this.transform);return[P[0],P[1],k[0],k[1]]}convertToPdfPoint(x,P){return s.Util.applyInverseTransform([x,P],this.transform)}}e.PageViewport=q;class V extends s.BaseException{constructor(x,P){super(x,"RenderingCancelledException"),this.type=P}}e.RenderingCancelledException=V;function g(E){const x=E.length;let P=0;for(;P<x&&E[P].trim()==="";)P++;return E.substring(P,P+5).toLowerCase()==="data:"}function F(E){return typeof E=="string"&&/\.pdf$/i.test(E)}function I(E){const x=E.indexOf("#"),P=E.indexOf("?"),k=Math.min(x>0?x:E.length,P>0?P:E.length);return E.substring(E.lastIndexOf("/",k)+1,k)}function j(E,x="document.pdf"){if(typeof E!="string")return x;if(g(E))return(0,s.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),x;const P=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,k=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,Q=P.exec(E);let Ce=k.exec(Q[1])||k.exec(Q[2])||k.exec(Q[3]);if(Ce&&(Ce=Ce[0],Ce.includes("%")))try{Ce=k.exec(decodeURIComponent(Ce))[0]}catch{}return Ce||x}class G{constructor(){this.started=Object.create(null),this.times=[]}time(x){x in this.started&&(0,s.warn)(`Timer is already running for ${x}`),this.started[x]=Date.now()}timeEnd(x){x in this.started||(0,s.warn)(`Timer has not been started for ${x}`),this.times.push({name:x,start:this.started[x],end:Date.now()}),delete this.started[x]}toString(){const x=[];let P=0;for(const k of this.times){const Q=k.name;Q.length>P&&(P=Q.length)}for(const k of this.times){const Q=k.end-k.start;x.push(`${k.name.padEnd(P)} ${Q}ms
`)}return x.join("")}}e.StatTimer=G;function O(E,x){try{const{protocol:P}=x?new URL(E,x):new URL(E);return P==="http:"||P==="https:"}catch{return!1}}function H(E,x=!1){return new Promise((P,k)=>{const Q=document.createElement("script");Q.src=E,Q.onload=function(Ce){x&&Q.remove(),P(Ce)},Q.onerror=function(){k(new Error(`Cannot load script at: ${Q.src}`))},(document.head||document.documentElement).appendChild(Q)})}function K(E){console.log("Deprecated API usage: "+E)}let Y;class U{static toDateObject(x){if(!x||typeof x!="string")return null;Y||(Y=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const P=Y.exec(x);if(!P)return null;const k=parseInt(P[1],10);let Q=parseInt(P[2],10);Q=Q>=1&&Q<=12?Q-1:0;let Ce=parseInt(P[3],10);Ce=Ce>=1&&Ce<=31?Ce:1;let Oe=parseInt(P[4],10);Oe=Oe>=0&&Oe<=23?Oe:0;let Se=parseInt(P[5],10);Se=Se>=0&&Se<=59?Se:0;let Fe=parseInt(P[6],10);Fe=Fe>=0&&Fe<=59?Fe:0;const Ve=P[7]||"Z";let Le=parseInt(P[8],10);Le=Le>=0&&Le<=23?Le:0;let W=parseInt(P[9],10)||0;return W=W>=0&&W<=59?W:0,Ve==="-"?(Oe+=Le,Se+=W):Ve==="+"&&(Oe-=Le,Se-=W),new Date(Date.UTC(k,Q,Ce,Oe,Se,Fe))}}e.PDFDateString=U;function h(E,{scale:x=1,rotation:P=0}){const{width:k,height:Q}=E.attributes.style,Ce=[0,0,parseInt(k),parseInt(Q)];return new q({viewBox:Ce,scale:x,rotation:P})}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BaseStandardFontDataFactory=e.BaseSVGFactory=e.BaseCanvasFactory=e.BaseCMapReaderFactory=void 0;var n=t(1);class s{constructor(){this.constructor===s&&(0,n.unreachable)("Cannot initialize BaseCanvasFactory.")}create(d,A){if(d<=0||A<=0)throw new Error("Invalid canvas size");const M=this._createCanvas(d,A);return{canvas:M,context:M.getContext("2d")}}reset(d,A,M){if(!d.canvas)throw new Error("Canvas is not specified");if(A<=0||M<=0)throw new Error("Invalid canvas size");d.canvas.width=A,d.canvas.height=M}destroy(d){if(!d.canvas)throw new Error("Canvas is not specified");d.canvas.width=0,d.canvas.height=0,d.canvas=null,d.context=null}_createCanvas(d,A){(0,n.unreachable)("Abstract method `_createCanvas` called.")}}e.BaseCanvasFactory=s;class o{constructor({baseUrl:d=null,isCompressed:A=!1}){this.constructor===o&&(0,n.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=d,this.isCompressed=A}async fetch({name:d}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!d)throw new Error("CMap name must be specified.");const A=this.baseUrl+d+(this.isCompressed?".bcmap":""),M=this.isCompressed?n.CMapCompressionType.BINARY:n.CMapCompressionType.NONE;return this._fetchData(A,M).catch(q=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${A}`)})}_fetchData(d,A){(0,n.unreachable)("Abstract method `_fetchData` called.")}}e.BaseCMapReaderFactory=o;class a{constructor({baseUrl:d=null}){this.constructor===a&&(0,n.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=d}async fetch({filename:d}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!d)throw new Error("Font filename must be specified.");const A=`${this.baseUrl}${d}`;return this._fetchData(A).catch(M=>{throw new Error(`Unable to load font data at: ${A}`)})}_fetchData(d){(0,n.unreachable)("Abstract method `_fetchData` called.")}}e.BaseStandardFontDataFactory=a;class l{constructor(){this.constructor===l&&(0,n.unreachable)("Cannot initialize BaseSVGFactory.")}create(d,A){if(d<=0||A<=0)throw new Error("Invalid SVG dimensions");const M=this._createSVG("svg:svg");return M.setAttribute("version","1.1"),M.setAttribute("width",`${d}px`),M.setAttribute("height",`${A}px`),M.setAttribute("preserveAspectRatio","none"),M.setAttribute("viewBox",`0 0 ${d} ${A}`),M}createElement(d){if(typeof d!="string")throw new Error("Invalid SVG element type");return this._createSVG(d)}_createSVG(d){(0,n.unreachable)("Abstract method `_createSVG` called.")}}e.BaseSVGFactory=l},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FontLoader=e.FontFaceObject=void 0;var n=t(1);class s{constructor({docId:f,onUnsupportedFeature:d,ownerDocument:A=globalThis.document,styleElement:M=null}){this.constructor===s&&(0,n.unreachable)("Cannot initialize BaseFontLoader."),this.docId=f,this._onUnsupportedFeature=d,this._document=A,this.nativeFontFaces=[],this.styleElement=null}addNativeFontFace(f){this.nativeFontFaces.push(f),this._document.fonts.add(f)}insertRule(f){let d=this.styleElement;d||(d=this.styleElement=this._document.createElement("style"),d.id=`PDFJS_FONT_STYLE_TAG_${this.docId}`,this._document.documentElement.getElementsByTagName("head")[0].appendChild(d));const A=d.sheet;A.insertRule(f,A.cssRules.length)}clear(){for(const f of this.nativeFontFaces)this._document.fonts.delete(f);this.nativeFontFaces.length=0,this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async bind(f){if(f.attached||f.missingFile)return;if(f.attached=!0,this.isFontLoadingAPISupported){const A=f.createNativeFontFace();if(A){this.addNativeFontFace(A);try{await A.loaded}catch(M){throw this._onUnsupportedFeature({featureId:n.UNSUPPORTED_FEATURES.errorFontLoadNative}),(0,n.warn)(`Failed to load font '${A.family}': '${M}'.`),f.disableFontFace=!0,M}}return}const d=f.createFontFaceRule();if(d){if(this.insertRule(d),this.isSyncFontLoadingSupported)return;await new Promise(A=>{const M=this._queueLoadingCallback(A);this._prepareFontLoadEvent([d],[f],M)})}}_queueLoadingCallback(f){(0,n.unreachable)("Abstract method `_queueLoadingCallback`.")}get isFontLoadingAPISupported(){var d;const f=!!((d=this._document)!=null&&d.fonts);return(0,n.shadow)(this,"isFontLoadingAPISupported",f)}get isSyncFontLoadingSupported(){(0,n.unreachable)("Abstract method `isSyncFontLoadingSupported`.")}get _loadTestFont(){(0,n.unreachable)("Abstract method `_loadTestFont`.")}_prepareFontLoadEvent(f,d,A){(0,n.unreachable)("Abstract method `_prepareFontLoadEvent`.")}}let o;e.FontLoader=o,e.FontLoader=o=class extends s{constructor(f){super(f),this.loadingContext={requests:[],nextRequestId:0},this.loadTestFontId=0}get isSyncFontLoadingSupported(){let f=!1;if(typeof navigator>"u")f=!0;else{const d=/Mozilla\/5.0.*?rv:(\d+).*? Gecko/.exec(navigator.userAgent);(d==null?void 0:d[1])>=14&&(f=!0)}return(0,n.shadow)(this,"isSyncFontLoadingSupported",f)}_queueLoadingCallback(f){function d(){for((0,n.assert)(!M.done,"completeRequest() cannot be called twice."),M.done=!0;A.requests.length>0&&A.requests[0].done;){const q=A.requests.shift();setTimeout(q.callback,0)}}const A=this.loadingContext,M={id:`pdfjs-font-loading-${A.nextRequestId++}`,done:!1,complete:d,callback:f};return A.requests.push(M),M}get _loadTestFont(){const f=function(){return atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==")};return(0,n.shadow)(this,"_loadTestFont",f())}_prepareFontLoadEvent(f,d,A){function M(k,Q){return k.charCodeAt(Q)<<24|k.charCodeAt(Q+1)<<16|k.charCodeAt(Q+2)<<8|k.charCodeAt(Q+3)&255}function q(k,Q,Ce,Oe){const Se=k.substring(0,Q),Fe=k.substring(Q+Ce);return Se+Oe+Fe}let V,g;const F=this._document.createElement("canvas");F.width=1,F.height=1;const I=F.getContext("2d");let j=0;function G(k,Q){if(j++,j>30){(0,n.warn)("Load test font never loaded."),Q();return}if(I.font="30px "+k,I.fillText(".",0,20),I.getImageData(0,0,1,1).data[3]>0){Q();return}setTimeout(G.bind(null,k,Q))}const O=`lt${Date.now()}${this.loadTestFontId++}`;let H=this._loadTestFont;H=q(H,976,O.length,O);const Y=16,U=1482184792;let h=M(H,Y);for(V=0,g=O.length-3;V<g;V+=4)h=h-U+M(O,V)|0;V<O.length&&(h=h-U+M(O+"XXX",V)|0),H=q(H,Y,4,(0,n.string32)(h));const _=`url(data:font/opentype;base64,${btoa(H)});`,E=`@font-face {font-family:"${O}";src:${_}}`;this.insertRule(E);const x=[];for(const k of d)x.push(k.loadedName);x.push(O);const P=this._document.createElement("div");P.style.visibility="hidden",P.style.width=P.style.height="10px",P.style.position="absolute",P.style.top=P.style.left="0px";for(const k of x){const Q=this._document.createElement("span");Q.textContent="Hi",Q.style.fontFamily=k,P.appendChild(Q)}this._document.body.appendChild(P),G(O,()=>{P.remove(),A.complete()})}};class a{constructor(f,{isEvalSupported:d=!0,disableFontFace:A=!1,ignoreErrors:M=!1,onUnsupportedFeature:q,fontRegistry:V=null}){this.compiledGlyphs=Object.create(null);for(const g in f)this[g]=f[g];this.isEvalSupported=d!==!1,this.disableFontFace=A===!0,this.ignoreErrors=M===!0,this._onUnsupportedFeature=q,this.fontRegistry=V}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let f;if(!this.cssFontInfo)f=new FontFace(this.loadedName,this.data,{});else{const d={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(d.style=`oblique ${this.cssFontInfo.italicAngle}deg`),f=new FontFace(this.cssFontInfo.fontFamily,this.data,d)}return this.fontRegistry&&this.fontRegistry.registerFont(this),f}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const f=(0,n.bytesToString)(this.data),d=`url(data:${this.mimetype};base64,${btoa(f)});`;let A;if(!this.cssFontInfo)A=`@font-face {font-family:"${this.loadedName}";src:${d}}`;else{let M=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(M+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),A=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${M}src:${d}}`}return this.fontRegistry&&this.fontRegistry.registerFont(this,d),A}getPathGenerator(f,d){if(this.compiledGlyphs[d]!==void 0)return this.compiledGlyphs[d];let A;try{A=f.get(this.loadedName+"_path_"+d)}catch(M){if(!this.ignoreErrors)throw M;return this._onUnsupportedFeature({featureId:n.UNSUPPORTED_FEATURES.errorFontGetPath}),(0,n.warn)(`getPathGenerator - ignoring character: "${M}".`),this.compiledGlyphs[d]=function(q,V){}}if(this.isEvalSupported&&n.FeatureTest.isEvalSupported){const M=[];for(const q of A){const V=q.args!==void 0?q.args.join(","):"";M.push("c.",q.cmd,"(",V,`);
`)}return this.compiledGlyphs[d]=new Function("c","size",M.join(""))}return this.compiledGlyphs[d]=function(M,q){for(const V of A)V.cmd==="scale"&&(V.args=[q,-q]),M[V.cmd].apply(M,V.args)}}}e.FontFaceObject=a},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationStorage=void 0;var n=t(9),s=t(1);class o{constructor(){this._storage=new Map,this._modified=!1,this.onSetModified=null,this.onResetModified=null}getValue(l,f){const d=this._storage.get(l);return d===void 0?f:Object.assign(f,d)}getRawValue(l){return this._storage.get(l)}setValue(l,f){const d=this._storage.get(l);let A=!1;if(d!==void 0)for(const[M,q]of Object.entries(f))d[M]!==q&&(A=!0,d[M]=q);else A=!0,this._storage.set(l,f);A&&this._setModified()}getAll(){return this._storage.size>0?(0,s.objectFromMap)(this._storage):null}get size(){return this._storage.size}_setModified(){this._modified||(this._modified=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this._modified&&(this._modified=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get serializable(){return this._storage.size>0?this._storage:null}get hash(){const l=new n.MurmurHash3_64;for(const[f,d]of this._storage)l.update(`${f}:${JSON.stringify(d)}`);return l.hexdigest()}}e.AnnotationStorage=o},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MurmurHash3_64=void 0;var n=t(1);const s=3285377520,o=4294901760,a=65535;class l{constructor(d){this.h1=d?d&4294967295:s,this.h2=d?d&4294967295:s}update(d){let A,M;if(typeof d=="string"){A=new Uint8Array(d.length*2),M=0;for(let U=0,h=d.length;U<h;U++){const _=d.charCodeAt(U);_<=255?A[M++]=_:(A[M++]=_>>>8,A[M++]=_&255)}}else if((0,n.isArrayBuffer)(d))A=d.slice(),M=A.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const q=M>>2,V=M-q*4,g=new Uint32Array(A.buffer,0,q);let F=0,I=0,j=this.h1,G=this.h2;const O=3432918353,H=461845907,K=O&a,Y=H&a;for(let U=0;U<q;U++)U&1?(F=g[U],F=F*O&o|F*K&a,F=F<<15|F>>>17,F=F*H&o|F*Y&a,j^=F,j=j<<13|j>>>19,j=j*5+3864292196):(I=g[U],I=I*O&o|I*K&a,I=I<<15|I>>>17,I=I*H&o|I*Y&a,G^=I,G=G<<13|G>>>19,G=G*5+3864292196);switch(F=0,V){case 3:F^=A[q*4+2]<<16;case 2:F^=A[q*4+1]<<8;case 1:F^=A[q*4],F=F*O&o|F*K&a,F=F<<15|F>>>17,F=F*H&o|F*Y&a,q&1?j^=F:G^=F}this.h1=j,this.h2=G}hexdigest(){let d=this.h1,A=this.h2;d^=A>>>1,d=d*3981806797&o|d*36045&a,A=A*4283543511&o|((A<<16|d>>>16)*2950163797&o)>>>16,d^=A>>>1,d=d*444984403&o|d*60499&a,A=A*3301882366&o|((A<<16|d>>>16)*3120437893&o)>>>16,d^=A>>>1;const M=(d>>>0).toString(16),q=(A>>>0).toString(16);return M.padStart(8,"0")+q.padStart(8,"0")}}e.MurmurHash3_64=l},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CanvasGraphics=void 0;var n=t(1),s=t(11),o=t(12),a=t(3),l=t(5);const f=16,d=100,A=4096,M=15,q=10,V=1e3,g=16,F=1.000001;function I(W,T){if(W._removeMirroring)throw new Error("Context is already forwarding operations.");W.__originalSave=W.save,W.__originalRestore=W.restore,W.__originalRotate=W.rotate,W.__originalScale=W.scale,W.__originalTranslate=W.translate,W.__originalTransform=W.transform,W.__originalSetTransform=W.setTransform,W.__originalResetTransform=W.resetTransform,W.__originalClip=W.clip,W.__originalMoveTo=W.moveTo,W.__originalLineTo=W.lineTo,W.__originalBezierCurveTo=W.bezierCurveTo,W.__originalRect=W.rect,W.__originalClosePath=W.closePath,W.__originalBeginPath=W.beginPath,W._removeMirroring=()=>{W.save=W.__originalSave,W.restore=W.__originalRestore,W.rotate=W.__originalRotate,W.scale=W.__originalScale,W.translate=W.__originalTranslate,W.transform=W.__originalTransform,W.setTransform=W.__originalSetTransform,W.resetTransform=W.__originalResetTransform,W.clip=W.__originalClip,W.moveTo=W.__originalMoveTo,W.lineTo=W.__originalLineTo,W.bezierCurveTo=W.__originalBezierCurveTo,W.rect=W.__originalRect,W.closePath=W.__originalClosePath,W.beginPath=W.__originalBeginPath,delete W._removeMirroring},W.save=function(){T.save(),this.__originalSave()},W.restore=function(){T.restore(),this.__originalRestore()},W.translate=function(B,c){T.translate(B,c),this.__originalTranslate(B,c)},W.scale=function(B,c){T.scale(B,c),this.__originalScale(B,c)},W.transform=function(B,c,p,R,L,N){T.transform(B,c,p,R,L,N),this.__originalTransform(B,c,p,R,L,N)},W.setTransform=function(B,c,p,R,L,N){T.setTransform(B,c,p,R,L,N),this.__originalSetTransform(B,c,p,R,L,N)},W.resetTransform=function(){T.resetTransform(),this.__originalResetTransform()},W.rotate=function(B){T.rotate(B),this.__originalRotate(B)},W.clip=function(B){T.clip(B),this.__originalClip(B)},W.moveTo=function(m,B){T.moveTo(m,B),this.__originalMoveTo(m,B)},W.lineTo=function(m,B){T.lineTo(m,B),this.__originalLineTo(m,B)},W.bezierCurveTo=function(m,B,c,p,R,L){T.bezierCurveTo(m,B,c,p,R,L),this.__originalBezierCurveTo(m,B,c,p,R,L)},W.rect=function(m,B,c,p){T.rect(m,B,c,p),this.__originalRect(m,B,c,p)},W.closePath=function(){T.closePath(),this.__originalClosePath()},W.beginPath=function(){T.beginPath(),this.__originalBeginPath()}}function j(W){if(W._transformStack&&(W._transformStack=[]),!W.mozCurrentTransform){W._originalSave=W.save,W._originalRestore=W.restore,W._originalRotate=W.rotate,W._originalScale=W.scale,W._originalTranslate=W.translate,W._originalTransform=W.transform,W._originalSetTransform=W.setTransform,W._originalResetTransform=W.resetTransform,W._transformMatrix=W._transformMatrix||[1,0,0,1,0,0],W._transformStack=[];try{const T=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(W),"lineWidth");W._setLineWidth=T.set,W._getLineWidth=T.get,Object.defineProperty(W,"lineWidth",{set:function(B){this._setLineWidth(B*F)},get:function(){return this._getLineWidth()}})}catch{}Object.defineProperty(W,"mozCurrentTransform",{get:function(){return this._transformMatrix}}),Object.defineProperty(W,"mozCurrentTransformInverse",{get:function(){const[m,B,c,p,R,L]=this._transformMatrix,N=m*p-B*c,z=B*c-m*p;return[p/N,B/z,c/z,m/N,(p*R-c*L)/z,(B*R-m*L)/N]}}),W.save=function(){const m=this._transformMatrix;this._transformStack.push(m),this._transformMatrix=m.slice(0,6),this._originalSave()},W.restore=function(){this._transformStack.length===0&&(0,n.warn)("Tried to restore a ctx when the stack was already empty.");const m=this._transformStack.pop();m&&(this._transformMatrix=m,this._originalRestore())},W.translate=function(m,B){const c=this._transformMatrix;c[4]=c[0]*m+c[2]*B+c[4],c[5]=c[1]*m+c[3]*B+c[5],this._originalTranslate(m,B)},W.scale=function(m,B){const c=this._transformMatrix;c[0]*=m,c[1]*=m,c[2]*=B,c[3]*=B,this._originalScale(m,B)},W.transform=function(m,B,c,p,R,L){const N=this._transformMatrix;this._transformMatrix=[N[0]*m+N[2]*B,N[1]*m+N[3]*B,N[0]*c+N[2]*p,N[1]*c+N[3]*p,N[0]*R+N[2]*L+N[4],N[1]*R+N[3]*L+N[5]],W._originalTransform(m,B,c,p,R,L)},W.setTransform=function(m,B,c,p,R,L){this._transformMatrix=[m,B,c,p,R,L],W._originalSetTransform(m,B,c,p,R,L)},W.resetTransform=function(){this._transformMatrix=[1,0,0,1,0,0],W._originalResetTransform()},W.rotate=function(m){const B=Math.cos(m),c=Math.sin(m),p=this._transformMatrix;this._transformMatrix=[p[0]*B+p[2]*c,p[1]*B+p[3]*c,p[0]*-c+p[2]*B,p[1]*-c+p[3]*B,p[4],p[5]],this._originalRotate(m)}}}class G{constructor(T){this.canvasFactory=T,this.cache=Object.create(null)}getCanvas(T,m,B,c){let p;return this.cache[T]!==void 0?(p=this.cache[T],this.canvasFactory.reset(p,m,B),p.context.setTransform(1,0,0,1,0,0)):(p=this.canvasFactory.create(m,B),this.cache[T]=p),c&&j(p.context),p}delete(T){delete this.cache[T]}clear(){for(const T in this.cache){const m=this.cache[T];this.canvasFactory.destroy(m),delete this.cache[T]}}}function O(W,T,m,B,c,p,R,L,N,z){const[X,ee,J,ie,Z,ve]=W.mozCurrentTransform;if(ee===0&&J===0){const Ne=R*X+Z,xe=Math.round(Ne),qe=L*ie+ve,$e=Math.round(qe),ke=(R+N)*X+Z,rt=Math.abs(Math.round(ke)-xe)||1,tt=(L+z)*ie+ve,ze=Math.abs(Math.round(tt)-$e)||1;return W.setTransform(Math.sign(X),0,0,Math.sign(ie),xe,$e),W.drawImage(T,m,B,c,p,0,0,rt,ze),W.setTransform(X,ee,J,ie,Z,ve),[rt,ze]}if(X===0&&ie===0){const Ne=L*J+Z,xe=Math.round(Ne),qe=R*ee+ve,$e=Math.round(qe),ke=(L+z)*J+Z,rt=Math.abs(Math.round(ke)-xe)||1,tt=(R+N)*ee+ve,ze=Math.abs(Math.round(tt)-$e)||1;return W.setTransform(0,Math.sign(ee),Math.sign(J),0,xe,$e),W.drawImage(T,m,B,c,p,0,0,ze,rt),W.setTransform(X,ee,J,ie,Z,ve),[ze,rt]}W.drawImage(T,m,B,c,p,R,L,N,z);const Me=Math.hypot(X,ee),Ue=Math.hypot(J,ie);return[Me*N,Ue*z]}function H(W){const{width:T,height:m}=W;if(T>V||m>V)return null;const B=1e3,c=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),p=T+1;let R=new Uint8Array(p*(m+1)),L,N,z;const X=T+7&-8;let ee=new Uint8Array(X*m),J=0;for(const xe of W.data){let qe=128;for(;qe>0;)ee[J++]=xe&qe?0:255,qe>>=1}let ie=0;for(J=0,ee[J]!==0&&(R[0]=1,++ie),N=1;N<T;N++)ee[J]!==ee[J+1]&&(R[N]=ee[J]?2:1,++ie),J++;for(ee[J]!==0&&(R[N]=2,++ie),L=1;L<m;L++){J=L*X,z=L*p,ee[J-X]!==ee[J]&&(R[z]=ee[J]?1:8,++ie);let xe=(ee[J]?4:0)+(ee[J-X]?8:0);for(N=1;N<T;N++)xe=(xe>>2)+(ee[J+1]?4:0)+(ee[J-X+1]?8:0),c[xe]&&(R[z+N]=c[xe],++ie),J++;if(ee[J-X]!==ee[J]&&(R[z+N]=ee[J]?2:4,++ie),ie>B)return null}for(J=X*(m-1),z=L*p,ee[J]!==0&&(R[z]=8,++ie),N=1;N<T;N++)ee[J]!==ee[J+1]&&(R[z+N]=ee[J]?4:8,++ie),J++;if(ee[J]!==0&&(R[z+N]=4,++ie),ie>B)return null;const Z=new Int32Array([0,p,-1,0,-p,0,0,0,1]);let ve,Me,Ue;for(a.isNodeJS?Me=[]:ve=new Path2D,L=0;ie&&L<=m;L++){let xe=L*p;const qe=xe+T;for(;xe<qe&&!R[xe];)xe++;if(xe===qe)continue;ve?ve.moveTo(xe%p,L):Ue=[xe%p,L];const $e=xe;let ke=R[xe];do{const rt=Z[ke];do xe+=rt;while(!R[xe]);const tt=R[xe];tt!==5&&tt!==10?(ke=tt,R[xe]=0):(ke=tt&51*ke>>4,R[xe]&=ke>>2|ke<<2),ve?ve.lineTo(xe%p,xe/p|0):Ue.push(xe%p,xe/p|0),R[xe]||--ie}while($e!==xe);ve||Me.push(Ue),--L}return ee=null,R=null,function(xe){if(xe.save(),xe.scale(1/T,-1/m),xe.translate(0,-m),ve)xe.fill(ve);else{xe.beginPath();for(const qe of Me){xe.moveTo(qe[0],qe[1]);for(let $e=2,ke=qe.length;$e<ke;$e+=2)xe.lineTo(qe[$e],qe[$e+1])}xe.fill()}xe.beginPath(),xe.restore()}}class K{constructor(T,m){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=n.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=n.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=n.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps=null,this.startNewPathAndClipBox([0,0,T,m])}clone(){const T=Object.create(this);return T.clipBox=this.clipBox.slice(),T}setCurrentPoint(T,m){this.x=T,this.y=m}updatePathMinMax(T,m,B){[m,B]=n.Util.applyTransform([m,B],T),this.minX=Math.min(this.minX,m),this.minY=Math.min(this.minY,B),this.maxX=Math.max(this.maxX,m),this.maxY=Math.max(this.maxY,B)}updateRectMinMax(T,m){const B=n.Util.applyTransform(m,T),c=n.Util.applyTransform(m.slice(2),T);this.minX=Math.min(this.minX,B[0],c[0]),this.minY=Math.min(this.minY,B[1],c[1]),this.maxX=Math.max(this.maxX,B[0],c[0]),this.maxY=Math.max(this.maxY,B[1],c[1])}updateScalingPathMinMax(T,m){n.Util.scaleMinMax(T,m),this.minX=Math.min(this.minX,m[0]),this.maxX=Math.max(this.maxX,m[1]),this.minY=Math.min(this.minY,m[2]),this.maxY=Math.max(this.maxY,m[3])}updateCurvePathMinMax(T,m,B,c,p,R,L,N,z,X){const ee=n.Util.bezierBoundingBox(m,B,c,p,R,L,N,z);if(X){X[0]=Math.min(X[0],ee[0],ee[2]),X[1]=Math.max(X[1],ee[0],ee[2]),X[2]=Math.min(X[2],ee[1],ee[3]),X[3]=Math.max(X[3],ee[1],ee[3]);return}this.updateRectMinMax(T,ee)}getPathBoundingBox(T=s.PathType.FILL,m=null){const B=[this.minX,this.minY,this.maxX,this.maxY];if(T===s.PathType.STROKE){m||(0,n.unreachable)("Stroke bounding box must include transform.");const c=n.Util.singularValueDecompose2dScale(m),p=c[0]*this.lineWidth/2,R=c[1]*this.lineWidth/2;B[0]-=p,B[1]-=R,B[2]+=p,B[3]+=R}return B}updateClipFromPath(){const T=n.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(T||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(T){this.clipBox=T,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(T=s.PathType.FILL,m=null){return n.Util.intersect(this.clipBox,this.getPathBoundingBox(T,m))}}function Y(W,T,m=null){if(typeof ImageData<"u"&&T instanceof ImageData){W.putImageData(T,0,0);return}const B=T.height,c=T.width,p=B%g,R=(B-p)/g,L=p===0?R:R+1,N=W.createImageData(c,g);let z=0,X;const ee=T.data,J=N.data;let ie,Z,ve,Me,Ue,Ne,xe,qe;if(m)switch(m.length){case 1:Ue=m[0],Ne=m[0],xe=m[0],qe=m[0];break;case 4:Ue=m[0],Ne=m[1],xe=m[2],qe=m[3];break}if(T.kind===n.ImageKind.GRAYSCALE_1BPP){const $e=ee.byteLength,ke=new Uint32Array(J.buffer,0,J.byteLength>>2),rt=ke.length,tt=c+7>>3;let ze=4294967295,Ge=n.FeatureTest.isLittleEndian?4278190080:255;for(qe&&qe[0]===255&&qe[255]===0&&([ze,Ge]=[Ge,ze]),ie=0;ie<L;ie++){for(ve=ie<R?g:p,X=0,Z=0;Z<ve;Z++){const Ke=$e-z;let ct=0;const at=Ke>tt?c:Ke*8-7,Et=at&-8;let st=0,Pe=0;for(;ct<Et;ct+=8)Pe=ee[z++],ke[X++]=Pe&128?ze:Ge,ke[X++]=Pe&64?ze:Ge,ke[X++]=Pe&32?ze:Ge,ke[X++]=Pe&16?ze:Ge,ke[X++]=Pe&8?ze:Ge,ke[X++]=Pe&4?ze:Ge,ke[X++]=Pe&2?ze:Ge,ke[X++]=Pe&1?ze:Ge;for(;ct<at;ct++)st===0&&(Pe=ee[z++],st=128),ke[X++]=Pe&st?ze:Ge,st>>=1}for(;X<rt;)ke[X++]=0;W.putImageData(N,0,ie*g)}}else if(T.kind===n.ImageKind.RGBA_32BPP){const $e=!!(Ue||Ne||xe);for(Z=0,Me=c*g*4,ie=0;ie<R;ie++){if(J.set(ee.subarray(z,z+Me)),z+=Me,$e)for(let ke=0;ke<Me;ke+=4)Ue&&(J[ke+0]=Ue[J[ke+0]]),Ne&&(J[ke+1]=Ne[J[ke+1]]),xe&&(J[ke+2]=xe[J[ke+2]]);W.putImageData(N,0,Z),Z+=g}if(ie<L){if(Me=c*p*4,J.set(ee.subarray(z,z+Me)),$e)for(let ke=0;ke<Me;ke+=4)Ue&&(J[ke+0]=Ue[J[ke+0]]),Ne&&(J[ke+1]=Ne[J[ke+1]]),xe&&(J[ke+2]=xe[J[ke+2]]);W.putImageData(N,0,Z)}}else if(T.kind===n.ImageKind.RGB_24BPP){const $e=!!(Ue||Ne||xe);for(ve=g,Me=c*ve,ie=0;ie<L;ie++){for(ie>=R&&(ve=p,Me=c*ve),X=0,Z=Me;Z--;)J[X++]=ee[z++],J[X++]=ee[z++],J[X++]=ee[z++],J[X++]=255;if($e)for(let ke=0;ke<X;ke+=4)Ue&&(J[ke+0]=Ue[J[ke+0]]),Ne&&(J[ke+1]=Ne[J[ke+1]]),xe&&(J[ke+2]=xe[J[ke+2]]);W.putImageData(N,0,ie*g)}}else throw new Error(`bad image kind: ${T.kind}`)}function U(W,T){if(T.bitmap){W.drawImage(T.bitmap,0,0);return}const m=T.height,B=T.width,c=m%g,p=(m-c)/g,R=c===0?p:p+1,L=W.createImageData(B,g);let N=0;const z=T.data,X=L.data;for(let ee=0;ee<R;ee++){const J=ee<p?g:c;({srcPos:N}=(0,o.applyMaskImageData)({src:z,srcPos:N,dest:X,width:B,height:J})),W.putImageData(L,0,ee*g)}}function h(W,T){const m=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font"];for(let B=0,c=m.length;B<c;B++){const p=m[B];W[p]!==void 0&&(T[p]=W[p])}W.setLineDash!==void 0&&(T.setLineDash(W.getLineDash()),T.lineDashOffset=W.lineDashOffset)}function _(W,T){W.strokeStyle=W.fillStyle=T||"#000000",W.fillRule="nonzero",W.globalAlpha=1,W.lineWidth=1,W.lineCap="butt",W.lineJoin="miter",W.miterLimit=10,W.globalCompositeOperation="source-over",W.font="10px sans-serif",W.setLineDash!==void 0&&(W.setLineDash([]),W.lineDashOffset=0)}function E(W,T,m,B){const c=W.length;for(let p=3;p<c;p+=4){const R=W[p];if(R===0)W[p-3]=T,W[p-2]=m,W[p-1]=B;else if(R<255){const L=255-R;W[p-3]=W[p-3]*R+T*L>>8,W[p-2]=W[p-2]*R+m*L>>8,W[p-1]=W[p-1]*R+B*L>>8}}}function x(W,T,m){const B=W.length,c=1/255;for(let p=3;p<B;p+=4){const R=m?m[W[p]]:W[p];T[p]=T[p]*R*c|0}}function P(W,T,m){const B=W.length;for(let c=3;c<B;c+=4){const p=W[c-3]*77+W[c-2]*152+W[c-1]*28;T[c]=m?T[c]*m[p>>8]>>8:T[c]*p>>16}}function k(W,T,m,B,c,p,R,L,N,z,X){const ee=!!p,J=ee?p[0]:0,ie=ee?p[1]:0,Z=ee?p[2]:0;let ve;c==="Luminosity"?ve=P:ve=x;const Ue=Math.min(B,Math.ceil(1048576/m));for(let Ne=0;Ne<B;Ne+=Ue){const xe=Math.min(Ue,B-Ne),qe=W.getImageData(L-z,Ne+(N-X),m,xe),$e=T.getImageData(L,Ne+N,m,xe);ee&&E(qe.data,J,ie,Z),ve(qe.data,$e.data,R),T.putImageData($e,L,Ne+N)}}function Q(W,T,m,B){const c=B[0],p=B[1],R=B[2]-c,L=B[3]-p;R===0||L===0||(k(T.context,m,R,L,T.subtype,T.backdrop,T.transferMap,c,p,T.offsetX,T.offsetY),W.save(),W.globalAlpha=1,W.globalCompositeOperation="source-over",W.setTransform(1,0,0,1,0,0),W.drawImage(m.canvas,0,0),W.restore())}function Ce(W,T){const m=n.Util.singularValueDecompose2dScale(W);m[0]=Math.fround(m[0]),m[1]=Math.fround(m[1]);const B=Math.fround((globalThis.devicePixelRatio||1)*l.PixelsPerInch.PDF_TO_CSS_UNITS);return T!==void 0?T:m[0]<=B||m[1]<=B}const Oe=["butt","round","square"],Se=["miter","round","bevel"],Fe={},Ve={};class Le{constructor(T,m,B,c,p,R,L,N){this.ctx=T,this.current=new K(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=m,this.objs=B,this.canvasFactory=c,this.imageLayer=p,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=[],this.optionalContentConfig=R,this.cachedCanvases=new G(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=L,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.backgroundColor=(N==null?void 0:N.background)||null,this.foregroundColor=(N==null?void 0:N.foreground)||null,T&&j(T),this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(T,m=null){return typeof T=="string"?T.startsWith("g_")?this.commonObjs.get(T):this.objs.get(T):m}beginDrawing({transform:T,viewport:m,transparency:B=!1,background:c=null}){const p=this.ctx.canvas.width,R=this.ctx.canvas.height,L=c||"#ffffff";if(this.ctx.save(),this.foregroundColor&&this.backgroundColor){this.ctx.fillStyle=this.foregroundColor;const N=this.foregroundColor=this.ctx.fillStyle;this.ctx.fillStyle=this.backgroundColor;const z=this.backgroundColor=this.ctx.fillStyle;let X=!0,ee=L;if(this.ctx.fillStyle=L,ee=this.ctx.fillStyle,X=typeof ee=="string"&&/^#[0-9A-Fa-f]{6}$/.test(ee),N==="#000000"&&z==="#ffffff"||N===z||!X)this.foregroundColor=this.backgroundColor=null;else{const J=parseInt(ee.slice(1),16),ie=(J&&16711680)>>16,Z=(J&&65280)>>8,ve=J&&255,Me=Ne=>(Ne/=255,Ne<=.03928?Ne/12.92:((Ne+.055)/1.055)**2.4),Ue=Math.round(.2126*Me(ie)+.7152*Me(Z)+.0722*Me(ve));this.selectColor=(Ne,xe,qe)=>{const $e=.2126*Me(Ne)+.7152*Me(xe)+.0722*Me(qe);return Math.round($e)===Ue?z:N}}}if(this.ctx.fillStyle=this.backgroundColor||L,this.ctx.fillRect(0,0,p,R),this.ctx.restore(),B){const N=this.cachedCanvases.getCanvas("transparent",p,R,!0);this.compositeCtx=this.ctx,this.transparentCanvas=N.canvas,this.ctx=N.context,this.ctx.save(),this.ctx.transform.apply(this.ctx,this.compositeCtx.mozCurrentTransform)}this.ctx.save(),_(this.ctx,this.foregroundColor),T&&(this.ctx.transform.apply(this.ctx,T),this.outputScaleX=T[0],this.outputScaleY=T[0]),this.ctx.transform.apply(this.ctx,m.transform),this.viewportScale=m.scale,this.baseTransform=this.ctx.mozCurrentTransform.slice(),this.imageLayer&&this.imageLayer.beginLayout()}executeOperatorList(T,m,B,c){const p=T.argsArray,R=T.fnArray;let L=m||0;const N=p.length;if(N===L)return L;const z=N-L>q&&typeof B=="function",X=z?Date.now()+M:0;let ee=0;const J=this.commonObjs,ie=this.objs;let Z;for(;;){if(c!==void 0&&L===c.nextBreakPoint)return c.breakIt(L,B),L;if(Z=R[L],Z!==n.OPS.dependency)this[Z].apply(this,p[L]);else for(const ve of p[L]){const Me=ve.startsWith("g_")?J:ie;if(!Me.has(ve))return Me.get(ve,B),L}if(L++,L===N)return L;if(z&&++ee>q){if(Date.now()>X)return B(),L;ee=0}}}endDrawing(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const T of this._cachedBitmapsMap.values()){for(const m of T.values())typeof HTMLCanvasElement<"u"&&m instanceof HTMLCanvasElement&&(m.width=m.height=0);T.clear()}this._cachedBitmapsMap.clear(),this.imageLayer&&this.imageLayer.endLayout()}_scaleImage(T,m){const B=T.width,c=T.height;let p=Math.max(Math.hypot(m[0],m[1]),1),R=Math.max(Math.hypot(m[2],m[3]),1),L=B,N=c,z="prescale1",X,ee;for(;p>2&&L>1||R>2&&N>1;){let J=L,ie=N;p>2&&L>1&&(J=Math.ceil(L/2),p/=L/J),R>2&&N>1&&(ie=Math.ceil(N/2),R/=N/ie),X=this.cachedCanvases.getCanvas(z,J,ie,!1),ee=X.context,ee.clearRect(0,0,J,ie),ee.drawImage(T,0,0,L,N,0,0,J,ie),T=X.canvas,L=J,N=ie,z=z==="prescale1"?"prescale2":"prescale1"}return{img:T,paintWidth:L,paintHeight:N}}_createMaskCanvas(T){const m=this.ctx,{width:B,height:c}=T,p=this.current.fillColor,R=this.current.patternFill,L=m.mozCurrentTransform;let N,z,X,ee;if((T.bitmap||T.data)&&T.count>1){const rt=T.bitmap||T.data.buffer,tt=L.slice(0,4);z=JSON.stringify(R?tt:[tt,p]),N=this._cachedBitmapsMap.get(rt),N||(N=new Map,this._cachedBitmapsMap.set(rt,N));const ze=N.get(z);if(ze&&!R){const Ge=Math.round(Math.min(L[0],L[2])+L[4]),Ke=Math.round(Math.min(L[1],L[3])+L[5]);return{canvas:ze,offsetX:Ge,offsetY:Ke}}X=ze}X||(ee=this.cachedCanvases.getCanvas("maskCanvas",B,c,!1),U(ee.context,T));let J=n.Util.transform(L,[1/B,0,0,-1/c,0,0]);J=n.Util.transform(J,[1,0,0,1,0,-c]);const ie=n.Util.applyTransform([0,0],J),Z=n.Util.applyTransform([B,c],J),ve=n.Util.normalizeRect([ie[0],ie[1],Z[0],Z[1]]),Me=Math.round(ve[2]-ve[0])||1,Ue=Math.round(ve[3]-ve[1])||1,Ne=this.cachedCanvases.getCanvas("fillCanvas",Me,Ue,!0),xe=Ne.context,qe=Math.min(ie[0],Z[0]),$e=Math.min(ie[1],Z[1]);xe.translate(-qe,-$e),xe.transform.apply(xe,J),X||(X=this._scaleImage(ee.canvas,xe.mozCurrentTransformInverse),X=X.img,N&&R&&N.set(z,X)),xe.imageSmoothingEnabled=Ce(xe.mozCurrentTransform,T.interpolate),O(xe,X,0,0,X.width,X.height,0,0,B,c),xe.globalCompositeOperation="source-in";const ke=n.Util.transform(xe.mozCurrentTransformInverse,[1,0,0,1,-qe,-$e]);return xe.fillStyle=R?p.getPattern(m,this,ke,s.PathType.FILL):p,xe.fillRect(0,0,B,c),N&&!R&&(this.cachedCanvases.delete("fillCanvas"),N.set(z,Ne.canvas)),{canvas:Ne.canvas,offsetX:Math.round(qe),offsetY:Math.round($e)}}setLineWidth(T){T!==this.current.lineWidth&&(this._cachedScaleForStroking=null),this.current.lineWidth=T,this.ctx.lineWidth=T}setLineCap(T){this.ctx.lineCap=Oe[T]}setLineJoin(T){this.ctx.lineJoin=Se[T]}setMiterLimit(T){this.ctx.miterLimit=T}setDash(T,m){const B=this.ctx;B.setLineDash!==void 0&&(B.setLineDash(T),B.lineDashOffset=m)}setRenderingIntent(T){}setFlatness(T){}setGState(T){for(let m=0,B=T.length;m<B;m++){const c=T[m],p=c[0],R=c[1];switch(p){case"LW":this.setLineWidth(R);break;case"LC":this.setLineCap(R);break;case"LJ":this.setLineJoin(R);break;case"ML":this.setMiterLimit(R);break;case"D":this.setDash(R[0],R[1]);break;case"RI":this.setRenderingIntent(R);break;case"FL":this.setFlatness(R);break;case"Font":this.setFont(R[0],R[1]);break;case"CA":this.current.strokeAlpha=c[1];break;case"ca":this.current.fillAlpha=c[1],this.ctx.globalAlpha=c[1];break;case"BM":this.ctx.globalCompositeOperation=R;break;case"SMask":this.current.activeSMask=R?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.current.transferMaps=R}}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const T=this.inSMaskMode;this.current.activeSMask&&!T?this.beginSMaskMode():!this.current.activeSMask&&T&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const T=this.ctx.canvas.width,m=this.ctx.canvas.height,B="smaskGroupAt"+this.groupLevel,c=this.cachedCanvases.getCanvas(B,T,m,!0);this.suspendedCtx=this.ctx,this.ctx=c.context;const p=this.ctx;p.setTransform.apply(p,this.suspendedCtx.mozCurrentTransform),h(this.suspendedCtx,p),I(p,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),h(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(T){if(!this.current.activeSMask)return;T?(T[0]=Math.floor(T[0]),T[1]=Math.floor(T[1]),T[2]=Math.ceil(T[2]),T[3]=Math.ceil(T[3])):T=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const m=this.current.activeSMask,B=this.suspendedCtx;Q(B,m,this.ctx,T),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(h(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const T=this.current;this.stateStack.push(T),this.current=T.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),h(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null)}transform(T,m,B,c,p,R){this.ctx.transform(T,m,B,c,p,R),this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null}constructPath(T,m,B){const c=this.ctx,p=this.current;let R=p.x,L=p.y,N,z;const X=c.mozCurrentTransform,ee=X[0]===0&&X[3]===0||X[1]===0&&X[2]===0,J=ee?B.slice(0):null;for(let ie=0,Z=0,ve=T.length;ie<ve;ie++)switch(T[ie]|0){case n.OPS.rectangle:R=m[Z++],L=m[Z++];const Me=m[Z++],Ue=m[Z++],Ne=R+Me,xe=L+Ue;c.moveTo(R,L),Me===0||Ue===0?c.lineTo(Ne,xe):(c.lineTo(Ne,L),c.lineTo(Ne,xe),c.lineTo(R,xe)),ee||p.updateRectMinMax(X,[R,L,Ne,xe]),c.closePath();break;case n.OPS.moveTo:R=m[Z++],L=m[Z++],c.moveTo(R,L),ee||p.updatePathMinMax(X,R,L);break;case n.OPS.lineTo:R=m[Z++],L=m[Z++],c.lineTo(R,L),ee||p.updatePathMinMax(X,R,L);break;case n.OPS.curveTo:N=R,z=L,R=m[Z+4],L=m[Z+5],c.bezierCurveTo(m[Z],m[Z+1],m[Z+2],m[Z+3],R,L),p.updateCurvePathMinMax(X,N,z,m[Z],m[Z+1],m[Z+2],m[Z+3],R,L,J),Z+=6;break;case n.OPS.curveTo2:N=R,z=L,c.bezierCurveTo(R,L,m[Z],m[Z+1],m[Z+2],m[Z+3]),p.updateCurvePathMinMax(X,N,z,R,L,m[Z],m[Z+1],m[Z+2],m[Z+3],J),R=m[Z+2],L=m[Z+3],Z+=4;break;case n.OPS.curveTo3:N=R,z=L,R=m[Z+2],L=m[Z+3],c.bezierCurveTo(m[Z],m[Z+1],R,L,R,L),p.updateCurvePathMinMax(X,N,z,m[Z],m[Z+1],R,L,R,L,J),Z+=4;break;case n.OPS.closePath:c.closePath();break}ee&&p.updateScalingPathMinMax(X,J),p.setCurrentPoint(R,L)}closePath(){this.ctx.closePath()}stroke(T){T=typeof T<"u"?T:!0;const m=this.ctx,B=this.current.strokeColor;m.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof B=="object"&&(B!=null&&B.getPattern)?(m.save(),m.strokeStyle=B.getPattern(m,this,m.mozCurrentTransformInverse,s.PathType.STROKE),this.rescaleAndStroke(!1),m.restore()):this.rescaleAndStroke(!0)),T&&this.consumePath(this.current.getClippedPathBoundingBox()),m.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(T){T=typeof T<"u"?T:!0;const m=this.ctx,B=this.current.fillColor,c=this.current.patternFill;let p=!1;c&&(m.save(),m.fillStyle=B.getPattern(m,this,m.mozCurrentTransformInverse,s.PathType.FILL),p=!0);const R=this.current.getClippedPathBoundingBox();this.contentVisible&&R!==null&&(this.pendingEOFill?(m.fill("evenodd"),this.pendingEOFill=!1):m.fill()),p&&m.restore(),T&&this.consumePath(R)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=Fe}eoClip(){this.pendingClip=Ve}beginText(){this.current.textMatrix=n.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const T=this.pendingTextPaths,m=this.ctx;if(T===void 0){m.beginPath();return}m.save(),m.beginPath();for(let B=0;B<T.length;B++){const c=T[B];m.setTransform.apply(m,c.transform),m.translate(c.x,c.y),c.addToPath(m,c.fontSize)}m.restore(),m.clip(),m.beginPath(),delete this.pendingTextPaths}setCharSpacing(T){this.current.charSpacing=T}setWordSpacing(T){this.current.wordSpacing=T}setHScale(T){this.current.textHScale=T/100}setLeading(T){this.current.leading=-T}setFont(T,m){const B=this.commonObjs.get(T),c=this.current;if(!B)throw new Error(`Can't find font for ${T}`);if(c.fontMatrix=B.fontMatrix||n.FONT_IDENTITY_MATRIX,(c.fontMatrix[0]===0||c.fontMatrix[3]===0)&&(0,n.warn)("Invalid font matrix for font "+T),m<0?(m=-m,c.fontDirection=-1):c.fontDirection=1,this.current.font=B,this.current.fontSize=m,B.isType3Font)return;const p=B.loadedName||"sans-serif";let R="normal";B.black?R="900":B.bold&&(R="bold");const L=B.italic?"italic":"normal",N=`"${p}", ${B.fallbackName}`;let z=m;m<f?z=f:m>d&&(z=d),this.current.fontSizeScale=m/z,this.ctx.font=`${L} ${R} ${z}px ${N}`}setTextRenderingMode(T){this.current.textRenderingMode=T}setTextRise(T){this.current.textRise=T}moveText(T,m){this.current.x=this.current.lineX+=T,this.current.y=this.current.lineY+=m}setLeadingMoveText(T,m){this.setLeading(-m),this.moveText(T,m)}setTextMatrix(T,m,B,c,p,R){this.current.textMatrix=[T,m,B,c,p,R],this.current.textMatrixScale=Math.hypot(T,m),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(T,m,B,c){const p=this.ctx,R=this.current,L=R.font,N=R.textRenderingMode,z=R.fontSize/R.fontSizeScale,X=N&n.TextRenderingMode.FILL_STROKE_MASK,ee=!!(N&n.TextRenderingMode.ADD_TO_PATH_FLAG),J=R.patternFill&&!L.missingFile;let ie;(L.disableFontFace||ee||J)&&(ie=L.getPathGenerator(this.commonObjs,T)),L.disableFontFace||J?(p.save(),p.translate(m,B),p.beginPath(),ie(p,z),c&&p.setTransform.apply(p,c),(X===n.TextRenderingMode.FILL||X===n.TextRenderingMode.FILL_STROKE)&&p.fill(),(X===n.TextRenderingMode.STROKE||X===n.TextRenderingMode.FILL_STROKE)&&p.stroke(),p.restore()):((X===n.TextRenderingMode.FILL||X===n.TextRenderingMode.FILL_STROKE)&&p.fillText(T,m,B),(X===n.TextRenderingMode.STROKE||X===n.TextRenderingMode.FILL_STROKE)&&p.strokeText(T,m,B)),ee&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:p.mozCurrentTransform,x:m,y:B,fontSize:z,addToPath:ie})}get isFontSubpixelAAEnabled(){const{context:T}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10,!1);T.scale(1.5,1),T.fillText("I",0,10);const m=T.getImageData(0,0,10,10).data;let B=!1;for(let c=3;c<m.length;c+=4)if(m[c]>0&&m[c]<255){B=!0;break}return(0,n.shadow)(this,"isFontSubpixelAAEnabled",B)}showText(T){const m=this.current,B=m.font;if(B.isType3Font)return this.showType3Text(T);const c=m.fontSize;if(c===0)return;const p=this.ctx,R=m.fontSizeScale,L=m.charSpacing,N=m.wordSpacing,z=m.fontDirection,X=m.textHScale*z,ee=T.length,J=B.vertical,ie=J?1:-1,Z=B.defaultVMetrics,ve=c*m.fontMatrix[0],Me=m.textRenderingMode===n.TextRenderingMode.FILL&&!B.disableFontFace&&!m.patternFill;p.save(),p.transform.apply(p,m.textMatrix),p.translate(m.x,m.y+m.textRise),z>0?p.scale(X,-1):p.scale(X,1);let Ue;if(m.patternFill){p.save();const ke=m.fillColor.getPattern(p,this,p.mozCurrentTransformInverse,s.PathType.FILL);Ue=p.mozCurrentTransform,p.restore(),p.fillStyle=ke}let Ne=m.lineWidth;const xe=m.textMatrixScale;if(xe===0||Ne===0){const ke=m.textRenderingMode&n.TextRenderingMode.FILL_STROKE_MASK;(ke===n.TextRenderingMode.STROKE||ke===n.TextRenderingMode.FILL_STROKE)&&(Ne=this.getSinglePixelWidth())}else Ne/=xe;R!==1&&(p.scale(R,R),Ne/=R),p.lineWidth=Ne;let qe=0,$e;for($e=0;$e<ee;++$e){const ke=T[$e];if(typeof ke=="number"){qe+=ie*ke*c/1e3;continue}let rt=!1;const tt=(ke.isSpace?N:0)+L,ze=ke.fontChar,Ge=ke.accent;let Ke,ct,at=ke.width;if(J){const st=ke.vmetric||Z,Pe=-(ke.vmetric?st[1]:at*.5)*ve,te=st[2]*ve;at=st?-st[0]:at,Ke=Pe/R,ct=(qe+te)/R}else Ke=qe/R,ct=0;if(B.remeasure&&at>0){const st=p.measureText(ze).width*1e3/c*R;if(at<st&&this.isFontSubpixelAAEnabled){const Pe=at/st;rt=!0,p.save(),p.scale(Pe,1),Ke/=Pe}else at!==st&&(Ke+=(at-st)/2e3*c/R)}if(this.contentVisible&&(ke.isInFont||B.missingFile)){if(Me&&!Ge)p.fillText(ze,Ke,ct);else if(this.paintChar(ze,Ke,ct,Ue),Ge){const st=Ke+c*Ge.offset.x/R,Pe=ct-c*Ge.offset.y/R;this.paintChar(Ge.fontChar,st,Pe,Ue)}}let Et;J?Et=at*ve-tt*z:Et=at*ve+tt*z,qe+=Et,rt&&p.restore()}J?m.y-=qe:m.x+=qe*X,p.restore(),this.compose()}showType3Text(T){const m=this.ctx,B=this.current,c=B.font,p=B.fontSize,R=B.fontDirection,L=c.vertical?1:-1,N=B.charSpacing,z=B.wordSpacing,X=B.textHScale*R,ee=B.fontMatrix||n.FONT_IDENTITY_MATRIX,J=T.length,ie=B.textRenderingMode===n.TextRenderingMode.INVISIBLE;let Z,ve,Me,Ue;if(!(ie||p===0)){for(this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,m.save(),m.transform.apply(m,B.textMatrix),m.translate(B.x,B.y),m.scale(X,R),Z=0;Z<J;++Z){if(ve=T[Z],typeof ve=="number"){Ue=L*ve*p/1e3,this.ctx.translate(Ue,0),B.x+=Ue*X;continue}const Ne=(ve.isSpace?z:0)+N,xe=c.charProcOperatorList[ve.operatorListId];if(!xe){(0,n.warn)(`Type3 character "${ve.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=ve,this.save(),m.scale(p,p),m.transform.apply(m,ee),this.executeOperatorList(xe),this.restore()),Me=n.Util.applyTransform([ve.width,0],ee)[0]*p+Ne,m.translate(Me,0),B.x+=Me*X}m.restore(),this.processingType3=null}}setCharWidth(T,m){}setCharWidthAndBounds(T,m,B,c,p,R){this.ctx.rect(B,c,p-B,R-c),this.ctx.clip(),this.endPath()}getColorN_Pattern(T){let m;if(T[0]==="TilingPattern"){const B=T[1],c=this.baseTransform||this.ctx.mozCurrentTransform.slice(),p={createCanvasGraphics:R=>new Le(R,this.commonObjs,this.objs,this.canvasFactory)};m=new s.TilingPattern(T,B,this.ctx,p,c)}else m=this._getPattern(T[1],T[2]);return m}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(T,m,B){var p;const c=((p=this.selectColor)==null?void 0:p.call(this,T,m,B))||n.Util.makeHexColor(T,m,B);this.ctx.strokeStyle=c,this.current.strokeColor=c}setFillRGBColor(T,m,B){var p;const c=((p=this.selectColor)==null?void 0:p.call(this,T,m,B))||n.Util.makeHexColor(T,m,B);this.ctx.fillStyle=c,this.current.fillColor=c,this.current.patternFill=!1}_getPattern(T,m=null){let B;return this.cachedPatterns.has(T)?B=this.cachedPatterns.get(T):(B=(0,s.getShadingPattern)(this.objs.get(T)),this.cachedPatterns.set(T,B)),m&&(B.matrix=m),B}shadingFill(T){if(!this.contentVisible)return;const m=this.ctx;this.save();const B=this._getPattern(T);m.fillStyle=B.getPattern(m,this,m.mozCurrentTransformInverse,s.PathType.SHADING);const c=m.mozCurrentTransformInverse;if(c){const p=m.canvas,R=p.width,L=p.height,N=n.Util.applyTransform([0,0],c),z=n.Util.applyTransform([0,L],c),X=n.Util.applyTransform([R,0],c),ee=n.Util.applyTransform([R,L],c),J=Math.min(N[0],z[0],X[0],ee[0]),ie=Math.min(N[1],z[1],X[1],ee[1]),Z=Math.max(N[0],z[0],X[0],ee[0]),ve=Math.max(N[1],z[1],X[1],ee[1]);this.ctx.fillRect(J,ie,Z-J,ve-ie)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,n.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,n.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(T,m){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(T)&&T.length===6&&this.transform.apply(this,T),this.baseTransform=this.ctx.mozCurrentTransform,m)){const B=m[2]-m[0],c=m[3]-m[1];this.ctx.rect(m[0],m[1],B,c),this.current.updateRectMinMax(this.ctx.mozCurrentTransform,m),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(T){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const m=this.ctx;T.isolated||(0,n.info)("TODO: Support non-isolated groups."),T.knockout&&(0,n.warn)("Knockout groups not supported.");const B=m.mozCurrentTransform;if(T.matrix&&m.transform.apply(m,T.matrix),!T.bbox)throw new Error("Bounding box is required.");let c=n.Util.getAxialAlignedBoundingBox(T.bbox,m.mozCurrentTransform);const p=[0,0,m.canvas.width,m.canvas.height];c=n.Util.intersect(c,p)||[0,0,0,0];const R=Math.floor(c[0]),L=Math.floor(c[1]);let N=Math.max(Math.ceil(c[2])-R,1),z=Math.max(Math.ceil(c[3])-L,1),X=1,ee=1;N>A&&(X=N/A,N=A),z>A&&(ee=z/A,z=A),this.current.startNewPathAndClipBox([0,0,N,z]);let J="groupAt"+this.groupLevel;T.smask&&(J+="_smask_"+this.smaskCounter++%2);const ie=this.cachedCanvases.getCanvas(J,N,z,!0),Z=ie.context;Z.scale(1/X,1/ee),Z.translate(-R,-L),Z.transform.apply(Z,B),T.smask?this.smaskStack.push({canvas:ie.canvas,context:Z,offsetX:R,offsetY:L,scaleX:X,scaleY:ee,subtype:T.smask.subtype,backdrop:T.smask.backdrop,transferMap:T.smask.transferMap||null,startTransformInverse:null}):(m.setTransform(1,0,0,1,0,0),m.translate(R,L),m.scale(X,ee),m.save()),h(m,Z),this.ctx=Z,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(m),this.groupLevel++}endGroup(T){if(!this.contentVisible)return;this.groupLevel--;const m=this.ctx,B=this.groupStack.pop();if(this.ctx=B,this.ctx.imageSmoothingEnabled=!1,T.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const c=this.ctx.mozCurrentTransform;this.restore(),this.ctx.save(),this.ctx.setTransform.apply(this.ctx,c);const p=n.Util.getAxialAlignedBoundingBox([0,0,m.canvas.width,m.canvas.height],c);this.ctx.drawImage(m.canvas,0,0),this.ctx.restore(),this.compose(p)}}beginAnnotations(){this.save(),this.baseTransform&&this.ctx.setTransform.apply(this.ctx,this.baseTransform)}endAnnotations(){this.restore()}beginAnnotation(T,m,B,c,p){if(this.save(),Array.isArray(m)&&m.length===4){const R=m[2]-m[0],L=m[3]-m[1];if(p&&this.annotationCanvasMap){B=B.slice(),B[4]-=m[0],B[5]-=m[1],m=m.slice(),m[0]=m[1]=0,m[2]=R,m[3]=L;const[N,z]=n.Util.singularValueDecompose2dScale(this.ctx.mozCurrentTransform),{viewportScale:X}=this,ee=Math.ceil(R*this.outputScaleX*X),J=Math.ceil(L*this.outputScaleY*X);this.annotationCanvas=this.canvasFactory.create(ee,J);const{canvas:ie,context:Z}=this.annotationCanvas,ve=`var(--zoom-factor) * ${l.PixelsPerInch.PDF_TO_CSS_UNITS}`;ie.style.width=`calc(${R}px * ${ve})`,ie.style.height=`calc(${L}px * ${ve})`,this.annotationCanvasMap.set(T,ie),this.annotationCanvas.savedCtx=this.ctx,this.ctx=Z,this.ctx.setTransform(N,0,0,-z,0,L*z),j(this.ctx),_(this.ctx,this.foregroundColor)}else _(this.ctx,this.foregroundColor),this.ctx.rect(m[0],m[1],R,L),this.ctx.clip(),this.endPath()}this.current=new K(this.ctx.canvas.width,this.ctx.canvas.height),this.transform.apply(this,B),this.transform.apply(this,c)}endAnnotation(){this.annotationCanvas&&(this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas),this.restore()}paintImageMaskXObject(T){if(!this.contentVisible)return;const m=T.count;T=this.getObject(T.data,T),T.count=m;const B=this.ctx,c=this.processingType3;if(c&&(c.compiled===void 0&&(c.compiled=H(T)),c.compiled)){c.compiled(B);return}const p=this._createMaskCanvas(T),R=p.canvas;B.save(),B.setTransform(1,0,0,1,0,0),B.drawImage(R,p.offsetX,p.offsetY),B.restore(),this.compose()}paintImageMaskXObjectRepeat(T,m,B=0,c=0,p,R){if(!this.contentVisible)return;T=this.getObject(T.data,T);const L=this.ctx;L.save();const N=L.mozCurrentTransform;L.transform(m,B,c,p,0,0);const z=this._createMaskCanvas(T);L.setTransform(1,0,0,1,0,0);for(let X=0,ee=R.length;X<ee;X+=2){const J=n.Util.transform(N,[m,B,c,p,R[X],R[X+1]]),[ie,Z]=n.Util.applyTransform([0,0],J);L.drawImage(z.canvas,ie,Z)}L.restore(),this.compose()}paintImageMaskXObjectGroup(T){if(!this.contentVisible)return;const m=this.ctx,B=this.current.fillColor,c=this.current.patternFill;for(let p=0,R=T.length;p<R;p++){const L=T[p],N=L.width,z=L.height,X=this.cachedCanvases.getCanvas("maskCanvas",N,z,!1),ee=X.context;ee.save(),U(ee,L),ee.globalCompositeOperation="source-in",ee.fillStyle=c?B.getPattern(ee,this,m.mozCurrentTransformInverse,s.PathType.FILL):B,ee.fillRect(0,0,N,z),ee.restore(),m.save(),m.transform.apply(m,L.transform),m.scale(1,-1),O(m,X.canvas,0,0,N,z,0,-1,1,1),m.restore()}this.compose()}paintImageXObject(T){if(!this.contentVisible)return;const m=this.getObject(T);if(!m){(0,n.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(m)}paintImageXObjectRepeat(T,m,B,c){if(!this.contentVisible)return;const p=this.getObject(T);if(!p){(0,n.warn)("Dependent image isn't ready yet");return}const R=p.width,L=p.height,N=[];for(let z=0,X=c.length;z<X;z+=2)N.push({transform:[m,0,0,B,c[z],c[z+1]],x:0,y:0,w:R,h:L});this.paintInlineImageXObjectGroup(p,N)}paintInlineImageXObject(T){if(!this.contentVisible)return;const m=T.width,B=T.height,c=this.ctx;this.save(),c.scale(1/m,-1/B);let p;if(typeof HTMLElement=="function"&&T instanceof HTMLElement||!T.data)p=T;else{const z=this.cachedCanvases.getCanvas("inlineImage",m,B,!1),X=z.context;Y(X,T,this.current.transferMaps),p=z.canvas}const R=this._scaleImage(p,c.mozCurrentTransformInverse);c.imageSmoothingEnabled=Ce(c.mozCurrentTransform,T.interpolate);const[L,N]=O(c,R.img,0,0,R.paintWidth,R.paintHeight,0,-B,m,B);if(this.imageLayer){const z=this.getCanvasPosition(0,-B);this.imageLayer.appendImage({imgData:T,left:z[0],top:z[1],width:L,height:N})}this.compose(),this.restore()}paintInlineImageXObjectGroup(T,m){if(!this.contentVisible)return;const B=this.ctx,c=T.width,p=T.height,R=this.cachedCanvases.getCanvas("inlineImage",c,p,!1),L=R.context;Y(L,T,this.current.transferMaps);for(let N=0,z=m.length;N<z;N++){const X=m[N];if(B.save(),B.transform.apply(B,X.transform),B.scale(1,-1),O(B,R.canvas,X.x,X.y,X.w,X.h,0,-1,1,1),this.imageLayer){const ee=this.getCanvasPosition(X.x,X.y);this.imageLayer.appendImage({imgData:T,left:ee[0],top:ee[1],width:c,height:p})}B.restore()}this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(T){}markPointProps(T,m){}beginMarkedContent(T){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(T,m){T==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(m)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(T){const m=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(T);const B=this.ctx;this.pendingClip&&(m||(this.pendingClip===Ve?B.clip("evenodd"):B.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),B.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const T=this.ctx.mozCurrentTransform;if(T[1]===0&&T[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(T[0]),Math.abs(T[3]));else{const m=Math.abs(T[0]*T[3]-T[2]*T[1]),B=Math.hypot(T[0],T[2]),c=Math.hypot(T[1],T[3]);this._cachedGetSinglePixelWidth=Math.max(B,c)/m}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(!this._cachedScaleForStroking){const{lineWidth:T}=this.current,m=this.ctx.mozCurrentTransform;let B,c;if(m[1]===0&&m[2]===0){const p=Math.abs(m[0]),R=Math.abs(m[3]);if(T===0)B=1/p,c=1/R;else{const L=p*T,N=R*T;B=L<1?1/L:1,c=N<1?1/N:1}}else{const p=Math.abs(m[0]*m[3]-m[2]*m[1]),R=Math.hypot(m[0],m[1]),L=Math.hypot(m[2],m[3]);if(T===0)B=L/p,c=R/p;else{const N=T*p;B=L>N?L/N:1,c=R>N?R/N:1}}this._cachedScaleForStroking=[B,c]}return this._cachedScaleForStroking}rescaleAndStroke(T){const{ctx:m}=this,{lineWidth:B}=this.current,[c,p]=this.getScaleForStroking();if(m.lineWidth=B||1,c===1&&p===1){m.stroke();return}let R,L,N;T&&(R=m.mozCurrentTransform.slice(),L=m.getLineDash().slice(),N=m.lineDashOffset),m.scale(c,p);const z=Math.max(c,p);m.setLineDash(m.getLineDash().map(X=>X/z)),m.lineDashOffset/=z,m.stroke(),T&&(m.setTransform(...R),m.setLineDash(L),m.lineDashOffset=N)}getCanvasPosition(T,m){const B=this.ctx.mozCurrentTransform;return[B[0]*T+B[2]*m+B[4],B[1]*T+B[3]*m+B[5]]}isContentVisible(){for(let T=this.markedContentStack.length-1;T>=0;T--)if(!this.markedContentStack[T].visible)return!1;return!0}}e.CanvasGraphics=Le;for(const W in n.OPS)Le.prototype[W]!==void 0&&(Le.prototype[n.OPS[W]]=Le.prototype[W])},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TilingPattern=e.PathType=void 0,e.getShadingPattern=V;var n=t(1),s=t(3);const o={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};e.PathType=o;function a(I,j){if(!j||s.isNodeJS)return;const G=j[2]-j[0],O=j[3]-j[1],H=new Path2D;H.rect(j[0],j[1],G,O),I.clip(H)}class l{constructor(){this.constructor===l&&(0,n.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,n.unreachable)("Abstract method `getPattern` called.")}}class f extends l{constructor(j){super(),this._type=j[1],this._bbox=j[2],this._colorStops=j[3],this._p0=j[4],this._p1=j[5],this._r0=j[6],this._r1=j[7],this.matrix=null}_createGradient(j){let G;this._type==="axial"?G=j.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(G=j.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const O of this._colorStops)G.addColorStop(O[0],O[1]);return G}getPattern(j,G,O,H){let K;if(H===o.STROKE||H===o.FILL){const Y=G.current.getClippedPathBoundingBox(H,j.mozCurrentTransform)||[0,0,0,0],U=Math.ceil(Y[2]-Y[0])||1,h=Math.ceil(Y[3]-Y[1])||1,_=G.cachedCanvases.getCanvas("pattern",U,h,!0),E=_.context;E.clearRect(0,0,E.canvas.width,E.canvas.height),E.beginPath(),E.rect(0,0,E.canvas.width,E.canvas.height),E.translate(-Y[0],-Y[1]),O=n.Util.transform(O,[1,0,0,1,Y[0],Y[1]]),E.transform.apply(E,G.baseTransform),this.matrix&&E.transform.apply(E,this.matrix),a(E,this._bbox),E.fillStyle=this._createGradient(E),E.fill(),K=j.createPattern(_.canvas,"no-repeat");const x=new DOMMatrix(O);try{K.setTransform(x)}catch(P){(0,n.warn)(`RadialAxialShadingPattern.getPattern: "${P==null?void 0:P.message}".`)}}else a(j,this._bbox),K=this._createGradient(j);return K}}function d(I,j,G,O,H,K,Y,U){const h=j.coords,_=j.colors,E=I.data,x=I.width*4;let P;h[G+1]>h[O+1]&&(P=G,G=O,O=P,P=K,K=Y,Y=P),h[O+1]>h[H+1]&&(P=O,O=H,H=P,P=Y,Y=U,U=P),h[G+1]>h[O+1]&&(P=G,G=O,O=P,P=K,K=Y,Y=P);const k=(h[G]+j.offsetX)*j.scaleX,Q=(h[G+1]+j.offsetY)*j.scaleY,Ce=(h[O]+j.offsetX)*j.scaleX,Oe=(h[O+1]+j.offsetY)*j.scaleY,Se=(h[H]+j.offsetX)*j.scaleX,Fe=(h[H+1]+j.offsetY)*j.scaleY;if(Q>=Fe)return;const Ve=_[K],Le=_[K+1],W=_[K+2],T=_[Y],m=_[Y+1],B=_[Y+2],c=_[U],p=_[U+1],R=_[U+2],L=Math.round(Q),N=Math.round(Fe);let z,X,ee,J,ie,Z,ve,Me;for(let Ue=L;Ue<=N;Ue++){if(Ue<Oe){let ke;Ue<Q?ke=0:ke=(Q-Ue)/(Q-Oe),z=k-(k-Ce)*ke,X=Ve-(Ve-T)*ke,ee=Le-(Le-m)*ke,J=W-(W-B)*ke}else{let ke;Ue>Fe?ke=1:Oe===Fe?ke=0:ke=(Oe-Ue)/(Oe-Fe),z=Ce-(Ce-Se)*ke,X=T-(T-c)*ke,ee=m-(m-p)*ke,J=B-(B-R)*ke}let Ne;Ue<Q?Ne=0:Ue>Fe?Ne=1:Ne=(Q-Ue)/(Q-Fe),ie=k-(k-Se)*Ne,Z=Ve-(Ve-c)*Ne,ve=Le-(Le-p)*Ne,Me=W-(W-R)*Ne;const xe=Math.round(Math.min(z,ie)),qe=Math.round(Math.max(z,ie));let $e=x*Ue+xe*4;for(let ke=xe;ke<=qe;ke++)Ne=(z-ke)/(z-ie),Ne<0?Ne=0:Ne>1&&(Ne=1),E[$e++]=X-(X-Z)*Ne|0,E[$e++]=ee-(ee-ve)*Ne|0,E[$e++]=J-(J-Me)*Ne|0,E[$e++]=255}}function A(I,j,G){const O=j.coords,H=j.colors;let K,Y;switch(j.type){case"lattice":const U=j.verticesPerRow,h=Math.floor(O.length/U)-1,_=U-1;for(K=0;K<h;K++){let E=K*U;for(let x=0;x<_;x++,E++)d(I,G,O[E],O[E+1],O[E+U],H[E],H[E+1],H[E+U]),d(I,G,O[E+U+1],O[E+1],O[E+U],H[E+U+1],H[E+1],H[E+U])}break;case"triangles":for(K=0,Y=O.length;K<Y;K+=3)d(I,G,O[K],O[K+1],O[K+2],H[K],H[K+1],H[K+2]);break;default:throw new Error("illegal figure")}}class M extends l{constructor(j){super(),this._coords=j[2],this._colors=j[3],this._figures=j[4],this._bounds=j[5],this._bbox=j[7],this._background=j[8],this.matrix=null}_createMeshCanvas(j,G,O){const U=Math.floor(this._bounds[0]),h=Math.floor(this._bounds[1]),_=Math.ceil(this._bounds[2])-U,E=Math.ceil(this._bounds[3])-h,x=Math.min(Math.ceil(Math.abs(_*j[0]*1.1)),3e3),P=Math.min(Math.ceil(Math.abs(E*j[1]*1.1)),3e3),k=_/x,Q=E/P,Ce={coords:this._coords,colors:this._colors,offsetX:-U,offsetY:-h,scaleX:1/k,scaleY:1/Q},Oe=x+2*2,Se=P+2*2,Fe=O.getCanvas("mesh",Oe,Se,!1),Ve=Fe.context,Le=Ve.createImageData(x,P);if(G){const T=Le.data;for(let m=0,B=T.length;m<B;m+=4)T[m]=G[0],T[m+1]=G[1],T[m+2]=G[2],T[m+3]=255}for(const T of this._figures)A(Le,T,Ce);return Ve.putImageData(Le,2,2),{canvas:Fe.canvas,offsetX:U-2*k,offsetY:h-2*Q,scaleX:k,scaleY:Q}}getPattern(j,G,O,H){a(j,this._bbox);let K;if(H===o.SHADING)K=n.Util.singularValueDecompose2dScale(j.mozCurrentTransform);else if(K=n.Util.singularValueDecompose2dScale(G.baseTransform),this.matrix){const U=n.Util.singularValueDecompose2dScale(this.matrix);K=[K[0]*U[0],K[1]*U[1]]}const Y=this._createMeshCanvas(K,H===o.SHADING?null:this._background,G.cachedCanvases);return H!==o.SHADING&&(j.setTransform.apply(j,G.baseTransform),this.matrix&&j.transform.apply(j,this.matrix)),j.translate(Y.offsetX,Y.offsetY),j.scale(Y.scaleX,Y.scaleY),j.createPattern(Y.canvas,"no-repeat")}}class q extends l{getPattern(){return"hotpink"}}function V(I){switch(I[0]){case"RadialAxial":return new f(I);case"Mesh":return new M(I);case"Dummy":return new q}throw new Error(`Unknown IR type: ${I[0]}`)}const g={COLORED:1,UNCOLORED:2};class F{static get MAX_PATTERN_SIZE(){return(0,n.shadow)(this,"MAX_PATTERN_SIZE",3e3)}constructor(j,G,O,H,K){this.operatorList=j[2],this.matrix=j[3]||[1,0,0,1,0,0],this.bbox=j[4],this.xstep=j[5],this.ystep=j[6],this.paintType=j[7],this.tilingType=j[8],this.color=G,this.ctx=O,this.canvasGraphicsFactory=H,this.baseTransform=K}createPatternCanvas(j){const G=this.operatorList,O=this.bbox,H=this.xstep,K=this.ystep,Y=this.paintType,U=this.tilingType,h=this.color,_=this.canvasGraphicsFactory;(0,n.info)("TilingType: "+U);const E=O[0],x=O[1],P=O[2],k=O[3],Q=n.Util.singularValueDecompose2dScale(this.matrix),Ce=n.Util.singularValueDecompose2dScale(this.baseTransform),Oe=[Q[0]*Ce[0],Q[1]*Ce[1]],Se=this.getSizeAndScale(H,this.ctx.canvas.width,Oe[0]),Fe=this.getSizeAndScale(K,this.ctx.canvas.height,Oe[1]),Ve=j.cachedCanvases.getCanvas("pattern",Se.size,Fe.size,!0),Le=Ve.context,W=_.createCanvasGraphics(Le);W.groupLevel=j.groupLevel,this.setFillAndStrokeStyleToContext(W,Y,h);let T=E,m=x,B=P,c=k;return E<0&&(T=0,B+=Math.abs(E)),x<0&&(m=0,c+=Math.abs(x)),Le.translate(-(Se.scale*T),-(Fe.scale*m)),W.transform(Se.scale,0,0,Fe.scale,0,0),Le.save(),this.clipBbox(W,T,m,B,c),W.baseTransform=W.ctx.mozCurrentTransform.slice(),W.executeOperatorList(G),W.endDrawing(),{canvas:Ve.canvas,scaleX:Se.scale,scaleY:Fe.scale,offsetX:T,offsetY:m}}getSizeAndScale(j,G,O){j=Math.abs(j);const H=Math.max(F.MAX_PATTERN_SIZE,G);let K=Math.ceil(j*O);return K>=H?K=H:O=K/j,{scale:O,size:K}}clipBbox(j,G,O,H,K){const Y=H-G,U=K-O;j.ctx.rect(G,O,Y,U),j.current.updateRectMinMax(j.ctx.mozCurrentTransform,[G,O,H,K]),j.clip(),j.endPath()}setFillAndStrokeStyleToContext(j,G,O){const H=j.ctx,K=j.current;switch(G){case g.COLORED:const Y=this.ctx;H.fillStyle=Y.fillStyle,H.strokeStyle=Y.strokeStyle,K.fillColor=Y.fillStyle,K.strokeColor=Y.strokeStyle;break;case g.UNCOLORED:const U=n.Util.makeHexColor(O[0],O[1],O[2]);H.fillStyle=U,H.strokeStyle=U,K.fillColor=U,K.strokeColor=U;break;default:throw new n.FormatError(`Unsupported paint type: ${G}`)}}getPattern(j,G,O,H){let K=O;H!==o.SHADING&&(K=n.Util.transform(K,G.baseTransform),this.matrix&&(K=n.Util.transform(K,this.matrix)));const Y=this.createPatternCanvas(G);let U=new DOMMatrix(K);U=U.translate(Y.offsetX,Y.offsetY),U=U.scale(1/Y.scaleX,1/Y.scaleY);const h=j.createPattern(Y.canvas,"repeat");try{h.setTransform(U)}catch(_){(0,n.warn)(`TilingPattern.getPattern: "${_==null?void 0:_.message}".`)}return h}}e.TilingPattern=F},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.applyMaskImageData=s;var n=t(1);function s({src:o,srcPos:a=0,dest:l,destPos:f=0,width:d,height:A,inverseDecode:M=!1}){const q=n.FeatureTest.isLittleEndian?4278190080:255,[V,g]=M?[0,q]:[q,0],F=d>>3,I=d&7,j=o.length;l=new Uint32Array(l.buffer);for(let G=0;G<A;G++){for(const H=a+F;a<H;a++){const K=a<j?o[a]:255;l[f++]=K&128?g:V,l[f++]=K&64?g:V,l[f++]=K&32?g:V,l[f++]=K&16?g:V,l[f++]=K&8?g:V,l[f++]=K&4?g:V,l[f++]=K&2?g:V,l[f++]=K&1?g:V}if(I===0)continue;const O=a<j?o[a++]:255;for(let H=0;H<I;H++)l[f++]=O&1<<7-H?g:V}return{srcPos:a,destPos:f}}},(r,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GlobalWorkerOptions=void 0;const t=Object.create(null);e.GlobalWorkerOptions=t,t.workerPort=t.workerPort===void 0?null:t.workerPort,t.workerSrc=t.workerSrc===void 0?"":t.workerSrc},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MessageHandler=void 0;var n=t(1);const s={UNKNOWN:0,DATA:1,ERROR:2},o={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function a(f){switch(f instanceof Error||typeof f=="object"&&f!==null||(0,n.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),f.name){case"AbortException":return new n.AbortException(f.message);case"MissingPDFException":return new n.MissingPDFException(f.message);case"PasswordException":return new n.PasswordException(f.message,f.code);case"UnexpectedResponseException":return new n.UnexpectedResponseException(f.message,f.status);case"UnknownErrorException":return new n.UnknownErrorException(f.message,f.details);default:return new n.UnknownErrorException(f.message,f.toString())}}class l{constructor(d,A,M){this.sourceName=d,this.targetName=A,this.comObj=M,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=q=>{const V=q.data;if(V.targetName!==this.sourceName)return;if(V.stream){this._processStreamMessage(V);return}if(V.callback){const F=V.callbackId,I=this.callbackCapabilities[F];if(!I)throw new Error(`Cannot resolve callback ${F}`);if(delete this.callbackCapabilities[F],V.callback===s.DATA)I.resolve(V.data);else if(V.callback===s.ERROR)I.reject(a(V.reason));else throw new Error("Unexpected callback case");return}const g=this.actionHandler[V.action];if(!g)throw new Error(`Unknown action from worker: ${V.action}`);if(V.callbackId){const F=this.sourceName,I=V.sourceName;new Promise(function(j){j(g(V.data))}).then(function(j){M.postMessage({sourceName:F,targetName:I,callback:s.DATA,callbackId:V.callbackId,data:j})},function(j){M.postMessage({sourceName:F,targetName:I,callback:s.ERROR,callbackId:V.callbackId,reason:a(j)})});return}if(V.streamId){this._createStreamSink(V);return}g(V.data)},M.addEventListener("message",this._onComObjOnMessage)}on(d,A){const M=this.actionHandler;if(M[d])throw new Error(`There is already an actionName called "${d}"`);M[d]=A}send(d,A,M){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:d,data:A},M)}sendWithPromise(d,A,M){const q=this.callbackId++,V=(0,n.createPromiseCapability)();this.callbackCapabilities[q]=V;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:d,callbackId:q,data:A},M)}catch(g){V.reject(g)}return V.promise}sendWithStream(d,A,M,q){const V=this.streamId++,g=this.sourceName,F=this.targetName,I=this.comObj;return new ReadableStream({start:j=>{const G=(0,n.createPromiseCapability)();return this.streamControllers[V]={controller:j,startCall:G,pullCall:null,cancelCall:null,isClosed:!1},I.postMessage({sourceName:g,targetName:F,action:d,streamId:V,data:A,desiredSize:j.desiredSize},q),G.promise},pull:j=>{const G=(0,n.createPromiseCapability)();return this.streamControllers[V].pullCall=G,I.postMessage({sourceName:g,targetName:F,stream:o.PULL,streamId:V,desiredSize:j.desiredSize}),G.promise},cancel:j=>{(0,n.assert)(j instanceof Error,"cancel must have a valid reason");const G=(0,n.createPromiseCapability)();return this.streamControllers[V].cancelCall=G,this.streamControllers[V].isClosed=!0,I.postMessage({sourceName:g,targetName:F,stream:o.CANCEL,streamId:V,reason:a(j)}),G.promise}},M)}_createStreamSink(d){const A=d.streamId,M=this.sourceName,q=d.sourceName,V=this.comObj,g=this,F=this.actionHandler[d.action],I={enqueue(j,G=1,O){if(this.isCancelled)return;const H=this.desiredSize;this.desiredSize-=G,H>0&&this.desiredSize<=0&&(this.sinkCapability=(0,n.createPromiseCapability)(),this.ready=this.sinkCapability.promise),V.postMessage({sourceName:M,targetName:q,stream:o.ENQUEUE,streamId:A,chunk:j},O)},close(){this.isCancelled||(this.isCancelled=!0,V.postMessage({sourceName:M,targetName:q,stream:o.CLOSE,streamId:A}),delete g.streamSinks[A])},error(j){(0,n.assert)(j instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,V.postMessage({sourceName:M,targetName:q,stream:o.ERROR,streamId:A,reason:a(j)}))},sinkCapability:(0,n.createPromiseCapability)(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:d.desiredSize,ready:null};I.sinkCapability.resolve(),I.ready=I.sinkCapability.promise,this.streamSinks[A]=I,new Promise(function(j){j(F(d.data,I))}).then(function(){V.postMessage({sourceName:M,targetName:q,stream:o.START_COMPLETE,streamId:A,success:!0})},function(j){V.postMessage({sourceName:M,targetName:q,stream:o.START_COMPLETE,streamId:A,reason:a(j)})})}_processStreamMessage(d){const A=d.streamId,M=this.sourceName,q=d.sourceName,V=this.comObj,g=this.streamControllers[A],F=this.streamSinks[A];switch(d.stream){case o.START_COMPLETE:d.success?g.startCall.resolve():g.startCall.reject(a(d.reason));break;case o.PULL_COMPLETE:d.success?g.pullCall.resolve():g.pullCall.reject(a(d.reason));break;case o.PULL:if(!F){V.postMessage({sourceName:M,targetName:q,stream:o.PULL_COMPLETE,streamId:A,success:!0});break}F.desiredSize<=0&&d.desiredSize>0&&F.sinkCapability.resolve(),F.desiredSize=d.desiredSize,new Promise(function(I){I(F.onPull&&F.onPull())}).then(function(){V.postMessage({sourceName:M,targetName:q,stream:o.PULL_COMPLETE,streamId:A,success:!0})},function(I){V.postMessage({sourceName:M,targetName:q,stream:o.PULL_COMPLETE,streamId:A,reason:a(I)})});break;case o.ENQUEUE:if((0,n.assert)(g,"enqueue should have stream controller"),g.isClosed)break;g.controller.enqueue(d.chunk);break;case o.CLOSE:if((0,n.assert)(g,"close should have stream controller"),g.isClosed)break;g.isClosed=!0,g.controller.close(),this._deleteStreamController(g,A);break;case o.ERROR:(0,n.assert)(g,"error should have stream controller"),g.controller.error(a(d.reason)),this._deleteStreamController(g,A);break;case o.CANCEL_COMPLETE:d.success?g.cancelCall.resolve():g.cancelCall.reject(a(d.reason)),this._deleteStreamController(g,A);break;case o.CANCEL:if(!F)break;new Promise(function(I){I(F.onCancel&&F.onCancel(a(d.reason)))}).then(function(){V.postMessage({sourceName:M,targetName:q,stream:o.CANCEL_COMPLETE,streamId:A,success:!0})},function(I){V.postMessage({sourceName:M,targetName:q,stream:o.CANCEL_COMPLETE,streamId:A,reason:a(I)})}),F.sinkCapability.reject(a(d.reason)),F.isCancelled=!0,delete this.streamSinks[A];break;default:throw new Error("Unexpected stream case")}}async _deleteStreamController(d,A){await Promise.allSettled([d.startCall&&d.startCall.promise,d.pullCall&&d.pullCall.promise,d.cancelCall&&d.cancelCall.promise]),delete this.streamControllers[A]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}e.MessageHandler=l},(r,e,t)=>{var o,a;Object.defineProperty(e,"__esModule",{value:!0}),e.Metadata=void 0;var n=t(1);class s{constructor({parsedData:f,rawData:d}){gt(this,o,void 0);gt(this,a,void 0);vt(this,o,f),vt(this,a,d)}getRaw(){return Ye(this,a)}get(f){return Ye(this,o).get(f)??null}getAll(){return(0,n.objectFromMap)(Ye(this,o))}has(f){return Ye(this,o).has(f)}}o=new WeakMap,a=new WeakMap,e.Metadata=s},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OptionalContentConfig=void 0;var n=t(1);class s{constructor(l,f){this.visible=!0,this.name=l,this.intent=f}}class o{constructor(l){if(this.name=null,this.creator=null,this._order=null,this._groups=new Map,l!==null){this.name=l.name,this.creator=l.creator,this._order=l.order;for(const f of l.groups)this._groups.set(f.id,new s(f.name,f.intent));if(l.baseState==="OFF")for(const f of this._groups)f.visible=!1;for(const f of l.on)this._groups.get(f).visible=!0;for(const f of l.off)this._groups.get(f).visible=!1}}_evaluateVisibilityExpression(l){const f=l.length;if(f<2)return!0;const d=l[0];for(let A=1;A<f;A++){const M=l[A];let q;if(Array.isArray(M))q=this._evaluateVisibilityExpression(M);else if(this._groups.has(M))q=this._groups.get(M).visible;else return(0,n.warn)(`Optional content group not found: ${M}`),!0;switch(d){case"And":if(!q)return!1;break;case"Or":if(q)return!0;break;case"Not":return!q;default:return!0}}return d==="And"}isVisible(l){if(this._groups.size===0)return!0;if(!l)return(0,n.warn)("Optional content group not defined."),!0;if(l.type==="OCG")return this._groups.has(l.id)?this._groups.get(l.id).visible:((0,n.warn)(`Optional content group not found: ${l.id}`),!0);if(l.type==="OCMD"){if(l.expression)return this._evaluateVisibilityExpression(l.expression);if(!l.policy||l.policy==="AnyOn"){for(const f of l.ids){if(!this._groups.has(f))return(0,n.warn)(`Optional content group not found: ${f}`),!0;if(this._groups.get(f).visible)return!0}return!1}else if(l.policy==="AllOn"){for(const f of l.ids){if(!this._groups.has(f))return(0,n.warn)(`Optional content group not found: ${f}`),!0;if(!this._groups.get(f).visible)return!1}return!0}else if(l.policy==="AnyOff"){for(const f of l.ids){if(!this._groups.has(f))return(0,n.warn)(`Optional content group not found: ${f}`),!0;if(!this._groups.get(f).visible)return!0}return!1}else if(l.policy==="AllOff"){for(const f of l.ids){if(!this._groups.has(f))return(0,n.warn)(`Optional content group not found: ${f}`),!0;if(this._groups.get(f).visible)return!1}return!0}return(0,n.warn)(`Unknown optional content policy ${l.policy}.`),!0}return(0,n.warn)(`Unknown group type ${l.type}.`),!0}setVisibility(l,f=!0){if(!this._groups.has(l)){(0,n.warn)(`Optional content group not found: ${l}`);return}this._groups.get(l).visible=!!f}getOrder(){return this._groups.size?this._order?this._order.slice():Array.from(this._groups.keys()):null}getGroups(){return this._groups.size>0?(0,n.objectFromMap)(this._groups):null}getGroup(l){return this._groups.get(l)||null}}e.OptionalContentConfig=o},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFDataTransportStream=void 0;var n=t(1),s=t(5);class o{constructor(d,A){(0,n.assert)(A,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=d.progressiveDone||!1,this._contentDispositionFilename=d.contentDispositionFilename||null;const M=d.initialData;if((M==null?void 0:M.length)>0){const q=new Uint8Array(M).buffer;this._queuedChunks.push(q)}this._pdfDataRangeTransport=A,this._isStreamingSupported=!d.disableStream,this._isRangeSupported=!d.disableRange,this._contentLength=d.length,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((q,V)=>{this._onReceiveData({begin:q,chunk:V})}),this._pdfDataRangeTransport.addProgressListener((q,V)=>{this._onProgress({loaded:q,total:V})}),this._pdfDataRangeTransport.addProgressiveReadListener(q=>{this._onReceiveData({chunk:q})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData(d){const A=new Uint8Array(d.chunk).buffer;if(d.begin===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(A):this._queuedChunks.push(A);else{const M=this._rangeReaders.some(function(q){return q._begin!==d.begin?!1:(q._enqueue(A),!0)});(0,n.assert)(M,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var d;return((d=this._fullRequestReader)==null?void 0:d._loaded)??0}_onProgress(d){if(d.total===void 0){const A=this._rangeReaders[0];A!=null&&A.onProgress&&A.onProgress({loaded:d.loaded})}else{const A=this._fullRequestReader;A!=null&&A.onProgress&&A.onProgress({loaded:d.loaded,total:d.total})}}_onProgressiveDone(){this._fullRequestReader&&this._fullRequestReader.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(d){const A=this._rangeReaders.indexOf(d);A>=0&&this._rangeReaders.splice(A,1)}getFullReader(){(0,n.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const d=this._queuedChunks;return this._queuedChunks=null,new a(this,d,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(d,A){if(A<=this._progressiveDataLength)return null;const M=new l(this,d,A);return this._pdfDataRangeTransport.requestDataRange(d,A),this._rangeReaders.push(M),M}cancelAllRequests(d){this._fullRequestReader&&this._fullRequestReader.cancel(d);for(const A of this._rangeReaders.slice(0))A.cancel(d);this._pdfDataRangeTransport.abort()}}e.PDFDataTransportStream=o;class a{constructor(d,A,M=!1,q=null){this._stream=d,this._done=M||!1,this._filename=(0,s.isPdfFile)(q)?q:null,this._queuedChunks=A||[],this._loaded=0;for(const V of this._queuedChunks)this._loaded+=V.byteLength;this._requests=[],this._headersReady=Promise.resolve(),d._fullRequestReader=this,this.onProgress=null}_enqueue(d){this._done||(this._requests.length>0?this._requests.shift().resolve({value:d,done:!1}):this._queuedChunks.push(d),this._loaded+=d.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const d=(0,n.createPromiseCapability)();return this._requests.push(d),d.promise}cancel(d){this._done=!0;for(const A of this._requests)A.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class l{constructor(d,A,M){this._stream=d,this._begin=A,this._end=M,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(d){if(!this._done){if(this._requests.length===0)this._queuedChunk=d;else{this._requests.shift().resolve({value:d,done:!1});for(const M of this._requests)M.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const A=this._queuedChunk;return this._queuedChunk=null,{value:A,done:!1}}if(this._done)return{value:void 0,done:!0};const d=(0,n.createPromiseCapability)();return this._requests.push(d),d.promise}cancel(d){this._done=!0;for(const A of this._requests)A.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(r,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaText=void 0;class t{static textContent(s){const o=[],a={items:o,styles:Object.create(null)};function l(f){var M;if(!f)return;let d=null;const A=f.name;if(A==="#text")d=f.value;else if(t.shouldBuildText(A))(M=f==null?void 0:f.attributes)!=null&&M.textContent?d=f.attributes.textContent:f.value&&(d=f.value);else return;if(d!==null&&o.push({str:d}),!!f.children)for(const q of f.children)l(q)}return l(s),a}static shouldBuildText(s){return!(s==="textarea"||s==="input"||s==="option"||s==="select")}}e.XfaText=t},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NodeStandardFontDataFactory=e.NodeCanvasFactory=e.NodeCMapReaderFactory=void 0;var n=t(6);const s=function(f){return new Promise((d,A)=>{require$$5.readFile(f,(q,V)=>{if(q||!V){A(new Error(q));return}d(new Uint8Array(V))})})};class o extends n.BaseCanvasFactory{_createCanvas(d,A){return require$$5.createCanvas(d,A)}}e.NodeCanvasFactory=o;class a extends n.BaseCMapReaderFactory{_fetchData(d,A){return s(d).then(M=>({cMapData:M,compressionType:A}))}}e.NodeCMapReaderFactory=a;class l extends n.BaseStandardFontDataFactory{_fetchData(d){return s(d)}}e.NodeStandardFontDataFactory=l},(r,e,t)=>{var T,Sn;Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationLayer=void 0;var n=t(1),s=t(5),o=t(8),a=t(21),l=t(22);const f=1e3,d=new WeakSet;function A(B){return{width:B[2]-B[0],height:B[3]-B[1]}}class M{static create(c){switch(c.data.annotationType){case n.AnnotationType.LINK:return new V(c);case n.AnnotationType.TEXT:return new g(c);case n.AnnotationType.WIDGET:switch(c.data.fieldType){case"Tx":return new I(c);case"Btn":return c.data.radioButton?new G(c):c.data.checkBox?new j(c):new O(c);case"Ch":return new H(c)}return new F(c);case n.AnnotationType.POPUP:return new K(c);case n.AnnotationType.FREETEXT:return new U(c);case n.AnnotationType.LINE:return new h(c);case n.AnnotationType.SQUARE:return new _(c);case n.AnnotationType.CIRCLE:return new E(c);case n.AnnotationType.POLYLINE:return new x(c);case n.AnnotationType.CARET:return new k(c);case n.AnnotationType.INK:return new Q(c);case n.AnnotationType.POLYGON:return new P(c);case n.AnnotationType.HIGHLIGHT:return new Ce(c);case n.AnnotationType.UNDERLINE:return new Oe(c);case n.AnnotationType.SQUIGGLY:return new Se(c);case n.AnnotationType.STRIKEOUT:return new Fe(c);case n.AnnotationType.STAMP:return new Ve(c);case n.AnnotationType.FILEATTACHMENT:return new Le(c);default:return new q(c)}}}class q{constructor(c,{isRenderable:p=!1,ignoreBorder:R=!1,createQuadrilaterals:L=!1}={}){this.isRenderable=p,this.data=c.data,this.layer=c.layer,this.page=c.page,this.viewport=c.viewport,this.linkService=c.linkService,this.downloadManager=c.downloadManager,this.imageResourcesPath=c.imageResourcesPath,this.renderForms=c.renderForms,this.svgFactory=c.svgFactory,this.annotationStorage=c.annotationStorage,this.enableScripting=c.enableScripting,this.hasJSActions=c.hasJSActions,this._fieldObjects=c.fieldObjects,this._mouseState=c.mouseState,p&&(this.container=this._createContainer(R)),L&&(this.quadrilaterals=this._createQuadrilaterals(R))}_createContainer(c=!1){const p=this.data,R=this.page,L=this.viewport,N=document.createElement("section");let{width:z,height:X}=A(p.rect);N.setAttribute("data-annotation-id",p.id);const ee=n.Util.normalizeRect([p.rect[0],R.view[3]-p.rect[1]+R.view[1],p.rect[2],R.view[3]-p.rect[3]+R.view[1]]);if(p.hasOwnCanvas){const J=L.transform.slice(),[ie,Z]=n.Util.singularValueDecompose2dScale(J);z=Math.ceil(z*ie),X=Math.ceil(X*Z),ee[0]*=ie,ee[1]*=Z;for(let ve=0;ve<4;ve++)J[ve]=Math.sign(J[ve]);N.style.transform=`matrix(${J.join(",")})`}else N.style.transform=`matrix(${L.transform.join(",")})`;if(N.style.transformOrigin=`${-ee[0]}px ${-ee[1]}px`,!c&&p.borderStyle.width>0){N.style.borderWidth=`${p.borderStyle.width}px`,p.borderStyle.style!==n.AnnotationBorderStyleType.UNDERLINE&&(z-=2*p.borderStyle.width,X-=2*p.borderStyle.width);const J=p.borderStyle.horizontalCornerRadius,ie=p.borderStyle.verticalCornerRadius;if(J>0||ie>0){const ve=`${J}px / ${ie}px`;N.style.borderRadius=ve}switch(p.borderStyle.style){case n.AnnotationBorderStyleType.SOLID:N.style.borderStyle="solid";break;case n.AnnotationBorderStyleType.DASHED:N.style.borderStyle="dashed";break;case n.AnnotationBorderStyleType.BEVELED:(0,n.warn)("Unimplemented border style: beveled");break;case n.AnnotationBorderStyleType.INSET:(0,n.warn)("Unimplemented border style: inset");break;case n.AnnotationBorderStyleType.UNDERLINE:N.style.borderBottomStyle="solid";break}p.borderColor||p.color||null?N.style.borderColor=n.Util.makeHexColor(p.color[0]|0,p.color[1]|0,p.color[2]|0):N.style.borderWidth=0}return N.style.left=`${ee[0]}px`,N.style.top=`${ee[1]}px`,p.hasOwnCanvas?N.style.width=N.style.height="auto":(N.style.width=`${z}px`,N.style.height=`${X}px`),N}get _commonActions(){const c=(p,R,L)=>{const N=L.detail[p];L.target.style[R]=a.ColorConverters[`${N[0]}_HTML`](N.slice(1))};return(0,n.shadow)(this,"_commonActions",{display:p=>{const R=p.detail.display%2===1;p.target.style.visibility=R?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:R,print:p.detail.display===0||p.detail.display===3})},print:p=>{this.annotationStorage.setValue(this.data.id,{print:p.detail.print})},hidden:p=>{p.target.style.visibility=p.detail.hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:p.detail.hidden})},focus:p=>{setTimeout(()=>p.target.focus({preventScroll:!1}),0)},userName:p=>{p.target.title=p.detail.userName},readonly:p=>{p.detail.readonly?p.target.setAttribute("readonly",""):p.target.removeAttribute("readonly")},required:p=>{p.detail.required?p.target.setAttribute("required",""):p.target.removeAttribute("required")},bgColor:p=>{c("bgColor","backgroundColor",p)},fillColor:p=>{c("fillColor","backgroundColor",p)},fgColor:p=>{c("fgColor","color",p)},textColor:p=>{c("textColor","color",p)},borderColor:p=>{c("borderColor","borderColor",p)},strokeColor:p=>{c("strokeColor","borderColor",p)}})}_dispatchEventFromSandbox(c,p){const R=this._commonActions;for(const L of Object.keys(p.detail)){const N=c[L]||R[L];N&&N(p)}}_setDefaultPropertiesFromJS(c){if(!this.enableScripting)return;const p=this.annotationStorage.getRawValue(this.data.id);if(!p)return;const R=this._commonActions;for(const[L,N]of Object.entries(p)){const z=R[L];z&&(z({detail:N,target:c}),delete p[L])}}_createQuadrilaterals(c=!1){if(!this.data.quadPoints)return null;const p=[],R=this.data.rect;for(const L of this.data.quadPoints)this.data.rect=[L[2].x,L[2].y,L[1].x,L[1].y],p.push(this._createContainer(c));return this.data.rect=R,p}_createPopup(c,p){let R=this.container;this.quadrilaterals&&(c=c||this.quadrilaterals,R=this.quadrilaterals[0]),c||(c=document.createElement("div"),c.style.height=R.style.height,c.style.width=R.style.width,R.appendChild(c));const N=new Y({container:R,trigger:c,color:p.color,titleObj:p.titleObj,modificationDate:p.modificationDate,contentsObj:p.contentsObj,richText:p.richText,hideWrapper:!0}).render();N.style.left=R.style.width,R.appendChild(N)}_renderQuadrilaterals(c){for(const p of this.quadrilaterals)p.className=c;return this.quadrilaterals}render(){(0,n.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(c,p=null){const R=[];if(this._fieldObjects){const L=this._fieldObjects[c];if(L)for(const{page:N,id:z,exportValues:X}of L){if(N===-1||z===p)continue;const ee=typeof X=="string"?X:null,J=document.getElementById(z);if(J&&!d.has(J)){(0,n.warn)(`_getElementsByName - element not allowed: ${z}`);continue}R.push({id:z,exportValue:ee,domElement:J})}return R}for(const L of document.getElementsByName(c)){const{id:N,exportValue:z}=L;N!==p&&d.has(L)&&R.push({id:N,exportValue:z,domElement:L})}return R}static get platform(){const c=typeof navigator<"u"?navigator.platform:"";return(0,n.shadow)(this,"platform",{isWin:c.includes("Win"),isMac:c.includes("Mac")})}}class V extends q{constructor(c,p=null){const R=!!(c.data.url||c.data.dest||c.data.action||c.data.isTooltipOnly||c.data.resetForm||c.data.actions&&(c.data.actions.Action||c.data.actions["Mouse Up"]||c.data.actions["Mouse Down"]));super(c,{isRenderable:R,ignoreBorder:!!(p!=null&&p.ignoreBorder),createQuadrilaterals:!0})}render(){const{data:c,linkService:p}=this,R=document.createElement("a");if(c.url)p.addLinkAttributes(R,c.url,c.newWindow);else if(c.action)this._bindNamedAction(R,c.action);else if(c.dest)this._bindLink(R,c.dest);else{let L=!1;c.actions&&(c.actions.Action||c.actions["Mouse Up"]||c.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(L=!0,this._bindJSAction(R,c)),c.resetForm?this._bindResetFormAction(R,c.resetForm):L||this._bindLink(R,"")}return this.quadrilaterals?this._renderQuadrilaterals("linkAnnotation").map((L,N)=>{const z=N===0?R:R.cloneNode();return L.appendChild(z),L}):(this.container.className="linkAnnotation",this.container.appendChild(R),this.container)}_bindLink(c,p){c.href=this.linkService.getDestinationHash(p),c.onclick=()=>(p&&this.linkService.goToDestination(p),!1),(p||p==="")&&(c.className="internalLink")}_bindNamedAction(c,p){c.href=this.linkService.getAnchorUrl(""),c.onclick=()=>(this.linkService.executeNamedAction(p),!1),c.className="internalLink"}_bindJSAction(c,p){c.href=this.linkService.getAnchorUrl("");const R=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const L of Object.keys(p.actions)){const N=R.get(L);N&&(c[N]=()=>{var z;return(z=this.linkService.eventBus)==null||z.dispatch("dispatcheventinsandbox",{source:this,detail:{id:p.id,name:L}}),!1})}c.onclick||(c.onclick=()=>!1),c.className="internalLink"}_bindResetFormAction(c,p){const R=c.onclick;if(R||(c.href=this.linkService.getAnchorUrl("")),c.className="internalLink",!this._fieldObjects){(0,n.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),R||(c.onclick=()=>!1);return}c.onclick=()=>{var ie;R&&R();const{fields:L,refs:N,include:z}=p,X=[];if(L.length!==0||N.length!==0){const Z=new Set(N);for(const ve of L){const Me=this._fieldObjects[ve]||[];for(const{id:Ue}of Me)Z.add(Ue)}for(const ve of Object.values(this._fieldObjects))for(const Me of ve)Z.has(Me.id)===z&&X.push(Me)}else for(const Z of Object.values(this._fieldObjects))X.push(...Z);const ee=this.annotationStorage,J=[];for(const Z of X){const{id:ve}=Z;switch(J.push(ve),Z.type){case"text":{const Ue=Z.defaultValue||"";ee.setValue(ve,{value:Ue});break}case"checkbox":case"radiobutton":{const Ue=Z.defaultValue===Z.exportValues;ee.setValue(ve,{value:Ue});break}case"combobox":case"listbox":{const Ue=Z.defaultValue||"";ee.setValue(ve,{value:Ue});break}default:continue}const Me=document.getElementById(ve);!Me||!d.has(Me)||Me.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((ie=this.linkService.eventBus)==null||ie.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:J,name:"ResetForm"}})),!1}}}class g extends q{constructor(c){var R,L,N;const p=!!(c.data.hasPopup||(R=c.data.titleObj)!=null&&R.str||(L=c.data.contentsObj)!=null&&L.str||(N=c.data.richText)!=null&&N.str);super(c,{isRenderable:p})}render(){this.container.className="textAnnotation";const c=document.createElement("img");return c.style.height=this.container.style.height,c.style.width=this.container.style.width,c.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",c.alt="[{{type}} Annotation]",c.dataset.l10nId="text_annotation_type",c.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.hasPopup||this._createPopup(c,this.data),this.container.appendChild(c),this.container}}class F extends q{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}_getKeyModifier(c){const{isWin:p,isMac:R}=q.platform;return p&&c.ctrlKey||R&&c.metaKey}_setEventListener(c,p,R,L){p.includes("mouse")?c.addEventListener(p,N=>{var z;(z=this.linkService.eventBus)==null||z.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:R,value:L(N),shift:N.shiftKey,modifier:this._getKeyModifier(N)}})}):c.addEventListener(p,N=>{var z;(z=this.linkService.eventBus)==null||z.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:R,value:L(N)}})})}_setEventListeners(c,p,R){var L;for(const[N,z]of p)(z==="Action"||(L=this.data.actions)!=null&&L[z])&&this._setEventListener(c,N,z,R)}_setBackgroundColor(c){const p=this.data.backgroundColor||null;c.style.backgroundColor=p===null?"transparent":n.Util.makeHexColor(p[0],p[1],p[2])}}class I extends F{constructor(c){const p=c.renderForms||!c.data.hasAppearance&&!!c.data.fieldValue;super(c,{isRenderable:p})}setPropertyOnSiblings(c,p,R,L){const N=this.annotationStorage;for(const z of this._getElementsByName(c.name,c.id))z.domElement&&(z.domElement[p]=R),N.setValue(z.id,{[L]:R})}render(){var L;const c=this.annotationStorage,p=this.data.id;this.container.className="textWidgetAnnotation";let R=null;if(this.renderForms){const N=c.getValue(p,{value:this.data.fieldValue}),z=N.formattedValue||N.value||"",X={userValue:null,formattedValue:null,valueOnFocus:""};this.data.multiLine?(R=document.createElement("textarea"),R.textContent=z):(R=document.createElement("input"),R.type="text",R.setAttribute("value",z)),d.add(R),R.disabled=this.data.readOnly,R.name=this.data.fieldName,R.tabIndex=f,X.userValue=z,R.setAttribute("id",p),R.addEventListener("input",J=>{c.setValue(p,{value:J.target.value}),this.setPropertyOnSiblings(R,"value",J.target.value,"value")}),R.addEventListener("resetform",J=>{const ie=this.data.defaultFieldValue??"";R.value=X.userValue=ie,X.formattedValue=null});let ee=J=>{const{formattedValue:ie}=X;ie!=null&&(J.target.value=ie),J.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){R.addEventListener("focus",ie=>{X.userValue&&(ie.target.value=X.userValue),X.valueOnFocus=ie.target.value}),R.addEventListener("updatefromsandbox",ie=>{const Z={value(ve){X.userValue=ve.detail.value??"",c.setValue(p,{value:X.userValue.toString()}),ve.target.value=X.userValue},formattedValue(ve){const{formattedValue:Me}=ve.detail;X.formattedValue=Me,Me!=null&&ve.target!==document.activeElement&&(ve.target.value=Me),c.setValue(p,{formattedValue:Me})},selRange(ve){ve.target.setSelectionRange(...ve.detail.selRange)}};this._dispatchEventFromSandbox(Z,ie)}),R.addEventListener("keydown",ie=>{var Me;let Z=-1;if(ie.key==="Escape"?Z=0:ie.key==="Enter"?Z=2:ie.key==="Tab"&&(Z=3),Z===-1)return;const{value:ve}=ie.target;X.valueOnFocus!==ve&&(X.userValue=ve,(Me=this.linkService.eventBus)==null||Me.dispatch("dispatcheventinsandbox",{source:this,detail:{id:p,name:"Keystroke",value:ve,willCommit:!0,commitKey:Z,selStart:ie.target.selectionStart,selEnd:ie.target.selectionEnd}}))});const J=ee;ee=null,R.addEventListener("blur",ie=>{var ve;const{value:Z}=ie.target;X.userValue=Z,this._mouseState.isDown&&X.valueOnFocus!==Z&&((ve=this.linkService.eventBus)==null||ve.dispatch("dispatcheventinsandbox",{source:this,detail:{id:p,name:"Keystroke",value:Z,willCommit:!0,commitKey:1,selStart:ie.target.selectionStart,selEnd:ie.target.selectionEnd}})),J(ie)}),(L=this.data.actions)!=null&&L.Keystroke&&R.addEventListener("beforeinput",ie=>{var $e;const{data:Z,target:ve}=ie,{value:Me,selectionStart:Ue,selectionEnd:Ne}=ve;let xe=Ue,qe=Ne;switch(ie.inputType){case"deleteWordBackward":{const ke=Me.substring(0,Ue).match(/\w*[^\w]*$/);ke&&(xe-=ke[0].length);break}case"deleteWordForward":{const ke=Me.substring(Ue).match(/^[^\w]*\w*/);ke&&(qe+=ke[0].length);break}case"deleteContentBackward":Ue===Ne&&(xe-=1);break;case"deleteContentForward":Ue===Ne&&(qe+=1);break}ie.preventDefault(),($e=this.linkService.eventBus)==null||$e.dispatch("dispatcheventinsandbox",{source:this,detail:{id:p,name:"Keystroke",value:Me,change:Z||"",willCommit:!1,selStart:xe,selEnd:qe}})}),this._setEventListeners(R,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],ie=>ie.target.value)}if(ee&&R.addEventListener("blur",ee),this.data.maxLen!==null&&(R.maxLength=this.data.maxLen),this.data.comb){const ie=(this.data.rect[2]-this.data.rect[0])/this.data.maxLen;R.classList.add("comb"),R.style.letterSpacing=`calc(${ie}px - 1ch)`}}else R=document.createElement("div"),R.textContent=this.data.fieldValue,R.style.verticalAlign="middle",R.style.display="table-cell";return this._setTextStyle(R),this._setBackgroundColor(R),this._setDefaultPropertiesFromJS(R),this.container.appendChild(R),this.container}_setTextStyle(c){const p=["left","center","right"],{fontSize:R,fontColor:L}=this.data.defaultAppearanceData,N=c.style;R&&(N.fontSize=`${R}px`),N.color=n.Util.makeHexColor(L[0],L[1],L[2]),this.data.textAlignment!==null&&(N.textAlign=p[this.data.textAlignment])}}class j extends F{constructor(c){super(c,{isRenderable:c.renderForms})}render(){const c=this.annotationStorage,p=this.data,R=p.id;let L=c.getValue(R,{value:p.exportValue===p.fieldValue}).value;typeof L=="string"&&(L=L!=="Off",c.setValue(R,{value:L})),this.container.className="buttonWidgetAnnotation checkBox";const N=document.createElement("input");return d.add(N),N.disabled=p.readOnly,N.type="checkbox",N.name=p.fieldName,L&&N.setAttribute("checked",!0),N.setAttribute("id",R),N.setAttribute("exportValue",p.exportValue),N.tabIndex=f,N.addEventListener("change",z=>{const{name:X,checked:ee}=z.target;for(const J of this._getElementsByName(X,R)){const ie=ee&&J.exportValue===p.exportValue;J.domElement&&(J.domElement.checked=ie),c.setValue(J.id,{value:ie})}c.setValue(R,{value:ee})}),N.addEventListener("resetform",z=>{const X=p.defaultFieldValue||"Off";z.target.checked=X===p.exportValue}),this.enableScripting&&this.hasJSActions&&(N.addEventListener("updatefromsandbox",z=>{const X={value(ee){ee.target.checked=ee.detail.value!=="Off",c.setValue(R,{value:ee.target.checked})}};this._dispatchEventFromSandbox(X,z)}),this._setEventListeners(N,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],z=>z.target.checked)),this._setBackgroundColor(N),this._setDefaultPropertiesFromJS(N),this.container.appendChild(N),this.container}}class G extends F{constructor(c){super(c,{isRenderable:c.renderForms})}render(){this.container.className="buttonWidgetAnnotation radioButton";const c=this.annotationStorage,p=this.data,R=p.id;let L=c.getValue(R,{value:p.fieldValue===p.buttonValue}).value;typeof L=="string"&&(L=L!==p.buttonValue,c.setValue(R,{value:L}));const N=document.createElement("input");if(d.add(N),N.disabled=p.readOnly,N.type="radio",N.name=p.fieldName,L&&N.setAttribute("checked",!0),N.setAttribute("id",R),N.tabIndex=f,N.addEventListener("change",z=>{const{name:X,checked:ee}=z.target;for(const J of this._getElementsByName(X,R))c.setValue(J.id,{value:!1});c.setValue(R,{value:ee})}),N.addEventListener("resetform",z=>{const X=p.defaultFieldValue;z.target.checked=X!=null&&X===p.buttonValue}),this.enableScripting&&this.hasJSActions){const z=p.buttonValue;N.addEventListener("updatefromsandbox",X=>{const ee={value:J=>{const ie=z===J.detail.value;for(const Z of this._getElementsByName(J.target.name)){const ve=ie&&Z.id===R;Z.domElement&&(Z.domElement.checked=ve),c.setValue(Z.id,{value:ve})}}};this._dispatchEventFromSandbox(ee,X)}),this._setEventListeners(N,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],X=>X.target.checked)}return this._setBackgroundColor(N),this._setDefaultPropertiesFromJS(N),this.container.appendChild(N),this.container}}class O extends V{constructor(c){super(c,{ignoreBorder:c.data.hasAppearance})}render(){const c=super.render();return c.className="buttonWidgetAnnotation pushButton",this.data.alternativeText&&(c.title=this.data.alternativeText),this._setDefaultPropertiesFromJS(c),c}}class H extends F{constructor(c){super(c,{isRenderable:c.renderForms})}render(){this.container.className="choiceWidgetAnnotation";const c=this.annotationStorage,p=this.data.id,R=c.getValue(p,{value:this.data.fieldValue});let{fontSize:L}=this.data.defaultAppearanceData;L||(L=9);const N=`calc(${L}px * var(--zoom-factor))`,z=document.createElement("select");d.add(z),z.disabled=this.data.readOnly,z.name=this.data.fieldName,z.setAttribute("id",p),z.tabIndex=f,z.style.fontSize=`${L}px`,this.data.combo||(z.size=this.data.options.length,this.data.multiSelect&&(z.multiple=!0)),z.addEventListener("resetform",J=>{const ie=this.data.defaultFieldValue;for(const Z of z.options)Z.selected=Z.value===ie});for(const J of this.data.options){const ie=document.createElement("option");ie.textContent=J.displayValue,ie.value=J.exportValue,this.data.combo&&(ie.style.fontSize=N),R.value.includes(J.exportValue)&&ie.setAttribute("selected",!0),z.appendChild(ie)}const X=(J,ie)=>{const Z=ie?"value":"textContent",ve=J.target.options;return J.target.multiple?Array.prototype.filter.call(ve,Me=>Me.selected).map(Me=>Me[Z]):ve.selectedIndex===-1?null:ve[ve.selectedIndex][Z]},ee=J=>{const ie=J.target.options;return Array.prototype.map.call(ie,Z=>({displayValue:Z.textContent,exportValue:Z.value}))};return this.enableScripting&&this.hasJSActions?(z.addEventListener("updatefromsandbox",J=>{const ie={value(Z){const ve=Z.detail.value,Me=new Set(Array.isArray(ve)?ve:[ve]);for(const Ue of z.options)Ue.selected=Me.has(Ue.value);c.setValue(p,{value:X(Z,!0)})},multipleSelection(Z){z.multiple=!0},remove(Z){const ve=z.options,Me=Z.detail.remove;ve[Me].selected=!1,z.remove(Me),ve.length>0&&Array.prototype.findIndex.call(ve,Ne=>Ne.selected)===-1&&(ve[0].selected=!0),c.setValue(p,{value:X(Z,!0),items:ee(Z)})},clear(Z){for(;z.length!==0;)z.remove(0);c.setValue(p,{value:null,items:[]})},insert(Z){const{index:ve,displayValue:Me,exportValue:Ue}=Z.detail.insert,Ne=document.createElement("option");Ne.textContent=Me,Ne.value=Ue,z.insertBefore(Ne,z.children[ve]),c.setValue(p,{value:X(Z,!0),items:ee(Z)})},items(Z){const{items:ve}=Z.detail;for(;z.length!==0;)z.remove(0);for(const Me of ve){const{displayValue:Ue,exportValue:Ne}=Me,xe=document.createElement("option");xe.textContent=Ue,xe.value=Ne,z.appendChild(xe)}z.options.length>0&&(z.options[0].selected=!0),c.setValue(p,{value:X(Z,!0),items:ee(Z)})},indices(Z){const ve=new Set(Z.detail.indices);for(const Me of Z.target.options)Me.selected=ve.has(Me.index);c.setValue(p,{value:X(Z,!0)})},editable(Z){Z.target.disabled=!Z.detail.editable}};this._dispatchEventFromSandbox(ie,J)}),z.addEventListener("input",J=>{var ve;const ie=X(J,!0),Z=X(J,!1);c.setValue(p,{value:ie}),(ve=this.linkService.eventBus)==null||ve.dispatch("dispatcheventinsandbox",{source:this,detail:{id:p,name:"Keystroke",value:Z,changeEx:ie,willCommit:!0,commitKey:1,keyDown:!1}})}),this._setEventListeners(z,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"]],J=>J.target.checked)):z.addEventListener("input",function(J){c.setValue(p,{value:X(J,!0)})}),this._setBackgroundColor(z),this._setDefaultPropertiesFromJS(z),this.container.appendChild(z),this.container}}class K extends q{constructor(c){var R,L,N;const p=!!((R=c.data.titleObj)!=null&&R.str||(L=c.data.contentsObj)!=null&&L.str||(N=c.data.richText)!=null&&N.str);super(c,{isRenderable:p})}render(){const c=["Line","Square","Circle","PolyLine","Polygon","Ink"];if(this.container.className="popupAnnotation",c.includes(this.data.parentType))return this.container;const p=`[data-annotation-id="${this.data.parentId}"]`,R=this.layer.querySelectorAll(p);if(R.length===0)return this.container;const L=new Y({container:this.container,trigger:Array.from(R),color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText}),N=this.page,z=n.Util.normalizeRect([this.data.parentRect[0],N.view[3]-this.data.parentRect[1]+N.view[1],this.data.parentRect[2],N.view[3]-this.data.parentRect[3]+N.view[1]]),X=z[0]+this.data.parentRect[2]-this.data.parentRect[0],ee=z[1];return this.container.style.transformOrigin=`${-X}px ${-ee}px`,this.container.style.left=`${X}px`,this.container.style.top=`${ee}px`,this.container.appendChild(L.render()),this.container}}class Y{constructor(c){this.container=c.container,this.trigger=c.trigger,this.color=c.color,this.titleObj=c.titleObj,this.modificationDate=c.modificationDate,this.contentsObj=c.contentsObj,this.richText=c.richText,this.hideWrapper=c.hideWrapper||!1,this.pinned=!1}render(){var X,ee;const p=document.createElement("div");p.className="popupWrapper",this.hideElement=this.hideWrapper?p:this.container,this.hideElement.hidden=!0;const R=document.createElement("div");R.className="popup";const L=this.color;if(L){const J=.7*(255-L[0])+L[0],ie=.7*(255-L[1])+L[1],Z=.7*(255-L[2])+L[2];R.style.backgroundColor=n.Util.makeHexColor(J|0,ie|0,Z|0)}const N=document.createElement("h1");N.dir=this.titleObj.dir,N.textContent=this.titleObj.str,R.appendChild(N);const z=s.PDFDateString.toDateObject(this.modificationDate);if(z){const J=document.createElement("span");J.className="popupDate",J.textContent="{{date}}, {{time}}",J.dataset.l10nId="annotation_date_string",J.dataset.l10nArgs=JSON.stringify({date:z.toLocaleDateString(),time:z.toLocaleTimeString()}),R.appendChild(J)}if((X=this.richText)!=null&&X.str&&(!((ee=this.contentsObj)!=null&&ee.str)||this.contentsObj.str===this.richText.str))l.XfaLayer.render({xfaHtml:this.richText.html,intent:"richText",div:R}),R.lastChild.className="richText popupContent";else{const J=this._formatContents(this.contentsObj);R.appendChild(J)}Array.isArray(this.trigger)||(this.trigger=[this.trigger]);for(const J of this.trigger)J.addEventListener("click",this._toggle.bind(this)),J.addEventListener("mouseover",this._show.bind(this,!1)),J.addEventListener("mouseout",this._hide.bind(this,!1));return R.addEventListener("click",this._hide.bind(this,!0)),p.appendChild(R),p}_formatContents({str:c,dir:p}){const R=document.createElement("p");R.className="popupContent",R.dir=p;const L=c.split(/(?:\r\n?|\n)/);for(let N=0,z=L.length;N<z;++N){const X=L[N];R.appendChild(document.createTextNode(X)),N<z-1&&R.appendChild(document.createElement("br"))}return R}_toggle(){this.pinned?this._hide(!0):this._show(!0)}_show(c=!1){c&&(this.pinned=!0),this.hideElement.hidden&&(this.hideElement.hidden=!1,this.container.style.zIndex+=1)}_hide(c=!0){c&&(this.pinned=!1),!this.hideElement.hidden&&!this.pinned&&(this.hideElement.hidden=!0,this.container.style.zIndex-=1)}}class U extends q{constructor(c){var R,L,N;const p=!!(c.data.hasPopup||(R=c.data.titleObj)!=null&&R.str||(L=c.data.contentsObj)!=null&&L.str||(N=c.data.richText)!=null&&N.str);super(c,{isRenderable:p,ignoreBorder:!0})}render(){return this.container.className="freeTextAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class h extends q{constructor(c){var R,L,N;const p=!!(c.data.hasPopup||(R=c.data.titleObj)!=null&&R.str||(L=c.data.contentsObj)!=null&&L.str||(N=c.data.richText)!=null&&N.str);super(c,{isRenderable:p,ignoreBorder:!0})}render(){this.container.className="lineAnnotation";const c=this.data,{width:p,height:R}=A(c.rect),L=this.svgFactory.create(p,R),N=this.svgFactory.createElement("svg:line");return N.setAttribute("x1",c.rect[2]-c.lineCoordinates[0]),N.setAttribute("y1",c.rect[3]-c.lineCoordinates[1]),N.setAttribute("x2",c.rect[2]-c.lineCoordinates[2]),N.setAttribute("y2",c.rect[3]-c.lineCoordinates[3]),N.setAttribute("stroke-width",c.borderStyle.width||1),N.setAttribute("stroke","transparent"),N.setAttribute("fill","transparent"),L.appendChild(N),this.container.append(L),this._createPopup(N,c),this.container}}class _ extends q{constructor(c){var R,L,N;const p=!!(c.data.hasPopup||(R=c.data.titleObj)!=null&&R.str||(L=c.data.contentsObj)!=null&&L.str||(N=c.data.richText)!=null&&N.str);super(c,{isRenderable:p,ignoreBorder:!0})}render(){this.container.className="squareAnnotation";const c=this.data,{width:p,height:R}=A(c.rect),L=this.svgFactory.create(p,R),N=c.borderStyle.width,z=this.svgFactory.createElement("svg:rect");return z.setAttribute("x",N/2),z.setAttribute("y",N/2),z.setAttribute("width",p-N),z.setAttribute("height",R-N),z.setAttribute("stroke-width",N||1),z.setAttribute("stroke","transparent"),z.setAttribute("fill","transparent"),L.appendChild(z),this.container.append(L),this._createPopup(z,c),this.container}}class E extends q{constructor(c){var R,L,N;const p=!!(c.data.hasPopup||(R=c.data.titleObj)!=null&&R.str||(L=c.data.contentsObj)!=null&&L.str||(N=c.data.richText)!=null&&N.str);super(c,{isRenderable:p,ignoreBorder:!0})}render(){this.container.className="circleAnnotation";const c=this.data,{width:p,height:R}=A(c.rect),L=this.svgFactory.create(p,R),N=c.borderStyle.width,z=this.svgFactory.createElement("svg:ellipse");return z.setAttribute("cx",p/2),z.setAttribute("cy",R/2),z.setAttribute("rx",p/2-N/2),z.setAttribute("ry",R/2-N/2),z.setAttribute("stroke-width",N||1),z.setAttribute("stroke","transparent"),z.setAttribute("fill","transparent"),L.appendChild(z),this.container.append(L),this._createPopup(z,c),this.container}}class x extends q{constructor(c){var R,L,N;const p=!!(c.data.hasPopup||(R=c.data.titleObj)!=null&&R.str||(L=c.data.contentsObj)!=null&&L.str||(N=c.data.richText)!=null&&N.str);super(c,{isRenderable:p,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;const c=this.data,{width:p,height:R}=A(c.rect),L=this.svgFactory.create(p,R);let N=[];for(const X of c.vertices){const ee=X.x-c.rect[0],J=c.rect[3]-X.y;N.push(ee+","+J)}N=N.join(" ");const z=this.svgFactory.createElement(this.svgElementName);return z.setAttribute("points",N),z.setAttribute("stroke-width",c.borderStyle.width||1),z.setAttribute("stroke","transparent"),z.setAttribute("fill","transparent"),L.appendChild(z),this.container.append(L),this._createPopup(z,c),this.container}}class P extends x{constructor(c){super(c),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class k extends q{constructor(c){var R,L,N;const p=!!(c.data.hasPopup||(R=c.data.titleObj)!=null&&R.str||(L=c.data.contentsObj)!=null&&L.str||(N=c.data.richText)!=null&&N.str);super(c,{isRenderable:p,ignoreBorder:!0})}render(){return this.container.className="caretAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class Q extends q{constructor(c){var R,L,N;const p=!!(c.data.hasPopup||(R=c.data.titleObj)!=null&&R.str||(L=c.data.contentsObj)!=null&&L.str||(N=c.data.richText)!=null&&N.str);super(c,{isRenderable:p,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;const c=this.data,{width:p,height:R}=A(c.rect),L=this.svgFactory.create(p,R);for(const N of c.inkLists){let z=[];for(const ee of N){const J=ee.x-c.rect[0],ie=c.rect[3]-ee.y;z.push(`${J},${ie}`)}z=z.join(" ");const X=this.svgFactory.createElement(this.svgElementName);X.setAttribute("points",z),X.setAttribute("stroke-width",c.borderStyle.width||1),X.setAttribute("stroke","transparent"),X.setAttribute("fill","transparent"),this._createPopup(X,c),L.appendChild(X)}return this.container.append(L),this.container}}class Ce extends q{constructor(c){var R,L,N;const p=!!(c.data.hasPopup||(R=c.data.titleObj)!=null&&R.str||(L=c.data.contentsObj)!=null&&L.str||(N=c.data.richText)!=null&&N.str);super(c,{isRenderable:p,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("highlightAnnotation"):(this.container.className="highlightAnnotation",this.container)}}class Oe extends q{constructor(c){var R,L,N;const p=!!(c.data.hasPopup||(R=c.data.titleObj)!=null&&R.str||(L=c.data.contentsObj)!=null&&L.str||(N=c.data.richText)!=null&&N.str);super(c,{isRenderable:p,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("underlineAnnotation"):(this.container.className="underlineAnnotation",this.container)}}class Se extends q{constructor(c){var R,L,N;const p=!!(c.data.hasPopup||(R=c.data.titleObj)!=null&&R.str||(L=c.data.contentsObj)!=null&&L.str||(N=c.data.richText)!=null&&N.str);super(c,{isRenderable:p,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("squigglyAnnotation"):(this.container.className="squigglyAnnotation",this.container)}}class Fe extends q{constructor(c){var R,L,N;const p=!!(c.data.hasPopup||(R=c.data.titleObj)!=null&&R.str||(L=c.data.contentsObj)!=null&&L.str||(N=c.data.richText)!=null&&N.str);super(c,{isRenderable:p,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("strikeoutAnnotation"):(this.container.className="strikeoutAnnotation",this.container)}}class Ve extends q{constructor(c){var R,L,N;const p=!!(c.data.hasPopup||(R=c.data.titleObj)!=null&&R.str||(L=c.data.contentsObj)!=null&&L.str||(N=c.data.richText)!=null&&N.str);super(c,{isRenderable:p,ignoreBorder:!0})}render(){return this.container.className="stampAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class Le extends q{constructor(c){var L;super(c,{isRenderable:!0});const{filename:p,content:R}=this.data.file;this.filename=(0,s.getFilenameFromUrl)(p),this.content=R,(L=this.linkService.eventBus)==null||L.dispatch("fileattachmentannotation",{source:this,filename:p,content:R})}render(){var p,R;this.container.className="fileAttachmentAnnotation";const c=document.createElement("div");return c.style.height=this.container.style.height,c.style.width=this.container.style.width,c.addEventListener("dblclick",this._download.bind(this)),!this.data.hasPopup&&((p=this.data.titleObj)!=null&&p.str||(R=this.data.contentsObj)!=null&&R.str||this.data.richText)&&this._createPopup(c,this.data),this.container.appendChild(c),this.container}_download(){var c;(c=this.downloadManager)==null||c.openOrDownloadData(this.container,this.content,this.filename)}}class W{static render(c){const p=[],R=[];for(const N of c.annotations){if(!N)continue;const{width:z,height:X}=A(N.rect);if(!(z<=0||X<=0)){if(N.annotationType===n.AnnotationType.POPUP){R.push(N);continue}p.push(N)}}R.length&&p.push(...R);const L=c.div;for(const N of p){const z=M.create({data:N,layer:L,page:c.page,viewport:c.viewport,linkService:c.linkService,downloadManager:c.downloadManager,imageResourcesPath:c.imageResourcesPath||"",renderForms:c.renderForms!==!1,svgFactory:new s.DOMSVGFactory,annotationStorage:c.annotationStorage||new o.AnnotationStorage,enableScripting:c.enableScripting,hasJSActions:c.hasJSActions,fieldObjects:c.fieldObjects,mouseState:c.mouseState||{isDown:!1}});if(z.isRenderable){const X=z.render();if(N.hidden&&(X.style.visibility="hidden"),Array.isArray(X))for(const ee of X)L.appendChild(ee);else z instanceof K?L.prepend(X):L.appendChild(X)}}Yt(this,T,Sn).call(this,L,c.annotationCanvasMap)}static update(c){const{page:p,viewport:R,annotations:L,annotationCanvasMap:N,div:z}=c,X=R.transform,ee=`matrix(${X.join(",")})`;let J,ie;for(const Z of L){const ve=z.querySelectorAll(`[data-annotation-id="${Z.id}"]`);if(ve)for(const Me of ve)if(Z.hasOwnCanvas){const Ue=n.Util.normalizeRect([Z.rect[0],p.view[3]-Z.rect[1]+p.view[1],Z.rect[2],p.view[3]-Z.rect[3]+p.view[1]]);if(!ie){J=Math.abs(X[0]||X[1]);const qe=X.slice();for(let $e=0;$e<4;$e++)qe[$e]=Math.sign(qe[$e]);ie=`matrix(${qe.join(",")})`}const Ne=Ue[0]*J,xe=Ue[1]*J;Me.style.left=`${Ne}px`,Me.style.top=`${xe}px`,Me.style.transformOrigin=`${-Ne}px ${-xe}px`,Me.style.transform=ie}else Me.style.transform=ee}Yt(this,T,Sn).call(this,z,N),z.hidden=!1}}T=new WeakSet,Sn=function(c,p){if(p){for(const[R,L]of p){const N=c.querySelector(`[data-annotation-id="${R}"]`);if(!N)continue;const{firstChild:z}=N;z.nodeName==="CANVAS"?N.replaceChild(L,z):N.insertBefore(L,z)}p.clear()}},gt(W,T),e.AnnotationLayer=W},(r,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ColorConverters=void 0;function t(s){return Math.floor(Math.max(0,Math.min(1,s))*255).toString(16).padStart(2,"0")}class n{static CMYK_G([o,a,l,f]){return["G",1-Math.min(1,.3*o+.59*l+.11*a+f)]}static G_CMYK([o]){return["CMYK",0,0,0,1-o]}static G_RGB([o]){return["RGB",o,o,o]}static G_HTML([o]){const a=t(o);return`#${a}${a}${a}`}static RGB_G([o,a,l]){return["G",.3*o+.59*a+.11*l]}static RGB_HTML([o,a,l]){const f=t(o),d=t(a),A=t(l);return`#${f}${d}${A}`}static T_HTML(){return"#00000000"}static CMYK_RGB([o,a,l,f]){return["RGB",1-Math.min(1,o+f),1-Math.min(1,l+f),1-Math.min(1,a+f)]}static CMYK_HTML(o){return this.RGB_HTML(this.CMYK_RGB(o))}static RGB_CMYK([o,a,l]){const f=1-o,d=1-a,A=1-l,M=Math.min(f,d,A);return["CMYK",f,d,A,M]}}e.ColorConverters=n},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaLayer=void 0;var n=t(18);class s{static setupStorage(a,l,f,d,A){const M=d.getValue(l,{value:null});switch(f.name){case"textarea":if(M.value!==null&&(a.textContent=M.value),A==="print")break;a.addEventListener("input",q=>{d.setValue(l,{value:q.target.value})});break;case"input":if(f.attributes.type==="radio"||f.attributes.type==="checkbox"){if(M.value===f.attributes.xfaOn?a.setAttribute("checked",!0):M.value===f.attributes.xfaOff&&a.removeAttribute("checked"),A==="print")break;a.addEventListener("change",q=>{d.setValue(l,{value:q.target.checked?q.target.getAttribute("xfaOn"):q.target.getAttribute("xfaOff")})})}else{if(M.value!==null&&a.setAttribute("value",M.value),A==="print")break;a.addEventListener("input",q=>{d.setValue(l,{value:q.target.value})})}break;case"select":if(M.value!==null)for(const q of f.children)q.attributes.value===M.value&&(q.attributes.selected=!0);a.addEventListener("input",q=>{const V=q.target.options,g=V.selectedIndex===-1?"":V[V.selectedIndex].value;d.setValue(l,{value:g})});break}}static setAttributes({html:a,element:l,storage:f=null,intent:d,linkService:A}){const{attributes:M}=l,q=a instanceof HTMLAnchorElement;M.type==="radio"&&(M.name=`${M.name}-${d}`);for(const[V,g]of Object.entries(M))if(!(g==null||V==="dataId"))if(V!=="style")if(V==="textContent")a.textContent=g;else if(V==="class")g.length&&a.setAttribute(V,g.join(" "));else{if(q&&(V==="href"||V==="newWindow"))continue;a.setAttribute(V,g)}else Object.assign(a.style,g);q&&A.addLinkAttributes(a,M.href,M.newWindow),f&&M.dataId&&this.setupStorage(a,M.dataId,l,f)}static render(a){var F;const l=a.annotationStorage,f=a.linkService,d=a.xfaHtml,A=a.intent||"display",M=document.createElement(d.name);d.attributes&&this.setAttributes({html:M,element:d,intent:A,linkService:f});const q=[[d,-1,M]],V=a.div;if(V.appendChild(M),a.viewport){const I=`matrix(${a.viewport.transform.join(",")})`;V.style.transform=I}A!=="richText"&&V.setAttribute("class","xfaLayer xfaFont");const g=[];for(;q.length>0;){const[I,j,G]=q[q.length-1];if(j+1===I.children.length){q.pop();continue}const O=I.children[++q[q.length-1][1]];if(O===null)continue;const{name:H}=O;if(H==="#text"){const Y=document.createTextNode(O.value);g.push(Y),G.appendChild(Y);continue}let K;if((F=O==null?void 0:O.attributes)!=null&&F.xmlns?K=document.createElementNS(O.attributes.xmlns,H):K=document.createElement(H),G.appendChild(K),O.attributes&&this.setAttributes({html:K,element:O,storage:l,intent:A,linkService:f}),O.children&&O.children.length>0)q.push([O,-1,K]);else if(O.value){const Y=document.createTextNode(O.value);n.XfaText.shouldBuildText(H)&&g.push(Y),K.appendChild(Y)}}for(const I of V.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))I.setAttribute("readOnly",!0);return{textDivs:g}}static update(a){const l=`matrix(${a.viewport.transform.join(",")})`;a.div.style.transform=l,a.div.hidden=!1}}e.XfaLayer=s},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.renderTextLayer=j;var n=t(1);const s=1e5,o=30,a=.8,l=new Map,f=/^\s+$/g;function d(G,O){const H=l.get(G);if(H)return H;O.save(),O.font=`${o}px ${G}`;const K=O.measureText("");let Y=K.fontBoundingBoxAscent,U=Math.abs(K.fontBoundingBoxDescent);if(Y){O.restore();const _=Y/(Y+U);return l.set(G,_),_}O.strokeStyle="red",O.clearRect(0,0,o,o),O.strokeText("g",0,0);let h=O.getImageData(0,0,o,o).data;U=0;for(let _=h.length-1-3;_>=0;_-=4)if(h[_]>0){U=Math.ceil(_/4/o);break}O.clearRect(0,0,o,o),O.strokeText("A",0,o),h=O.getImageData(0,0,o,o).data,Y=0;for(let _=0,E=h.length;_<E;_+=4)if(h[_]>0){Y=o-Math.floor(_/4/o);break}if(O.restore(),Y){const _=Y/(Y+U);return l.set(G,_),_}return l.set(G,a),a}function A(G,O,H,K){const Y=document.createElement("span"),U=G._enhanceTextSelection?{angle:0,canvasWidth:0,hasText:O.str!=="",hasEOL:O.hasEOL,originalTransform:null,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,scale:1}:{angle:0,canvasWidth:0,hasText:O.str!=="",hasEOL:O.hasEOL};G._textDivs.push(Y);const h=n.Util.transform(G._viewport.transform,O.transform);let _=Math.atan2(h[1],h[0]);const E=H[O.fontName];E.vertical&&(_+=Math.PI/2);const x=Math.hypot(h[2],h[3]),P=x*d(E.fontFamily,K);let k,Q;_===0?(k=h[4],Q=h[5]-P):(k=h[4]+P*Math.sin(_),Q=h[5]-P*Math.cos(_)),Y.style.left=`${k}px`,Y.style.top=`${Q}px`,Y.style.fontSize=`${x}px`,Y.style.fontFamily=E.fontFamily,Y.setAttribute("role","presentation"),Y.textContent=O.str,Y.dir=O.dir,G._fontInspectorEnabled&&(Y.dataset.fontName=O.fontName),_!==0&&(U.angle=_*(180/Math.PI));let Ce=!1;if(O.str.length>1||G._enhanceTextSelection&&f.test(O.str))Ce=!0;else if(O.str!==" "&&O.transform[0]!==O.transform[3]){const Oe=Math.abs(O.transform[0]),Se=Math.abs(O.transform[3]);Oe!==Se&&Math.max(Oe,Se)/Math.min(Oe,Se)>1.5&&(Ce=!0)}if(Ce&&(E.vertical?U.canvasWidth=O.height*G._viewport.scale:U.canvasWidth=O.width*G._viewport.scale),G._textDivProperties.set(Y,U),G._textContentStream&&G._layoutText(Y),G._enhanceTextSelection&&U.hasText){let Oe=1,Se=0;_!==0&&(Oe=Math.cos(_),Se=Math.sin(_));const Fe=(E.vertical?O.height:O.width)*G._viewport.scale,Ve=x;let Le,W;_!==0?(Le=[Oe,Se,-Se,Oe,k,Q],W=n.Util.getAxialAlignedBoundingBox([0,0,Fe,Ve],Le)):W=[k,Q,k+Fe,Q+Ve],G._bounds.push({left:W[0],top:W[1],right:W[2],bottom:W[3],div:Y,size:[Fe,Ve],m:Le})}}function M(G){if(G._canceled)return;const O=G._textDivs,H=G._capability,K=O.length;if(K>s){G._renderingDone=!0,H.resolve();return}if(!G._textContentStream)for(let Y=0;Y<K;Y++)G._layoutText(O[Y]);G._renderingDone=!0,H.resolve()}function q(G,O,H){let K=0;for(let Y=0;Y<H;Y++){const U=G[O++];U>0&&(K=K?Math.min(U,K):U)}return K}function V(G){const O=G._bounds,H=G._viewport,K=g(H.width,H.height,O);for(let Y=0;Y<K.length;Y++){const U=O[Y].div,h=G._textDivProperties.get(U);if(h.angle===0){h.paddingLeft=O[Y].left-K[Y].left,h.paddingTop=O[Y].top-K[Y].top,h.paddingRight=K[Y].right-O[Y].right,h.paddingBottom=K[Y].bottom-O[Y].bottom,G._textDivProperties.set(U,h);continue}const _=K[Y],E=O[Y],x=E.m,P=x[0],k=x[1],Q=[[0,0],[0,E.size[1]],[E.size[0],0],E.size],Ce=new Float64Array(64);for(let Se=0,Fe=Q.length;Se<Fe;Se++){const Ve=n.Util.applyTransform(Q[Se],x);Ce[Se+0]=P&&(_.left-Ve[0])/P,Ce[Se+4]=k&&(_.top-Ve[1])/k,Ce[Se+8]=P&&(_.right-Ve[0])/P,Ce[Se+12]=k&&(_.bottom-Ve[1])/k,Ce[Se+16]=k&&(_.left-Ve[0])/-k,Ce[Se+20]=P&&(_.top-Ve[1])/P,Ce[Se+24]=k&&(_.right-Ve[0])/-k,Ce[Se+28]=P&&(_.bottom-Ve[1])/P,Ce[Se+32]=P&&(_.left-Ve[0])/-P,Ce[Se+36]=k&&(_.top-Ve[1])/-k,Ce[Se+40]=P&&(_.right-Ve[0])/-P,Ce[Se+44]=k&&(_.bottom-Ve[1])/-k,Ce[Se+48]=k&&(_.left-Ve[0])/k,Ce[Se+52]=P&&(_.top-Ve[1])/-P,Ce[Se+56]=k&&(_.right-Ve[0])/k,Ce[Se+60]=P&&(_.bottom-Ve[1])/-P}const Oe=1+Math.min(Math.abs(P),Math.abs(k));h.paddingLeft=q(Ce,32,16)/Oe,h.paddingTop=q(Ce,48,16)/Oe,h.paddingRight=q(Ce,0,16)/Oe,h.paddingBottom=q(Ce,16,16)/Oe,G._textDivProperties.set(U,h)}}function g(G,O,H){const K=H.map(function(U,h){return{x1:U.left,y1:U.top,x2:U.right,y2:U.bottom,index:h,x1New:void 0,x2New:void 0}});F(G,K);const Y=new Array(H.length);for(const U of K){const h=U.index;Y[h]={left:U.x1New,top:0,right:U.x2New,bottom:0}}H.map(function(U,h){const _=Y[h],E=K[h];E.x1=U.top,E.y1=G-_.right,E.x2=U.bottom,E.y2=G-_.left,E.index=h,E.x1New=void 0,E.x2New=void 0}),F(O,K);for(const U of K){const h=U.index;Y[h].top=U.x1New,Y[h].bottom=U.x2New}return Y}function F(G,O){O.sort(function(Y,U){return Y.x1-U.x1||Y.index-U.index});const K=[{start:-1/0,end:1/0,boundary:{x1:-1/0,y1:-1/0,x2:0,y2:1/0,index:-1,x1New:0,x2New:0}}];for(const Y of O){let U=0;for(;U<K.length&&K[U].end<=Y.y1;)U++;let h=K.length-1;for(;h>=0&&K[h].start>=Y.y2;)h--;let _,E,x,P,k=-1/0;for(x=U;x<=h;x++){_=K[x],E=_.boundary;let Oe;E.x2>Y.x1?Oe=E.index>Y.index?E.x1New:Y.x1:E.x2New===void 0?Oe=(E.x2+Y.x1)/2:Oe=E.x2New,Oe>k&&(k=Oe)}for(Y.x1New=k,x=U;x<=h;x++)_=K[x],E=_.boundary,E.x2New===void 0?E.x2>Y.x1?E.index>Y.index&&(E.x2New=E.x2):E.x2New=k:E.x2New>k&&(E.x2New=Math.max(k,E.x2));const Q=[];let Ce=null;for(x=U;x<=h;x++){_=K[x],E=_.boundary;const Oe=E.x2>Y.x2?E:Y;Ce===Oe?Q[Q.length-1].end=_.end:(Q.push({start:_.start,end:_.end,boundary:Oe}),Ce=Oe)}for(K[U].start<Y.y1&&(Q[0].start=Y.y1,Q.unshift({start:K[U].start,end:Y.y1,boundary:K[U].boundary})),Y.y2<K[h].end&&(Q[Q.length-1].end=Y.y2,Q.push({start:Y.y2,end:K[h].end,boundary:K[h].boundary})),x=U;x<=h;x++){if(_=K[x],E=_.boundary,E.x2New!==void 0)continue;let Oe=!1;for(P=U-1;!Oe&&P>=0&&K[P].start>=E.y1;P--)Oe=K[P].boundary===E;for(P=h+1;!Oe&&P<K.length&&K[P].end<=E.y2;P++)Oe=K[P].boundary===E;for(P=0;!Oe&&P<Q.length;P++)Oe=Q[P].boundary===E;Oe||(E.x2New=k)}Array.prototype.splice.apply(K,[U,h-U+1].concat(Q))}for(const Y of K){const U=Y.boundary;U.x2New===void 0&&(U.x2New=Math.max(G,U.x2))}}class I{constructor({textContent:O,textContentStream:H,container:K,viewport:Y,textDivs:U,textContentItemsStr:h,enhanceTextSelection:_}){var E;this._textContent=O,this._textContentStream=H,this._container=K,this._document=K.ownerDocument,this._viewport=Y,this._textDivs=U||[],this._textContentItemsStr=h||[],this._enhanceTextSelection=!!_,this._fontInspectorEnabled=!!((E=globalThis.FontInspector)!=null&&E.enabled),this._reader=null,this._layoutTextLastFontSize=null,this._layoutTextLastFontFamily=null,this._layoutTextCtx=null,this._textDivProperties=new WeakMap,this._renderingDone=!1,this._canceled=!1,this._capability=(0,n.createPromiseCapability)(),this._renderTimer=null,this._bounds=[],this._capability.promise.finally(()=>{this._enhanceTextSelection||(this._textDivProperties=null),this._layoutTextCtx&&(this._layoutTextCtx.canvas.width=0,this._layoutTextCtx.canvas.height=0,this._layoutTextCtx=null)}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new n.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._renderTimer!==null&&(clearTimeout(this._renderTimer),this._renderTimer=null),this._capability.reject(new Error("TextLayer task cancelled."))}_processItems(O,H){for(let K=0,Y=O.length;K<Y;K++){if(O[K].str===void 0){if(O[K].type==="beginMarkedContentProps"||O[K].type==="beginMarkedContent"){const U=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),O[K].id!==null&&this._container.setAttribute("id",`${O[K].id}`),U.appendChild(this._container)}else O[K].type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(O[K].str),A(this,O[K],H,this._layoutTextCtx)}}_layoutText(O){const H=this._textDivProperties.get(O);let K="";if(H.canvasWidth!==0&&H.hasText){const{fontSize:Y,fontFamily:U}=O.style;(Y!==this._layoutTextLastFontSize||U!==this._layoutTextLastFontFamily)&&(this._layoutTextCtx.font=`${Y} ${U}`,this._layoutTextLastFontSize=Y,this._layoutTextLastFontFamily=U);const{width:h}=this._layoutTextCtx.measureText(O.textContent);if(h>0){const _=H.canvasWidth/h;this._enhanceTextSelection&&(H.scale=_),K=`scaleX(${_})`}}if(H.angle!==0&&(K=`rotate(${H.angle}deg) ${K}`),K.length>0&&(this._enhanceTextSelection&&(H.originalTransform=K),O.style.transform=K),H.hasText&&this._container.appendChild(O),H.hasEOL){const Y=document.createElement("br");Y.setAttribute("role","presentation"),this._container.appendChild(Y)}}_render(O=0){const H=(0,n.createPromiseCapability)();let K=Object.create(null);const Y=this._document.createElement("canvas");if(Y.height=Y.width=o,this._layoutTextCtx=Y.getContext("2d",{alpha:!1}),this._textContent){const U=this._textContent.items,h=this._textContent.styles;this._processItems(U,h),H.resolve()}else if(this._textContentStream){const U=()=>{this._reader.read().then(({value:h,done:_})=>{if(_){H.resolve();return}Object.assign(K,h.styles),this._processItems(h.items,K),U()},H.reject)};this._reader=this._textContentStream.getReader(),U()}else throw new Error('Neither "textContent" nor "textContentStream" parameters specified.');H.promise.then(()=>{K=null,O?this._renderTimer=setTimeout(()=>{M(this),this._renderTimer=null},O):M(this)},this._capability.reject)}expandTextDivs(O=!1){if(!this._enhanceTextSelection||!this._renderingDone)return;this._bounds!==null&&(V(this),this._bounds=null);const H=[],K=[];for(let Y=0,U=this._textDivs.length;Y<U;Y++){const h=this._textDivs[Y],_=this._textDivProperties.get(h);_.hasText&&(O?(H.length=0,K.length=0,_.originalTransform&&H.push(_.originalTransform),_.paddingTop>0?(K.push(`${_.paddingTop}px`),H.push(`translateY(${-_.paddingTop}px)`)):K.push(0),_.paddingRight>0?K.push(`${_.paddingRight/_.scale}px`):K.push(0),_.paddingBottom>0?K.push(`${_.paddingBottom}px`):K.push(0),_.paddingLeft>0?(K.push(`${_.paddingLeft/_.scale}px`),H.push(`translateX(${-_.paddingLeft/_.scale}px)`)):K.push(0),h.style.padding=K.join(" "),H.length&&(h.style.transform=H.join(" "))):(h.style.padding=null,h.style.transform=_.originalTransform))}}}function j(G){const O=new I({textContent:G.textContent,textContentStream:G.textContentStream,container:G.container,viewport:G.viewport,textDivs:G.textDivs,textContentItemsStr:G.textContentItemsStr,enhanceTextSelection:G.enhanceTextSelection});return O._render(G.timeout),O}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SVGGraphics=void 0;var n=t(1),s=t(5),o=t(3);let a=class{constructor(){(0,n.unreachable)("Not implemented: SVGGraphics")}};e.SVGGraphics=a;{let G=function(h){let _=[];const E=[];for(const x of h){if(x.fn==="save"){_.push({fnId:92,fn:"group",items:[]}),E.push(_),_=_[_.length-1].items;continue}x.fn==="restore"?_=E.pop():_.push(x)}return _},O=function(h){if(Number.isInteger(h))return h.toString();const _=h.toFixed(10);let E=_.length-1;if(_[E]!=="0")return _;do E--;while(_[E]==="0");return _.substring(0,_[E]==="."?E:E+1)},H=function(h){if(h[4]===0&&h[5]===0){if(h[1]===0&&h[2]===0)return h[0]===1&&h[3]===1?"":`scale(${O(h[0])} ${O(h[3])})`;if(h[0]===h[3]&&h[1]===-h[2]){const _=Math.acos(h[0])*180/Math.PI;return`rotate(${O(_)})`}}else if(h[0]===1&&h[1]===0&&h[2]===0&&h[3]===1)return`translate(${O(h[4])} ${O(h[5])})`;return`matrix(${O(h[0])} ${O(h[1])} ${O(h[2])} ${O(h[3])} ${O(h[4])} ${O(h[5])})`};var l=G,f=O,d=H;const A={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},M="http://www.w3.org/XML/1998/namespace",q="http://www.w3.org/1999/xlink",V=["butt","round","square"],g=["miter","round","bevel"],F=function(h,_="",E=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!E)return URL.createObjectURL(new Blob([h],{type:_}));const x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let P=`data:${_};base64,`;for(let k=0,Q=h.length;k<Q;k+=3){const Ce=h[k]&255,Oe=h[k+1]&255,Se=h[k+2]&255,Fe=Ce>>2,Ve=(Ce&3)<<4|Oe>>4,Le=k+1<Q?(Oe&15)<<2|Se>>6:64,W=k+2<Q?Se&63:64;P+=x[Fe]+x[Ve]+x[Le]+x[W]}return P},I=function(){const h=new Uint8Array([137,80,78,71,13,10,26,10]),_=12,E=new Int32Array(256);for(let Se=0;Se<256;Se++){let Fe=Se;for(let Ve=0;Ve<8;Ve++)Fe&1?Fe=3988292384^Fe>>1&2147483647:Fe=Fe>>1&2147483647;E[Se]=Fe}function x(Se,Fe,Ve){let Le=-1;for(let W=Fe;W<Ve;W++){const T=(Le^Se[W])&255,m=E[T];Le=Le>>>8^m}return Le^-1}function P(Se,Fe,Ve,Le){let W=Le;const T=Fe.length;Ve[W]=T>>24&255,Ve[W+1]=T>>16&255,Ve[W+2]=T>>8&255,Ve[W+3]=T&255,W+=4,Ve[W]=Se.charCodeAt(0)&255,Ve[W+1]=Se.charCodeAt(1)&255,Ve[W+2]=Se.charCodeAt(2)&255,Ve[W+3]=Se.charCodeAt(3)&255,W+=4,Ve.set(Fe,W),W+=Fe.length;const m=x(Ve,Le+4,W);Ve[W]=m>>24&255,Ve[W+1]=m>>16&255,Ve[W+2]=m>>8&255,Ve[W+3]=m&255}function k(Se,Fe,Ve){let Le=1,W=0;for(let T=Fe;T<Ve;++T)Le=(Le+(Se[T]&255))%65521,W=(W+Le)%65521;return W<<16|Le}function Q(Se){if(!o.isNodeJS)return Ce(Se);try{let Fe;parseInt(process.versions.node)>=8?Fe=Se:Fe=Buffer.from(Se);const Ve=require$$5.deflateSync(Fe,{level:9});return Ve instanceof Uint8Array?Ve:new Uint8Array(Ve)}catch(Fe){(0,n.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+Fe)}return Ce(Se)}function Ce(Se){let Fe=Se.length;const Ve=65535,Le=Math.ceil(Fe/Ve),W=new Uint8Array(2+Fe+Le*5+4);let T=0;W[T++]=120,W[T++]=156;let m=0;for(;Fe>Ve;)W[T++]=0,W[T++]=255,W[T++]=255,W[T++]=0,W[T++]=0,W.set(Se.subarray(m,m+Ve),T),T+=Ve,m+=Ve,Fe-=Ve;W[T++]=1,W[T++]=Fe&255,W[T++]=Fe>>8&255,W[T++]=~Fe&65535&255,W[T++]=(~Fe&65535)>>8&255,W.set(Se.subarray(m),T),T+=Se.length-m;const B=k(Se,0,Se.length);return W[T++]=B>>24&255,W[T++]=B>>16&255,W[T++]=B>>8&255,W[T++]=B&255,W}function Oe(Se,Fe,Ve,Le){const W=Se.width,T=Se.height;let m,B,c;const p=Se.data;switch(Fe){case n.ImageKind.GRAYSCALE_1BPP:B=0,m=1,c=W+7>>3;break;case n.ImageKind.RGB_24BPP:B=2,m=8,c=W*3;break;case n.ImageKind.RGBA_32BPP:B=6,m=8,c=W*4;break;default:throw new Error("invalid format")}const R=new Uint8Array((1+c)*T);let L=0,N=0;for(let Z=0;Z<T;++Z)R[L++]=0,R.set(p.subarray(N,N+c),L),N+=c,L+=c;if(Fe===n.ImageKind.GRAYSCALE_1BPP&&Le){L=0;for(let Z=0;Z<T;Z++){L++;for(let ve=0;ve<c;ve++)R[L++]^=255}}const z=new Uint8Array([W>>24&255,W>>16&255,W>>8&255,W&255,T>>24&255,T>>16&255,T>>8&255,T&255,m,B,0,0,0]),X=Q(R),ee=h.length+_*3+z.length+X.length,J=new Uint8Array(ee);let ie=0;return J.set(h,ie),ie+=h.length,P("IHDR",z,J,ie),ie+=_+z.length,P("IDATA",X,J,ie),ie+=_+X.length,P("IEND",new Uint8Array(0),J,ie),F(J,"image/png",Ve)}return function(Fe,Ve,Le){const W=Fe.kind===void 0?n.ImageKind.GRAYSCALE_1BPP:Fe.kind;return Oe(Fe,W,Ve,Le)}}();class j{constructor(){this.fontSizeScale=1,this.fontWeight=A.fontWeight,this.fontSize=0,this.textMatrix=n.IDENTITY_MATRIX,this.fontMatrix=n.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=n.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=A.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(_,E){this.x=_,this.y=E}}let K=0,Y=0,U=0;e.SVGGraphics=a=class{constructor(h,_,E=!1){this.svgFactory=new s.DOMSVGFactory,this.current=new j,this.transformMatrix=n.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=h,this.objs=_,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!E,this._operatorIdMapping=[];for(const x in n.OPS)this._operatorIdMapping[n.OPS[x]]=x}save(){this.transformStack.push(this.transformMatrix);const h=this.current;this.extraStack.push(h),this.current=h.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(h){this.save(),this.executeOpTree(h),this.restore()}loadDependencies(h){const _=h.fnArray,E=h.argsArray;for(let x=0,P=_.length;x<P;x++)if(_[x]===n.OPS.dependency)for(const k of E[x]){const Q=k.startsWith("g_")?this.commonObjs:this.objs,Ce=new Promise(Oe=>{Q.get(k,Oe)});this.current.dependencies.push(Ce)}return Promise.all(this.current.dependencies)}transform(h,_,E,x,P,k){const Q=[h,_,E,x,P,k];this.transformMatrix=n.Util.transform(this.transformMatrix,Q),this.tgrp=null}getSVG(h,_){this.viewport=_;const E=this._initialize(_);return this.loadDependencies(h).then(()=>(this.transformMatrix=n.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(h)),E))}convertOpList(h){const _=this._operatorIdMapping,E=h.argsArray,x=h.fnArray,P=[];for(let k=0,Q=x.length;k<Q;k++){const Ce=x[k];P.push({fnId:Ce,fn:_[Ce],args:E[k]})}return G(P)}executeOpTree(h){for(const _ of h){const E=_.fn,x=_.fnId,P=_.args;switch(x|0){case n.OPS.beginText:this.beginText();break;case n.OPS.dependency:break;case n.OPS.setLeading:this.setLeading(P);break;case n.OPS.setLeadingMoveText:this.setLeadingMoveText(P[0],P[1]);break;case n.OPS.setFont:this.setFont(P);break;case n.OPS.showText:this.showText(P[0]);break;case n.OPS.showSpacedText:this.showText(P[0]);break;case n.OPS.endText:this.endText();break;case n.OPS.moveText:this.moveText(P[0],P[1]);break;case n.OPS.setCharSpacing:this.setCharSpacing(P[0]);break;case n.OPS.setWordSpacing:this.setWordSpacing(P[0]);break;case n.OPS.setHScale:this.setHScale(P[0]);break;case n.OPS.setTextMatrix:this.setTextMatrix(P[0],P[1],P[2],P[3],P[4],P[5]);break;case n.OPS.setTextRise:this.setTextRise(P[0]);break;case n.OPS.setTextRenderingMode:this.setTextRenderingMode(P[0]);break;case n.OPS.setLineWidth:this.setLineWidth(P[0]);break;case n.OPS.setLineJoin:this.setLineJoin(P[0]);break;case n.OPS.setLineCap:this.setLineCap(P[0]);break;case n.OPS.setMiterLimit:this.setMiterLimit(P[0]);break;case n.OPS.setFillRGBColor:this.setFillRGBColor(P[0],P[1],P[2]);break;case n.OPS.setStrokeRGBColor:this.setStrokeRGBColor(P[0],P[1],P[2]);break;case n.OPS.setStrokeColorN:this.setStrokeColorN(P);break;case n.OPS.setFillColorN:this.setFillColorN(P);break;case n.OPS.shadingFill:this.shadingFill(P[0]);break;case n.OPS.setDash:this.setDash(P[0],P[1]);break;case n.OPS.setRenderingIntent:this.setRenderingIntent(P[0]);break;case n.OPS.setFlatness:this.setFlatness(P[0]);break;case n.OPS.setGState:this.setGState(P[0]);break;case n.OPS.fill:this.fill();break;case n.OPS.eoFill:this.eoFill();break;case n.OPS.stroke:this.stroke();break;case n.OPS.fillStroke:this.fillStroke();break;case n.OPS.eoFillStroke:this.eoFillStroke();break;case n.OPS.clip:this.clip("nonzero");break;case n.OPS.eoClip:this.clip("evenodd");break;case n.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case n.OPS.paintImageXObject:this.paintImageXObject(P[0]);break;case n.OPS.paintInlineImageXObject:this.paintInlineImageXObject(P[0]);break;case n.OPS.paintImageMaskXObject:this.paintImageMaskXObject(P[0]);break;case n.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(P[0],P[1]);break;case n.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case n.OPS.closePath:this.closePath();break;case n.OPS.closeStroke:this.closeStroke();break;case n.OPS.closeFillStroke:this.closeFillStroke();break;case n.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case n.OPS.nextLine:this.nextLine();break;case n.OPS.transform:this.transform(P[0],P[1],P[2],P[3],P[4],P[5]);break;case n.OPS.constructPath:this.constructPath(P[0],P[1]);break;case n.OPS.endPath:this.endPath();break;case 92:this.group(_.items);break;default:(0,n.warn)(`Unimplemented operator ${E}`);break}}}setWordSpacing(h){this.current.wordSpacing=h}setCharSpacing(h){this.current.charSpacing=h}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(h,_,E,x,P,k){const Q=this.current;Q.textMatrix=Q.lineMatrix=[h,_,E,x,P,k],Q.textMatrixScale=Math.hypot(h,_),Q.x=Q.lineX=0,Q.y=Q.lineY=0,Q.xcoords=[],Q.ycoords=[],Q.tspan=this.svgFactory.createElement("svg:tspan"),Q.tspan.setAttributeNS(null,"font-family",Q.fontFamily),Q.tspan.setAttributeNS(null,"font-size",`${O(Q.fontSize)}px`),Q.tspan.setAttributeNS(null,"y",O(-Q.y)),Q.txtElement=this.svgFactory.createElement("svg:text"),Q.txtElement.appendChild(Q.tspan)}beginText(){const h=this.current;h.x=h.lineX=0,h.y=h.lineY=0,h.textMatrix=n.IDENTITY_MATRIX,h.lineMatrix=n.IDENTITY_MATRIX,h.textMatrixScale=1,h.tspan=this.svgFactory.createElement("svg:tspan"),h.txtElement=this.svgFactory.createElement("svg:text"),h.txtgrp=this.svgFactory.createElement("svg:g"),h.xcoords=[],h.ycoords=[]}moveText(h,_){const E=this.current;E.x=E.lineX+=h,E.y=E.lineY+=_,E.xcoords=[],E.ycoords=[],E.tspan=this.svgFactory.createElement("svg:tspan"),E.tspan.setAttributeNS(null,"font-family",E.fontFamily),E.tspan.setAttributeNS(null,"font-size",`${O(E.fontSize)}px`),E.tspan.setAttributeNS(null,"y",O(-E.y))}showText(h){const _=this.current,E=_.font,x=_.fontSize;if(x===0)return;const P=_.fontSizeScale,k=_.charSpacing,Q=_.wordSpacing,Ce=_.fontDirection,Oe=_.textHScale*Ce,Se=E.vertical,Fe=Se?1:-1,Ve=E.defaultVMetrics,Le=x*_.fontMatrix[0];let W=0;for(const B of h){if(B===null){W+=Ce*Q;continue}else if(typeof B=="number"){W+=Fe*B*x/1e3;continue}const c=(B.isSpace?Q:0)+k,p=B.fontChar;let R,L,N=B.width;if(Se){let X;const ee=B.vmetric||Ve;X=B.vmetric?ee[1]:N*.5,X=-X*Le;const J=ee[2]*Le;N=ee?-ee[0]:N,R=X/P,L=(W+J)/P}else R=W/P,L=0;(B.isInFont||E.missingFile)&&(_.xcoords.push(_.x+R),Se&&_.ycoords.push(-_.y+L),_.tspan.textContent+=p);let z;Se?z=N*Le-c*Ce:z=N*Le+c*Ce,W+=z}_.tspan.setAttributeNS(null,"x",_.xcoords.map(O).join(" ")),Se?_.tspan.setAttributeNS(null,"y",_.ycoords.map(O).join(" ")):_.tspan.setAttributeNS(null,"y",O(-_.y)),Se?_.y-=W:_.x+=W*Oe,_.tspan.setAttributeNS(null,"font-family",_.fontFamily),_.tspan.setAttributeNS(null,"font-size",`${O(_.fontSize)}px`),_.fontStyle!==A.fontStyle&&_.tspan.setAttributeNS(null,"font-style",_.fontStyle),_.fontWeight!==A.fontWeight&&_.tspan.setAttributeNS(null,"font-weight",_.fontWeight);const T=_.textRenderingMode&n.TextRenderingMode.FILL_STROKE_MASK;if(T===n.TextRenderingMode.FILL||T===n.TextRenderingMode.FILL_STROKE?(_.fillColor!==A.fillColor&&_.tspan.setAttributeNS(null,"fill",_.fillColor),_.fillAlpha<1&&_.tspan.setAttributeNS(null,"fill-opacity",_.fillAlpha)):_.textRenderingMode===n.TextRenderingMode.ADD_TO_PATH?_.tspan.setAttributeNS(null,"fill","transparent"):_.tspan.setAttributeNS(null,"fill","none"),T===n.TextRenderingMode.STROKE||T===n.TextRenderingMode.FILL_STROKE){const B=1/(_.textMatrixScale||1);this._setStrokeAttributes(_.tspan,B)}let m=_.textMatrix;_.textRise!==0&&(m=m.slice(),m[5]+=_.textRise),_.txtElement.setAttributeNS(null,"transform",`${H(m)} scale(${O(Oe)}, -1)`),_.txtElement.setAttributeNS(M,"xml:space","preserve"),_.txtElement.appendChild(_.tspan),_.txtgrp.appendChild(_.txtElement),this._ensureTransformGroup().appendChild(_.txtElement)}setLeadingMoveText(h,_){this.setLeading(-_),this.moveText(h,_)}addFontStyle(h){if(!h.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.appendChild(this.cssStyle));const _=F(h.data,h.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${h.loadedName}"; src: url(${_}); }
`}setFont(h){const _=this.current,E=this.commonObjs.get(h[0]);let x=h[1];_.font=E,this.embedFonts&&!E.missingFile&&!this.embeddedFonts[E.loadedName]&&(this.addFontStyle(E),this.embeddedFonts[E.loadedName]=E),_.fontMatrix=E.fontMatrix||n.FONT_IDENTITY_MATRIX;let P="normal";E.black?P="900":E.bold&&(P="bold");const k=E.italic?"italic":"normal";x<0?(x=-x,_.fontDirection=-1):_.fontDirection=1,_.fontSize=x,_.fontFamily=E.loadedName,_.fontWeight=P,_.fontStyle=k,_.tspan=this.svgFactory.createElement("svg:tspan"),_.tspan.setAttributeNS(null,"y",O(-_.y)),_.xcoords=[],_.ycoords=[]}endText(){var _;const h=this.current;h.textRenderingMode&n.TextRenderingMode.ADD_TO_PATH_FLAG&&((_=h.txtElement)!=null&&_.hasChildNodes())&&(h.element=h.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(h){h>0&&(this.current.lineWidth=h)}setLineCap(h){this.current.lineCap=V[h]}setLineJoin(h){this.current.lineJoin=g[h]}setMiterLimit(h){this.current.miterLimit=h}setStrokeAlpha(h){this.current.strokeAlpha=h}setStrokeRGBColor(h,_,E){this.current.strokeColor=n.Util.makeHexColor(h,_,E)}setFillAlpha(h){this.current.fillAlpha=h}setFillRGBColor(h,_,E){this.current.fillColor=n.Util.makeHexColor(h,_,E),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(h){this.current.strokeColor=this._makeColorN_Pattern(h)}setFillColorN(h){this.current.fillColor=this._makeColorN_Pattern(h)}shadingFill(h){const _=this.viewport.width,E=this.viewport.height,x=n.Util.inverseTransform(this.transformMatrix),P=n.Util.applyTransform([0,0],x),k=n.Util.applyTransform([0,E],x),Q=n.Util.applyTransform([_,0],x),Ce=n.Util.applyTransform([_,E],x),Oe=Math.min(P[0],k[0],Q[0],Ce[0]),Se=Math.min(P[1],k[1],Q[1],Ce[1]),Fe=Math.max(P[0],k[0],Q[0],Ce[0]),Ve=Math.max(P[1],k[1],Q[1],Ce[1]),Le=this.svgFactory.createElement("svg:rect");Le.setAttributeNS(null,"x",Oe),Le.setAttributeNS(null,"y",Se),Le.setAttributeNS(null,"width",Fe-Oe),Le.setAttributeNS(null,"height",Ve-Se),Le.setAttributeNS(null,"fill",this._makeShadingPattern(h)),this.current.fillAlpha<1&&Le.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().appendChild(Le)}_makeColorN_Pattern(h){return h[0]==="TilingPattern"?this._makeTilingPattern(h):this._makeShadingPattern(h)}_makeTilingPattern(h){const _=h[1],E=h[2],x=h[3]||n.IDENTITY_MATRIX,[P,k,Q,Ce]=h[4],Oe=h[5],Se=h[6],Fe=h[7],Ve=`shading${U++}`,[Le,W,T,m]=n.Util.normalizeRect([...n.Util.applyTransform([P,k],x),...n.Util.applyTransform([Q,Ce],x)]),[B,c]=n.Util.singularValueDecompose2dScale(x),p=Oe*B,R=Se*c,L=this.svgFactory.createElement("svg:pattern");L.setAttributeNS(null,"id",Ve),L.setAttributeNS(null,"patternUnits","userSpaceOnUse"),L.setAttributeNS(null,"width",p),L.setAttributeNS(null,"height",R),L.setAttributeNS(null,"x",`${Le}`),L.setAttributeNS(null,"y",`${W}`);const N=this.svg,z=this.transformMatrix,X=this.current.fillColor,ee=this.current.strokeColor,J=this.svgFactory.create(T-Le,m-W);if(this.svg=J,this.transformMatrix=x,Fe===2){const ie=n.Util.makeHexColor(..._);this.current.fillColor=ie,this.current.strokeColor=ie}return this.executeOpTree(this.convertOpList(E)),this.svg=N,this.transformMatrix=z,this.current.fillColor=X,this.current.strokeColor=ee,L.appendChild(J.childNodes[0]),this.defs.appendChild(L),`url(#${Ve})`}_makeShadingPattern(h){switch(typeof h=="string"&&(h=this.objs.get(h)),h[0]){case"RadialAxial":const _=`shading${U++}`,E=h[3];let x;switch(h[1]){case"axial":const P=h[4],k=h[5];x=this.svgFactory.createElement("svg:linearGradient"),x.setAttributeNS(null,"id",_),x.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),x.setAttributeNS(null,"x1",P[0]),x.setAttributeNS(null,"y1",P[1]),x.setAttributeNS(null,"x2",k[0]),x.setAttributeNS(null,"y2",k[1]);break;case"radial":const Q=h[4],Ce=h[5],Oe=h[6],Se=h[7];x=this.svgFactory.createElement("svg:radialGradient"),x.setAttributeNS(null,"id",_),x.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),x.setAttributeNS(null,"cx",Ce[0]),x.setAttributeNS(null,"cy",Ce[1]),x.setAttributeNS(null,"r",Se),x.setAttributeNS(null,"fx",Q[0]),x.setAttributeNS(null,"fy",Q[1]),x.setAttributeNS(null,"fr",Oe);break;default:throw new Error(`Unknown RadialAxial type: ${h[1]}`)}for(const P of E){const k=this.svgFactory.createElement("svg:stop");k.setAttributeNS(null,"offset",P[0]),k.setAttributeNS(null,"stop-color",P[1]),x.appendChild(k)}return this.defs.appendChild(x),`url(#${_})`;case"Mesh":return(0,n.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${h[0]}`)}}setDash(h,_){this.current.dashArray=h,this.current.dashPhase=_}constructPath(h,_){const E=this.current;let x=E.x,P=E.y,k=[],Q=0;for(const Ce of h)switch(Ce|0){case n.OPS.rectangle:x=_[Q++],P=_[Q++];const Oe=_[Q++],Se=_[Q++],Fe=x+Oe,Ve=P+Se;k.push("M",O(x),O(P),"L",O(Fe),O(P),"L",O(Fe),O(Ve),"L",O(x),O(Ve),"Z");break;case n.OPS.moveTo:x=_[Q++],P=_[Q++],k.push("M",O(x),O(P));break;case n.OPS.lineTo:x=_[Q++],P=_[Q++],k.push("L",O(x),O(P));break;case n.OPS.curveTo:x=_[Q+4],P=_[Q+5],k.push("C",O(_[Q]),O(_[Q+1]),O(_[Q+2]),O(_[Q+3]),O(x),O(P)),Q+=6;break;case n.OPS.curveTo2:k.push("C",O(x),O(P),O(_[Q]),O(_[Q+1]),O(_[Q+2]),O(_[Q+3])),x=_[Q+2],P=_[Q+3],Q+=4;break;case n.OPS.curveTo3:x=_[Q+2],P=_[Q+3],k.push("C",O(_[Q]),O(_[Q+1]),O(x),O(P),O(x),O(P)),Q+=4;break;case n.OPS.closePath:k.push("Z");break}k=k.join(" "),E.path&&h.length>0&&h[0]!==n.OPS.rectangle&&h[0]!==n.OPS.moveTo?k=E.path.getAttributeNS(null,"d")+k:(E.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().appendChild(E.path)),E.path.setAttributeNS(null,"d",k),E.path.setAttributeNS(null,"fill","none"),E.element=E.path,E.setCurrentPoint(x,P)}endPath(){const h=this.current;if(h.path=null,!this.pendingClip)return;if(!h.element){this.pendingClip=null;return}const _=`clippath${K++}`,E=this.svgFactory.createElement("svg:clipPath");E.setAttributeNS(null,"id",_),E.setAttributeNS(null,"transform",H(this.transformMatrix));const x=h.element.cloneNode(!0);if(this.pendingClip==="evenodd"?x.setAttributeNS(null,"clip-rule","evenodd"):x.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,E.appendChild(x),this.defs.appendChild(E),h.activeClipUrl){h.clipGroup=null;for(const P of this.extraStack)P.clipGroup=null;E.setAttributeNS(null,"clip-path",h.activeClipUrl)}h.activeClipUrl=`url(#${_})`,this.tgrp=null}clip(h){this.pendingClip=h}closePath(){const h=this.current;if(h.path){const _=`${h.path.getAttributeNS(null,"d")}Z`;h.path.setAttributeNS(null,"d",_)}}setLeading(h){this.current.leading=-h}setTextRise(h){this.current.textRise=h}setTextRenderingMode(h){this.current.textRenderingMode=h}setHScale(h){this.current.textHScale=h/100}setRenderingIntent(h){}setFlatness(h){}setGState(h){for(const[_,E]of h)switch(_){case"LW":this.setLineWidth(E);break;case"LC":this.setLineCap(E);break;case"LJ":this.setLineJoin(E);break;case"ML":this.setMiterLimit(E);break;case"D":this.setDash(E[0],E[1]);break;case"RI":this.setRenderingIntent(E);break;case"FL":this.setFlatness(E);break;case"Font":this.setFont(E);break;case"CA":this.setStrokeAlpha(E);break;case"ca":this.setFillAlpha(E);break;default:(0,n.warn)(`Unimplemented graphic state operator ${_}`);break}}fill(){const h=this.current;h.element&&(h.element.setAttributeNS(null,"fill",h.fillColor),h.element.setAttributeNS(null,"fill-opacity",h.fillAlpha),this.endPath())}stroke(){const h=this.current;h.element&&(this._setStrokeAttributes(h.element),h.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(h,_=1){const E=this.current;let x=E.dashArray;_!==1&&x.length>0&&(x=x.map(function(P){return _*P})),h.setAttributeNS(null,"stroke",E.strokeColor),h.setAttributeNS(null,"stroke-opacity",E.strokeAlpha),h.setAttributeNS(null,"stroke-miterlimit",O(E.miterLimit)),h.setAttributeNS(null,"stroke-linecap",E.lineCap),h.setAttributeNS(null,"stroke-linejoin",E.lineJoin),h.setAttributeNS(null,"stroke-width",O(_*E.lineWidth)+"px"),h.setAttributeNS(null,"stroke-dasharray",x.map(O).join(" ")),h.setAttributeNS(null,"stroke-dashoffset",O(_*E.dashPhase)+"px")}eoFill(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const h=this.svgFactory.createElement("svg:rect");h.setAttributeNS(null,"x","0"),h.setAttributeNS(null,"y","0"),h.setAttributeNS(null,"width","1px"),h.setAttributeNS(null,"height","1px"),h.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().appendChild(h)}paintImageXObject(h){const _=h.startsWith("g_")?this.commonObjs.get(h):this.objs.get(h);if(!_){(0,n.warn)(`Dependent image with object ID ${h} is not ready yet`);return}this.paintInlineImageXObject(_)}paintInlineImageXObject(h,_){const E=h.width,x=h.height,P=I(h,this.forceDataSchema,!!_),k=this.svgFactory.createElement("svg:rect");k.setAttributeNS(null,"x","0"),k.setAttributeNS(null,"y","0"),k.setAttributeNS(null,"width",O(E)),k.setAttributeNS(null,"height",O(x)),this.current.element=k,this.clip("nonzero");const Q=this.svgFactory.createElement("svg:image");Q.setAttributeNS(q,"xlink:href",P),Q.setAttributeNS(null,"x","0"),Q.setAttributeNS(null,"y",O(-x)),Q.setAttributeNS(null,"width",O(E)+"px"),Q.setAttributeNS(null,"height",O(x)+"px"),Q.setAttributeNS(null,"transform",`scale(${O(1/E)} ${O(-1/x)})`),_?_.appendChild(Q):this._ensureTransformGroup().appendChild(Q)}paintImageMaskXObject(h){const _=this.current,E=h.width,x=h.height,P=_.fillColor;_.maskId=`mask${Y++}`;const k=this.svgFactory.createElement("svg:mask");k.setAttributeNS(null,"id",_.maskId);const Q=this.svgFactory.createElement("svg:rect");Q.setAttributeNS(null,"x","0"),Q.setAttributeNS(null,"y","0"),Q.setAttributeNS(null,"width",O(E)),Q.setAttributeNS(null,"height",O(x)),Q.setAttributeNS(null,"fill",P),Q.setAttributeNS(null,"mask",`url(#${_.maskId})`),this.defs.appendChild(k),this._ensureTransformGroup().appendChild(Q),this.paintInlineImageXObject(h,k)}paintFormXObjectBegin(h,_){if(Array.isArray(h)&&h.length===6&&this.transform(h[0],h[1],h[2],h[3],h[4],h[5]),_){const E=_[2]-_[0],x=_[3]-_[1],P=this.svgFactory.createElement("svg:rect");P.setAttributeNS(null,"x",_[0]),P.setAttributeNS(null,"y",_[1]),P.setAttributeNS(null,"width",O(E)),P.setAttributeNS(null,"height",O(x)),this.current.element=P,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(h){const _=this.svgFactory.create(h.width,h.height),E=this.svgFactory.createElement("svg:defs");_.appendChild(E),this.defs=E;const x=this.svgFactory.createElement("svg:g");return x.setAttributeNS(null,"transform",H(h.transform)),_.appendChild(x),this.svg=x,_}_ensureClipGroup(){if(!this.current.clipGroup){const h=this.svgFactory.createElement("svg:g");h.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.appendChild(h),this.current.clipGroup=h}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",H(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().appendChild(this.tgrp):this.svg.appendChild(this.tgrp)),this.tgrp}}}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNodeStream=void 0;var n=t(1),s=t(26);const o=require$$5,a=require$$5,l=require$$5,f=require$$5,d=/^file:\/\/\/[a-zA-Z]:\//;function A(O){const H=f.parse(O);return H.protocol==="file:"||H.host?H:/^[a-z]:[/\\]/i.test(O)?f.parse(`file:///${O}`):(H.host||(H.protocol="file:"),H)}class M{constructor(H){this.source=H,this.url=A(H.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&H.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var H;return((H=this._fullRequestReader)==null?void 0:H._loaded)??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new j(this):new F(this),this._fullRequestReader}getRangeReader(H,K){if(K<=this._progressiveDataLength)return null;const Y=this.isFsUrl?new G(this,H,K):new I(this,H,K);return this._rangeRequestReaders.push(Y),Y}cancelAllRequests(H){this._fullRequestReader&&this._fullRequestReader.cancel(H);for(const K of this._rangeRequestReaders.slice(0))K.cancel(H)}}e.PDFNodeStream=M;class q{constructor(H){this._url=H.url,this._done=!1,this._storedError=null,this.onProgress=null;const K=H.source;this._contentLength=K.length,this._loaded=0,this._filename=null,this._disableRange=K.disableRange||!1,this._rangeChunkSize=K.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!K.disableStream,this._isRangeSupported=!K.disableRange,this._readableStream=null,this._readCapability=(0,n.createPromiseCapability)(),this._headersCapability=(0,n.createPromiseCapability)()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const H=this._readableStream.read();return H===null?(this._readCapability=(0,n.createPromiseCapability)(),this.read()):(this._loaded+=H.length,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(H).buffer,done:!1})}cancel(H){if(!this._readableStream){this._error(H);return}this._readableStream.destroy(H)}_error(H){this._storedError=H,this._readCapability.resolve()}_setReadableStream(H){this._readableStream=H,H.on("readable",()=>{this._readCapability.resolve()}),H.on("end",()=>{H.destroy(),this._done=!0,this._readCapability.resolve()}),H.on("error",K=>{this._error(K)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new n.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class V{constructor(H){this._url=H.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=(0,n.createPromiseCapability)();const K=H.source;this._isStreamingSupported=!K.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const H=this._readableStream.read();return H===null?(this._readCapability=(0,n.createPromiseCapability)(),this.read()):(this._loaded+=H.length,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(H).buffer,done:!1})}cancel(H){if(!this._readableStream){this._error(H);return}this._readableStream.destroy(H)}_error(H){this._storedError=H,this._readCapability.resolve()}_setReadableStream(H){this._readableStream=H,H.on("readable",()=>{this._readCapability.resolve()}),H.on("end",()=>{H.destroy(),this._done=!0,this._readCapability.resolve()}),H.on("error",K=>{this._error(K)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function g(O,H){return{protocol:O.protocol,auth:O.auth,host:O.hostname,port:O.port,path:O.path,method:"GET",headers:H}}class F extends q{constructor(H){super(H);const K=Y=>{if(Y.statusCode===404){const E=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=E,this._headersCapability.reject(E);return}this._headersCapability.resolve(),this._setReadableStream(Y);const U=E=>this._readableStream.headers[E.toLowerCase()],{allowRangeRequests:h,suggestedLength:_}=(0,s.validateRangeRequestCapabilities)({getResponseHeader:U,isHttp:H.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=h,this._contentLength=_||this._contentLength,this._filename=(0,s.extractFilenameFromHeader)(U)};this._request=null,this._url.protocol==="http:"?this._request=a.request(g(this._url,H.httpHeaders),K):this._request=l.request(g(this._url,H.httpHeaders),K),this._request.on("error",Y=>{this._storedError=Y,this._headersCapability.reject(Y)}),this._request.end()}}class I extends V{constructor(H,K,Y){super(H),this._httpHeaders={};for(const h in H.httpHeaders){const _=H.httpHeaders[h];typeof _>"u"||(this._httpHeaders[h]=_)}this._httpHeaders.Range=`bytes=${K}-${Y-1}`;const U=h=>{if(h.statusCode===404){const _=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=_;return}this._setReadableStream(h)};this._request=null,this._url.protocol==="http:"?this._request=a.request(g(this._url,this._httpHeaders),U):this._request=l.request(g(this._url,this._httpHeaders),U),this._request.on("error",h=>{this._storedError=h}),this._request.end()}}class j extends q{constructor(H){super(H);let K=decodeURIComponent(this._url.path);d.test(this._url.href)&&(K=K.replace(/^\//,"")),o.lstat(K,(Y,U)=>{if(Y){Y.code==="ENOENT"&&(Y=new n.MissingPDFException(`Missing PDF "${K}".`)),this._storedError=Y,this._headersCapability.reject(Y);return}this._contentLength=U.size,this._setReadableStream(o.createReadStream(K)),this._headersCapability.resolve()})}}class G extends V{constructor(H,K,Y){super(H);let U=decodeURIComponent(this._url.path);d.test(this._url.href)&&(U=U.replace(/^\//,"")),this._setReadableStream(o.createReadStream(U,{start:K,end:Y-1}))}}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createResponseStatusError=f,e.extractFilenameFromHeader=l,e.validateRangeRequestCapabilities=a,e.validateResponseStatus=d;var n=t(1),s=t(27),o=t(5);function a({getResponseHeader:A,isHttp:M,rangeChunkSize:q,disableRange:V}){const g={allowRangeRequests:!1,suggestedLength:void 0},F=parseInt(A("Content-Length"),10);return!Number.isInteger(F)||(g.suggestedLength=F,F<=2*q)||V||!M||A("Accept-Ranges")!=="bytes"||(A("Content-Encoding")||"identity")!=="identity"||(g.allowRangeRequests=!0),g}function l(A){const M=A("Content-Disposition");if(M){let q=(0,s.getFilenameFromContentDispositionHeader)(M);if(q.includes("%"))try{q=decodeURIComponent(q)}catch{}if((0,o.isPdfFile)(q))return q}return null}function f(A,M){return A===404||A===0&&M.startsWith("file:")?new n.MissingPDFException('Missing PDF "'+M+'".'):new n.UnexpectedResponseException(`Unexpected server response (${A}) while retrieving PDF "${M}".`,A)}function d(A){return A===200||A===206}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getFilenameFromContentDispositionHeader=s;var n=t(1);function s(o){let a=!0,l=f("filename\\*","i").exec(o);if(l){l=l[1];let F=q(l);return F=unescape(F),F=V(F),F=g(F),A(F)}if(l=M(o),l){const F=g(l);return A(F)}if(l=f("filename","i").exec(o),l){l=l[1];let F=q(l);return F=g(F),A(F)}function f(F,I){return new RegExp("(?:^|;)\\s*"+F+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',I)}function d(F,I){if(F){if(!/^[\x00-\xFF]+$/.test(I))return I;try{const j=new TextDecoder(F,{fatal:!0}),G=(0,n.stringToBytes)(I);I=j.decode(G),a=!1}catch{}}return I}function A(F){return a&&/[\x80-\xff]/.test(F)&&(F=d("utf-8",F),a&&(F=d("iso-8859-1",F))),F}function M(F){const I=[];let j;const G=f("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(j=G.exec(F))!==null;){let[,H,K,Y]=j;if(H=parseInt(H,10),H in I){if(H===0)break;continue}I[H]=[K,Y]}const O=[];for(let H=0;H<I.length&&H in I;++H){let[K,Y]=I[H];Y=q(Y),K&&(Y=unescape(Y),H===0&&(Y=V(Y))),O.push(Y)}return O.join("")}function q(F){if(F.startsWith('"')){const I=F.slice(1).split('\\"');for(let j=0;j<I.length;++j){const G=I[j].indexOf('"');G!==-1&&(I[j]=I[j].slice(0,G),I.length=j+1),I[j]=I[j].replace(/\\(.)/g,"$1")}F=I.join('"')}return F}function V(F){const I=F.indexOf("'");if(I===-1)return F;const j=F.slice(0,I),O=F.slice(I+1).replace(/^[^']*'/,"");return d(j,O)}function g(F){return!F.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(F)?F:F.replace(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(I,j,G,O){if(G==="q"||G==="Q")return O=O.replace(/_/g," "),O=O.replace(/=([0-9a-fA-F]{2})/g,function(H,K){return String.fromCharCode(parseInt(K,16))}),d(j,O);try{O=atob(O)}catch{}return d(j,O)})}return""}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNetworkStream=void 0;var n=t(1),s=t(26);const o=200,a=206;function l(q){const V=q.response;return typeof V!="string"?V:(0,n.stringToBytes)(V).buffer}class f{constructor(V,g={}){this.url=V,this.isHttp=/^https?:/i.test(V),this.httpHeaders=this.isHttp&&g.httpHeaders||Object.create(null),this.withCredentials=g.withCredentials||!1,this.getXhr=g.getXhr||function(){return new XMLHttpRequest},this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(V,g,F){const I={begin:V,end:g};for(const j in F)I[j]=F[j];return this.request(I)}requestFull(V){return this.request(V)}request(V){const g=this.getXhr(),F=this.currXhrId++,I=this.pendingRequests[F]={xhr:g};g.open("GET",this.url),g.withCredentials=this.withCredentials;for(const j in this.httpHeaders){const G=this.httpHeaders[j];typeof G>"u"||g.setRequestHeader(j,G)}return this.isHttp&&"begin"in V&&"end"in V?(g.setRequestHeader("Range",`bytes=${V.begin}-${V.end-1}`),I.expectedStatus=a):I.expectedStatus=o,g.responseType="arraybuffer",V.onError&&(g.onerror=function(j){V.onError(g.status)}),g.onreadystatechange=this.onStateChange.bind(this,F),g.onprogress=this.onProgress.bind(this,F),I.onHeadersReceived=V.onHeadersReceived,I.onDone=V.onDone,I.onError=V.onError,I.onProgress=V.onProgress,g.send(null),F}onProgress(V,g){var I;const F=this.pendingRequests[V];F&&((I=F.onProgress)==null||I.call(F,g))}onStateChange(V,g){var H,K,Y;const F=this.pendingRequests[V];if(!F)return;const I=F.xhr;if(I.readyState>=2&&F.onHeadersReceived&&(F.onHeadersReceived(),delete F.onHeadersReceived),I.readyState!==4||!(V in this.pendingRequests))return;if(delete this.pendingRequests[V],I.status===0&&this.isHttp){(H=F.onError)==null||H.call(F,I.status);return}const j=I.status||o;if(!(j===o&&F.expectedStatus===a)&&j!==F.expectedStatus){(K=F.onError)==null||K.call(F,I.status);return}const O=l(I);if(j===a){const U=I.getResponseHeader("Content-Range"),h=/bytes (\d+)-(\d+)\/(\d+)/.exec(U);F.onDone({begin:parseInt(h[1],10),chunk:O})}else O?F.onDone({begin:0,chunk:O}):(Y=F.onError)==null||Y.call(F,I.status)}getRequestXhr(V){return this.pendingRequests[V].xhr}isPendingRequest(V){return V in this.pendingRequests}abortRequest(V){const g=this.pendingRequests[V].xhr;delete this.pendingRequests[V],g.abort()}}class d{constructor(V){this._source=V,this._manager=new f(V.url,{httpHeaders:V.httpHeaders,withCredentials:V.withCredentials}),this._rangeChunkSize=V.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(V){const g=this._rangeRequestReaders.indexOf(V);g>=0&&this._rangeRequestReaders.splice(g,1)}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new A(this._manager,this._source),this._fullRequestReader}getRangeReader(V,g){const F=new M(this._manager,V,g);return F.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(F),F}cancelAllRequests(V){var g;(g=this._fullRequestReader)==null||g.cancel(V);for(const F of this._rangeRequestReaders.slice(0))F.cancel(V)}}e.PDFNetworkStream=d;class A{constructor(V,g){this._manager=V;const F={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=g.url,this._fullRequestId=V.requestFull(F),this._headersReceivedCapability=(0,n.createPromiseCapability)(),this._disableRange=g.disableRange||!1,this._contentLength=g.length,this._rangeChunkSize=g.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const V=this._fullRequestId,g=this._manager.getRequestXhr(V),F=G=>g.getResponseHeader(G),{allowRangeRequests:I,suggestedLength:j}=(0,s.validateRangeRequestCapabilities)({getResponseHeader:F,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});I&&(this._isRangeSupported=!0),this._contentLength=j||this._contentLength,this._filename=(0,s.extractFilenameFromHeader)(F),this._isRangeSupported&&this._manager.abortRequest(V),this._headersReceivedCapability.resolve()}_onDone(V){if(V&&(this._requests.length>0?this._requests.shift().resolve({value:V.chunk,done:!1}):this._cachedChunks.push(V.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(V){this._storedError=(0,s.createResponseStatusError)(V,this._url),this._headersReceivedCapability.reject(this._storedError);for(const g of this._requests)g.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(V){var g;(g=this.onProgress)==null||g.call(this,{loaded:V.loaded,total:V.lengthComputable?V.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const V=(0,n.createPromiseCapability)();return this._requests.push(V),V.promise}cancel(V){this._done=!0,this._headersReceivedCapability.reject(V);for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class M{constructor(V,g,F){this._manager=V;const I={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=V.url,this._requestId=V.requestRange(g,F,I),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var V;(V=this.onClosed)==null||V.call(this,this)}_onDone(V){const g=V.chunk;this._requests.length>0?this._requests.shift().resolve({value:g,done:!1}):this._queuedChunk=g,this._done=!0;for(const F of this._requests)F.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(V){this._storedError=(0,s.createResponseStatusError)(V,this._url);for(const g of this._requests)g.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(V){var g;this.isStreamingSupported||(g=this.onProgress)==null||g.call(this,{loaded:V.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const g=this._queuedChunk;return this._queuedChunk=null,{value:g,done:!1}}if(this._done)return{value:void 0,done:!0};const V=(0,n.createPromiseCapability)();return this._requests.push(V),V.promise}cancel(V){this._done=!0;for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFFetchStream=void 0;var n=t(1),s=t(26);function o(A,M,q){return{method:"GET",headers:A,signal:q==null?void 0:q.signal,mode:"cors",credentials:M?"include":"same-origin",redirect:"follow"}}function a(A){const M=new Headers;for(const q in A){const V=A[q];typeof V>"u"||M.append(q,V)}return M}class l{constructor(M){this.source=M,this.isHttp=/^https?:/i.test(M.url),this.httpHeaders=this.isHttp&&M.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var M;return((M=this._fullRequestReader)==null?void 0:M._loaded)??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new f(this),this._fullRequestReader}getRangeReader(M,q){if(q<=this._progressiveDataLength)return null;const V=new d(this,M,q);return this._rangeRequestReaders.push(V),V}cancelAllRequests(M){this._fullRequestReader&&this._fullRequestReader.cancel(M);for(const q of this._rangeRequestReaders.slice(0))q.cancel(M)}}e.PDFFetchStream=l;class f{constructor(M){this._stream=M,this._reader=null,this._loaded=0,this._filename=null;const q=M.source;this._withCredentials=q.withCredentials||!1,this._contentLength=q.length,this._headersCapability=(0,n.createPromiseCapability)(),this._disableRange=q.disableRange||!1,this._rangeChunkSize=q.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),typeof AbortController<"u"&&(this._abortController=new AbortController),this._isStreamingSupported=!q.disableStream,this._isRangeSupported=!q.disableRange,this._headers=a(this._stream.httpHeaders);const V=q.url;fetch(V,o(this._headers,this._withCredentials,this._abortController)).then(g=>{if(!(0,s.validateResponseStatus)(g.status))throw(0,s.createResponseStatusError)(g.status,V);this._reader=g.body.getReader(),this._headersCapability.resolve();const F=G=>g.headers.get(G),{allowRangeRequests:I,suggestedLength:j}=(0,s.validateRangeRequestCapabilities)({getResponseHeader:F,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=I,this._contentLength=j||this._contentLength,this._filename=(0,s.extractFilenameFromHeader)(F),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new n.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:M,done:q}=await this._reader.read();return q?{value:M,done:q}:(this._loaded+=M.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(M).buffer,done:!1})}cancel(M){this._reader&&this._reader.cancel(M),this._abortController&&this._abortController.abort()}}class d{constructor(M,q,V){this._stream=M,this._reader=null,this._loaded=0;const g=M.source;this._withCredentials=g.withCredentials||!1,this._readCapability=(0,n.createPromiseCapability)(),this._isStreamingSupported=!g.disableStream,typeof AbortController<"u"&&(this._abortController=new AbortController),this._headers=a(this._stream.httpHeaders),this._headers.append("Range",`bytes=${q}-${V-1}`);const F=g.url;fetch(F,o(this._headers,this._withCredentials,this._abortController)).then(I=>{if(!(0,s.validateResponseStatus)(I.status))throw(0,s.createResponseStatusError)(I.status,F);this._readCapability.resolve(),this._reader=I.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:M,done:q}=await this._reader.read();return q?{value:M,done:q}:(this._loaded+=M.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(M).buffer,done:!1})}cancel(M){this._reader&&this._reader.cancel(M),this._abortController&&this._abortController.abort()}}}],__webpack_module_cache__={};function __w_pdfjs_require__(r){var e=__webpack_module_cache__[r];if(e!==void 0)return e.exports;var t=__webpack_module_cache__[r]={exports:{}};return __webpack_modules__[r](t,t.exports,__w_pdfjs_require__),t.exports}var __webpack_exports__={};return(()=>{var r=__webpack_exports__;Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"AnnotationLayer",{enumerable:!0,get:function(){return s.AnnotationLayer}}),Object.defineProperty(r,"AnnotationMode",{enumerable:!0,get:function(){return e.AnnotationMode}}),Object.defineProperty(r,"CMapCompressionType",{enumerable:!0,get:function(){return e.CMapCompressionType}}),Object.defineProperty(r,"GlobalWorkerOptions",{enumerable:!0,get:function(){return o.GlobalWorkerOptions}}),Object.defineProperty(r,"InvalidPDFException",{enumerable:!0,get:function(){return e.InvalidPDFException}}),Object.defineProperty(r,"LoopbackPort",{enumerable:!0,get:function(){return t.LoopbackPort}}),Object.defineProperty(r,"MissingPDFException",{enumerable:!0,get:function(){return e.MissingPDFException}}),Object.defineProperty(r,"OPS",{enumerable:!0,get:function(){return e.OPS}}),Object.defineProperty(r,"PDFDataRangeTransport",{enumerable:!0,get:function(){return t.PDFDataRangeTransport}}),Object.defineProperty(r,"PDFDateString",{enumerable:!0,get:function(){return n.PDFDateString}}),Object.defineProperty(r,"PDFWorker",{enumerable:!0,get:function(){return t.PDFWorker}}),Object.defineProperty(r,"PasswordResponses",{enumerable:!0,get:function(){return e.PasswordResponses}}),Object.defineProperty(r,"PermissionFlag",{enumerable:!0,get:function(){return e.PermissionFlag}}),Object.defineProperty(r,"PixelsPerInch",{enumerable:!0,get:function(){return n.PixelsPerInch}}),Object.defineProperty(r,"RenderingCancelledException",{enumerable:!0,get:function(){return n.RenderingCancelledException}}),Object.defineProperty(r,"SVGGraphics",{enumerable:!0,get:function(){return f.SVGGraphics}}),Object.defineProperty(r,"UNSUPPORTED_FEATURES",{enumerable:!0,get:function(){return e.UNSUPPORTED_FEATURES}}),Object.defineProperty(r,"UnexpectedResponseException",{enumerable:!0,get:function(){return e.UnexpectedResponseException}}),Object.defineProperty(r,"Util",{enumerable:!0,get:function(){return e.Util}}),Object.defineProperty(r,"VerbosityLevel",{enumerable:!0,get:function(){return e.VerbosityLevel}}),Object.defineProperty(r,"XfaLayer",{enumerable:!0,get:function(){return d.XfaLayer}}),Object.defineProperty(r,"build",{enumerable:!0,get:function(){return t.build}}),Object.defineProperty(r,"createPromiseCapability",{enumerable:!0,get:function(){return e.createPromiseCapability}}),Object.defineProperty(r,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return e.createValidAbsoluteUrl}}),Object.defineProperty(r,"getDocument",{enumerable:!0,get:function(){return t.getDocument}}),Object.defineProperty(r,"getFilenameFromUrl",{enumerable:!0,get:function(){return n.getFilenameFromUrl}}),Object.defineProperty(r,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return n.getPdfFilenameFromUrl}}),Object.defineProperty(r,"getXfaPageViewport",{enumerable:!0,get:function(){return n.getXfaPageViewport}}),Object.defineProperty(r,"isPdfFile",{enumerable:!0,get:function(){return n.isPdfFile}}),Object.defineProperty(r,"loadScript",{enumerable:!0,get:function(){return n.loadScript}}),Object.defineProperty(r,"renderTextLayer",{enumerable:!0,get:function(){return l.renderTextLayer}}),Object.defineProperty(r,"shadow",{enumerable:!0,get:function(){return e.shadow}}),Object.defineProperty(r,"version",{enumerable:!0,get:function(){return t.version}});var e=__w_pdfjs_require__(1),t=__w_pdfjs_require__(4),n=__w_pdfjs_require__(5),s=__w_pdfjs_require__(20),o=__w_pdfjs_require__(13),a=__w_pdfjs_require__(3),l=__w_pdfjs_require__(23),f=__w_pdfjs_require__(24),d=__w_pdfjs_require__(22);if(a.isNodeJS){const{PDFNodeStream:A}=__w_pdfjs_require__(25);(0,t.setPDFNetworkStreamFactory)(M=>new A(M))}else{const{PDFNetworkStream:A}=__w_pdfjs_require__(28),{PDFFetchStream:M}=__w_pdfjs_require__(29);(0,t.setPDFNetworkStreamFactory)(q=>(0,n.isValidFetchUrl)(q.url)?new M(q):new A(q))}})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports;pdfExports.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.worker.min.js";async function setupPdfSummarizer(){removeHistory();const r=initializeApp(firebaseConfig),e=getVertexAI(r),t=getGenerativeModel(e,{model:"gemini-1.5-flash-preview-0514"}),n=document.getElementById("fileInput"),s=document.getElementById("uploadBtn"),o=document.getElementById("pdfResponseText"),a=document.getElementById("pdfResponse"),l=document.getElementById("pdfLoading"),f=document.getElementById("pdfQuestionField"),d=document.getElementById("askQuestionBtn");s.addEventListener("click",async()=>{var q;const M=(q=n.files)==null?void 0:q[0];if(!M){updateResponse(o,"Please upload a valid PDF file.",l,a);return}try{l.style.display="block",a.style.display="none";const V=await A(M);console.log("Extracted PDF text:",V),updateResponse(o,"Pdf is uploaded, Enter prompt to continue",l,a)}catch(V){console.error("Error during PDF summarization:",V),updateResponse(o,"Error processing the PDF. Please try again.",l,a)}}),d.addEventListener("click",async()=>{var q;const M=f.value.trim();if(!M){updateResponse(o,"Please enter a question about the PDF.",l,a);return}try{const V=await A((q=n.files)==null?void 0:q[0]);console.log("Extracted PDF text:",V),await generateResponse(t,`Answer the question based on this PDF: ${M} => ${V}`,o,l,a)}catch(V){console.error("Error during question answering:",V),updateResponse(o,"Error processing the PDF. Please try again.",l,a)}});function A(M){return new Promise((q,V)=>{const g=new FileReader;g.onload=async F=>{var I;try{const j=new Uint8Array((I=F.target)==null?void 0:I.result),G=await pdfExports.getDocument(j).promise;let O="";for(let H=1;H<=G.numPages;H++){const Y=await(await G.getPage(H)).getTextContent();O+=Y.items.map(U=>U.str).join(" ")+`
`}q(O)}catch(j){V("Error extracting text from PDF: "+j)}},g.onerror=()=>{V("Error reading PDF file.")},g.readAsArrayBuffer(M)})}}async function setupHistory(){const r=initializeApp(firebaseConfig),e=getFirestore(r),t=collection(e,"model_interactions"),n=document.createElement("div");n.id="historyContainer",n.style.marginTop="20px",n.style.padding="10px",n.style.border="1px solid #ddd",n.style.borderRadius="8px",n.style.backgroundColor="#f9f9f9",n.innerHTML="<h2>Interaction History:</h2>";try{(await getDocs(t)).forEach(a=>{const l=a.data(),f=l.request||"No Request",d=l.response||"No Response",A=document.createElement("div");A.style.marginBottom="10px",A.innerHTML=`
        <p><strong>Request:</strong> ${f}</p>
        <p><strong>Response:</strong> ${d}</p>
        <hr />
      `,n.appendChild(A)})}catch(o){console.error("Error fetching history:",o);const a=document.createElement("p");a.textContent="Failed to load history.",n.appendChild(a)}const s=document.querySelector(".container");s&&s.appendChild(n)}function main(){removeHistory();const r=document.getElementById("normalPromptBtn"),e=document.getElementById("pdfSummarizerBtn"),t=document.getElementById("showHistoryBtn");r.addEventListener("click",setupPromptGenerator),e.addEventListener("click",setupPdfSummarizer),t.addEventListener("click",setupHistory)}main();
